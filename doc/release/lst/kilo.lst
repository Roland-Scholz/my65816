  Sun Jan  9 2022 20:39                                                Page 1


                     ***************************************
                     **      WDC 65C816 Macro Assembler   **
                     **                                   **
                     **     Version 3.49.1- Feb  6 2006    **
                     ***************************************

     1                        ;:ts=8
     2             00000001   R0	equ	1
     3             00000005   R1	equ	5
     4             00000009   R2	equ	9
     5             0000000D   R3	equ	13
     6                        ;/* Kilo -- A very simple editor in less than 1-ki
                    lo lines of code (as counted
     7                        ; *         by "cloc"). Does not depend on libcurs
                    es, directly emits VT100
     8                        ; *         escapes on the terminal.
     9                        ; *
    10                        ; * ----------------------------------------------
                    -------------------------
    11                        ; *
    12                        ; * Copyright (C) 2016 Salvatore Sanfilippo <antir
                    ez at gmail dot com>
    13                        ; *
    14                        ; * All rights reserved.
    15                        ; *
    16                        ; * Redistribution and use in source and binary fo
                    rms, with or without
    17                        ; * modification, are permitted provided that the 
                    following conditions are
    18                        ; * met:
    19                        ; *
    20                        ; *  *  Redistributions of source code must retain
                     the above copyright
    21                        ; *     notice, this list of conditions and the fo
                    llowing disclaimer.
    22                        ; *
    23                        ; *  *  Redistributions in binary form must reprod
                    uce the above copyright
    24                        ; *     notice, this list of conditions and the fo
                    llowing disclaimer in the
    25                        ; *     documentation and/or other materials provi
                    ded with the distribution.
    26                        ; *
    27                        ; * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOL
                    DERS AND CONTRIBUTORS
    28                        ; * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
                     INCLUDING, BUT NOT
    29                        ; * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANT
                    ABILITY AND FITNESS FOR
    30                        ; * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVE
                    NT SHALL THE COPYRIGHT
    31                        ; * HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIREC
                    T, INDIRECT, INCIDENTAL,
    32                        ; * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (
                    INCLUDING, BUT NOT
    33                        ; * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
                     SERVICES; LOSS OF USE,
    34                        ; * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HO
  Sun Jan  9 2022 20:39                                                Page 2


                    WEVER CAUSED AND ON ANY
    35                        ; * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRI
                    CT LIABILITY, OR TORT
    36                        ; * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
                     ANY WAY OUT OF THE USE
    37                        ; * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSI
                    BILITY OF SUCH DAMAGE.
    38                        ; */
    39                        ;
    40                        ;#include <stdio.h>
    41                        ;#include <stdlib.h>
    42                        ;#include <string.h>
    43                        ;#include <stdbool.h>
    44                        ;#include <errno.h>
    45                        ;#include <unistd.h>
    46                        ;#include <dirent.h>
    47                        ;
    48                        ;#include "freeRTOS.h"
    49                        ;#include "task.h"
    50                        ;#include <homebrew.h>
    51                        ;
    52                        ;
    53                        ;#define KILO_VERSION "0.0.1"
    54                        ;
    55                        ;#define SCREENADR 0x7FF000
    56                        ;#define FALSE 0
    57                        ;#define TRUE !FALSE
    58                        ;
    59                        ;
    60                        ;/* Syntax highlight types */
    61                        ;#define HL_NORMAL 0
    62                        ;#define HL_NONPRINT 1
    63                        ;#define HL_COMMENT 2   /* Single line comment. */
    64                        ;#define HL_MLCOMMENT 3 /* Multi-line comment. */
    65                        ;#define HL_KEYWORD1 4
    66                        ;#define HL_KEYWORD2 5
    67                        ;#define HL_STRING 6
    68                        ;#define HL_NUMBER 7
    69                        ;#define HL_MATCH 8      /* Search match. */
    70                        ;
    71                        ;#define HL_HIGHLIGHT_STRINGS (1<<0)
    72                        ;#define HL_HIGHLIGHT_NUMBERS (1<<1)
    73                        ;
    74                        ;
    75                        ;struct editorSyntax {
    76                        ;    char **filematch;
    77                        ;    char **keywords;
    78                        ;    char singleline_comment_start[2];
    79                        ;    char multiline_comment_start[3];
    80                        ;    char multiline_comment_end[3];
    81                        ;    int flags;
    82                        ;};
    83                        ;
    84                        ;/* This structure represents a single line of the
                     file we are editing. */
    85                        ;typedef struct erow {
    86                        ;    int idx;            /* Row index in the file,
                     zero-based. */
  Sun Jan  9 2022 20:39                                                Page 3


    87                        ;    int size;           /* Size of the row, exclu
                    ding the null term. */
    88                        ;    int rsize;          /* Size of the rendered r
                    ow. */
    89                        ;    char *chars;        /* Row content. */
    90                        ;    char *render;       /* Row content "rendered"
                     for screen (for TABs). */
    91                        ;    unsigned char *hl;  /* Syntax highlight type 
                    for each character in render.*/
    92                        ;    int hl_oc;          /* Row had open comment a
                    t end in last syntax highlight
    93                        ;                           check. */
    94                        ;} erow;
    95                        ;
    96                        ;typedef struct hlcolor {
    97                        ;    int r,g,b;
    98                        ;} hlcolor;
    99                        ;
   100                        ;struct editorConfig {
   101                        ;    unsigned int cx,cy;  /* Cursor x and y positi
                    on in characters */
   102                        ;    unsigned int rowoff;     /* Offset of row dis
                    played. */
   103                        ;    unsigned int coloff;     /* Offset of column 
                    displayed. */
   104                        ;    unsigned int screenrows; /* Number of rows th
                    at we can show */
   105                        ;    unsigned int screencols; /* Number of cols th
                    at we can show */
   106                        ;    unsigned int numrows;    /* Number of rows */
   107                        ;    unsigned int rawmode;    /* Is terminal raw m
                    ode enabled? */
   108                        ;    erow *row;      /* Rows */
   109                        ;    unsigned int dirty;      /* File modified but
                     not saved. */
   110                        ;	unsigned int readonly;
   111                        ;	unsigned int hex;
   112                        ;    char *filename; /* Currently open filename */
   113                        ;    char statusmsg[80];
   114                        ;    time_t statusmsg_time;
   115                        ;    struct editorSyntax *syntax;    /* Current sy
                    ntax highlight, or NULL. */
   116                        ;	unsigned int rowsavail;
   117                        ;};
   118                        ;
   119                        ;static struct editorConfig E;
   120                        ;static int end;
   121                        ;static char status[81];
   122                        ;
   123                        ;enum KEY_ACTION{
   124                        ;        KEY_NULL = 0,       /* NULL */
   125                        ;		CTRL_B = 2,
   126                        ;        CTRL_C = 3,         /* Ctrl-c */
   127                        ;        CTRL_D = 4,         /* Ctrl-d */
   128                        ;		CTRL_E = 5,			/* Ctrl-
                    e */
   129                        ;        CTRL_F = 6,         /* Ctrl-f */
   130                        ;        CTRL_H = 8,         /* Ctrl-h */
  Sun Jan  9 2022 20:39                                                Page 4


   131                        ;        TAB = 9,            /* Tab */
   132                        ;        CTRL_L = 12,        /* Ctrl+l */
   133                        ;        CTRL_N = 14,        /* Ctrl+n */
   134                        ;        ENTER = 10,         /* Enter */
   135                        ;        CTRL_Q = 17,        /* Ctrl-q */
   136                        ;        CTRL_S = 19,        /* Ctrl-s */
   137                        ;        CTRL_U = 21,        /* Ctrl-u */
   138                        ;        CTRL_X = 24,        /* Ctrl-x */
   139                        ;        ESC = 27,           /* Escape */
   140                        ;        BACKSPACE =  127,   /* Backspace */
   141                        ;        /* The following are just soft codes, not
                     really reported by the
   142                        ;         * terminal directly. */
   143                        ;        ARROW_LEFT = 1000,
   144                        ;        ARROW_RIGHT,
   145                        ;        ARROW_UP,
   146                        ;        ARROW_DOWN,
   147                        ;        DEL_KEY,
   148                        ;        HOME_KEY,
   149                        ;        END_KEY,
   150                        ;        PAGE_UP,
   151                        ;        PAGE_DOWN,
   152                        ;		HOME_LINE,
   153                        ;		END_LINE
   154                        ;};
   155                        ;
   156                        ;void editorSetStatusMessage(const char *fmt, ...)
                    ;
   157                        ;void editorRefreshScreen(void);
   158                        ;
   159                        ;//unsigned char *ucHeap16 = (unsigned char *)0x0A
                    000;
   160                        ;//unsigned char *ucHeap = (unsigned char *)0x0100
                    00;
   161                        ;//extern unsigned char fd2iocb[8];
   162                        ;
   163                        ;time_t time(time_t *t) {
   164                        	code
   165                        	xdef	~~time
   166                        	func
   167                        ~~time:
   168                        	longa	on
   169                        	longi	on
   170 00:0000: 3B           	tsc
   171 00:0001: 38           	sec
   172 00:0002: E9 00 00     	sbc	#L2
   173 00:0005: 1B           	tcs
   174 00:0006: 0B           	phd
   175 00:0007: 5B           	tcd
   176             00000004   t_0	set	4
   177                        ;	return 0;
   178 00:0008: A9 00 00     	lda	#$0
   179 00:000B: AA           	tax
   180 00:000C: A8           	tay
   181 00:000D: A5 02        	lda	<L2+2
   182 00:000F: 85 06        	sta	<L2+2+4
   183 00:0011: A5 01        	lda	<L2+1
   184 00:0013: 85 05        	sta	<L2+1+4
  Sun Jan  9 2022 20:39                                                Page 5


   185 00:0015: 2B           	pld
   186 00:0016: 3B           	tsc
   187 00:0017: 18           	clc
   188 00:0018: 69 04 00     	adc	#L2+4
   189 00:001B: 1B           	tcs
   190 00:001C: 98           	tya
   191 00:001D: 6B           	rtl
   192                        ;}
   193             00000000   L2	equ	0
   194             00000001   L3	equ	1
   195                        	ends
   196                        	efunc
   197                        ;int tcgetattr(int fd, struct termios *termios_p) 
                    {
   198                        	code
   199                        	xdef	~~tcgetattr
   200                        	func
   201                        ~~tcgetattr:
   202                        	longa	on
   203                        	longi	on
   204 00:001E: 3B           	tsc
   205 00:001F: 38           	sec
   206 00:0020: E9 00 00     	sbc	#L5
   207 00:0023: 1B           	tcs
   208 00:0024: 0B           	phd
   209 00:0025: 5B           	tcd
   210             00000004   fd_0	set	4
   211             00000006   termios_p_0	set	6
   212                        ;	return 1;
   213 00:0026: A9 01 00     	lda	#$1
   214 00:0029: A8           	tay
   215 00:002A: A5 02        	lda	<L5+2
   216 00:002C: 85 08        	sta	<L5+2+6
   217 00:002E: A5 01        	lda	<L5+1
   218 00:0030: 85 07        	sta	<L5+1+6
   219 00:0032: 2B           	pld
   220 00:0033: 3B           	tsc
   221 00:0034: 18           	clc
   222 00:0035: 69 06 00     	adc	#L5+6
   223 00:0038: 1B           	tcs
   224 00:0039: 98           	tya
   225 00:003A: 6B           	rtl
   226                        ;}
   227             00000000   L5	equ	0
   228             00000001   L6	equ	1
   229                        	ends
   230                        	efunc
   231                        ;
   232                        ;int tcsetattr(int fd, int optional_actions, struc
                    t termios *termios_p) {
   233                        	code
   234                        	xdef	~~tcsetattr
   235                        	func
   236                        ~~tcsetattr:
   237                        	longa	on
   238                        	longi	on
   239 00:003B: 3B           	tsc
   240 00:003C: 38           	sec
  Sun Jan  9 2022 20:39                                                Page 6


   241 00:003D: E9 00 00     	sbc	#L8
   242 00:0040: 1B           	tcs
   243 00:0041: 0B           	phd
   244 00:0042: 5B           	tcd
   245             00000004   fd_0	set	4
   246             00000006   optional_actions_0	set	6
   247             00000008   termios_p_0	set	8
   248                        ;	return 1;
   249 00:0043: A9 01 00     	lda	#$1
   250 00:0046: A8           	tay
   251 00:0047: A5 02        	lda	<L8+2
   252 00:0049: 85 0A        	sta	<L8+2+8
   253 00:004B: A5 01        	lda	<L8+1
   254 00:004D: 85 09        	sta	<L8+1+8
   255 00:004F: 2B           	pld
   256 00:0050: 3B           	tsc
   257 00:0051: 18           	clc
   258 00:0052: 69 08 00     	adc	#L8+8
   259 00:0055: 1B           	tcs
   260 00:0056: 98           	tya
   261 00:0057: 6B           	rtl
   262                        ;}
   263             00000000   L8	equ	0
   264             00000001   L9	equ	1
   265                        	ends
   266                        	efunc
   267                        ;
   268                        ;void exit(int status) {
   269                        	code
   270                        	xdef	~~exit
   271                        	func
   272                        ~~exit:
   273                        	longa	on
   274                        	longi	on
   275 00:0058: 3B           	tsc
   276 00:0059: 38           	sec
   277 00:005A: E9 00 00     	sbc	#L11
   278 00:005D: 1B           	tcs
   279 00:005E: 0B           	phd
   280 00:005F: 5B           	tcd
   281             00000004   status_0	set	4
   282                        ;}
   283 00:0060: A5 02        	lda	<L11+2
   284 00:0062: 85 04        	sta	<L11+2+2
   285 00:0064: A5 01        	lda	<L11+1
   286 00:0066: 85 03        	sta	<L11+1+2
   287 00:0068: 2B           	pld
   288 00:0069: 3B           	tsc
   289 00:006A: 18           	clc
   290 00:006B: 69 02 00     	adc	#L11+2
   291 00:006E: 1B           	tcs
   292 00:006F: 6B           	rtl
   293             00000000   L11	equ	0
   294             00000001   L12	equ	1
   295                        	ends
   296                        	efunc
   297                        ;
   298                        ;void toggleHex() {
  Sun Jan  9 2022 20:39                                                Page 7


   299                        	code
   300                        	xdef	~~toggleHex
   301                        	func
   302                        ~~toggleHex:
   303                        	longa	on
   304                        	longi	on
   305                        ;	if (E.hex) E.hex = 0;
   306 00:0070: AD xx xx     	lda	|~~E+24
   307 00:0073: F0 05        	beq	L10001
   308 00:0075: 9C xx xx     	stz	|~~E+24
   309                        ;	else E.hex++;
   310 00:0078: 80 03        	bra	L17
   311                        L10001:
   312 00:007A: EE xx xx     	inc	|~~E+24
   313                        ;}
   314                        L17:
   315 00:007D: 6B           	rtl
   316             00000000   L14	equ	0
   317             00000001   L15	equ	1
   318                        	ends
   319                        	efunc
   320                        ;
   321                        ;#if 0
   322                        ;/* =========================== Syntax highlights 
                    DB =========================
   323                        ; *
   324                        ; * In order to add a new syntax, define two array
                    s with a list of file name
   325                        ; * matches and keywords. The file name matches ar
                    e used in order to match
   326                        ; * a given syntax with a given file name: if a ma
                    tch pattern starts with a
   327                        ; * dot, it is matched as the last past of the fil
                    ename, for example ".c".
   328                        ; * Otherwise the pattern is just searched inside 
                    the filenme, like "Makefile").
   329                        ; *
   330                        ; * The list of keywords to highlight is just a li
                    st of words, however if they
   331                        ; * a trailing '|' character is added at the end, 
                    they are highlighted in
   332                        ; * a different color, so that you can have two di
                    fferent sets of keywords.
   333                        ; *
   334                        ; * Finally add a stanza in the HLDB global variab
                    le with two two arrays
   335                        ; * of strings, and a set of flags in order to ena
                    ble highlighting of
   336                        ; * comments and numbers.
   337                        ; *
   338                        ; * The characters for single and multi line comme
                    nts must be exactly two
   339                        ; * and must be provided as well (see the C langua
                    ge example).
   340                        ; *
   341                        ; * There is no support to highlight patterns curr
                    ently. */
   342                        ;
  Sun Jan  9 2022 20:39                                                Page 8


   343                        ;/* C / C++ */
   344                        ;char *C_HL_extensions[] = {".c",".cpp",NULL};
   345                        ;char *C_HL_keywords[] = {
   346                        ;        /* A few C / C++ keywords */
   347                        ;        "switch","if","while","for","break","cont
                    inue","return","else",
   348                        ;        "struct","union","typedef","static","enum
                    ","class",
   349                        ;        /* C types */
   350                        ;        "int|","long|","double|","float|","char|"
                    ,"unsigned|","signed|",
   351                        ;        "void|",NULL
   352                        ;};
   353                        ;
   354                        ;/* Here we define an array of syntax highlights b
                    y extensions, keywords,
   355                        ; * comments delimiters and flags. */
   356                        ;struct editorSyntax HLDB[] = {
   357                        ;    {
   358                        ;        /* C / C++ */
   359                        ;        C_HL_extensions,
   360                        ;        C_HL_keywords,
   361                        ;        "//","/*","*/",
   362                        ;        HL_HIGHLIGHT_STRINGS | HL_HIGHLIGHT_NUMBE
                    RS
   363                        ;    }
   364                        ;};
   365                        ;
   366                        ;#define HLDB_ENTRIES (sizeof(HLDB)/sizeof(HLDB[0]
                    ))
   367                        ;
   368                        ;/* ====================== Syntax highlight color 
                    scheme  ==================== */
   369                        ;
   370                        ;int is_separator(int c) {
   371                        ;    return c == '\0' || isspace(c) || strchr(",.(
                    )+-/*=~%[];",c) != NULL;
   372                        ;}
   373                        ;
   374                        ;/* Return true if the specified row last char is 
                    part of a multi line comment
   375                        ; * that starts at this row or at one before, and 
                    does not end at the end
   376                        ; * of the row but spawns to the next row. */
   377                        ;int editorRowHasOpenComment(erow *row) {
   378                        ;    if (row->hl && row->rsize && row->hl[row->rsi
                    ze-1] == HL_MLCOMMENT &&
   379                        ;        (row->rsize < 2 || (row->render[row->rsiz
                    e-2] != '*' ||
   380                        ;                            row->render[row->rsiz
                    e-1] != '/'))) return 1;
   381                        ;    return 0;
   382                        ;}
   383                        ;
   384                        ;
   385                        ;/* Select the syntax highlight scheme depending o
                    n the filename,
   386                        ; * setting it in the global state E.syntax. */
  Sun Jan  9 2022 20:39                                                Page 9


   387                        ;void editorSelectSyntaxHighlight(char *filename) 
                    {
   388                        ;    struct editorSyntax *s;
   389                        ;    unsigned int i;
   390                        ;    char *p;
   391                        ;    int patlen;
   392                        ;    unsigned int j;
   393                        ;
   394                        ;    for (j = 0; j < HLDB_ENTRIES; j++) {
   395                        ;        s = HLDB+j;
   396                        ;        i = 0;
   397                        ;        while(s->filematch[i]) {
   398                        ;            patlen = strlen(s->filematch[i]);
   399                        ;            if ((p = strstr(filename,s->filematch
                    [i])) != NULL) {
   400                        ;                if (s->filematch[i][0] != '.' || 
                    p[patlen] == '\0') {
   401                        ;                    E.syntax = s;
   402                        ;                    return;
   403                        ;                }
   404                        ;            }
   405                        ;            i++;
   406                        ;        }
   407                        ;    }
   408                        ;}
   409                        ;
   410                        ;/* Set every byte of row->hl (that corresponds to
                     every character in the line)
   411                        ; * to the right syntax highlight type (HL_* defin
                    es). */
   412                        ;void editorUpdateSyntax(erow *row) {
   413                        ;    int i, prev_sep, in_string, in_comment, j, kl
                    en, kw2;
   414                        ;    char *p;
   415                        ;    char **keywords;
   416                        ;    char *scs;
   417                        ;    char *mcs;
   418                        ;    char *mce;  
   419                        ;    int oc;
   420                        ;    
   421                        ;    row->hl = realloc(row->hl,row->rsize);
   422                        ;    memset(row->hl,HL_NORMAL,row->rsize);
   423                        ;
   424                        ;    if (E.syntax == NULL) return; /* No syntax, e
                    verything is HL_NORMAL. */
   425                        ;
   426                        ;    
   427                        ;    keywords = E.syntax->keywords;
   428                        ;    scs = E.syntax->singleline_comment_start;
   429                        ;    mcs = E.syntax->multiline_comment_start;
   430                        ;    mce = E.syntax->multiline_comment_end;
   431                        ;
   432                        ;    /* Point to the first non-space char. */
   433                        ;    p = row->render;
   434                        ;    i = 0; /* Current char offset */
   435                        ;    while(*p && isspace(*p)) {
   436                        ;        p++;
   437                        ;        i++;
  Sun Jan  9 2022 20:39                                                Page 10


   438                        ;    }
   439                        ;    prev_sep = 1; /* Tell the parser if 'i' point
                    s to start of word. */
   440                        ;    in_string = 0; /* Are we inside "" or '' ? */
   441                        ;    in_comment = 0; /* Are we inside multi-line c
                    omment? */
   442                        ;
   443                        ;    /* If the previous line has an open comment, 
                    this line starts
   444                        ;     * with an open comment state. */
   445                        ;    if (row->idx > 0 && editorRowHasOpenComment(&
                    E.row[row->idx-1]))
   446                        ;        in_comment = 1;
   447                        ;
   448                        ;    while(*p) {
   449                        ;        /* Handle // comments. */
   450                        ;        if (prev_sep && *p == scs[0] && *(p+1) ==
                     scs[1]) {
   451                        ;            /* From here to end is a comment */
   452                        ;            memset(row->hl+i,HL_COMMENT,row->size
                    -i);
   453                        ;            return;
   454                        ;        }
   455                        ;
   456                        ;        /* Handle multi line comments. */
   457                        ;        if (in_comment) {
   458                        ;            row->hl[i] = HL_MLCOMMENT;
   459                        ;            if (*p == mce[0] && *(p+1) == mce[1])
                     {
   460                        ;                row->hl[i+1] = HL_MLCOMMENT;
   461                        ;                p += 2; i += 2;
   462                        ;                in_comment = 0;
   463                        ;                prev_sep = 1;
   464                        ;                continue;
   465                        ;            } else {
   466                        ;                prev_sep = 0;
   467                        ;                p++; i++;
   468                        ;                continue;
   469                        ;            }
   470                        ;        } else if (*p == mcs[0] && *(p+1) == mcs[
                    1]) {
   471                        ;            row->hl[i] = HL_MLCOMMENT;
   472                        ;            row->hl[i+1] = HL_MLCOMMENT;
   473                        ;            p += 2; i += 2;
   474                        ;            in_comment = 1;
   475                        ;            prev_sep = 0;
   476                        ;            continue;
   477                        ;        }
   478                        ;
   479                        ;        /* Handle "" and '' */
   480                        ;        if (in_string) {
   481                        ;            row->hl[i] = HL_STRING;
   482                        ;            if (*p == '\\') {
   483                        ;                row->hl[i+1] = HL_STRING;
   484                        ;                p += 2; i += 2;
   485                        ;                prev_sep = 0;
   486                        ;                continue;
   487                        ;            }
  Sun Jan  9 2022 20:39                                                Page 11


   488                        ;            if (*p == in_string) in_string = 0;
   489                        ;            p++; i++;
   490                        ;            continue;
   491                        ;        } else {
   492                        ;            if (*p == '"' || *p == '\'') {
   493                        ;                in_string = *p;
   494                        ;                row->hl[i] = HL_STRING;
   495                        ;                p++; i++;
   496                        ;                prev_sep = 0;
   497                        ;                continue;
   498                        ;            }
   499                        ;        }
   500                        ;
   501                        ;        /* Handle non printable chars. */
   502                        ;        if (!isprint(*p)) {
   503                        ;            row->hl[i] = HL_NONPRINT;
   504                        ;            p++; i++;
   505                        ;            prev_sep = 0;
   506                        ;            continue;
   507                        ;        }
   508                        ;
   509                        ;        /* Handle numbers */
   510                        ;        if ((isdigit(*p) && (prev_sep || row->hl[
                    i-1] == HL_NUMBER)) ||
   511                        ;            (*p == '.' && i >0 && row->hl[i-1] ==
                     HL_NUMBER)) {
   512                        ;            row->hl[i] = HL_NUMBER;
   513                        ;            p++; i++;
   514                        ;            prev_sep = 0;
   515                        ;            continue;
   516                        ;        }
   517                        ;
   518                        ;        /* Handle keywords and lib calls */
   519                        ;        if (prev_sep) {
   520                        ;            for (j = 0; keywords[j]; j++) {
   521                        ;                klen = strlen(keywords[j]);
   522                        ;                kw2 = keywords[j][klen-1] == '|';
   523                        ;                if (kw2) klen--;
   524                        ;
   525                        ;                if (!memcmp(p,keywords[j],klen) &
                    &
   526                        ;                    is_separator(*(p+klen)))
   527                        ;                {
   528                        ;                    /* Keyword */
   529                        ;                    memset(row->hl+i,kw2 ? HL_KEY
                    WORD2 : HL_KEYWORD1,klen);
   530                        ;                    p += klen;
   531                        ;                    i += klen;
   532                        ;                    break;
   533                        ;                }
   534                        ;            }
   535                        ;            if (keywords[j] != NULL) {
   536                        ;                prev_sep = 0;
   537                        ;                continue; /* We had a keyword mat
                    ch */
   538                        ;            }
   539                        ;        }
   540                        ;
  Sun Jan  9 2022 20:39                                                Page 12


   541                        ;        /* Not special chars */
   542                        ;        prev_sep = is_separator(*p);
   543                        ;        p++; i++;
   544                        ;    }
   545                        ;
   546                        ;    /* Propagate syntax change to the next row if
                     the open commen
   547                        ;     * state changed. This may recursively affect
                     all the following rows
   548                        ;     * in the file. */
   549                        ;    oc = editorRowHasOpenComment(row);
   550                        ;    if (row->hl_oc != oc && row->idx+1 < E.numrow
                    s)
   551                        ;        editorUpdateSyntax(&E.row[row->idx+1]);
   552                        ;    row->hl_oc = oc;
   553                        ;}
   554                        ;
   555                        ;/* Maps syntax highlight token types to terminal 
                    colors. */
   556                        ;int editorSyntaxToColor(int hl) {
   557                        ;    switch(hl) {
   558                        ;    case HL_COMMENT:
   559                        ;    case HL_MLCOMMENT: return 36;     /* cyan */
   560                        ;    case HL_KEYWORD1: return 33;    /* yellow */
   561                        ;    case HL_KEYWORD2: return 32;    /* green */
   562                        ;    case HL_STRING: return 35;      /* magenta */
   563                        ;    case HL_NUMBER: return 31;      /* red */
   564                        ;    case HL_MATCH: return 34;      /* blu */
   565                        ;    default: return 37;             /* white */
   566                        ;    }
   567                        ;}
   568                        ;#endif
   569                        ;
   570                        ;/* ======================= Low level terminal han
                    dling ====================== */
   571                        ;#if 0
   572                        ;static struct termios orig_termios; /* In order t
                    o restore at exit.*/
   573                        ;
   574                        ;void disableRawMode(int fd) {
   575                        ;    /* Don't even check the return value as it's 
                    too late. */
   576                        ;    if (E.rawmode) {
   577                        ;        tcsetattr(fd,TCSAFLUSH,&orig_termios);
   578                        ;        E.rawmode = 0;
   579                        ;    }
   580                        ;}
   581                        ;
   582                        ;/* Called at exit to avoid remaining in raw mode.
                     */
   583                        ;void editorAtExit(void) {
   584                        ;    disableRawMode(STDIN_FILENO);
   585                        ;}
   586                        ;#endif
   587                        ;
   588                        ;/* Raw mode: 1960 magic shit. */
   589                        ;int enableRawMode(int fd) {
   590                        	code
  Sun Jan  9 2022 20:39                                                Page 13


   591                        	xdef	~~enableRawMode
   592                        	func
   593                        ~~enableRawMode:
   594                        	longa	on
   595                        	longi	on
   596 00:007E: 3B           	tsc
   597 00:007F: 38           	sec
   598 00:0080: E9 04 00     	sbc	#L18
   599 00:0083: 1B           	tcs
   600 00:0084: 0B           	phd
   601 00:0085: 5B           	tcd
   602             00000004   fd_0	set	4
   603                        ;#if 0
   604                        ;    struct termios raw;
   605                        ;
   606                        ;    if (E.rawmode) return 0; /* Already enabled. 
                    */
   607                        ;    if (!isatty(STDIN_FILENO)) goto fatal;
   608                        ;    atexit(editorAtExit);
   609                        ;    if (tcgetattr(fd,&orig_termios) == -1) goto f
                    atal;
   610                        ;
   611                        ;    raw = orig_termios;  /* modify the original m
                    ode */
   612                        ;    /* input modes: no break, no CR to NL, no par
                    ity check, no strip char,
   613                        ;     * no start/stop output control. */
   614                        ;    raw.c_iflag &= ~(BRKINT | ICRNL | INPCK | IST
                    RIP | IXON);
   615                        ;    /* output modes - disable post processing */
   616                        ;    raw.c_oflag &= ~(OPOST);
   617                        ;    /* control modes - set 8 bit chars */
   618                        ;    raw.c_cflag |= (CS8);
   619                        ;    /* local modes - choing off, canonical off, n
                    o extended functions,
   620                        ;     * no signal chars (^Z,^C) */
   621                        ;    raw.c_lflag &= ~(ECHO | ICANON | IEXTEN | ISI
                    G);
   622                        ;    /* control chars - set return condition: min 
                    number of bytes and timer. */
   623                        ;    raw.c_cc[VMIN] = 0; /* Return each byte, or z
                    ero for timeout. */
   624                        ;    raw.c_cc[VTIME] = 1; /* 100 ms timeout (unit 
                    is tens of second). */
   625                        ;
   626                        ;    /* put terminal in raw mode after flushing */
   627                        ;    if (tcsetattr(fd,TCSAFLUSH,&raw) < 0) goto fa
                    tal;
   628                        ;#endif
   629                        ;    E.rawmode = 1;
   630 00:0086: A9 01 00     	lda	#$1
   631 00:0089: 8D xx xx     	sta	|~~E+14
   632                        ;    return 0;
   633 00:008C: 3A           	dea
   634 00:008D: A8           	tay
   635 00:008E: A5 06        	lda	<L18+2
   636 00:0090: 85 08        	sta	<L18+2+2
   637 00:0092: A5 05        	lda	<L18+1
  Sun Jan  9 2022 20:39                                                Page 14


   638 00:0094: 85 07        	sta	<L18+1+2
   639 00:0096: 2B           	pld
   640 00:0097: 3B           	tsc
   641 00:0098: 18           	clc
   642 00:0099: 69 06 00     	adc	#L18+2
   643 00:009C: 1B           	tcs
   644 00:009D: 98           	tya
   645 00:009E: 6B           	rtl
   646                        ;
   647                        ;fatal:
   648                        ;    errno = ENOTTY;
   649                        ;    return -1;
   650                        ;}
   651             00000004   L18	equ	4
   652             00000005   L19	equ	5
   653                        	ends
   654                        	efunc
   655                        ;
   656                        ;/* Read a key from the terminal put in raw mode, 
                    trying to handle
   657                        ; * escape sequences. */
   658                        ;int editorReadKey(int fd) {
   659                        	code
   660                        	xdef	~~editorReadKey
   661                        	func
   662                        ~~editorReadKey:
   663                        	longa	on
   664                        	longi	on
   665 00:009F: 3B           	tsc
   666 00:00A0: 38           	sec
   667 00:00A1: E9 0A 00     	sbc	#L21
   668 00:00A4: 1B           	tcs
   669 00:00A5: 0B           	phd
   670 00:00A6: 5B           	tcd
   671             00000004   fd_0	set	4
   672                        ;    int nread;
   673                        ;    char c, seq[3];
   674                        ;	char *superf = (char *)0x000244;
   675                        ;	
   676                        ;    while ((nread = read(fd,&c,1)) == 0);
   677             00000000   nread_1	set	0
   678             00000002   c_1	set	2
   679             00000003   seq_1	set	3
   680             00000006   superf_1	set	6
   681 00:00A7: A9 44 02     	lda	#$244
   682 00:00AA: 85 07        	sta	<L22+superf_1
   683 00:00AC: A9 00 00     	lda	#$0
   684 00:00AF: 85 09        	sta	<L22+superf_1+2
   685                        L10004:
   686 00:00B1: F4 00 00     	pea	#^$1
   687 00:00B4: F4 01 00     	pea	#<$1
   688 00:00B7: F4 00 00     	pea	#0
   689 00:00BA: 18           	clc
   690 00:00BB: 7B           	tdc
   691 00:00BC: 69 03 00     	adc	#<L22+c_1
   692 00:00BF: 48           	pha
   693 00:00C0: D4 0E        	pei	<L21+fd_0
   694 00:00C2: 22 xx xx xx  	jsl	~~read
  Sun Jan  9 2022 20:39                                                Page 15


   695 00:00C6: 85 01        	sta	<L22+nread_1
   696 00:00C8: A5 01        	lda	<L22+nread_1
   697 00:00CA: F0 E5        	beq	L10004
   698                        ;	
   699                        ;    //if (nread == -1) exit(1);
   700                        ;
   701                        ;	switch(c) {
   702 00:00CC: A5 03        	lda	<L22+c_1
   703 00:00CE: 29 FF 00     	and	#$ff
   704                        	xref	~~~swt
   705 00:00D1: 22 xx xx xx  	jsl	~~~swt
   706 00:00D5: 09 00        	dw	9
   707 00:00D7: 01 00        	dw	1
   708 00:00D9: xx xx        	dw	L10019-1
   709 00:00DB: 02 00        	dw	2
   710 00:00DD: xx xx        	dw	L10020-1
   711 00:00DF: 08 00        	dw	8
   712 00:00E1: xx xx        	dw	L10016-1
   713 00:00E3: 1C 00        	dw	28
   714 00:00E5: xx xx        	dw	L10008-1
   715 00:00E7: 1D 00        	dw	29
   716 00:00E9: xx xx        	dw	L10010-1
   717 00:00EB: 1E 00        	dw	30
   718 00:00ED: xx xx        	dw	L10012-1
   719 00:00EF: 1F 00        	dw	31
   720 00:00F1: xx xx        	dw	L10014-1
   721 00:00F3: 95 00        	dw	149
   722 00:00F5: xx xx        	dw	L20001-1
   723 00:00F7: 96 00        	dw	150
   724 00:00F9: xx xx        	dw	L20000-1
   725 00:00FB: xx xx        	dw	L10021-1
   726                        ;		case CCUP:
   727                        L10008:
   728                        ;			if (*superf) return HOME_LINE;
   729 00:00FD: A7 07        	lda	[<L22+superf_1]
   730 00:00FF: 29 FF 00     	and	#$ff
   731 00:0102: F0 15        	beq	L10009
   732 00:0104: A9 F1 03     	lda	#$3f1
   733                        L25:
   734 00:0107: A8           	tay
   735 00:0108: A5 0C        	lda	<L21+2
   736 00:010A: 85 0E        	sta	<L21+2+2
   737 00:010C: A5 0B        	lda	<L21+1
   738 00:010E: 85 0D        	sta	<L21+1+2
   739 00:0110: 2B           	pld
   740 00:0111: 3B           	tsc
   741 00:0112: 18           	clc
   742 00:0113: 69 0C 00     	adc	#L21+2
   743 00:0116: 1B           	tcs
   744 00:0117: 98           	tya
   745 00:0118: 6B           	rtl
   746                        ;			return ARROW_UP;
   747                        L10009:
   748 00:0119: A9 EA 03     	lda	#$3ea
   749 00:011C: 80 E9        	bra	L25
   750                        ;		case CCDN:
   751                        L10010:
   752                        ;			if (*superf) return END_LINE;
  Sun Jan  9 2022 20:39                                                Page 16


   753 00:011E: A7 07        	lda	[<L22+superf_1]
   754 00:0120: 29 FF 00     	and	#$ff
   755 00:0123: F0 05        	beq	L10011
   756 00:0125: A9 F2 03     	lda	#$3f2
   757 00:0128: 80 DD        	bra	L25
   758                        ;			return ARROW_DOWN;
   759                        L10011:
   760 00:012A: A9 EB 03     	lda	#$3eb
   761 00:012D: 80 D8        	bra	L25
   762                        ;		case CCLF:
   763                        L10012:
   764                        ;			if (*superf) return PAGE_DOWN;
   765 00:012F: A7 07        	lda	[<L22+superf_1]
   766 00:0131: 29 FF 00     	and	#$ff
   767 00:0134: F0 05        	beq	L10013
   768                        L20000:
   769 00:0136: A9 F0 03     	lda	#$3f0
   770 00:0139: 80 CC        	bra	L25
   771                        ;			return ARROW_LEFT;
   772                        L10013:
   773 00:013B: A9 E8 03     	lda	#$3e8
   774 00:013E: 80 C7        	bra	L25
   775                        ;		case CCRT:
   776                        L10014:
   777                        ;			if (*superf) return PAGE_UP;
   778 00:0140: A7 07        	lda	[<L22+superf_1]
   779 00:0142: 29 FF 00     	and	#$ff
   780 00:0145: F0 05        	beq	L10015
   781                        L20001:
   782 00:0147: A9 EF 03     	lda	#$3ef
   783 00:014A: 80 BB        	bra	L25
   784                        ;			return ARROW_RIGHT;
   785                        L10015:
   786 00:014C: A9 E9 03     	lda	#$3e9
   787 00:014F: 80 B6        	bra	L25
   788                        ;		case BACK:
   789                        L10016:
   790                        ;			return DEL_KEY;
   791 00:0151: A9 EC 03     	lda	#$3ec
   792 00:0154: 80 B1        	bra	L25
   793                        ;		case CPGUP:
   794                        ;			return PAGE_UP;
   795                        ;		case CPGDN:
   796                        ;			return PAGE_DOWN;
   797                        ;		case CLS:
   798                        L10019:
   799                        ;			return HOME_KEY;
   800 00:0156: A9 ED 03     	lda	#$3ed
   801 00:0159: 80 AC        	bra	L25
   802                        ;		case CTRL_B:
   803                        L10020:
   804                        ;			return END_KEY;
   805 00:015B: A9 EE 03     	lda	#$3ee
   806 00:015E: 80 A7        	bra	L25
   807                        ;		default:
   808                        L10021:
   809                        ;			return c;
   810 00:0160: A5 03        	lda	<L22+c_1
  Sun Jan  9 2022 20:39                                                Page 17


   811 00:0162: 29 FF 00     	and	#$ff
   812 00:0165: 80 A0        	bra	L25
   813                        ;	}
   814                        ;		
   815                        ;		
   816                        ;#if 0
   817                        ;    while(1) {
   818                        ;        switch(c) {
   819                        ;			
   820                        ;        case ESC:    /* escape sequence */
   821                        ;            /* If this is just an ESC, we'll time
                    out here. */
   822                        ;            if (read(fd,seq,1) == 0) return ESC;
   823                        ;            if (read(fd,seq+1,1) == 0) return ESC
                    ;
   824                        ;
   825                        ;            /* ESC [ sequences. */
   826                        ;            if (seq[0] == '[') {
   827                        ;                if (seq[1] >= '0' && seq[1] <= '9
                    ') {
   828                        ;                    /* Extended escape, read addi
                    tional byte. */
   829                        ;                    if (read(fd,seq+2,1) == 0) re
                    turn ESC;
   830                        ;                    if (seq[2] == '~') {
   831                        ;                        switch(seq[1]) {
   832                        ;                        case '3': return DEL_KEY;
   833                        ;                        case '5': return PAGE_UP;
   834                        ;                        case '6': return PAGE_DOW
                    N;
   835                        ;                        }
   836                        ;                    }
   837                        ;                } else {
   838                        ;                    switch(seq[1]) {
   839                        ;                    case 'A': return ARROW_UP;
   840                        ;                    case 'B': return ARROW_DOWN;
   841                        ;                    case 'C': return ARROW_RIGHT;
   842                        ;                    case 'D': return ARROW_LEFT;
   843                        ;                    case 'H': return HOME_KEY;
   844                        ;                    case 'F': return END_KEY;
   845                        ;                    }
   846                        ;                }
   847                        ;            }
   848                        ;
   849                        ;            /* ESC O sequences. */
   850                        ;            else if (seq[0] == 'O') {
   851                        ;                switch(seq[1]) {
   852                        ;                case 'H': return HOME_KEY;
   853                        ;                case 'F': return END_KEY;
   854                        ;                }
   855                        ;            }
   856                        ;            break;
   857                        ;        default:
   858                        ;            return c;
   859                        ;        }
   860                        ;    }
   861                        ;#endif
   862                        ;
  Sun Jan  9 2022 20:39                                                Page 18


   863                        ;}
   864             0000000A   L21	equ	10
   865             00000001   L22	equ	1
   866                        	ends
   867                        	efunc
   868                        ;
   869                        ;
   870                        ;void setCursor(unsigned int row, unsigned int col
                    ) {
   871                        	code
   872                        	xdef	~~setCursor
   873                        	func
   874                        ~~setCursor:
   875                        	longa	on
   876                        	longi	on
   877 00:0167: 3B           	tsc
   878 00:0168: 38           	sec
   879 00:0169: E9 04 00     	sbc	#L29
   880 00:016C: 1B           	tcs
   881 00:016D: 0B           	phd
   882 00:016E: 5B           	tcd
   883             00000004   row_0	set	4
   884             00000006   col_0	set	6
   885                        ;		
   886                        ;	CURSOR = row * E.screencols + col /*+ 0xB000*/;
   887 00:016F: A5 08        	lda	<L29+row_0
   888 00:0171: AE xx xx     	ldx	|~~E+10
   889                        	xref	~~~mul
   890 00:0174: 22 xx xx xx  	jsl	~~~mul
   891 00:0178: 18           	clc
   892 00:0179: 65 0A        	adc	<L29+col_0
   893 00:017B: 8F 0A FE FF  	sta	>16776714
   894                        ;}
   895 00:017F: A5 06        	lda	<L29+2
   896 00:0181: 85 0A        	sta	<L29+2+4
   897 00:0183: A5 05        	lda	<L29+1
   898 00:0185: 85 09        	sta	<L29+1+4
   899 00:0187: 2B           	pld
   900 00:0188: 3B           	tsc
   901 00:0189: 18           	clc
   902 00:018A: 69 08 00     	adc	#L29+4
   903 00:018D: 1B           	tcs
   904 00:018E: 6B           	rtl
   905             00000004   L29	equ	4
   906             00000005   L30	equ	5
   907                        	ends
   908                        	efunc
   909                        ;
   910                        ;void writeScreen(char *p, size_t len) {
   911                        	code
   912                        	xdef	~~writeScreen
   913                        	func
   914                        ~~writeScreen:
   915                        	longa	on
   916                        	longi	on
   917 00:018F: 3B           	tsc
   918 00:0190: 38           	sec
   919 00:0191: E9 06 00     	sbc	#L32
  Sun Jan  9 2022 20:39                                                Page 19


   920 00:0194: 1B           	tcs
   921 00:0195: 0B           	phd
   922 00:0196: 5B           	tcd
   923             00000004   p_0	set	4
   924             00000008   len_0	set	8
   925                        ;	
   926                        ;	int rowleft;
   927                        ;	char *dst = (char *)SCREENADR;
   928                        ;	
   929                        ;	for (rowleft = E.screencols; len > 0; len--) {
   930             00000000   rowleft_1	set	0
   931             00000002   dst_1	set	2
   932 00:0197: A9 00 F0     	lda	#$f000
   933 00:019A: 85 03        	sta	<L33+dst_1
   934 00:019C: A9 7F 00     	lda	#$7f
   935 00:019F: 85 05        	sta	<L33+dst_1+2
   936 00:01A1: AD xx xx     	lda	|~~E+10
   937 00:01A4: 85 01        	sta	<L33+rowleft_1
   938 00:01A6: 80 4C        	bra	L10025
   939                        L20003:
   940                        ;		if (*p == '\n') {
   941 00:01A8: E2 20        	sep	#$20
   942                        	longa	off
   943 00:01AA: A7 0A        	lda	[<L32+p_0]
   944 00:01AC: C9 0A        	cmp	#<$a
   945 00:01AE: C2 20        	rep	#$20
   946                        	longa	on
   947 00:01B0: F0 22        	beq	L10030
   948                        ;			*dst++ = *p;
   949 00:01B2: E2 20        	sep	#$20
   950                        	longa	off
   951 00:01B4: A7 0A        	lda	[<L32+p_0]
   952 00:01B6: 87 03        	sta	[<L33+dst_1]
   953 00:01B8: C2 20        	rep	#$20
   954                        	longa	on
   955 00:01BA: E6 03        	inc	<L33+dst_1
   956 00:01BC: D0 02        	bne	L38
   957 00:01BE: E6 05        	inc	<L33+dst_1+2
   958                        L38:
   959                        ;			rowleft--;
   960 00:01C0: C6 01        	dec	<L33+rowleft_1
   961                        ;		}
   962 00:01C2: 80 22        	bra	L10031
   963                        ;			for  (; rowleft > 0; rowleft--) 
                    {
   964                        L10029:
   965                        ;				*dst++ = ' ';
   966 00:01C4: E2 20        	sep	#$20
   967                        	longa	off
   968 00:01C6: A9 20        	lda	#$20
   969 00:01C8: 87 03        	sta	[<L33+dst_1]
   970 00:01CA: C2 20        	rep	#$20
   971                        	longa	on
   972 00:01CC: E6 03        	inc	<L33+dst_1
   973 00:01CE: D0 02        	bne	L10027
   974 00:01D0: E6 05        	inc	<L33+dst_1+2
   975                        ;			}
   976                        L10027:
  Sun Jan  9 2022 20:39                                                Page 20


   977 00:01D2: C6 01        	dec	<L33+rowleft_1
   978                        L10030:
   979 00:01D4: 38           	sec
   980 00:01D5: A9 00 00     	lda	#$0
   981 00:01D8: E5 01        	sbc	<L33+rowleft_1
   982 00:01DA: 70 03        	bvs	L36
   983 00:01DC: 49 00 80     	eor	#$8000
   984                        L36:
   985 00:01DF: 10 E3        	bpl	L10029
   986                        ;			rowleft = E.screencols;
   987 00:01E1: AD xx xx     	lda	|~~E+10
   988 00:01E4: 85 01        	sta	<L33+rowleft_1
   989                        ;		} else {
   990                        L10031:
   991                        ;		p++;
   992 00:01E6: E6 0A        	inc	<L32+p_0
   993 00:01E8: D0 02        	bne	L10022
   994 00:01EA: E6 0C        	inc	<L32+p_0+2
   995                        ;	}
   996                        L10022:
   997 00:01EC: A5 0E        	lda	<L32+len_0
   998 00:01EE: D0 02        	bne	L40
   999 00:01F0: C6 10        	dec	<L32+len_0+2
  1000                        L40:
  1001 00:01F2: C6 0E        	dec	<L32+len_0
  1002                        L10025:
  1003 00:01F4: A9 00 00     	lda	#$0
  1004 00:01F7: C5 0E        	cmp	<L32+len_0
  1005 00:01F9: E5 10        	sbc	<L32+len_0+2
  1006 00:01FB: 90 AB        	bcc	L20003
  1007                        ;}
  1008 00:01FD: A5 08        	lda	<L32+2
  1009 00:01FF: 85 10        	sta	<L32+2+8
  1010 00:0201: A5 07        	lda	<L32+1
  1011 00:0203: 85 0F        	sta	<L32+1+8
  1012 00:0205: 2B           	pld
  1013 00:0206: 3B           	tsc
  1014 00:0207: 18           	clc
  1015 00:0208: 69 0E 00     	adc	#L32+8
  1016 00:020B: 1B           	tcs
  1017 00:020C: 6B           	rtl
  1018             00000006   L32	equ	6
  1019             00000001   L33	equ	1
  1020                        	ends
  1021                        	efunc
  1022                        ;
  1023                        ;#if 0
  1024                        ;
  1025                        ;/* Use the ESC [6n escape sequence to query the h
                    orizontal cursor position
  1026                        ; * and return it. On error -1 is returned, on suc
                    cess the position of the
  1027                        ; * cursor is stored at *rows and *cols and 0 is r
                    eturned. */
  1028                        ;int getCursorPosition(int ifd, int ofd, int *rows
                    , int *cols) {
  1029                        ;	
  1030                        ;	char *row = (char *)0x0037;
  Sun Jan  9 2022 20:39                                                Page 21


  1031                        ;	int *col = (int *)0x0038;
  1032                        ;	
  1033                        ;	*rows = *row;
  1034                        ;	*cols = *col;
  1035                        ;	
  1036                        ;    static char buf[32];
  1037                        ;    unsigned int i = 0;
  1038                        ;
  1039                        ;    /* Report cursor location */
  1040                        ;    if (write(ofd, "\x1b[6n", 4) != 4) return -1;
  1041                        ;
  1042                        ;    /* Read the response: ESC [ rows ; cols R */
  1043                        ;    while (i < sizeof(buf)-1) {
  1044                        ;        if (read(ifd,buf+i,1) != 1) break;
  1045                        ;        if (buf[i] == 'R') break;
  1046                        ;        i++;
  1047                        ;    }
  1048                        ;    buf[i] = '\0';
  1049                        ;
  1050                        ;    /* Parse it. */
  1051                        ;    if (buf[0] != ESC || buf[1] != '[') return -1
                    ;
  1052                        ;    if (sscanf(buf+2,"%d;%d",rows,cols) != 2) ret
                    urn -1;
  1053                        ;
  1054                        ;    return 0;
  1055                        ;}
  1056                        ;#endif
  1057                        ;
  1058                        ;
  1059                        ;/* Try to get the number of columns in the curren
                    t terminal. If the ioctl()
  1060                        ; * call fails the function will try to query the 
                    terminal itself.
  1061                        ; * Returns 0 on success, -1 on error. */
  1062                        ;int getWindowSize(int ifd, int ofd, unsigned int 
                    *rows, unsigned int *cols) {
  1063                        	code
  1064                        	xdef	~~getWindowSize
  1065                        	func
  1066                        ~~getWindowSize:
  1067                        	longa	on
  1068                        	longi	on
  1069 00:020D: 3B           	tsc
  1070 00:020E: 38           	sec
  1071 00:020F: E9 00 00     	sbc	#L43
  1072 00:0212: 1B           	tcs
  1073 00:0213: 0B           	phd
  1074 00:0214: 5B           	tcd
  1075             00000004   ifd_0	set	4
  1076             00000006   ofd_0	set	6
  1077             00000008   rows_0	set	8
  1078             0000000C   cols_0	set	12
  1079                        ;	*rows = 25;
  1080 00:0215: A9 19 00     	lda	#$19
  1081 00:0218: 87 08        	sta	[<L43+rows_0]
  1082                        ;	*cols = 80;
  1083 00:021A: A9 50 00     	lda	#$50
  Sun Jan  9 2022 20:39                                                Page 22


  1084 00:021D: 87 0C        	sta	[<L43+cols_0]
  1085                        ;	return 0;
  1086 00:021F: A9 00 00     	lda	#$0
  1087 00:0222: A8           	tay
  1088 00:0223: A5 02        	lda	<L43+2
  1089 00:0225: 85 0E        	sta	<L43+2+12
  1090 00:0227: A5 01        	lda	<L43+1
  1091 00:0229: 85 0D        	sta	<L43+1+12
  1092 00:022B: 2B           	pld
  1093 00:022C: 3B           	tsc
  1094 00:022D: 18           	clc
  1095 00:022E: 69 0C 00     	adc	#L43+12
  1096 00:0231: 1B           	tcs
  1097 00:0232: 98           	tya
  1098 00:0233: 6B           	rtl
  1099                        ;	
  1100                        ;#if 0
  1101                        ;    struct winsize ws;
  1102                        ;    static char seq[32];
  1103                        ;
  1104                        ;    if (ioctl(1, TIOCGWINSZ, &ws) == -1 || ws.ws_
                    col == 0) {
  1105                        ;        /* ioctl() failed. Try to query the termi
                    nal itself. */
  1106                        ;        int orig_row, orig_col, retval;
  1107                        ;
  1108                        ;        /* Get the initial position so we can res
                    tore it later. */
  1109                        ;        retval = getCursorPosition(ifd,ofd,&orig_
                    row,&orig_col);
  1110                        ;        if (retval == -1) goto failed;
  1111                        ;
  1112                        ;        /* Go to right/bottom margin and get posi
                    tion. */
  1113                        ;        if (write(ofd,"\x1b[999C\x1b[999B",12) !=
                     12) goto failed;
  1114                        ;        retval = getCursorPosition(ifd,ofd,rows,c
                    ols);
  1115                        ;        if (retval == -1) goto failed;
  1116                        ;
  1117                        ;        /* Restore position. */
  1118                        ;        snprintf(seq,32,"\x1b[%d;%dH",orig_row,or
                    ig_col);
  1119                        ;        if (write(ofd,seq,strlen(seq)) == -1) {
  1120                        ;            /* Can't recover... */
  1121                        ;        }
  1122                        ;        return 0;
  1123                        ;    } else {
  1124                        ;        *cols = ws.ws_col;
  1125                        ;        *rows = ws.ws_row;
  1126                        ;        return 0;
  1127                        ;    }
  1128                        ;
  1129                        ;failed:
  1130                        ;    return -1;
  1131                        ;#endif
  1132                        ;}
  1133             00000000   L43	equ	0
  Sun Jan  9 2022 20:39                                                Page 23


  1134             00000001   L44	equ	1
  1135                        	ends
  1136                        	efunc
  1137                        ;
  1138                        ;
  1139                        ;/* ======================= Editor rows implementa
                    tion ======================= */
  1140                        ;
  1141                        ;/* Update the rendered version and the syntax hig
                    hlight of a row. */
  1142                        ;void editorUpdateRow(erow *row) {
  1143                        	code
  1144                        	xdef	~~editorUpdateRow
  1145                        	func
  1146                        ~~editorUpdateRow:
  1147                        	longa	on
  1148                        	longi	on
  1149 00:0234: 3B           	tsc
  1150 00:0235: 38           	sec
  1151 00:0236: E9 0E 00     	sbc	#L46
  1152 00:0239: 1B           	tcs
  1153 00:023A: 0B           	phd
  1154 00:023B: 5B           	tcd
  1155             00000004   row_0	set	4
  1156                        ;    int tabs, j, idx;
  1157                        ;//	int nonprint;
  1158                        ;	
  1159                        ;	return;
  1160             00000000   tabs_1	set	0
  1161             00000002   j_1	set	2
  1162             00000004   idx_1	set	4
  1163                        L48:
  1164 00:023C: A5 10        	lda	<L46+2
  1165 00:023E: 85 14        	sta	<L46+2+4
  1166 00:0240: A5 0F        	lda	<L46+1
  1167 00:0242: 85 13        	sta	<L46+1+4
  1168 00:0244: 2B           	pld
  1169 00:0245: 3B           	tsc
  1170 00:0246: 18           	clc
  1171 00:0247: 69 12 00     	adc	#L46+4
  1172 00:024A: 1B           	tcs
  1173 00:024B: 6B           	rtl
  1174                        ;	
  1175                        ;	tabs = 0;
  1176                        ;	//nonprint = 0;
  1177                        ;	
  1178                        ;   /* Create a version of the row we can directly
                     print on the screen,
  1179                        ;     * respecting tabs, substituting non printabl
                    e characters with '?'. */
  1180                        ;    free(row->render);
  1181                        ;    for (j = 0; j < row->size; j++)
  1182                        L10034:
  1183                        ;        if (row->chars[j] == TAB) tabs++;
  1184 00:024C: A0 06 00     	ldy	#$6
  1185 00:024F: B7 12        	lda	[<L46+row_0],Y
  1186 00:0251: 85 01        	sta	<R0
  1187 00:0253: C8           	iny
  Sun Jan  9 2022 20:39                                                Page 24


  1188 00:0254: C8           	iny
  1189 00:0255: B7 12        	lda	[<L46+row_0],Y
  1190 00:0257: 85 03        	sta	<R0+2
  1191 00:0259: E2 20        	sep	#$20
  1192                        	longa	off
  1193 00:025B: A4 0B        	ldy	<L47+j_1
  1194 00:025D: B7 01        	lda	[<R0],Y
  1195 00:025F: C9 09        	cmp	#<$9
  1196 00:0261: C2 20        	rep	#$20
  1197                        	longa	on
  1198 00:0263: D0 02        	bne	L10032
  1199 00:0265: E6 09        	inc	<L47+tabs_1
  1200                        ;
  1201                        ;	if (tabs == 0) {
  1202                        L10032:
  1203 00:0267: E6 0B        	inc	<L47+j_1
  1204 00:0269: 38           	sec
  1205 00:026A: A5 0B        	lda	<L47+j_1
  1206 00:026C: A0 02 00     	ldy	#$2
  1207 00:026F: F7 12        	sbc	[<L46+row_0],Y
  1208 00:0271: 70 03        	bvs	L50
  1209 00:0273: 49 00 80     	eor	#$8000
  1210                        L50:
  1211 00:0276: 10 D4        	bpl	L10034
  1212 00:0278: A5 09        	lda	<L47+tabs_1
  1213 00:027A: D0 1D        	bne	L10037
  1214                        ;		row->rsize = row->size;
  1215 00:027C: A0 02 00     	ldy	#$2
  1216 00:027F: B7 12        	lda	[<L46+row_0],Y
  1217 00:0281: C8           	iny
  1218 00:0282: C8           	iny
  1219 00:0283: 97 12        	sta	[<L46+row_0],Y
  1220                        ;		row->render = row->chars;
  1221 00:0285: C8           	iny
  1222 00:0286: C8           	iny
  1223 00:0287: B7 12        	lda	[<L46+row_0],Y
  1224 00:0289: A0 0A 00     	ldy	#$a
  1225 00:028C: 97 12        	sta	[<L46+row_0],Y
  1226 00:028E: 88           	dey
  1227 00:028F: 88           	dey
  1228 00:0290: B7 12        	lda	[<L46+row_0],Y
  1229 00:0292: A0 0C 00     	ldy	#$c
  1230 00:0295: 97 12        	sta	[<L46+row_0],Y
  1231                        ;		return;
  1232 00:0297: 80 A3        	bra	L48
  1233                        ;	}
  1234                        ;
  1235                        ;    //row->render = malloc(row->size + tabs*8 + n
                    onprint*9 + 1);
  1236                        ;    row->render = malloc(row->size + (tabs << 2) 
                    + 1);
  1237                        L10037:
  1238 00:0299: A5 09        	lda	<L47+tabs_1
  1239 00:029B: 0A           	asl	A
  1240 00:029C: 0A           	asl	A
  1241 00:029D: 18           	clc
  1242 00:029E: A0 02 00     	ldy	#$2
  1243 00:02A1: 77 12        	adc	[<L46+row_0],Y
  Sun Jan  9 2022 20:39                                                Page 25


  1244 00:02A3: 1A           	ina
  1245 00:02A4: 85 01        	sta	<R0
  1246 00:02A6: 88           	dey
  1247 00:02A7: 88           	dey
  1248 00:02A8: A5 01        	lda	<R0
  1249 00:02AA: 10 01        	bpl	L53
  1250 00:02AC: 88           	dey
  1251                        L53:
  1252 00:02AD: 85 01        	sta	<R0
  1253 00:02AF: 84 03        	sty	<R0+2
  1254 00:02B1: D4 03        	pei	<R0+2
  1255 00:02B3: D4 01        	pei	<R0
  1256 00:02B5: 22 xx xx xx  	jsl	~~malloc
  1257 00:02B9: 86 07        	stx	<R1+2
  1258 00:02BB: A0 0A 00     	ldy	#$a
  1259 00:02BE: 97 12        	sta	[<L46+row_0],Y
  1260 00:02C0: A5 07        	lda	<R1+2
  1261 00:02C2: C8           	iny
  1262 00:02C3: C8           	iny
  1263 00:02C4: 97 12        	sta	[<L46+row_0],Y
  1264                        ;	//fprintf(stderr, "editorUpdateRow render: %08lX
                    \n", row->render);
  1265                        ;	
  1266                        ;    idx = 0;
  1267 00:02C6: 64 0D        	stz	<L47+idx_1
  1268                        ;    for (j = 0; j < row->size; j++) {
  1269 00:02C8: 64 0B        	stz	<L47+j_1
  1270 00:02CA: 82 7E 00     	brl	L10041
  1271                        L10040:
  1272                        ;        if (row->chars[j] == TAB) {
  1273 00:02CD: A0 06 00     	ldy	#$6
  1274 00:02D0: B7 12        	lda	[<L46+row_0],Y
  1275 00:02D2: 85 01        	sta	<R0
  1276 00:02D4: C8           	iny
  1277 00:02D5: C8           	iny
  1278 00:02D6: B7 12        	lda	[<L46+row_0],Y
  1279 00:02D8: 85 03        	sta	<R0+2
  1280 00:02DA: E2 20        	sep	#$20
  1281                        	longa	off
  1282 00:02DC: A4 0B        	ldy	<L47+j_1
  1283 00:02DE: B7 01        	lda	[<R0],Y
  1284 00:02E0: C9 09        	cmp	#<$9
  1285 00:02E2: C2 20        	rep	#$20
  1286                        	longa	on
  1287 00:02E4: D0 3B        	bne	L10042
  1288                        ;            row->render[idx++] = ' ';
  1289 00:02E6: A0 0A 00     	ldy	#$a
  1290 00:02E9: B7 12        	lda	[<L46+row_0],Y
  1291 00:02EB: 85 01        	sta	<R0
  1292 00:02ED: C8           	iny
  1293 00:02EE: C8           	iny
  1294 00:02EF: B7 12        	lda	[<L46+row_0],Y
  1295 00:02F1: 85 03        	sta	<R0+2
  1296 00:02F3: E2 20        	sep	#$20
  1297                        	longa	off
  1298 00:02F5: A9 20        	lda	#$20
  1299 00:02F7: A4 0D        	ldy	<L47+idx_1
  1300 00:02F9: 97 01        	sta	[<R0],Y
  Sun Jan  9 2022 20:39                                                Page 26


  1301 00:02FB: C2 20        	rep	#$20
  1302                        	longa	on
  1303                        L20004:
  1304 00:02FD: E6 0D        	inc	<L47+idx_1
  1305                        ;            while((idx+1) % 4 != 0) row->render[i
                    dx++] = ' ';
  1306 00:02FF: A5 0D        	lda	<L47+idx_1
  1307 00:0301: 1A           	ina
  1308 00:0302: 29 03 00     	and	#$03
  1309 00:0305: AA           	tax
  1310 00:0306: F0 41        	beq	L10038
  1311                        ;        } else {
  1312 00:0308: A0 0A 00     	ldy	#$a
  1313 00:030B: B7 12        	lda	[<L46+row_0],Y
  1314 00:030D: 85 01        	sta	<R0
  1315 00:030F: C8           	iny
  1316 00:0310: C8           	iny
  1317 00:0311: B7 12        	lda	[<L46+row_0],Y
  1318 00:0313: 85 03        	sta	<R0+2
  1319 00:0315: E2 20        	sep	#$20
  1320                        	longa	off
  1321 00:0317: A9 20        	lda	#$20
  1322 00:0319: A4 0D        	ldy	<L47+idx_1
  1323 00:031B: 97 01        	sta	[<R0],Y
  1324 00:031D: C2 20        	rep	#$20
  1325                        	longa	on
  1326 00:031F: 80 DC        	bra	L20004
  1327                        L10042:
  1328                        ;            row->render[idx++] = row->chars[j];
  1329 00:0321: A0 0A 00     	ldy	#$a
  1330 00:0324: B7 12        	lda	[<L46+row_0],Y
  1331 00:0326: 85 01        	sta	<R0
  1332 00:0328: C8           	iny
  1333 00:0329: C8           	iny
  1334 00:032A: B7 12        	lda	[<L46+row_0],Y
  1335 00:032C: 85 03        	sta	<R0+2
  1336 00:032E: A0 06 00     	ldy	#$6
  1337 00:0331: B7 12        	lda	[<L46+row_0],Y
  1338 00:0333: 85 05        	sta	<R1
  1339 00:0335: C8           	iny
  1340 00:0336: C8           	iny
  1341 00:0337: B7 12        	lda	[<L46+row_0],Y
  1342 00:0339: 85 07        	sta	<R1+2
  1343 00:033B: E2 20        	sep	#$20
  1344                        	longa	off
  1345 00:033D: A4 0B        	ldy	<L47+j_1
  1346 00:033F: B7 05        	lda	[<R1],Y
  1347 00:0341: A4 0D        	ldy	<L47+idx_1
  1348 00:0343: 97 01        	sta	[<R0],Y
  1349 00:0345: C2 20        	rep	#$20
  1350                        	longa	on
  1351 00:0347: E6 0D        	inc	<L47+idx_1
  1352                        ;        }
  1353                        ;    }
  1354                        L10038:
  1355 00:0349: E6 0B        	inc	<L47+j_1
  1356                        L10041:
  1357 00:034B: 38           	sec
  Sun Jan  9 2022 20:39                                                Page 27


  1358 00:034C: A5 0B        	lda	<L47+j_1
  1359 00:034E: A0 02 00     	ldy	#$2
  1360 00:0351: F7 12        	sbc	[<L46+row_0],Y
  1361 00:0353: 70 03        	bvs	L56
  1362 00:0355: 49 00 80     	eor	#$8000
  1363                        L56:
  1364 00:0358: 30 03        	bmi	*+5
  1365 00:035A: 82 70 FF     	brl	L10040
  1366                        ;    row->rsize = idx;
  1367 00:035D: A5 0D        	lda	<L47+idx_1
  1368 00:035F: A0 04 00     	ldy	#$4
  1369 00:0362: 97 12        	sta	[<L46+row_0],Y
  1370                        ;    row->render[idx] = '\0';
  1371 00:0364: A0 0A 00     	ldy	#$a
  1372 00:0367: B7 12        	lda	[<L46+row_0],Y
  1373 00:0369: 85 01        	sta	<R0
  1374 00:036B: C8           	iny
  1375 00:036C: C8           	iny
  1376 00:036D: B7 12        	lda	[<L46+row_0],Y
  1377 00:036F: 85 03        	sta	<R0+2
  1378 00:0371: E2 20        	sep	#$20
  1379                        	longa	off
  1380 00:0373: A9 00        	lda	#$0
  1381 00:0375: A4 0D        	ldy	<L47+idx_1
  1382 00:0377: 97 01        	sta	[<R0],Y
  1383 00:0379: C2 20        	rep	#$20
  1384                        	longa	on
  1385                        ;
  1386                        ;    /* Update the syntax highlighting attributes 
                    of the row. */
  1387                        ;    //editorUpdateSyntax(row);
  1388                        ;}
  1389 00:037B: 82 BE FE     	brl	L48
  1390             0000000E   L46	equ	14
  1391             00000009   L47	equ	9
  1392                        	ends
  1393                        	efunc
  1394                        ;
  1395                        ;/* Insert a row at the specified position, shifti
                    ng the other rows on the bottom
  1396                        ; * if required. */
  1397                        ;void editorInsertRow(unsigned int at, char *s, un
                    signed int len) {
  1398                        	code
  1399                        	xdef	~~editorInsertRow
  1400                        	func
  1401                        ~~editorInsertRow:
  1402                        	longa	on
  1403                        	longi	on
  1404 00:037E: 3B           	tsc
  1405 00:037F: 38           	sec
  1406 00:0380: E9 1A 00     	sbc	#L58
  1407 00:0383: 1B           	tcs
  1408 00:0384: 0B           	phd
  1409 00:0385: 5B           	tcd
  1410             00000004   at_0	set	4
  1411             00000006   s_0	set	6
  1412             0000000A   len_0	set	10
  Sun Jan  9 2022 20:39                                                Page 28


  1413                        ;    unsigned int j;
  1414                        ;	erow *row;
  1415                        ;	size_t size;
  1416                        ;		
  1417                        ;    if (at > E.numrows) return;
  1418             00000000   j_1	set	0
  1419             00000002   row_1	set	2
  1420             00000006   size_1	set	6
  1421 00:0386: AD xx xx     	lda	|~~E+12
  1422 00:0389: C5 1E        	cmp	<L58+at_0
  1423 00:038B: B0 10        	bcs	L10046
  1424                        L61:
  1425 00:038D: A5 1C        	lda	<L58+2
  1426 00:038F: 85 24        	sta	<L58+2+8
  1427 00:0391: A5 1B        	lda	<L58+1
  1428 00:0393: 85 23        	sta	<L58+1+8
  1429 00:0395: 2B           	pld
  1430 00:0396: 3B           	tsc
  1431 00:0397: 18           	clc
  1432 00:0398: 69 22 00     	adc	#L58+8
  1433 00:039B: 1B           	tcs
  1434 00:039C: 6B           	rtl
  1435                        ;	
  1436                        ;	//fprintf(stderr, "realloc: %08lX %lu\n", E.row,
                     sizeof(erow)*(E.numrows+1));	
  1437                        ;    //E.row = realloc(E.row,sizeof(erow)*(E.numro
                    ws+1));
  1438                        ;	
  1439                        ;	size = 0;
  1440                        L10046:
  1441 00:039D: 64 17        	stz	<L59+size_1
  1442 00:039F: 64 19        	stz	<L59+size_1+2
  1443                        ;	
  1444                        ;	if (E.rowsavail == 0) {
  1445 00:03A1: AD xx xx     	lda	|~~E+118
  1446 00:03A4: D0 56        	bne	L10047
  1447                        ;		size = sizeof(erow)*(E.numrows+1000);
  1448 00:03A6: A9 E8 03     	lda	#$3e8
  1449 00:03A9: 18           	clc
  1450 00:03AA: 6D xx xx     	adc	|~~E+12
  1451 00:03AD: 85 01        	sta	<R0
  1452 00:03AF: 64 03        	stz	<R0+2
  1453 00:03B1: F4 00 00     	pea	#^$14
  1454 00:03B4: F4 14 00     	pea	#<$14
  1455 00:03B7: D4 03        	pei	<R0+2
  1456 00:03B9: D4 01        	pei	<R0
  1457                        	xref	~~~lmul
  1458 00:03BB: 22 xx xx xx  	jsl	~~~lmul
  1459 00:03BF: 85 17        	sta	<L59+size_1
  1460 00:03C1: 86 19        	stx	<L59+size_1+2
  1461                        ;		//debugf("s_erow:%d, E.numrows:%d size:%
                    d \n", (size_t)sizeof(erow), (size_t)E.numrows, size);
  1462                        ;		E.row = realloc(E.row, sizeof(erow)*(E.n
                    umrows+1000));	
  1463 00:03C3: A9 E8 03     	lda	#$3e8
  1464 00:03C6: 18           	clc
  1465 00:03C7: 6D xx xx     	adc	|~~E+12
  1466 00:03CA: 85 01        	sta	<R0
  Sun Jan  9 2022 20:39                                                Page 29


  1467 00:03CC: 64 03        	stz	<R0+2
  1468 00:03CE: F4 00 00     	pea	#^$14
  1469 00:03D1: F4 14 00     	pea	#<$14
  1470 00:03D4: D4 03        	pei	<R0+2
  1471 00:03D6: D4 01        	pei	<R0
  1472                        	xref	~~~lmul
  1473 00:03D8: 22 xx xx xx  	jsl	~~~lmul
  1474 00:03DC: 85 01        	sta	<R0
  1475 00:03DE: 86 03        	stx	<R0+2
  1476 00:03E0: D4 03        	pei	<R0+2
  1477 00:03E2: D4 01        	pei	<R0
  1478 00:03E4: AD xx xx     	lda	|~~E+16+2
  1479 00:03E7: 48           	pha
  1480 00:03E8: AD xx xx     	lda	|~~E+16
  1481 00:03EB: 48           	pha
  1482 00:03EC: 22 xx xx xx  	jsl	~~realloc
  1483 00:03F0: 8D xx xx     	sta	|~~E+16
  1484 00:03F3: 8E xx xx     	stx	|~~E+16+2
  1485                        ;		E.rowsavail = 1000;
  1486 00:03F6: A9 E8 03     	lda	#$3e8
  1487 00:03F9: 8D xx xx     	sta	|~~E+118
  1488                        ;	}
  1489                        ;	//debugf("realloc: %08X, size:%08X \n", E.row, s
                    ize);
  1490                        ;	
  1491                        ;    if (at != E.numrows) {
  1492                        L10047:
  1493 00:03FC: A5 1E        	lda	<L58+at_0
  1494 00:03FE: CD xx xx     	cmp	|~~E+12
  1495 00:0401: D0 03        	bne	*+5
  1496 00:0403: 82 BF 00     	brl	L10048
  1497                        ;        memmove(E.row+at+1,E.row+at,sizeof(E.row[
                    0])*(E.numrows-at));
  1498 00:0406: 38           	sec
  1499 00:0407: AD xx xx     	lda	|~~E+12
  1500 00:040A: E5 1E        	sbc	<L58+at_0
  1501 00:040C: 85 01        	sta	<R0
  1502 00:040E: 64 03        	stz	<R0+2
  1503 00:0410: F4 00 00     	pea	#^$14
  1504 00:0413: F4 14 00     	pea	#<$14
  1505 00:0416: D4 03        	pei	<R0+2
  1506 00:0418: D4 01        	pei	<R0
  1507                        	xref	~~~lmul
  1508 00:041A: 22 xx xx xx  	jsl	~~~lmul
  1509 00:041E: 85 01        	sta	<R0
  1510 00:0420: 86 03        	stx	<R0+2
  1511 00:0422: D4 03        	pei	<R0+2
  1512 00:0424: D4 01        	pei	<R0
  1513 00:0426: A5 1E        	lda	<L58+at_0
  1514 00:0428: 85 05        	sta	<R1
  1515 00:042A: 64 07        	stz	<R1+2
  1516 00:042C: F4 00 00     	pea	#^$14
  1517 00:042F: F4 14 00     	pea	#<$14
  1518 00:0432: D4 07        	pei	<R1+2
  1519 00:0434: D4 05        	pei	<R1
  1520                        	xref	~~~lmul
  1521 00:0436: 22 xx xx xx  	jsl	~~~lmul
  1522 00:043A: 85 05        	sta	<R1
  Sun Jan  9 2022 20:39                                                Page 30


  1523 00:043C: 86 07        	stx	<R1+2
  1524 00:043E: AD xx xx     	lda	|~~E+16
  1525 00:0441: 18           	clc
  1526 00:0442: 65 05        	adc	<R1
  1527 00:0444: 85 09        	sta	<R2
  1528 00:0446: AD xx xx     	lda	|~~E+16+2
  1529 00:0449: 65 07        	adc	<R1+2
  1530 00:044B: 48           	pha
  1531 00:044C: D4 09        	pei	<R2
  1532 00:044E: A5 1E        	lda	<L58+at_0
  1533 00:0450: 85 05        	sta	<R1
  1534 00:0452: 64 07        	stz	<R1+2
  1535 00:0454: F4 00 00     	pea	#^$14
  1536 00:0457: F4 14 00     	pea	#<$14
  1537 00:045A: D4 07        	pei	<R1+2
  1538 00:045C: D4 05        	pei	<R1
  1539                        	xref	~~~lmul
  1540 00:045E: 22 xx xx xx  	jsl	~~~lmul
  1541 00:0462: 85 05        	sta	<R1
  1542 00:0464: 86 07        	stx	<R1+2
  1543 00:0466: A9 14 00     	lda	#$14
  1544 00:0469: 18           	clc
  1545 00:046A: 65 05        	adc	<R1
  1546 00:046C: 85 0D        	sta	<R3
  1547 00:046E: A9 00 00     	lda	#$0
  1548 00:0471: 65 07        	adc	<R1+2
  1549 00:0473: 85 0F        	sta	<R3+2
  1550 00:0475: AD xx xx     	lda	|~~E+16
  1551 00:0478: 18           	clc
  1552 00:0479: 65 0D        	adc	<R3
  1553 00:047B: 85 05        	sta	<R1
  1554 00:047D: AD xx xx     	lda	|~~E+16+2
  1555 00:0480: 65 0F        	adc	<R3+2
  1556 00:0482: 48           	pha
  1557 00:0483: D4 05        	pei	<R1
  1558 00:0485: 22 xx xx xx  	jsl	~~memmove
  1559                        ;        for (j = at+1; j <= E.numrows; j++) E.row
                    [j].idx++;
  1560 00:0489: A5 1E        	lda	<L58+at_0
  1561 00:048B: 1A           	ina
  1562 00:048C: 85 11        	sta	<L59+j_1
  1563 00:048E: 80 2E        	bra	L10052
  1564                        L10051:
  1565 00:0490: A5 11        	lda	<L59+j_1
  1566 00:0492: 85 01        	sta	<R0
  1567 00:0494: 64 03        	stz	<R0+2
  1568 00:0496: F4 00 00     	pea	#^$14
  1569 00:0499: F4 14 00     	pea	#<$14
  1570 00:049C: D4 03        	pei	<R0+2
  1571 00:049E: D4 01        	pei	<R0
  1572                        	xref	~~~lmul
  1573 00:04A0: 22 xx xx xx  	jsl	~~~lmul
  1574 00:04A4: 85 01        	sta	<R0
  1575 00:04A6: 86 03        	stx	<R0+2
  1576 00:04A8: AD xx xx     	lda	|~~E+16
  1577 00:04AB: 18           	clc
  1578 00:04AC: 65 01        	adc	<R0
  1579 00:04AE: 85 05        	sta	<R1
  Sun Jan  9 2022 20:39                                                Page 31


  1580 00:04B0: AD xx xx     	lda	|~~E+16+2
  1581 00:04B3: 65 03        	adc	<R0+2
  1582 00:04B5: 85 07        	sta	<R1+2
  1583 00:04B7: A7 05        	lda	[<R1]
  1584 00:04B9: 1A           	ina
  1585 00:04BA: 87 05        	sta	[<R1]
  1586 00:04BC: E6 11        	inc	<L59+j_1
  1587                        L10052:
  1588 00:04BE: AD xx xx     	lda	|~~E+12
  1589 00:04C1: C5 11        	cmp	<L59+j_1
  1590 00:04C3: B0 CB        	bcs	L10051
  1591                        ;		//printf("memmove \n");
  1592                        ;    }
  1593                        ;    
  1594                        ;	row = &E.row[at];
  1595                        L10048:
  1596 00:04C5: A5 1E        	lda	<L58+at_0
  1597 00:04C7: 85 01        	sta	<R0
  1598 00:04C9: 64 03        	stz	<R0+2
  1599 00:04CB: F4 00 00     	pea	#^$14
  1600 00:04CE: F4 14 00     	pea	#<$14
  1601 00:04D1: D4 03        	pei	<R0+2
  1602 00:04D3: D4 01        	pei	<R0
  1603                        	xref	~~~lmul
  1604 00:04D5: 22 xx xx xx  	jsl	~~~lmul
  1605 00:04D9: 85 01        	sta	<R0
  1606 00:04DB: 86 03        	stx	<R0+2
  1607 00:04DD: AD xx xx     	lda	|~~E+16
  1608 00:04E0: 18           	clc
  1609 00:04E1: 65 01        	adc	<R0
  1610 00:04E3: 85 13        	sta	<L59+row_1
  1611 00:04E5: AD xx xx     	lda	|~~E+16+2
  1612 00:04E8: 65 03        	adc	<R0+2
  1613 00:04EA: 85 15        	sta	<L59+row_1+2
  1614                        ;
  1615                        ;    row->size = len;
  1616 00:04EC: A5 24        	lda	<L58+len_0
  1617 00:04EE: A0 02 00     	ldy	#$2
  1618 00:04F1: 97 13        	sta	[<L59+row_1],Y
  1619                        ;    row->chars = malloc(len+1);
  1620 00:04F3: A5 24        	lda	<L58+len_0
  1621 00:04F5: 1A           	ina
  1622 00:04F6: 85 01        	sta	<R0
  1623 00:04F8: 64 03        	stz	<R0+2
  1624 00:04FA: D4 03        	pei	<R0+2
  1625 00:04FC: D4 01        	pei	<R0
  1626 00:04FE: 22 xx xx xx  	jsl	~~malloc
  1627 00:0502: 86 07        	stx	<R1+2
  1628 00:0504: A0 06 00     	ldy	#$6
  1629 00:0507: 97 13        	sta	[<L59+row_1],Y
  1630 00:0509: A5 07        	lda	<R1+2
  1631 00:050B: C8           	iny
  1632 00:050C: C8           	iny
  1633 00:050D: 97 13        	sta	[<L59+row_1],Y
  1634                        ;	
  1635                        ;	
  1636                        ;    memcpy(row->chars,s,len+1);
  1637 00:050F: A5 24        	lda	<L58+len_0
  Sun Jan  9 2022 20:39                                                Page 32


  1638 00:0511: 1A           	ina
  1639 00:0512: 85 01        	sta	<R0
  1640 00:0514: 64 03        	stz	<R0+2
  1641 00:0516: D4 03        	pei	<R0+2
  1642 00:0518: D4 01        	pei	<R0
  1643 00:051A: D4 22        	pei	<L58+s_0+2
  1644 00:051C: D4 20        	pei	<L58+s_0
  1645 00:051E: B7 13        	lda	[<L59+row_1],Y
  1646 00:0520: 48           	pha
  1647 00:0521: 88           	dey
  1648 00:0522: 88           	dey
  1649 00:0523: B7 13        	lda	[<L59+row_1],Y
  1650 00:0525: 48           	pha
  1651 00:0526: 22 xx xx xx  	jsl	~~memcpy
  1652                        ;    row->hl = NULL;
  1653 00:052A: A9 00 00     	lda	#$0
  1654 00:052D: A0 0E 00     	ldy	#$e
  1655 00:0530: 97 13        	sta	[<L59+row_1],Y
  1656 00:0532: C8           	iny
  1657 00:0533: C8           	iny
  1658 00:0534: 97 13        	sta	[<L59+row_1],Y
  1659                        ;    row->hl_oc = 0;
  1660 00:0536: C8           	iny
  1661 00:0537: C8           	iny
  1662 00:0538: 97 13        	sta	[<L59+row_1],Y
  1663                        ;    row->render = NULL;
  1664 00:053A: A0 0A 00     	ldy	#$a
  1665 00:053D: 97 13        	sta	[<L59+row_1],Y
  1666 00:053F: C8           	iny
  1667 00:0540: C8           	iny
  1668 00:0541: 97 13        	sta	[<L59+row_1],Y
  1669                        ;    row->rsize = 0;
  1670 00:0543: A0 04 00     	ldy	#$4
  1671 00:0546: 97 13        	sta	[<L59+row_1],Y
  1672                        ;    row->idx = at;
  1673 00:0548: A5 1E        	lda	<L58+at_0
  1674 00:054A: 87 13        	sta	[<L59+row_1]
  1675                        ;
  1676                        ;    editorUpdateRow(row);
  1677 00:054C: D4 15        	pei	<L59+row_1+2
  1678 00:054E: D4 13        	pei	<L59+row_1
  1679 00:0550: 22 xx xx xx  	jsl	~~editorUpdateRow
  1680                        ;	
  1681                        ;	//fprintf(stderr, "insert row: %d, %s, render; %
                    s\n", at, E.row[at].chars, E.row[at].render);
  1682                        ;		
  1683                        ;    E.numrows++;
  1684 00:0554: EE xx xx     	inc	|~~E+12
  1685                        ;    E.dirty++;
  1686 00:0557: EE xx xx     	inc	|~~E+20
  1687                        ;	E.rowsavail--;
  1688 00:055A: CE xx xx     	dec	|~~E+118
  1689                        ;	
  1690                        ;	//debugf("E.numrows:%d \n", (size_t)E.numrows);
  1691                        ;}
  1692 00:055D: 82 2D FE     	brl	L61
  1693             0000001A   L58	equ	26
  1694             00000011   L59	equ	17
  Sun Jan  9 2022 20:39                                                Page 33


  1695                        	ends
  1696                        	efunc
  1697                        ;
  1698                        ;/* free row's heap allocated stuff. */
  1699                        ;void editorfreeRow(erow *row) {
  1700                        	code
  1701                        	xdef	~~editorfreeRow
  1702                        	func
  1703                        ~~editorfreeRow:
  1704                        	longa	on
  1705                        	longi	on
  1706 00:0560: 3B           	tsc
  1707 00:0561: 38           	sec
  1708 00:0562: E9 00 00     	sbc	#L65
  1709 00:0565: 1B           	tcs
  1710 00:0566: 0B           	phd
  1711 00:0567: 5B           	tcd
  1712             00000004   row_0	set	4
  1713                        ;    free(row->render);
  1714 00:0568: A0 0C 00     	ldy	#$c
  1715 00:056B: B7 04        	lda	[<L65+row_0],Y
  1716 00:056D: 48           	pha
  1717 00:056E: 88           	dey
  1718 00:056F: 88           	dey
  1719 00:0570: B7 04        	lda	[<L65+row_0],Y
  1720 00:0572: 48           	pha
  1721 00:0573: 22 xx xx xx  	jsl	~~free
  1722                        ;	if (row->render != row->chars)
  1723                        ;		free(row->chars);
  1724 00:0577: A0 0A 00     	ldy	#$a
  1725 00:057A: B7 04        	lda	[<L65+row_0],Y
  1726 00:057C: A0 06 00     	ldy	#$6
  1727 00:057F: D7 04        	cmp	[<L65+row_0],Y
  1728 00:0581: D0 0A        	bne	L67
  1729 00:0583: A0 0C 00     	ldy	#$c
  1730 00:0586: B7 04        	lda	[<L65+row_0],Y
  1731 00:0588: A0 08 00     	ldy	#$8
  1732 00:058B: D7 04        	cmp	[<L65+row_0],Y
  1733                        L67:
  1734 00:058D: F0 0F        	beq	L10053
  1735 00:058F: A0 08 00     	ldy	#$8
  1736 00:0592: B7 04        	lda	[<L65+row_0],Y
  1737 00:0594: 48           	pha
  1738 00:0595: 88           	dey
  1739 00:0596: 88           	dey
  1740 00:0597: B7 04        	lda	[<L65+row_0],Y
  1741 00:0599: 48           	pha
  1742 00:059A: 22 xx xx xx  	jsl	~~free
  1743                        ;    free(row->hl);
  1744                        L10053:
  1745 00:059E: A0 10 00     	ldy	#$10
  1746 00:05A1: B7 04        	lda	[<L65+row_0],Y
  1747 00:05A3: 48           	pha
  1748 00:05A4: 88           	dey
  1749 00:05A5: 88           	dey
  1750 00:05A6: B7 04        	lda	[<L65+row_0],Y
  1751 00:05A8: 48           	pha
  1752 00:05A9: 22 xx xx xx  	jsl	~~free
  Sun Jan  9 2022 20:39                                                Page 34


  1753                        ;}
  1754 00:05AD: A5 02        	lda	<L65+2
  1755 00:05AF: 85 06        	sta	<L65+2+4
  1756 00:05B1: A5 01        	lda	<L65+1
  1757 00:05B3: 85 05        	sta	<L65+1+4
  1758 00:05B5: 2B           	pld
  1759 00:05B6: 3B           	tsc
  1760 00:05B7: 18           	clc
  1761 00:05B8: 69 04 00     	adc	#L65+4
  1762 00:05BB: 1B           	tcs
  1763 00:05BC: 6B           	rtl
  1764             00000000   L65	equ	0
  1765             00000001   L66	equ	1
  1766                        	ends
  1767                        	efunc
  1768                        ;
  1769                        ;/* Remove the row at the specified position, shif
                    ting the remainign on the
  1770                        ; * top. */
  1771                        ;void editorDelRow(int at) {
  1772                        	code
  1773                        	xdef	~~editorDelRow
  1774                        	func
  1775                        ~~editorDelRow:
  1776                        	longa	on
  1777                        	longi	on
  1778 00:05BD: 3B           	tsc
  1779 00:05BE: 38           	sec
  1780 00:05BF: E9 1A 00     	sbc	#L70
  1781 00:05C2: 1B           	tcs
  1782 00:05C3: 0B           	phd
  1783 00:05C4: 5B           	tcd
  1784             00000004   at_0	set	4
  1785                        ;    erow *row;
  1786                        ;    int j;
  1787                        ;    
  1788                        ;    if (at >= E.numrows) return;
  1789             00000000   row_1	set	0
  1790             00000004   j_1	set	4
  1791 00:05C5: A5 1E        	lda	<L70+at_0
  1792 00:05C7: CD xx xx     	cmp	|~~E+12
  1793 00:05CA: 90 10        	bcc	L10054
  1794                        L73:
  1795 00:05CC: A5 1C        	lda	<L70+2
  1796 00:05CE: 85 1E        	sta	<L70+2+2
  1797 00:05D0: A5 1B        	lda	<L70+1
  1798 00:05D2: 85 1D        	sta	<L70+1+2
  1799 00:05D4: 2B           	pld
  1800 00:05D5: 3B           	tsc
  1801 00:05D6: 18           	clc
  1802 00:05D7: 69 1C 00     	adc	#L70+2
  1803 00:05DA: 1B           	tcs
  1804 00:05DB: 6B           	rtl
  1805                        ;    row = E.row+at;
  1806                        L10054:
  1807 00:05DC: A0 00 00     	ldy	#$0
  1808 00:05DF: A5 1E        	lda	<L70+at_0
  1809 00:05E1: 10 01        	bpl	L74
  Sun Jan  9 2022 20:39                                                Page 35


  1810 00:05E3: 88           	dey
  1811                        L74:
  1812 00:05E4: 85 01        	sta	<R0
  1813 00:05E6: 84 03        	sty	<R0+2
  1814 00:05E8: F4 00 00     	pea	#^$14
  1815 00:05EB: F4 14 00     	pea	#<$14
  1816 00:05EE: D4 03        	pei	<R0+2
  1817 00:05F0: D4 01        	pei	<R0
  1818                        	xref	~~~lmul
  1819 00:05F2: 22 xx xx xx  	jsl	~~~lmul
  1820 00:05F6: 85 01        	sta	<R0
  1821 00:05F8: 86 03        	stx	<R0+2
  1822 00:05FA: AD xx xx     	lda	|~~E+16
  1823 00:05FD: 18           	clc
  1824 00:05FE: 65 01        	adc	<R0
  1825 00:0600: 85 15        	sta	<L71+row_1
  1826 00:0602: AD xx xx     	lda	|~~E+16+2
  1827 00:0605: 65 03        	adc	<R0+2
  1828 00:0607: 85 17        	sta	<L71+row_1+2
  1829                        ;    editorfreeRow(row);
  1830 00:0609: 48           	pha
  1831 00:060A: D4 15        	pei	<L71+row_1
  1832 00:060C: 22 xx xx xx  	jsl	~~editorfreeRow
  1833                        ;    memmove(E.row+at,E.row+at+1,sizeof(E.row[0])*
                    (E.numrows-at-1));
  1834 00:0610: 38           	sec
  1835 00:0611: AD xx xx     	lda	|~~E+12
  1836 00:0614: E5 1E        	sbc	<L70+at_0
  1837 00:0616: 18           	clc
  1838 00:0617: 69 FF FF     	adc	#$ffff
  1839 00:061A: 85 01        	sta	<R0
  1840 00:061C: 64 03        	stz	<R0+2
  1841 00:061E: F4 00 00     	pea	#^$14
  1842 00:0621: F4 14 00     	pea	#<$14
  1843 00:0624: D4 03        	pei	<R0+2
  1844 00:0626: D4 01        	pei	<R0
  1845                        	xref	~~~lmul
  1846 00:0628: 22 xx xx xx  	jsl	~~~lmul
  1847 00:062C: 85 01        	sta	<R0
  1848 00:062E: 86 03        	stx	<R0+2
  1849 00:0630: D4 03        	pei	<R0+2
  1850 00:0632: D4 01        	pei	<R0
  1851 00:0634: A0 00 00     	ldy	#$0
  1852 00:0637: A5 1E        	lda	<L70+at_0
  1853 00:0639: 10 01        	bpl	L75
  1854 00:063B: 88           	dey
  1855                        L75:
  1856 00:063C: 85 05        	sta	<R1
  1857 00:063E: 84 07        	sty	<R1+2
  1858 00:0640: F4 00 00     	pea	#^$14
  1859 00:0643: F4 14 00     	pea	#<$14
  1860 00:0646: D4 07        	pei	<R1+2
  1861 00:0648: D4 05        	pei	<R1
  1862                        	xref	~~~lmul
  1863 00:064A: 22 xx xx xx  	jsl	~~~lmul
  1864 00:064E: 85 05        	sta	<R1
  1865 00:0650: 86 07        	stx	<R1+2
  1866 00:0652: A9 14 00     	lda	#$14
  Sun Jan  9 2022 20:39                                                Page 36


  1867 00:0655: 18           	clc
  1868 00:0656: 65 05        	adc	<R1
  1869 00:0658: 85 09        	sta	<R2
  1870 00:065A: A9 00 00     	lda	#$0
  1871 00:065D: 65 07        	adc	<R1+2
  1872 00:065F: 85 0B        	sta	<R2+2
  1873 00:0661: AD xx xx     	lda	|~~E+16
  1874 00:0664: 18           	clc
  1875 00:0665: 65 09        	adc	<R2
  1876 00:0667: 85 05        	sta	<R1
  1877 00:0669: AD xx xx     	lda	|~~E+16+2
  1878 00:066C: 65 0B        	adc	<R2+2
  1879 00:066E: 48           	pha
  1880 00:066F: D4 05        	pei	<R1
  1881 00:0671: A0 00 00     	ldy	#$0
  1882 00:0674: A5 1E        	lda	<L70+at_0
  1883 00:0676: 10 01        	bpl	L76
  1884 00:0678: 88           	dey
  1885                        L76:
  1886 00:0679: 85 0D        	sta	<R3
  1887 00:067B: 84 0F        	sty	<R3+2
  1888 00:067D: F4 00 00     	pea	#^$14
  1889 00:0680: F4 14 00     	pea	#<$14
  1890 00:0683: D4 0F        	pei	<R3+2
  1891 00:0685: D4 0D        	pei	<R3
  1892                        	xref	~~~lmul
  1893 00:0687: 22 xx xx xx  	jsl	~~~lmul
  1894 00:068B: 85 0D        	sta	<R3
  1895 00:068D: 86 0F        	stx	<R3+2
  1896 00:068F: AD xx xx     	lda	|~~E+16
  1897 00:0692: 18           	clc
  1898 00:0693: 65 0D        	adc	<R3
  1899 00:0695: 85 11        	sta	<17
  1900 00:0697: AD xx xx     	lda	|~~E+16+2
  1901 00:069A: 65 0F        	adc	<R3+2
  1902 00:069C: 85 13        	sta	<17+2
  1903 00:069E: 48           	pha
  1904 00:069F: D4 11        	pei	<17
  1905 00:06A1: 22 xx xx xx  	jsl	~~memmove
  1906                        ;    for (j = at; j < E.numrows-1; j++) E.row[j].i
                    dx++;
  1907 00:06A5: A5 1E        	lda	<L70+at_0
  1908 00:06A7: 85 19        	sta	<L71+j_1
  1909 00:06A9: 80 34        	bra	L10058
  1910                        L10057:
  1911 00:06AB: A0 00 00     	ldy	#$0
  1912 00:06AE: A5 19        	lda	<L71+j_1
  1913 00:06B0: 10 01        	bpl	L77
  1914 00:06B2: 88           	dey
  1915                        L77:
  1916 00:06B3: 85 01        	sta	<R0
  1917 00:06B5: 84 03        	sty	<R0+2
  1918 00:06B7: F4 00 00     	pea	#^$14
  1919 00:06BA: F4 14 00     	pea	#<$14
  1920 00:06BD: D4 03        	pei	<R0+2
  1921 00:06BF: D4 01        	pei	<R0
  1922                        	xref	~~~lmul
  1923 00:06C1: 22 xx xx xx  	jsl	~~~lmul
  Sun Jan  9 2022 20:39                                                Page 37


  1924 00:06C5: 85 01        	sta	<R0
  1925 00:06C7: 86 03        	stx	<R0+2
  1926 00:06C9: AD xx xx     	lda	|~~E+16
  1927 00:06CC: 18           	clc
  1928 00:06CD: 65 01        	adc	<R0
  1929 00:06CF: 85 05        	sta	<R1
  1930 00:06D1: AD xx xx     	lda	|~~E+16+2
  1931 00:06D4: 65 03        	adc	<R0+2
  1932 00:06D6: 85 07        	sta	<R1+2
  1933 00:06D8: A7 05        	lda	[<R1]
  1934 00:06DA: 1A           	ina
  1935 00:06DB: 87 05        	sta	[<R1]
  1936 00:06DD: E6 19        	inc	<L71+j_1
  1937                        L10058:
  1938 00:06DF: A9 FF FF     	lda	#$ffff
  1939 00:06E2: 18           	clc
  1940 00:06E3: 6D xx xx     	adc	|~~E+12
  1941 00:06E6: 85 01        	sta	<R0
  1942 00:06E8: A5 19        	lda	<L71+j_1
  1943 00:06EA: C5 01        	cmp	<R0
  1944 00:06EC: 90 BD        	bcc	L10057
  1945                        ;    E.numrows--;
  1946 00:06EE: CE xx xx     	dec	|~~E+12
  1947                        ;    E.dirty++;
  1948 00:06F1: EE xx xx     	inc	|~~E+20
  1949                        ;}
  1950 00:06F4: 82 D5 FE     	brl	L73
  1951             0000001A   L70	equ	26
  1952             00000015   L71	equ	21
  1953                        	ends
  1954                        	efunc
  1955                        ;
  1956                        ;void editorfreeAllRows() {
  1957                        	code
  1958                        	xdef	~~editorfreeAllRows
  1959                        	func
  1960                        ~~editorfreeAllRows:
  1961                        	longa	on
  1962                        	longi	on
  1963 00:06F7: 3B           	tsc
  1964 00:06F8: 38           	sec
  1965 00:06F9: E9 06 00     	sbc	#L79
  1966 00:06FC: 1B           	tcs
  1967 00:06FD: 0B           	phd
  1968 00:06FE: 5B           	tcd
  1969                        ;	int j;
  1970                        ;	erow *row;
  1971                        ;	
  1972                        ;	row = E.row;
  1973             00000000   j_1	set	0
  1974             00000002   row_1	set	2
  1975 00:06FF: AD xx xx     	lda	|~~E+16
  1976 00:0702: 85 03        	sta	<L80+row_1
  1977 00:0704: AD xx xx     	lda	|~~E+16+2
  1978 00:0707: 85 05        	sta	<L80+row_1+2
  1979                        ;    for (j = 0; j < E.numrows; j++) {
  1980 00:0709: 64 01        	stz	<L80+j_1
  1981 00:070B: 80 19        	bra	L10062
  Sun Jan  9 2022 20:39                                                Page 38


  1982                        L10061:
  1983                        ;		editorfreeRow(row);
  1984 00:070D: D4 05        	pei	<L80+row_1+2
  1985 00:070F: D4 03        	pei	<L80+row_1
  1986 00:0711: 22 xx xx xx  	jsl	~~editorfreeRow
  1987                        ;		row++;
  1988 00:0715: A9 14 00     	lda	#$14
  1989 00:0718: 18           	clc
  1990 00:0719: 65 03        	adc	<L80+row_1
  1991 00:071B: 85 03        	sta	<L80+row_1
  1992 00:071D: 90 02        	bcc	L81
  1993 00:071F: E6 05        	inc	<L80+row_1+2
  1994                        L81:
  1995                        ;		E.rowsavail++;
  1996 00:0721: EE xx xx     	inc	|~~E+118
  1997                        ;	}	
  1998 00:0724: E6 01        	inc	<L80+j_1
  1999                        L10062:
  2000 00:0726: A5 01        	lda	<L80+j_1
  2001 00:0728: CD xx xx     	cmp	|~~E+12
  2002 00:072B: 90 E0        	bcc	L10061
  2003                        ;}
  2004 00:072D: 2B           	pld
  2005 00:072E: 3B           	tsc
  2006 00:072F: 18           	clc
  2007 00:0730: 69 06 00     	adc	#L79
  2008 00:0733: 1B           	tcs
  2009 00:0734: 6B           	rtl
  2010             00000006   L79	equ	6
  2011             00000001   L80	equ	1
  2012                        	ends
  2013                        	efunc
  2014                        ;
  2015                        ;/* Turn the editor rows into a single heap-alloca
                    ted string.
  2016                        ; * Returns the pointer to the heap-allocated stri
                    ng and populate the
  2017                        ; * integer pointed by 'buflen' with the size of t
                    he string, escluding
  2018                        ; * the final nulterm. */
  2019                        ;char *editorRowsToString(size_t *buflen) {
  2020                        	code
  2021                        	xdef	~~editorRowsToString
  2022                        	func
  2023                        ~~editorRowsToString:
  2024                        	longa	on
  2025                        	longi	on
  2026 00:0735: 3B           	tsc
  2027 00:0736: 38           	sec
  2028 00:0737: E9 1E 00     	sbc	#L84
  2029 00:073A: 1B           	tcs
  2030 00:073B: 0B           	phd
  2031 00:073C: 5B           	tcd
  2032             00000004   buflen_0	set	4
  2033                        ;    char *buf, *p;
  2034                        ;    size_t totlen;
  2035                        ;    int j;
  2036                        ;
  Sun Jan  9 2022 20:39                                                Page 39


  2037                        ;	totlen = 0;
  2038             00000000   buf_1	set	0
  2039             00000004   p_1	set	4
  2040             00000008   totlen_1	set	8
  2041             0000000C   j_1	set	12
  2042 00:073D: 64 19        	stz	<L85+totlen_1
  2043 00:073F: 64 1B        	stz	<L85+totlen_1+2
  2044                        ;	
  2045                        ;    /* Compute count of bytes */
  2046                        ;    for (j = 0; j < E.numrows; j++)
  2047 00:0741: 64 1D        	stz	<L85+j_1
  2048 00:0743: 80 5C        	bra	L10066
  2049                        L10065:
  2050                        ;        totlen += E.row[j].size+1; /* +1 is for "
                    \n" at end of every row */
  2051 00:0745: A0 00 00     	ldy	#$0
  2052 00:0748: A5 1D        	lda	<L85+j_1
  2053 00:074A: 10 01        	bpl	L86
  2054 00:074C: 88           	dey
  2055                        L86:
  2056 00:074D: 85 01        	sta	<R0
  2057 00:074F: 84 03        	sty	<R0+2
  2058 00:0751: F4 00 00     	pea	#^$14
  2059 00:0754: F4 14 00     	pea	#<$14
  2060 00:0757: D4 03        	pei	<R0+2
  2061 00:0759: D4 01        	pei	<R0
  2062                        	xref	~~~lmul
  2063 00:075B: 22 xx xx xx  	jsl	~~~lmul
  2064 00:075F: 85 01        	sta	<R0
  2065 00:0761: 86 03        	stx	<R0+2
  2066 00:0763: A9 02 00     	lda	#$2
  2067 00:0766: 18           	clc
  2068 00:0767: 6D xx xx     	adc	|~~E+16
  2069 00:076A: 85 05        	sta	<R1
  2070 00:076C: A9 00 00     	lda	#$0
  2071 00:076F: 6D xx xx     	adc	|~~E+16+2
  2072 00:0772: 85 07        	sta	<R1+2
  2073 00:0774: A5 05        	lda	<R1
  2074 00:0776: 18           	clc
  2075 00:0777: 65 01        	adc	<R0
  2076 00:0779: 85 09        	sta	<R2
  2077 00:077B: A5 07        	lda	<R1+2
  2078 00:077D: 65 03        	adc	<R0+2
  2079 00:077F: 85 0B        	sta	<R2+2
  2080 00:0781: A7 09        	lda	[<R2]
  2081 00:0783: 1A           	ina
  2082 00:0784: 85 01        	sta	<R0
  2083 00:0786: A0 00 00     	ldy	#$0
  2084 00:0789: A5 01        	lda	<R0
  2085 00:078B: 10 01        	bpl	L87
  2086 00:078D: 88           	dey
  2087                        L87:
  2088 00:078E: 85 01        	sta	<R0
  2089 00:0790: 84 03        	sty	<R0+2
  2090 00:0792: A5 01        	lda	<R0
  2091 00:0794: 18           	clc
  2092 00:0795: 65 19        	adc	<L85+totlen_1
  2093 00:0797: 85 19        	sta	<L85+totlen_1
  Sun Jan  9 2022 20:39                                                Page 40


  2094 00:0799: A5 03        	lda	<R0+2
  2095 00:079B: 65 1B        	adc	<L85+totlen_1+2
  2096 00:079D: 85 1B        	sta	<L85+totlen_1+2
  2097 00:079F: E6 1D        	inc	<L85+j_1
  2098                        L10066:
  2099 00:07A1: A5 1D        	lda	<L85+j_1
  2100 00:07A3: CD xx xx     	cmp	|~~E+12
  2101 00:07A6: 90 9D        	bcc	L10065
  2102                        ;    *buflen = totlen;
  2103 00:07A8: A5 19        	lda	<L85+totlen_1
  2104 00:07AA: 87 22        	sta	[<L84+buflen_0]
  2105 00:07AC: A5 1B        	lda	<L85+totlen_1+2
  2106 00:07AE: A0 02 00     	ldy	#$2
  2107 00:07B1: 97 22        	sta	[<L84+buflen_0],Y
  2108                        ;    totlen++; /* Also make space for nulterm */
  2109 00:07B3: E6 19        	inc	<L85+totlen_1
  2110 00:07B5: D0 02        	bne	L89
  2111 00:07B7: E6 1B        	inc	<L85+totlen_1+2
  2112                        L89:
  2113                        ;
  2114                        ;    p = buf = malloc(totlen);
  2115 00:07B9: D4 1B        	pei	<L85+totlen_1+2
  2116 00:07BB: D4 19        	pei	<L85+totlen_1
  2117 00:07BD: 22 xx xx xx  	jsl	~~malloc
  2118 00:07C1: 85 11        	sta	<L85+buf_1
  2119 00:07C3: 86 13        	stx	<L85+buf_1+2
  2120 00:07C5: 85 15        	sta	<L85+p_1
  2121 00:07C7: A5 13        	lda	<L85+buf_1+2
  2122 00:07C9: 85 17        	sta	<L85+p_1+2
  2123                        ;    for (j = 0; j < E.numrows; j++) {
  2124 00:07CB: 64 1D        	stz	<L85+j_1
  2125 00:07CD: 82 FE 00     	brl	L10070
  2126                        L10069:
  2127                        ;        memcpy(p,E.row[j].chars,E.row[j].size);
  2128 00:07D0: A0 00 00     	ldy	#$0
  2129 00:07D3: A5 1D        	lda	<L85+j_1
  2130 00:07D5: 10 01        	bpl	L90
  2131 00:07D7: 88           	dey
  2132                        L90:
  2133 00:07D8: 85 01        	sta	<R0
  2134 00:07DA: 84 03        	sty	<R0+2
  2135 00:07DC: F4 00 00     	pea	#^$14
  2136 00:07DF: F4 14 00     	pea	#<$14
  2137 00:07E2: D4 03        	pei	<R0+2
  2138 00:07E4: D4 01        	pei	<R0
  2139                        	xref	~~~lmul
  2140 00:07E6: 22 xx xx xx  	jsl	~~~lmul
  2141 00:07EA: 85 01        	sta	<R0
  2142 00:07EC: 86 03        	stx	<R0+2
  2143 00:07EE: A9 02 00     	lda	#$2
  2144 00:07F1: 18           	clc
  2145 00:07F2: 6D xx xx     	adc	|~~E+16
  2146 00:07F5: 85 05        	sta	<R1
  2147 00:07F7: A9 00 00     	lda	#$0
  2148 00:07FA: 6D xx xx     	adc	|~~E+16+2
  2149 00:07FD: 85 07        	sta	<R1+2
  2150 00:07FF: A5 05        	lda	<R1
  2151 00:0801: 18           	clc
  Sun Jan  9 2022 20:39                                                Page 41


  2152 00:0802: 65 01        	adc	<R0
  2153 00:0804: 85 09        	sta	<R2
  2154 00:0806: A5 07        	lda	<R1+2
  2155 00:0808: 65 03        	adc	<R0+2
  2156 00:080A: 85 0B        	sta	<R2+2
  2157 00:080C: A0 00 00     	ldy	#$0
  2158 00:080F: A7 09        	lda	[<R2]
  2159 00:0811: 10 01        	bpl	L91
  2160 00:0813: 88           	dey
  2161                        L91:
  2162 00:0814: 85 01        	sta	<R0
  2163 00:0816: 84 03        	sty	<R0+2
  2164 00:0818: D4 03        	pei	<R0+2
  2165 00:081A: D4 01        	pei	<R0
  2166 00:081C: A0 00 00     	ldy	#$0
  2167 00:081F: A5 1D        	lda	<L85+j_1
  2168 00:0821: 10 01        	bpl	L92
  2169 00:0823: 88           	dey
  2170                        L92:
  2171 00:0824: 85 05        	sta	<R1
  2172 00:0826: 84 07        	sty	<R1+2
  2173 00:0828: F4 00 00     	pea	#^$14
  2174 00:082B: F4 14 00     	pea	#<$14
  2175 00:082E: D4 07        	pei	<R1+2
  2176 00:0830: D4 05        	pei	<R1
  2177                        	xref	~~~lmul
  2178 00:0832: 22 xx xx xx  	jsl	~~~lmul
  2179 00:0836: 85 05        	sta	<R1
  2180 00:0838: 86 07        	stx	<R1+2
  2181 00:083A: A9 06 00     	lda	#$6
  2182 00:083D: 18           	clc
  2183 00:083E: 6D xx xx     	adc	|~~E+16
  2184 00:0841: 85 09        	sta	<R2
  2185 00:0843: A9 00 00     	lda	#$0
  2186 00:0846: 6D xx xx     	adc	|~~E+16+2
  2187 00:0849: 85 0B        	sta	<R2+2
  2188 00:084B: A5 09        	lda	<R2
  2189 00:084D: 18           	clc
  2190 00:084E: 65 05        	adc	<R1
  2191 00:0850: 85 0D        	sta	<R3
  2192 00:0852: A5 0B        	lda	<R2+2
  2193 00:0854: 65 07        	adc	<R1+2
  2194 00:0856: 85 0F        	sta	<R3+2
  2195 00:0858: A0 02 00     	ldy	#$2
  2196 00:085B: B7 0D        	lda	[<R3],Y
  2197 00:085D: 48           	pha
  2198 00:085E: A7 0D        	lda	[<R3]
  2199 00:0860: 48           	pha
  2200 00:0861: D4 17        	pei	<L85+p_1+2
  2201 00:0863: D4 15        	pei	<L85+p_1
  2202 00:0865: 22 xx xx xx  	jsl	~~memcpy
  2203                        ;        p += E.row[j].size;
  2204 00:0869: A0 00 00     	ldy	#$0
  2205 00:086C: A5 1D        	lda	<L85+j_1
  2206 00:086E: 10 01        	bpl	L93
  2207 00:0870: 88           	dey
  2208                        L93:
  2209 00:0871: 85 01        	sta	<R0
  Sun Jan  9 2022 20:39                                                Page 42


  2210 00:0873: 84 03        	sty	<R0+2
  2211 00:0875: F4 00 00     	pea	#^$14
  2212 00:0878: F4 14 00     	pea	#<$14
  2213 00:087B: D4 03        	pei	<R0+2
  2214 00:087D: D4 01        	pei	<R0
  2215                        	xref	~~~lmul
  2216 00:087F: 22 xx xx xx  	jsl	~~~lmul
  2217 00:0883: 85 01        	sta	<R0
  2218 00:0885: 86 03        	stx	<R0+2
  2219 00:0887: A9 02 00     	lda	#$2
  2220 00:088A: 18           	clc
  2221 00:088B: 6D xx xx     	adc	|~~E+16
  2222 00:088E: 85 05        	sta	<R1
  2223 00:0890: A9 00 00     	lda	#$0
  2224 00:0893: 6D xx xx     	adc	|~~E+16+2
  2225 00:0896: 85 07        	sta	<R1+2
  2226 00:0898: A5 05        	lda	<R1
  2227 00:089A: 18           	clc
  2228 00:089B: 65 01        	adc	<R0
  2229 00:089D: 85 09        	sta	<R2
  2230 00:089F: A5 07        	lda	<R1+2
  2231 00:08A1: 65 03        	adc	<R0+2
  2232 00:08A3: 85 0B        	sta	<R2+2
  2233 00:08A5: A0 00 00     	ldy	#$0
  2234 00:08A8: A7 09        	lda	[<R2]
  2235 00:08AA: 10 01        	bpl	L94
  2236 00:08AC: 88           	dey
  2237                        L94:
  2238 00:08AD: 85 01        	sta	<R0
  2239 00:08AF: 84 03        	sty	<R0+2
  2240 00:08B1: A5 15        	lda	<L85+p_1
  2241 00:08B3: 18           	clc
  2242 00:08B4: 65 01        	adc	<R0
  2243 00:08B6: 85 15        	sta	<L85+p_1
  2244 00:08B8: A5 17        	lda	<L85+p_1+2
  2245 00:08BA: 65 03        	adc	<R0+2
  2246 00:08BC: 85 17        	sta	<L85+p_1+2
  2247                        ;        *p = '\n';
  2248 00:08BE: E2 20        	sep	#$20
  2249                        	longa	off
  2250 00:08C0: A9 0A        	lda	#$a
  2251 00:08C2: 87 15        	sta	[<L85+p_1]
  2252 00:08C4: C2 20        	rep	#$20
  2253                        	longa	on
  2254                        ;        p++;
  2255 00:08C6: E6 15        	inc	<L85+p_1
  2256 00:08C8: D0 02        	bne	L10067
  2257 00:08CA: E6 17        	inc	<L85+p_1+2
  2258                        ;    }
  2259                        L10067:
  2260 00:08CC: E6 1D        	inc	<L85+j_1
  2261                        L10070:
  2262 00:08CE: A5 1D        	lda	<L85+j_1
  2263 00:08D0: CD xx xx     	cmp	|~~E+12
  2264 00:08D3: B0 03        	bcs	*+5
  2265 00:08D5: 82 F8 FE     	brl	L10069
  2266                        ;    *p = '\0';
  2267 00:08D8: E2 20        	sep	#$20
  Sun Jan  9 2022 20:39                                                Page 43


  2268                        	longa	off
  2269 00:08DA: A9 00        	lda	#$0
  2270 00:08DC: 87 15        	sta	[<L85+p_1]
  2271 00:08DE: C2 20        	rep	#$20
  2272                        	longa	on
  2273                        ;    return buf;
  2274 00:08E0: A6 13        	ldx	<L85+buf_1+2
  2275 00:08E2: A5 11        	lda	<L85+buf_1
  2276 00:08E4: A8           	tay
  2277 00:08E5: A5 20        	lda	<L84+2
  2278 00:08E7: 85 24        	sta	<L84+2+4
  2279 00:08E9: A5 1F        	lda	<L84+1
  2280 00:08EB: 85 23        	sta	<L84+1+4
  2281 00:08ED: 2B           	pld
  2282 00:08EE: 3B           	tsc
  2283 00:08EF: 18           	clc
  2284 00:08F0: 69 22 00     	adc	#L84+4
  2285 00:08F3: 1B           	tcs
  2286 00:08F4: 98           	tya
  2287 00:08F5: 6B           	rtl
  2288                        ;}
  2289             0000001E   L84	equ	30
  2290             00000011   L85	equ	17
  2291                        	ends
  2292                        	efunc
  2293                        ;
  2294                        ;/* Insert a character at the specified position i
                    n a row, moving the remaining
  2295                        ; * chars on the right if needed. */
  2296                        ;void editorRowInsertChar(erow *row, int at, int c
                    ) {
  2297                        	code
  2298                        	xdef	~~editorRowInsertChar
  2299                        	func
  2300                        ~~editorRowInsertChar:
  2301                        	longa	on
  2302                        	longi	on
  2303 00:08F6: 3B           	tsc
  2304 00:08F7: 38           	sec
  2305 00:08F8: E9 12 00     	sbc	#L98
  2306 00:08FB: 1B           	tcs
  2307 00:08FC: 0B           	phd
  2308 00:08FD: 5B           	tcd
  2309             00000004   row_0	set	4
  2310             00000008   at_0	set	8
  2311             0000000A   c_0	set	10
  2312                        ;    int padlen;
  2313                        ;    
  2314                        ;	
  2315                        ;	//fprintf(stderr, "RowInsertChar %08lX, at: %u, 
                    size: %u, c: %c \n", row, at, row->size, c);
  2316                        ;	
  2317                        ;    if (at > row->size) {
  2318             00000000   padlen_1	set	0
  2319 00:08FE: 38           	sec
  2320 00:08FF: A0 02 00     	ldy	#$2
  2321 00:0902: B7 16        	lda	[<L98+row_0],Y
  2322 00:0904: E5 1A        	sbc	<L98+at_0
  Sun Jan  9 2022 20:39                                                Page 44


  2323 00:0906: 70 03        	bvs	L100
  2324 00:0908: 49 00 80     	eor	#$8000
  2325                        L100:
  2326 00:090B: 10 03        	bpl	*+5
  2327 00:090D: 82 B6 00     	brl	L10071
  2328                        ;        /* Pad the string with spaces if the inse
                    rt location is outside the
  2329                        ;         * current length by more than a single c
                    haracter. */
  2330                        ;        padlen = at-row->size;
  2331 00:0910: 38           	sec
  2332 00:0911: A5 1A        	lda	<L98+at_0
  2333 00:0913: A0 02 00     	ldy	#$2
  2334 00:0916: F7 16        	sbc	[<L98+row_0],Y
  2335 00:0918: 85 11        	sta	<L99+padlen_1
  2336 00:091A: 18           	clc
  2337 00:091B: 77 16        	adc	[<L98+row_0],Y
  2338 00:091D: 18           	clc
  2339 00:091E: 69 02 00     	adc	#$2
  2340 00:0921: 85 05        	sta	<R1
  2341 00:0923: 88           	dey
  2342 00:0924: 88           	dey
  2343 00:0925: A5 05        	lda	<R1
  2344 00:0927: 10 01        	bpl	L102
  2345 00:0929: 88           	dey
  2346                        L102:
  2347 00:092A: 85 01        	sta	<R0
  2348 00:092C: 84 03        	sty	<R0+2
  2349 00:092E: D4 03        	pei	<R0+2
  2350 00:0930: D4 01        	pei	<R0
  2351 00:0932: A0 08 00     	ldy	#$8
  2352 00:0935: B7 16        	lda	[<L98+row_0],Y
  2353 00:0937: 48           	pha
  2354 00:0938: 88           	dey
  2355 00:0939: 88           	dey
  2356 00:093A: B7 16        	lda	[<L98+row_0],Y
  2357 00:093C: 48           	pha
  2358 00:093D: 22 xx xx xx  	jsl	~~realloc
  2359 00:0941: 86 07        	stx	<R1+2
  2360 00:0943: A0 06 00     	ldy	#$6
  2361 00:0946: 97 16        	sta	[<L98+row_0],Y
  2362 00:0948: A5 07        	lda	<R1+2
  2363 00:094A: C8           	iny
  2364 00:094B: C8           	iny
  2365 00:094C: 97 16        	sta	[<L98+row_0],Y
  2366                        ;        memset(row->chars+row->size,' ',padlen);
  2367 00:094E: A0 00 00     	ldy	#$0
  2368 00:0951: A5 11        	lda	<L99+padlen_1
  2369 00:0953: 10 01        	bpl	L103
  2370 00:0955: 88           	dey
  2371                        L103:
  2372 00:0956: 85 01        	sta	<R0
  2373 00:0958: 84 03        	sty	<R0+2
  2374 00:095A: D4 03        	pei	<R0+2
  2375 00:095C: D4 01        	pei	<R0
  2376 00:095E: F4 20 00     	pea	#<$20
  2377 00:0961: A0 00 00     	ldy	#$0
  2378 00:0964: 5A           	phy
  Sun Jan  9 2022 20:39                                                Page 45


  2379 00:0965: C8           	iny
  2380 00:0966: C8           	iny
  2381 00:0967: B7 16        	lda	[<L98+row_0],Y
  2382 00:0969: 7A           	ply
  2383 00:096A: 2A           	rol	A
  2384 00:096B: 6A           	ror	A
  2385 00:096C: 10 01        	bpl	L104
  2386 00:096E: 88           	dey
  2387                        L104:
  2388 00:096F: 85 05        	sta	<R1
  2389 00:0971: 84 07        	sty	<R1+2
  2390 00:0973: 18           	clc
  2391 00:0974: A0 06 00     	ldy	#$6
  2392 00:0977: B7 16        	lda	[<L98+row_0],Y
  2393 00:0979: 65 05        	adc	<R1
  2394 00:097B: 85 09        	sta	<R2
  2395 00:097D: C8           	iny
  2396 00:097E: C8           	iny
  2397 00:097F: B7 16        	lda	[<L98+row_0],Y
  2398 00:0981: 65 07        	adc	<R1+2
  2399 00:0983: 48           	pha
  2400 00:0984: D4 09        	pei	<R2
  2401 00:0986: 22 xx xx xx  	jsl	~~memset
  2402                        ;        row->chars[row->size+padlen+1] = '\0';
  2403 00:098A: 18           	clc
  2404 00:098B: A0 02 00     	ldy	#$2
  2405 00:098E: B7 16        	lda	[<L98+row_0],Y
  2406 00:0990: 65 11        	adc	<L99+padlen_1
  2407 00:0992: 1A           	ina
  2408 00:0993: 85 05        	sta	<R1
  2409 00:0995: A0 06 00     	ldy	#$6
  2410 00:0998: B7 16        	lda	[<L98+row_0],Y
  2411 00:099A: 85 01        	sta	<R0
  2412 00:099C: C8           	iny
  2413 00:099D: C8           	iny
  2414 00:099E: B7 16        	lda	[<L98+row_0],Y
  2415 00:09A0: 85 03        	sta	<R0+2
  2416 00:09A2: E2 20        	sep	#$20
  2417                        	longa	off
  2418 00:09A4: A9 00        	lda	#$0
  2419 00:09A6: A4 05        	ldy	<R1
  2420 00:09A8: 97 01        	sta	[<R0],Y
  2421 00:09AA: C2 20        	rep	#$20
  2422                        	longa	on
  2423                        ;        row->size += padlen+1;
  2424 00:09AC: A9 02 00     	lda	#$2
  2425 00:09AF: 18           	clc
  2426 00:09B0: 65 16        	adc	<L98+row_0
  2427 00:09B2: 85 01        	sta	<R0
  2428 00:09B4: A9 00 00     	lda	#$0
  2429 00:09B7: 65 18        	adc	<L98+row_0+2
  2430 00:09B9: 85 03        	sta	<R0+2
  2431 00:09BB: A7 01        	lda	[<R0]
  2432 00:09BD: 18           	clc
  2433 00:09BE: 65 11        	adc	<L99+padlen_1
  2434 00:09C0: 1A           	ina
  2435 00:09C1: 87 01        	sta	[<R0]
  2436                        ;    } else {
  Sun Jan  9 2022 20:39                                                Page 46


  2437 00:09C3: 82 A7 00     	brl	L10072
  2438                        L10071:
  2439                        ;        /* If we are in the middle of the string 
                    just make space for 1 new
  2440                        ;         * char plus the (already existing) null 
                    term. */
  2441                        ;		//fprintf(stderr, "RowInsertChar %08lX %
                    08lX \n", row->chars, (size_t)row->size+2);
  2442                        ;		
  2443                        ;        row->chars = realloc(row->chars,row->size
                    +2);
  2444 00:09C6: 18           	clc
  2445 00:09C7: A9 02 00     	lda	#$2
  2446 00:09CA: A8           	tay
  2447 00:09CB: 77 16        	adc	[<L98+row_0],Y
  2448 00:09CD: 85 01        	sta	<R0
  2449 00:09CF: 88           	dey
  2450 00:09D0: 88           	dey
  2451 00:09D1: A5 01        	lda	<R0
  2452 00:09D3: 10 01        	bpl	L105
  2453 00:09D5: 88           	dey
  2454                        L105:
  2455 00:09D6: 85 01        	sta	<R0
  2456 00:09D8: 84 03        	sty	<R0+2
  2457 00:09DA: D4 03        	pei	<R0+2
  2458 00:09DC: D4 01        	pei	<R0
  2459 00:09DE: A0 08 00     	ldy	#$8
  2460 00:09E1: B7 16        	lda	[<L98+row_0],Y
  2461 00:09E3: 48           	pha
  2462 00:09E4: 88           	dey
  2463 00:09E5: 88           	dey
  2464 00:09E6: B7 16        	lda	[<L98+row_0],Y
  2465 00:09E8: 48           	pha
  2466 00:09E9: 22 xx xx xx  	jsl	~~realloc
  2467 00:09ED: 86 07        	stx	<R1+2
  2468 00:09EF: A0 06 00     	ldy	#$6
  2469 00:09F2: 97 16        	sta	[<L98+row_0],Y
  2470 00:09F4: A5 07        	lda	<R1+2
  2471 00:09F6: C8           	iny
  2472 00:09F7: C8           	iny
  2473 00:09F8: 97 16        	sta	[<L98+row_0],Y
  2474                        ;		
  2475                        ;		//fprintf(stderr, "RowInsertChar %08lX \
                    n", row->chars);
  2476                        ;
  2477                        ;        memmove(row->chars+at+1,row->chars+at,row
                    ->size-at+1);
  2478 00:09FA: 38           	sec
  2479 00:09FB: A0 02 00     	ldy	#$2
  2480 00:09FE: B7 16        	lda	[<L98+row_0],Y
  2481 00:0A00: E5 1A        	sbc	<L98+at_0
  2482 00:0A02: 1A           	ina
  2483 00:0A03: 85 05        	sta	<R1
  2484 00:0A05: 88           	dey
  2485 00:0A06: 88           	dey
  2486 00:0A07: A5 05        	lda	<R1
  2487 00:0A09: 10 01        	bpl	L106
  2488 00:0A0B: 88           	dey
  Sun Jan  9 2022 20:39                                                Page 47


  2489                        L106:
  2490 00:0A0C: 85 01        	sta	<R0
  2491 00:0A0E: 84 03        	sty	<R0+2
  2492 00:0A10: D4 03        	pei	<R0+2
  2493 00:0A12: D4 01        	pei	<R0
  2494 00:0A14: A0 00 00     	ldy	#$0
  2495 00:0A17: A5 1A        	lda	<L98+at_0
  2496 00:0A19: 10 01        	bpl	L107
  2497 00:0A1B: 88           	dey
  2498                        L107:
  2499 00:0A1C: 85 05        	sta	<R1
  2500 00:0A1E: 84 07        	sty	<R1+2
  2501 00:0A20: 18           	clc
  2502 00:0A21: A0 06 00     	ldy	#$6
  2503 00:0A24: B7 16        	lda	[<L98+row_0],Y
  2504 00:0A26: 65 05        	adc	<R1
  2505 00:0A28: 85 09        	sta	<R2
  2506 00:0A2A: C8           	iny
  2507 00:0A2B: C8           	iny
  2508 00:0A2C: B7 16        	lda	[<L98+row_0],Y
  2509 00:0A2E: 65 07        	adc	<R1+2
  2510 00:0A30: 48           	pha
  2511 00:0A31: D4 09        	pei	<R2
  2512 00:0A33: A0 00 00     	ldy	#$0
  2513 00:0A36: A5 1A        	lda	<L98+at_0
  2514 00:0A38: 10 01        	bpl	L108
  2515 00:0A3A: 88           	dey
  2516                        L108:
  2517 00:0A3B: 85 05        	sta	<R1
  2518 00:0A3D: 84 07        	sty	<R1+2
  2519 00:0A3F: A9 01 00     	lda	#$1
  2520 00:0A42: 18           	clc
  2521 00:0A43: 65 05        	adc	<R1
  2522 00:0A45: 85 0D        	sta	<R3
  2523 00:0A47: A9 00 00     	lda	#$0
  2524 00:0A4A: 65 07        	adc	<R1+2
  2525 00:0A4C: 85 0F        	sta	<R3+2
  2526 00:0A4E: 18           	clc
  2527 00:0A4F: A0 06 00     	ldy	#$6
  2528 00:0A52: B7 16        	lda	[<L98+row_0],Y
  2529 00:0A54: 65 0D        	adc	<R3
  2530 00:0A56: 85 05        	sta	<R1
  2531 00:0A58: C8           	iny
  2532 00:0A59: C8           	iny
  2533 00:0A5A: B7 16        	lda	[<L98+row_0],Y
  2534 00:0A5C: 65 0F        	adc	<R3+2
  2535 00:0A5E: 48           	pha
  2536 00:0A5F: D4 05        	pei	<R1
  2537 00:0A61: 22 xx xx xx  	jsl	~~memmove
  2538                        ;        row->size++;
  2539 00:0A65: A0 02 00     	ldy	#$2
  2540 00:0A68: B7 16        	lda	[<L98+row_0],Y
  2541 00:0A6A: 1A           	ina
  2542 00:0A6B: 97 16        	sta	[<L98+row_0],Y
  2543                        ;    }
  2544                        L10072:
  2545                        ;    row->chars[at] = c;
  2546 00:0A6D: A0 06 00     	ldy	#$6
  Sun Jan  9 2022 20:39                                                Page 48


  2547 00:0A70: B7 16        	lda	[<L98+row_0],Y
  2548 00:0A72: 85 01        	sta	<R0
  2549 00:0A74: C8           	iny
  2550 00:0A75: C8           	iny
  2551 00:0A76: B7 16        	lda	[<L98+row_0],Y
  2552 00:0A78: 85 03        	sta	<R0+2
  2553 00:0A7A: E2 20        	sep	#$20
  2554                        	longa	off
  2555 00:0A7C: A5 1C        	lda	<L98+c_0
  2556 00:0A7E: A4 1A        	ldy	<L98+at_0
  2557 00:0A80: 97 01        	sta	[<R0],Y
  2558 00:0A82: C2 20        	rep	#$20
  2559                        	longa	on
  2560                        ;    editorUpdateRow(row);
  2561 00:0A84: D4 18        	pei	<L98+row_0+2
  2562 00:0A86: D4 16        	pei	<L98+row_0
  2563 00:0A88: 22 xx xx xx  	jsl	~~editorUpdateRow
  2564                        ;    E.dirty++;
  2565 00:0A8C: EE xx xx     	inc	|~~E+20
  2566                        ;}
  2567 00:0A8F: A5 14        	lda	<L98+2
  2568 00:0A91: 85 1C        	sta	<L98+2+8
  2569 00:0A93: A5 13        	lda	<L98+1
  2570 00:0A95: 85 1B        	sta	<L98+1+8
  2571 00:0A97: 2B           	pld
  2572 00:0A98: 3B           	tsc
  2573 00:0A99: 18           	clc
  2574 00:0A9A: 69 1A 00     	adc	#L98+8
  2575 00:0A9D: 1B           	tcs
  2576 00:0A9E: 6B           	rtl
  2577             00000012   L98	equ	18
  2578             00000011   L99	equ	17
  2579                        	ends
  2580                        	efunc
  2581                        ;
  2582                        ;/* Append the string 's' at the end of a row */
  2583                        ;void editorRowAppendString(erow *row, char *s, si
                    ze_t len) {
  2584                        	code
  2585                        	xdef	~~editorRowAppendString
  2586                        	func
  2587                        ~~editorRowAppendString:
  2588                        	longa	on
  2589                        	longi	on
  2590 00:0A9F: 3B           	tsc
  2591 00:0AA0: 38           	sec
  2592 00:0AA1: E9 0C 00     	sbc	#L110
  2593 00:0AA4: 1B           	tcs
  2594 00:0AA5: 0B           	phd
  2595 00:0AA6: 5B           	tcd
  2596             00000004   row_0	set	4
  2597             00000008   s_0	set	8
  2598             0000000C   len_0	set	12
  2599                        ;    row->chars = realloc(row->chars,row->size+len
                    +1);
  2600 00:0AA7: A0 00 00     	ldy	#$0
  2601 00:0AAA: 5A           	phy
  2602 00:0AAB: C8           	iny
  Sun Jan  9 2022 20:39                                                Page 49


  2603 00:0AAC: C8           	iny
  2604 00:0AAD: B7 10        	lda	[<L110+row_0],Y
  2605 00:0AAF: 7A           	ply
  2606 00:0AB0: 2A           	rol	A
  2607 00:0AB1: 6A           	ror	A
  2608 00:0AB2: 10 01        	bpl	L112
  2609 00:0AB4: 88           	dey
  2610                        L112:
  2611 00:0AB5: 85 01        	sta	<R0
  2612 00:0AB7: 84 03        	sty	<R0+2
  2613 00:0AB9: A5 01        	lda	<R0
  2614 00:0ABB: 18           	clc
  2615 00:0ABC: 65 18        	adc	<L110+len_0
  2616 00:0ABE: 85 05        	sta	<R1
  2617 00:0AC0: A5 03        	lda	<R0+2
  2618 00:0AC2: 65 1A        	adc	<L110+len_0+2
  2619 00:0AC4: 85 07        	sta	<R1+2
  2620 00:0AC6: A9 01 00     	lda	#$1
  2621 00:0AC9: 18           	clc
  2622 00:0ACA: 65 05        	adc	<R1
  2623 00:0ACC: 85 01        	sta	<R0
  2624 00:0ACE: A9 00 00     	lda	#$0
  2625 00:0AD1: 65 07        	adc	<R1+2
  2626 00:0AD3: 48           	pha
  2627 00:0AD4: D4 01        	pei	<R0
  2628 00:0AD6: A0 08 00     	ldy	#$8
  2629 00:0AD9: B7 10        	lda	[<L110+row_0],Y
  2630 00:0ADB: 48           	pha
  2631 00:0ADC: 88           	dey
  2632 00:0ADD: 88           	dey
  2633 00:0ADE: B7 10        	lda	[<L110+row_0],Y
  2634 00:0AE0: 48           	pha
  2635 00:0AE1: 22 xx xx xx  	jsl	~~realloc
  2636 00:0AE5: 86 07        	stx	<R1+2
  2637 00:0AE7: A0 06 00     	ldy	#$6
  2638 00:0AEA: 97 10        	sta	[<L110+row_0],Y
  2639 00:0AEC: A5 07        	lda	<R1+2
  2640 00:0AEE: C8           	iny
  2641 00:0AEF: C8           	iny
  2642 00:0AF0: 97 10        	sta	[<L110+row_0],Y
  2643                        ;    memcpy(row->chars+row->size,s,len);
  2644 00:0AF2: D4 1A        	pei	<L110+len_0+2
  2645 00:0AF4: D4 18        	pei	<L110+len_0
  2646 00:0AF6: D4 16        	pei	<L110+s_0+2
  2647 00:0AF8: D4 14        	pei	<L110+s_0
  2648 00:0AFA: A0 00 00     	ldy	#$0
  2649 00:0AFD: 5A           	phy
  2650 00:0AFE: C8           	iny
  2651 00:0AFF: C8           	iny
  2652 00:0B00: B7 10        	lda	[<L110+row_0],Y
  2653 00:0B02: 7A           	ply
  2654 00:0B03: 2A           	rol	A
  2655 00:0B04: 6A           	ror	A
  2656 00:0B05: 10 01        	bpl	L113
  2657 00:0B07: 88           	dey
  2658                        L113:
  2659 00:0B08: 85 01        	sta	<R0
  2660 00:0B0A: 84 03        	sty	<R0+2
  Sun Jan  9 2022 20:39                                                Page 50


  2661 00:0B0C: 18           	clc
  2662 00:0B0D: A0 06 00     	ldy	#$6
  2663 00:0B10: B7 10        	lda	[<L110+row_0],Y
  2664 00:0B12: 65 01        	adc	<R0
  2665 00:0B14: 85 05        	sta	<R1
  2666 00:0B16: C8           	iny
  2667 00:0B17: C8           	iny
  2668 00:0B18: B7 10        	lda	[<L110+row_0],Y
  2669 00:0B1A: 65 03        	adc	<R0+2
  2670 00:0B1C: 48           	pha
  2671 00:0B1D: D4 05        	pei	<R1
  2672 00:0B1F: 22 xx xx xx  	jsl	~~memcpy
  2673                        ;    row->size += len;
  2674 00:0B23: A9 02 00     	lda	#$2
  2675 00:0B26: 18           	clc
  2676 00:0B27: 65 10        	adc	<L110+row_0
  2677 00:0B29: 85 01        	sta	<R0
  2678 00:0B2B: A9 00 00     	lda	#$0
  2679 00:0B2E: 65 12        	adc	<L110+row_0+2
  2680 00:0B30: 85 03        	sta	<R0+2
  2681 00:0B32: A0 00 00     	ldy	#$0
  2682 00:0B35: A7 01        	lda	[<R0]
  2683 00:0B37: 10 01        	bpl	L114
  2684 00:0B39: 88           	dey
  2685                        L114:
  2686 00:0B3A: 85 05        	sta	<R1
  2687 00:0B3C: 84 07        	sty	<R1+2
  2688 00:0B3E: A5 05        	lda	<R1
  2689 00:0B40: 18           	clc
  2690 00:0B41: 65 18        	adc	<L110+len_0
  2691 00:0B43: 85 09        	sta	<R2
  2692 00:0B45: A5 07        	lda	<R1+2
  2693 00:0B47: 65 1A        	adc	<L110+len_0+2
  2694 00:0B49: 85 0B        	sta	<R2+2
  2695 00:0B4B: A5 09        	lda	<R2
  2696 00:0B4D: 87 01        	sta	[<R0]
  2697                        ;    row->chars[row->size] = '\0';
  2698 00:0B4F: A0 02 00     	ldy	#$2
  2699 00:0B52: B7 10        	lda	[<L110+row_0],Y
  2700 00:0B54: 85 01        	sta	<R0
  2701 00:0B56: A0 06 00     	ldy	#$6
  2702 00:0B59: B7 10        	lda	[<L110+row_0],Y
  2703 00:0B5B: 85 05        	sta	<R1
  2704 00:0B5D: C8           	iny
  2705 00:0B5E: C8           	iny
  2706 00:0B5F: B7 10        	lda	[<L110+row_0],Y
  2707 00:0B61: 85 07        	sta	<R1+2
  2708 00:0B63: E2 20        	sep	#$20
  2709                        	longa	off
  2710 00:0B65: A9 00        	lda	#$0
  2711 00:0B67: A4 01        	ldy	<R0
  2712 00:0B69: 97 05        	sta	[<R1],Y
  2713 00:0B6B: C2 20        	rep	#$20
  2714                        	longa	on
  2715                        ;    editorUpdateRow(row);
  2716 00:0B6D: D4 12        	pei	<L110+row_0+2
  2717 00:0B6F: D4 10        	pei	<L110+row_0
  2718 00:0B71: 22 xx xx xx  	jsl	~~editorUpdateRow
  Sun Jan  9 2022 20:39                                                Page 51


  2719                        ;    E.dirty++;
  2720 00:0B75: EE xx xx     	inc	|~~E+20
  2721                        ;}
  2722 00:0B78: A5 0E        	lda	<L110+2
  2723 00:0B7A: 85 1A        	sta	<L110+2+12
  2724 00:0B7C: A5 0D        	lda	<L110+1
  2725 00:0B7E: 85 19        	sta	<L110+1+12
  2726 00:0B80: 2B           	pld
  2727 00:0B81: 3B           	tsc
  2728 00:0B82: 18           	clc
  2729 00:0B83: 69 18 00     	adc	#L110+12
  2730 00:0B86: 1B           	tcs
  2731 00:0B87: 6B           	rtl
  2732             0000000C   L110	equ	12
  2733             0000000D   L111	equ	13
  2734                        	ends
  2735                        	efunc
  2736                        ;
  2737                        ;/* Delete the character at offset 'at' from the s
                    pecified row. */
  2738                        ;void editorRowDelChar(erow *row, int at) {
  2739                        	code
  2740                        	xdef	~~editorRowDelChar
  2741                        	func
  2742                        ~~editorRowDelChar:
  2743                        	longa	on
  2744                        	longi	on
  2745 00:0B88: 3B           	tsc
  2746 00:0B89: 38           	sec
  2747 00:0B8A: E9 14 00     	sbc	#L116
  2748 00:0B8D: 1B           	tcs
  2749 00:0B8E: 0B           	phd
  2750 00:0B8F: 5B           	tcd
  2751             00000004   row_0	set	4
  2752             00000008   at_0	set	8
  2753                        ;    if (row->size <= at) return;
  2754 00:0B90: 38           	sec
  2755 00:0B91: A5 1C        	lda	<L116+at_0
  2756 00:0B93: A0 02 00     	ldy	#$2
  2757 00:0B96: F7 18        	sbc	[<L116+row_0],Y
  2758 00:0B98: 70 03        	bvs	L118
  2759 00:0B9A: 49 00 80     	eor	#$8000
  2760                        L118:
  2761 00:0B9D: 10 10        	bpl	L10073
  2762                        L120:
  2763 00:0B9F: A5 16        	lda	<L116+2
  2764 00:0BA1: 85 1C        	sta	<L116+2+6
  2765 00:0BA3: A5 15        	lda	<L116+1
  2766 00:0BA5: 85 1B        	sta	<L116+1+6
  2767 00:0BA7: 2B           	pld
  2768 00:0BA8: 3B           	tsc
  2769 00:0BA9: 18           	clc
  2770 00:0BAA: 69 1A 00     	adc	#L116+6
  2771 00:0BAD: 1B           	tcs
  2772 00:0BAE: 6B           	rtl
  2773                        ;    memmove(row->chars+at,row->chars+at+1,row->si
                    ze-at);
  2774                        L10073:
  Sun Jan  9 2022 20:39                                                Page 52


  2775 00:0BAF: 38           	sec
  2776 00:0BB0: A0 02 00     	ldy	#$2
  2777 00:0BB3: B7 18        	lda	[<L116+row_0],Y
  2778 00:0BB5: E5 1C        	sbc	<L116+at_0
  2779 00:0BB7: 85 01        	sta	<R0
  2780 00:0BB9: 88           	dey
  2781 00:0BBA: 88           	dey
  2782 00:0BBB: A5 01        	lda	<R0
  2783 00:0BBD: 10 01        	bpl	L121
  2784 00:0BBF: 88           	dey
  2785                        L121:
  2786 00:0BC0: 85 01        	sta	<R0
  2787 00:0BC2: 84 03        	sty	<R0+2
  2788 00:0BC4: D4 03        	pei	<R0+2
  2789 00:0BC6: D4 01        	pei	<R0
  2790 00:0BC8: A0 00 00     	ldy	#$0
  2791 00:0BCB: A5 1C        	lda	<L116+at_0
  2792 00:0BCD: 10 01        	bpl	L122
  2793 00:0BCF: 88           	dey
  2794                        L122:
  2795 00:0BD0: 85 05        	sta	<R1
  2796 00:0BD2: 84 07        	sty	<R1+2
  2797 00:0BD4: A9 01 00     	lda	#$1
  2798 00:0BD7: 18           	clc
  2799 00:0BD8: 65 05        	adc	<R1
  2800 00:0BDA: 85 09        	sta	<R2
  2801 00:0BDC: A9 00 00     	lda	#$0
  2802 00:0BDF: 65 07        	adc	<R1+2
  2803 00:0BE1: 85 0B        	sta	<R2+2
  2804 00:0BE3: 18           	clc
  2805 00:0BE4: A0 06 00     	ldy	#$6
  2806 00:0BE7: B7 18        	lda	[<L116+row_0],Y
  2807 00:0BE9: 65 09        	adc	<R2
  2808 00:0BEB: 85 05        	sta	<R1
  2809 00:0BED: C8           	iny
  2810 00:0BEE: C8           	iny
  2811 00:0BEF: B7 18        	lda	[<L116+row_0],Y
  2812 00:0BF1: 65 0B        	adc	<R2+2
  2813 00:0BF3: 48           	pha
  2814 00:0BF4: D4 05        	pei	<R1
  2815 00:0BF6: A0 00 00     	ldy	#$0
  2816 00:0BF9: A5 1C        	lda	<L116+at_0
  2817 00:0BFB: 10 01        	bpl	L123
  2818 00:0BFD: 88           	dey
  2819                        L123:
  2820 00:0BFE: 85 0D        	sta	<R3
  2821 00:0C00: 84 0F        	sty	<R3+2
  2822 00:0C02: 18           	clc
  2823 00:0C03: A0 06 00     	ldy	#$6
  2824 00:0C06: B7 18        	lda	[<L116+row_0],Y
  2825 00:0C08: 65 0D        	adc	<R3
  2826 00:0C0A: 85 11        	sta	<17
  2827 00:0C0C: C8           	iny
  2828 00:0C0D: C8           	iny
  2829 00:0C0E: B7 18        	lda	[<L116+row_0],Y
  2830 00:0C10: 65 0F        	adc	<R3+2
  2831 00:0C12: 85 13        	sta	<17+2
  2832 00:0C14: 48           	pha
  Sun Jan  9 2022 20:39                                                Page 53


  2833 00:0C15: D4 11        	pei	<17
  2834 00:0C17: 22 xx xx xx  	jsl	~~memmove
  2835                        ;    editorUpdateRow(row);
  2836 00:0C1B: D4 1A        	pei	<L116+row_0+2
  2837 00:0C1D: D4 18        	pei	<L116+row_0
  2838 00:0C1F: 22 xx xx xx  	jsl	~~editorUpdateRow
  2839                        ;    row->size--;
  2840 00:0C23: 18           	clc
  2841 00:0C24: A9 FF FF     	lda	#$ffff
  2842 00:0C27: A0 02 00     	ldy	#$2
  2843 00:0C2A: 77 18        	adc	[<L116+row_0],Y
  2844 00:0C2C: 97 18        	sta	[<L116+row_0],Y
  2845                        ;    E.dirty++;
  2846 00:0C2E: EE xx xx     	inc	|~~E+20
  2847                        ;}
  2848 00:0C31: 82 6B FF     	brl	L120
  2849             00000014   L116	equ	20
  2850             00000015   L117	equ	21
  2851                        	ends
  2852                        	efunc
  2853                        ;
  2854                        ;/* Insert the specified char at the current promp
                    t position. */
  2855                        ;void editorInsertChar(int c) {
  2856                        	code
  2857                        	xdef	~~editorInsertChar
  2858                        	func
  2859                        ~~editorInsertChar:
  2860                        	longa	on
  2861                        	longi	on
  2862 00:0C34: 3B           	tsc
  2863 00:0C35: 38           	sec
  2864 00:0C36: E9 10 00     	sbc	#L124
  2865 00:0C39: 1B           	tcs
  2866 00:0C3A: 0B           	phd
  2867 00:0C3B: 5B           	tcd
  2868             00000004   c_0	set	4
  2869                        ;    int filerow = E.rowoff+E.cy;
  2870                        ;    int filecol = E.coloff+E.cx;
  2871                        ;    erow *row = (filerow >= E.numrows) ? NULL : &
                    E.row[filerow];
  2872                        ;	
  2873                        ;	
  2874                        ;	//fprintf(stderr, "erow: %08lX \n", row);
  2875                        ;	
  2876                        ;    /* If the row where the cursor is currently l
                    ocated does not exist in our
  2877                        ;     * logical representaion of the file, add eno
                    ugh empty rows as needed. */
  2878                        ;    if (row == NULL) {
  2879             00000000   filerow_1	set	0
  2880             00000002   filecol_1	set	2
  2881             00000004   row_1	set	4
  2882 00:0C3C: AD xx xx     	lda	|~~E+4
  2883 00:0C3F: 18           	clc
  2884 00:0C40: 6D xx xx     	adc	|~~E+2
  2885 00:0C43: 85 09        	sta	<L125+filerow_1
  2886 00:0C45: AD xx xx     	lda	|~~E+6
  Sun Jan  9 2022 20:39                                                Page 54


  2887 00:0C48: 18           	clc
  2888 00:0C49: 6D xx xx     	adc	|~~E
  2889 00:0C4C: 85 0B        	sta	<L125+filecol_1
  2890 00:0C4E: A5 09        	lda	<L125+filerow_1
  2891 00:0C50: CD xx xx     	cmp	|~~E+12
  2892 00:0C53: 90 06        	bcc	L126
  2893 00:0C55: A9 00 00     	lda	#$0
  2894 00:0C58: AA           	tax
  2895 00:0C59: 80 31        	bra	L128
  2896                        L126:
  2897 00:0C5B: A0 00 00     	ldy	#$0
  2898 00:0C5E: A5 09        	lda	<L125+filerow_1
  2899 00:0C60: 10 01        	bpl	L129
  2900 00:0C62: 88           	dey
  2901                        L129:
  2902 00:0C63: 85 01        	sta	<R0
  2903 00:0C65: 84 03        	sty	<R0+2
  2904 00:0C67: F4 00 00     	pea	#^$14
  2905 00:0C6A: F4 14 00     	pea	#<$14
  2906 00:0C6D: D4 03        	pei	<R0+2
  2907 00:0C6F: D4 01        	pei	<R0
  2908                        	xref	~~~lmul
  2909 00:0C71: 22 xx xx xx  	jsl	~~~lmul
  2910 00:0C75: 85 01        	sta	<R0
  2911 00:0C77: 86 03        	stx	<R0+2
  2912 00:0C79: AD xx xx     	lda	|~~E+16
  2913 00:0C7C: 18           	clc
  2914 00:0C7D: 65 01        	adc	<R0
  2915 00:0C7F: 85 05        	sta	<R1
  2916 00:0C81: AD xx xx     	lda	|~~E+16+2
  2917 00:0C84: 65 03        	adc	<R0+2
  2918 00:0C86: 85 07        	sta	<R1+2
  2919 00:0C88: A6 07        	ldx	<R1+2
  2920 00:0C8A: A5 05        	lda	<R1
  2921                        L128:
  2922 00:0C8C: 86 03        	stx	<R0+2
  2923 00:0C8E: 85 0D        	sta	<L125+row_1
  2924 00:0C90: A5 03        	lda	<R0+2
  2925 00:0C92: 85 0F        	sta	<L125+row_1+2
  2926 00:0C94: A5 0D        	lda	<L125+row_1
  2927 00:0C96: 05 0F        	ora	<L125+row_1+2
  2928 00:0C98: F0 13        	beq	L10075
  2929                        ;        while(E.numrows <= filerow) {
  2930 00:0C9A: 80 18        	bra	L10074
  2931                        L20008:
  2932                        ;			editorInsertRow(E.numrows,"",0);
  2933 00:0C9C: F4 00 00     	pea	#<$0
  2934 00:0C9F: F4 xx xx     	pea	#^L1
  2935 00:0CA2: F4 xx xx     	pea	#<L1
  2936 00:0CA5: AD xx xx     	lda	|~~E+12
  2937 00:0CA8: 48           	pha
  2938 00:0CA9: 22 xx xx xx  	jsl	~~editorInsertRow
  2939                        ;		}
  2940                        L10075:
  2941 00:0CAD: A5 09        	lda	<L125+filerow_1
  2942 00:0CAF: CD xx xx     	cmp	|~~E+12
  2943 00:0CB2: B0 E8        	bcs	L20008
  2944                        ;    }
  Sun Jan  9 2022 20:39                                                Page 55


  2945                        ;	
  2946                        ;
  2947                        ;    row = &E.row[filerow];
  2948                        L10074:
  2949 00:0CB4: A0 00 00     	ldy	#$0
  2950 00:0CB7: A5 09        	lda	<L125+filerow_1
  2951 00:0CB9: 10 01        	bpl	L132
  2952 00:0CBB: 88           	dey
  2953                        L132:
  2954 00:0CBC: 85 01        	sta	<R0
  2955 00:0CBE: 84 03        	sty	<R0+2
  2956 00:0CC0: F4 00 00     	pea	#^$14
  2957 00:0CC3: F4 14 00     	pea	#<$14
  2958 00:0CC6: D4 03        	pei	<R0+2
  2959 00:0CC8: D4 01        	pei	<R0
  2960                        	xref	~~~lmul
  2961 00:0CCA: 22 xx xx xx  	jsl	~~~lmul
  2962 00:0CCE: 85 01        	sta	<R0
  2963 00:0CD0: 86 03        	stx	<R0+2
  2964 00:0CD2: AD xx xx     	lda	|~~E+16
  2965 00:0CD5: 18           	clc
  2966 00:0CD6: 65 01        	adc	<R0
  2967 00:0CD8: 85 0D        	sta	<L125+row_1
  2968 00:0CDA: AD xx xx     	lda	|~~E+16+2
  2969 00:0CDD: 65 03        	adc	<R0+2
  2970 00:0CDF: 85 0F        	sta	<L125+row_1+2
  2971                        ;	//fprintf(stderr, "erow: %08lX \n", row);
  2972                        ;	
  2973                        ;    editorRowInsertChar(row, filecol, c);
  2974 00:0CE1: D4 14        	pei	<L124+c_0
  2975 00:0CE3: D4 0B        	pei	<L125+filecol_1
  2976 00:0CE5: D4 0F        	pei	<L125+row_1+2
  2977 00:0CE7: D4 0D        	pei	<L125+row_1
  2978 00:0CE9: 22 xx xx xx  	jsl	~~editorRowInsertChar
  2979                        ;	
  2980                        ;
  2981                        ;    if (E.cx == E.screencols-1)
  2982                        ;        E.coloff++;
  2983 00:0CED: A9 FF FF     	lda	#$ffff
  2984 00:0CF0: 18           	clc
  2985 00:0CF1: 6D xx xx     	adc	|~~E+10
  2986 00:0CF4: CD xx xx     	cmp	|~~E
  2987 00:0CF7: D0 05        	bne	L10077
  2988 00:0CF9: EE xx xx     	inc	|~~E+6
  2989                        ;    else
  2990 00:0CFC: 80 03        	bra	L10078
  2991                        L10077:
  2992                        ;        E.cx++;
  2993 00:0CFE: EE xx xx     	inc	|~~E
  2994                        L10078:
  2995                        ;	
  2996                        ;    E.dirty++;
  2997 00:0D01: EE xx xx     	inc	|~~E+20
  2998                        ;}
  2999 00:0D04: A5 12        	lda	<L124+2
  3000 00:0D06: 85 14        	sta	<L124+2+2
  3001 00:0D08: A5 11        	lda	<L124+1
  3002 00:0D0A: 85 13        	sta	<L124+1+2
  Sun Jan  9 2022 20:39                                                Page 56


  3003 00:0D0C: 2B           	pld
  3004 00:0D0D: 3B           	tsc
  3005 00:0D0E: 18           	clc
  3006 00:0D0F: 69 12 00     	adc	#L124+2
  3007 00:0D12: 1B           	tcs
  3008 00:0D13: 6B           	rtl
  3009             00000010   L124	equ	16
  3010             00000009   L125	equ	9
  3011                        	ends
  3012                        	efunc
  3013                        	data
  3014                        L1:
  3015 00:0000: 00           	db	$00
  3016 00:0001:              	ends
  3017                        ;
  3018                        ;/* Inserting a newline is slightly complex as we 
                    have to handle inserting a
  3019                        ; * newline in the middle of a line, splitting the
                     line as needed. */
  3020                        ;void editorInsertNewline(void) {
  3021                        	code
  3022                        	xdef	~~editorInsertNewline
  3023                        	func
  3024                        ~~editorInsertNewline:
  3025                        	longa	on
  3026                        	longi	on
  3027 00:0D14: 3B           	tsc
  3028 00:0D15: 38           	sec
  3029 00:0D16: E9 10 00     	sbc	#L136
  3030 00:0D19: 1B           	tcs
  3031 00:0D1A: 0B           	phd
  3032 00:0D1B: 5B           	tcd
  3033                        ;    unsigned int filerow = E.rowoff+E.cy;
  3034                        ;    unsigned int filecol = E.coloff+E.cx;
  3035                        ;    erow *row = (filerow >= E.numrows) ? NULL : &
                    (E.row[filerow]);
  3036                        ;		
  3037                        ;    if (!row) {
  3038             00000000   filerow_1	set	0
  3039             00000002   filecol_1	set	2
  3040             00000004   row_1	set	4
  3041 00:0D1C: AD xx xx     	lda	|~~E+4
  3042 00:0D1F: 18           	clc
  3043 00:0D20: 6D xx xx     	adc	|~~E+2
  3044 00:0D23: 85 09        	sta	<L137+filerow_1
  3045 00:0D25: AD xx xx     	lda	|~~E+6
  3046 00:0D28: 18           	clc
  3047 00:0D29: 6D xx xx     	adc	|~~E
  3048 00:0D2C: 85 0B        	sta	<L137+filecol_1
  3049 00:0D2E: A5 09        	lda	<L137+filerow_1
  3050 00:0D30: CD xx xx     	cmp	|~~E+12
  3051 00:0D33: 90 06        	bcc	L138
  3052 00:0D35: A9 00 00     	lda	#$0
  3053 00:0D38: AA           	tax
  3054 00:0D39: 80 2B        	bra	L140
  3055                        L138:
  3056 00:0D3B: A5 09        	lda	<L137+filerow_1
  3057 00:0D3D: 85 01        	sta	<R0
  Sun Jan  9 2022 20:39                                                Page 57


  3058 00:0D3F: 64 03        	stz	<R0+2
  3059 00:0D41: F4 00 00     	pea	#^$14
  3060 00:0D44: F4 14 00     	pea	#<$14
  3061 00:0D47: D4 03        	pei	<R0+2
  3062 00:0D49: D4 01        	pei	<R0
  3063                        	xref	~~~lmul
  3064 00:0D4B: 22 xx xx xx  	jsl	~~~lmul
  3065 00:0D4F: 85 01        	sta	<R0
  3066 00:0D51: 86 03        	stx	<R0+2
  3067 00:0D53: AD xx xx     	lda	|~~E+16
  3068 00:0D56: 18           	clc
  3069 00:0D57: 65 01        	adc	<R0
  3070 00:0D59: 85 05        	sta	<R1
  3071 00:0D5B: AD xx xx     	lda	|~~E+16+2
  3072 00:0D5E: 65 03        	adc	<R0+2
  3073 00:0D60: 85 07        	sta	<R1+2
  3074 00:0D62: A6 07        	ldx	<R1+2
  3075 00:0D64: A5 05        	lda	<R1
  3076                        L140:
  3077 00:0D66: 86 03        	stx	<R0+2
  3078 00:0D68: 85 0D        	sta	<L137+row_1
  3079 00:0D6A: A5 03        	lda	<R0+2
  3080 00:0D6C: 85 0F        	sta	<L137+row_1+2
  3081 00:0D6E: A5 0D        	lda	<L137+row_1
  3082 00:0D70: 05 0F        	ora	<L137+row_1+2
  3083 00:0D72: D0 27        	bne	L10079
  3084                        ;        if (filerow == E.numrows) {
  3085 00:0D74: A5 09        	lda	<L137+filerow_1
  3086 00:0D76: CD xx xx     	cmp	|~~E+12
  3087 00:0D79: F0 03        	beq	*+5
  3088 00:0D7B: 82 BE 00     	brl	L143
  3089                        ;            editorInsertRow(filerow,"",0);
  3090 00:0D7E: F4 00 00     	pea	#<$0
  3091 00:0D81: F4 xx xx     	pea	#^L135
  3092 00:0D84: F4 xx xx     	pea	#<L135
  3093 00:0D87: 80 09        	bra	L20010
  3094                        L20012:
  3095                        ;        editorInsertRow(filerow,"",0);
  3096 00:0D89: F4 00 00     	pea	#<$0
  3097 00:0D8C: F4 xx xx     	pea	#^L135+1
  3098 00:0D8F: F4 xx xx     	pea	#<L135+1
  3099                        ;    } else {
  3100                        L20010:
  3101 00:0D92: D4 09        	pei	<L137+filerow_1
  3102 00:0D94: 22 xx xx xx  	jsl	~~editorInsertRow
  3103                        ;            goto fixcursor;
  3104 00:0D98: 82 87 00     	brl	L10081
  3105                        ;        }
  3106                        ;        return;
  3107                        ;    }
  3108                        ;    /* If the cursor is over the current line siz
                    e, we want to conceptually
  3109                        ;     * think it's just over the last character. *
                    /
  3110                        ;	 
  3111                        ;    if (filecol >= row->size) filecol = row->size
                    ;
  3112                        L10079:
  Sun Jan  9 2022 20:39                                                Page 58


  3113 00:0D9B: A5 0B        	lda	<L137+filecol_1
  3114 00:0D9D: A0 02 00     	ldy	#$2
  3115 00:0DA0: D7 0D        	cmp	[<L137+row_1],Y
  3116 00:0DA2: 90 04        	bcc	L10082
  3117 00:0DA4: B7 0D        	lda	[<L137+row_1],Y
  3118 00:0DA6: 85 0B        	sta	<L137+filecol_1
  3119                        ;    if (filecol == 0) {
  3120                        L10082:
  3121 00:0DA8: A5 0B        	lda	<L137+filecol_1
  3122 00:0DAA: F0 DD        	beq	L20012
  3123                        ;        /* We are in the middle of a line. Split 
                    it between two rows. */
  3124                        ;        editorInsertRow(filerow+1,row->chars+file
                    col,row->size-filecol);
  3125 00:0DAC: 38           	sec
  3126 00:0DAD: A0 02 00     	ldy	#$2
  3127 00:0DB0: B7 0D        	lda	[<L137+row_1],Y
  3128 00:0DB2: E5 0B        	sbc	<L137+filecol_1
  3129 00:0DB4: 48           	pha
  3130 00:0DB5: A5 0B        	lda	<L137+filecol_1
  3131 00:0DB7: 85 01        	sta	<R0
  3132 00:0DB9: 64 03        	stz	<R0+2
  3133 00:0DBB: 18           	clc
  3134 00:0DBC: A0 06 00     	ldy	#$6
  3135 00:0DBF: B7 0D        	lda	[<L137+row_1],Y
  3136 00:0DC1: 65 01        	adc	<R0
  3137 00:0DC3: 85 05        	sta	<R1
  3138 00:0DC5: C8           	iny
  3139 00:0DC6: C8           	iny
  3140 00:0DC7: B7 0D        	lda	[<L137+row_1],Y
  3141 00:0DC9: 65 03        	adc	<R0+2
  3142 00:0DCB: 48           	pha
  3143 00:0DCC: D4 05        	pei	<R1
  3144 00:0DCE: A5 09        	lda	<L137+filerow_1
  3145 00:0DD0: 1A           	ina
  3146 00:0DD1: 48           	pha
  3147 00:0DD2: 22 xx xx xx  	jsl	~~editorInsertRow
  3148                        ;        row = &E.row[filerow];
  3149 00:0DD6: A5 09        	lda	<L137+filerow_1
  3150 00:0DD8: 85 01        	sta	<R0
  3151 00:0DDA: 64 03        	stz	<R0+2
  3152 00:0DDC: F4 00 00     	pea	#^$14
  3153 00:0DDF: F4 14 00     	pea	#<$14
  3154 00:0DE2: D4 03        	pei	<R0+2
  3155 00:0DE4: D4 01        	pei	<R0
  3156                        	xref	~~~lmul
  3157 00:0DE6: 22 xx xx xx  	jsl	~~~lmul
  3158 00:0DEA: 85 01        	sta	<R0
  3159 00:0DEC: 86 03        	stx	<R0+2
  3160 00:0DEE: AD xx xx     	lda	|~~E+16
  3161 00:0DF1: 18           	clc
  3162 00:0DF2: 65 01        	adc	<R0
  3163 00:0DF4: 85 0D        	sta	<L137+row_1
  3164 00:0DF6: AD xx xx     	lda	|~~E+16+2
  3165 00:0DF9: 65 03        	adc	<R0+2
  3166 00:0DFB: 85 0F        	sta	<L137+row_1+2
  3167                        ;        row->chars[filecol] = '\0';
  3168 00:0DFD: A0 06 00     	ldy	#$6
  Sun Jan  9 2022 20:39                                                Page 59


  3169 00:0E00: B7 0D        	lda	[<L137+row_1],Y
  3170 00:0E02: 85 01        	sta	<R0
  3171 00:0E04: C8           	iny
  3172 00:0E05: C8           	iny
  3173 00:0E06: B7 0D        	lda	[<L137+row_1],Y
  3174 00:0E08: 85 03        	sta	<R0+2
  3175 00:0E0A: E2 20        	sep	#$20
  3176                        	longa	off
  3177 00:0E0C: A9 00        	lda	#$0
  3178 00:0E0E: A4 0B        	ldy	<L137+filecol_1
  3179 00:0E10: 97 01        	sta	[<R0],Y
  3180 00:0E12: C2 20        	rep	#$20
  3181                        	longa	on
  3182                        ;        row->size = filecol;
  3183 00:0E14: 98           	tya
  3184 00:0E15: A0 02 00     	ldy	#$2
  3185 00:0E18: 97 0D        	sta	[<L137+row_1],Y
  3186                        ;        editorUpdateRow(row);
  3187 00:0E1A: D4 0F        	pei	<L137+row_1+2
  3188 00:0E1C: D4 0D        	pei	<L137+row_1
  3189 00:0E1E: 22 xx xx xx  	jsl	~~editorUpdateRow
  3190                        ;    }
  3191                        ;fixcursor:
  3192                        L10081:
  3193                        ;
  3194                        ;    if (E.cy == E.screenrows-1) {
  3195 00:0E22: A9 FF FF     	lda	#$ffff
  3196 00:0E25: 18           	clc
  3197 00:0E26: 6D xx xx     	adc	|~~E+8
  3198 00:0E29: CD xx xx     	cmp	|~~E+2
  3199 00:0E2C: D0 05        	bne	L10085
  3200                        ;        E.rowoff++;
  3201 00:0E2E: EE xx xx     	inc	|~~E+4
  3202                        ;    } else {
  3203 00:0E31: 80 03        	bra	L10086
  3204                        L10085:
  3205                        ;        E.cy++;
  3206 00:0E33: EE xx xx     	inc	|~~E+2
  3207                        ;    }
  3208                        L10086:
  3209                        ;    E.cx = 0;
  3210 00:0E36: 9C xx xx     	stz	|~~E
  3211                        ;    E.coloff = 0;
  3212 00:0E39: 9C xx xx     	stz	|~~E+6
  3213                        ;}
  3214                        L143:
  3215 00:0E3C: 2B           	pld
  3216 00:0E3D: 3B           	tsc
  3217 00:0E3E: 18           	clc
  3218 00:0E3F: 69 10 00     	adc	#L136
  3219 00:0E42: 1B           	tcs
  3220 00:0E43: 6B           	rtl
  3221             00000010   L136	equ	16
  3222             00000009   L137	equ	9
  3223                        	ends
  3224                        	efunc
  3225                        	data
  3226                        L135:
  Sun Jan  9 2022 20:39                                                Page 60


  3227 00:0001: 00 00        	db	$00,$00
  3228 00:0003:              	ends
  3229                        ;
  3230                        ;/* Delete the char at the current prompt position
                    . */
  3231                        ;void editorDelChar() {
  3232                        	code
  3233                        	xdef	~~editorDelChar
  3234                        	func
  3235                        ~~editorDelChar:
  3236                        	longa	on
  3237                        	longi	on
  3238 00:0E44: 3B           	tsc
  3239 00:0E45: 38           	sec
  3240 00:0E46: E9 16 00     	sbc	#L148
  3241 00:0E49: 1B           	tcs
  3242 00:0E4A: 0B           	phd
  3243 00:0E4B: 5B           	tcd
  3244                        ;    int shift;
  3245                        ;    int filerow = E.rowoff+E.cy;
  3246                        ;    int filecol = E.coloff+E.cx;
  3247                        ;    erow *row = (filerow >= E.numrows) ? NULL : &
                    E.row[filerow];
  3248                        ;
  3249                        ;	
  3250                        ;    if (!row || (filecol == 0 && filerow == 0)) r
                    eturn;
  3251             00000000   shift_1	set	0
  3252             00000002   filerow_1	set	2
  3253             00000004   filecol_1	set	4
  3254             00000006   row_1	set	6
  3255 00:0E4C: AD xx xx     	lda	|~~E+4
  3256 00:0E4F: 18           	clc
  3257 00:0E50: 6D xx xx     	adc	|~~E+2
  3258 00:0E53: 85 0F        	sta	<L149+filerow_1
  3259 00:0E55: AD xx xx     	lda	|~~E+6
  3260 00:0E58: 18           	clc
  3261 00:0E59: 6D xx xx     	adc	|~~E
  3262 00:0E5C: 85 11        	sta	<L149+filecol_1
  3263 00:0E5E: A5 0F        	lda	<L149+filerow_1
  3264 00:0E60: CD xx xx     	cmp	|~~E+12
  3265 00:0E63: 90 06        	bcc	L150
  3266 00:0E65: A9 00 00     	lda	#$0
  3267 00:0E68: AA           	tax
  3268 00:0E69: 80 31        	bra	L152
  3269                        L150:
  3270 00:0E6B: A0 00 00     	ldy	#$0
  3271 00:0E6E: A5 0F        	lda	<L149+filerow_1
  3272 00:0E70: 10 01        	bpl	L153
  3273 00:0E72: 88           	dey
  3274                        L153:
  3275 00:0E73: 85 01        	sta	<R0
  3276 00:0E75: 84 03        	sty	<R0+2
  3277 00:0E77: F4 00 00     	pea	#^$14
  3278 00:0E7A: F4 14 00     	pea	#<$14
  3279 00:0E7D: D4 03        	pei	<R0+2
  3280 00:0E7F: D4 01        	pei	<R0
  3281                        	xref	~~~lmul
  Sun Jan  9 2022 20:39                                                Page 61


  3282 00:0E81: 22 xx xx xx  	jsl	~~~lmul
  3283 00:0E85: 85 01        	sta	<R0
  3284 00:0E87: 86 03        	stx	<R0+2
  3285 00:0E89: AD xx xx     	lda	|~~E+16
  3286 00:0E8C: 18           	clc
  3287 00:0E8D: 65 01        	adc	<R0
  3288 00:0E8F: 85 05        	sta	<R1
  3289 00:0E91: AD xx xx     	lda	|~~E+16+2
  3290 00:0E94: 65 03        	adc	<R0+2
  3291 00:0E96: 85 07        	sta	<R1+2
  3292 00:0E98: A6 07        	ldx	<R1+2
  3293 00:0E9A: A5 05        	lda	<R1
  3294                        L152:
  3295 00:0E9C: 86 03        	stx	<R0+2
  3296 00:0E9E: 85 13        	sta	<L149+row_1
  3297 00:0EA0: A5 03        	lda	<R0+2
  3298 00:0EA2: 85 15        	sta	<L149+row_1+2
  3299 00:0EA4: A5 13        	lda	<L149+row_1
  3300 00:0EA6: 05 15        	ora	<L149+row_1+2
  3301 00:0EA8: F0 08        	beq	L158
  3302 00:0EAA: A5 11        	lda	<L149+filecol_1
  3303 00:0EAC: D0 0C        	bne	L10087
  3304 00:0EAE: A5 0F        	lda	<L149+filerow_1
  3305 00:0EB0: D0 08        	bne	L10087
  3306                        L158:
  3307 00:0EB2: 2B           	pld
  3308 00:0EB3: 3B           	tsc
  3309 00:0EB4: 18           	clc
  3310 00:0EB5: 69 16 00     	adc	#L148
  3311 00:0EB8: 1B           	tcs
  3312 00:0EB9: 6B           	rtl
  3313                        ;    if (filecol == 0) {
  3314                        L10087:
  3315 00:0EBA: A5 11        	lda	<L149+filecol_1
  3316 00:0EBC: F0 03        	beq	*+5
  3317 00:0EBE: 82 E2 00     	brl	L10088
  3318                        ;        /* Handle the case of column 0, we need t
                    o move the current line
  3319                        ;         * on the right of the previous one. */
  3320                        ;        filecol = E.row[filerow-1].size;
  3321 00:0EC1: A9 FF FF     	lda	#$ffff
  3322 00:0EC4: 18           	clc
  3323 00:0EC5: 65 0F        	adc	<L149+filerow_1
  3324 00:0EC7: 85 01        	sta	<R0
  3325 00:0EC9: A0 00 00     	ldy	#$0
  3326 00:0ECC: A5 01        	lda	<R0
  3327 00:0ECE: 10 01        	bpl	L160
  3328 00:0ED0: 88           	dey
  3329                        L160:
  3330 00:0ED1: 85 01        	sta	<R0
  3331 00:0ED3: 84 03        	sty	<R0+2
  3332 00:0ED5: F4 00 00     	pea	#^$14
  3333 00:0ED8: F4 14 00     	pea	#<$14
  3334 00:0EDB: D4 03        	pei	<R0+2
  3335 00:0EDD: D4 01        	pei	<R0
  3336                        	xref	~~~lmul
  3337 00:0EDF: 22 xx xx xx  	jsl	~~~lmul
  3338 00:0EE3: 85 01        	sta	<R0
  Sun Jan  9 2022 20:39                                                Page 62


  3339 00:0EE5: 86 03        	stx	<R0+2
  3340 00:0EE7: A9 02 00     	lda	#$2
  3341 00:0EEA: 18           	clc
  3342 00:0EEB: 6D xx xx     	adc	|~~E+16
  3343 00:0EEE: 85 05        	sta	<R1
  3344 00:0EF0: A9 00 00     	lda	#$0
  3345 00:0EF3: 6D xx xx     	adc	|~~E+16+2
  3346 00:0EF6: 85 07        	sta	<R1+2
  3347 00:0EF8: A5 05        	lda	<R1
  3348 00:0EFA: 18           	clc
  3349 00:0EFB: 65 01        	adc	<R0
  3350 00:0EFD: 85 09        	sta	<R2
  3351 00:0EFF: A5 07        	lda	<R1+2
  3352 00:0F01: 65 03        	adc	<R0+2
  3353 00:0F03: 85 0B        	sta	<R2+2
  3354 00:0F05: A7 09        	lda	[<R2]
  3355 00:0F07: 85 11        	sta	<L149+filecol_1
  3356                        ;        editorRowAppendString(&E.row[filerow-1],r
                    ow->chars,row->size);
  3357 00:0F09: A0 00 00     	ldy	#$0
  3358 00:0F0C: 5A           	phy
  3359 00:0F0D: C8           	iny
  3360 00:0F0E: C8           	iny
  3361 00:0F0F: B7 13        	lda	[<L149+row_1],Y
  3362 00:0F11: 7A           	ply
  3363 00:0F12: 2A           	rol	A
  3364 00:0F13: 6A           	ror	A
  3365 00:0F14: 10 01        	bpl	L161
  3366 00:0F16: 88           	dey
  3367                        L161:
  3368 00:0F17: 85 01        	sta	<R0
  3369 00:0F19: 84 03        	sty	<R0+2
  3370 00:0F1B: D4 03        	pei	<R0+2
  3371 00:0F1D: D4 01        	pei	<R0
  3372 00:0F1F: A0 08 00     	ldy	#$8
  3373 00:0F22: B7 13        	lda	[<L149+row_1],Y
  3374 00:0F24: 48           	pha
  3375 00:0F25: 88           	dey
  3376 00:0F26: 88           	dey
  3377 00:0F27: B7 13        	lda	[<L149+row_1],Y
  3378 00:0F29: 48           	pha
  3379 00:0F2A: A9 FF FF     	lda	#$ffff
  3380 00:0F2D: 18           	clc
  3381 00:0F2E: 65 0F        	adc	<L149+filerow_1
  3382 00:0F30: 85 05        	sta	<R1
  3383 00:0F32: A0 00 00     	ldy	#$0
  3384 00:0F35: A5 05        	lda	<R1
  3385 00:0F37: 10 01        	bpl	L162
  3386 00:0F39: 88           	dey
  3387                        L162:
  3388 00:0F3A: 85 05        	sta	<R1
  3389 00:0F3C: 84 07        	sty	<R1+2
  3390 00:0F3E: F4 00 00     	pea	#^$14
  3391 00:0F41: F4 14 00     	pea	#<$14
  3392 00:0F44: D4 07        	pei	<R1+2
  3393 00:0F46: D4 05        	pei	<R1
  3394                        	xref	~~~lmul
  3395 00:0F48: 22 xx xx xx  	jsl	~~~lmul
  Sun Jan  9 2022 20:39                                                Page 63


  3396 00:0F4C: 85 05        	sta	<R1
  3397 00:0F4E: 86 07        	stx	<R1+2
  3398 00:0F50: AD xx xx     	lda	|~~E+16
  3399 00:0F53: 18           	clc
  3400 00:0F54: 65 05        	adc	<R1
  3401 00:0F56: 85 09        	sta	<R2
  3402 00:0F58: AD xx xx     	lda	|~~E+16+2
  3403 00:0F5B: 65 07        	adc	<R1+2
  3404 00:0F5D: 48           	pha
  3405 00:0F5E: D4 09        	pei	<R2
  3406 00:0F60: 22 xx xx xx  	jsl	~~editorRowAppendString
  3407                        ;        editorDelRow(filerow);
  3408 00:0F64: D4 0F        	pei	<L149+filerow_1
  3409 00:0F66: 22 xx xx xx  	jsl	~~editorDelRow
  3410                        ;        row = NULL;
  3411 00:0F6A: 64 13        	stz	<L149+row_1
  3412 00:0F6C: 64 15        	stz	<L149+row_1+2
  3413                        ;        if (E.cy == 0)
  3414                        ;            E.rowoff--;
  3415 00:0F6E: AD xx xx     	lda	|~~E+2
  3416 00:0F71: D0 05        	bne	L10089
  3417 00:0F73: CE xx xx     	dec	|~~E+4
  3418                        ;        else
  3419 00:0F76: 80 03        	bra	L10090
  3420                        L10089:
  3421                        ;            E.cy--;
  3422 00:0F78: CE xx xx     	dec	|~~E+2
  3423                        L10090:
  3424                        ;        E.cx = filecol;
  3425 00:0F7B: A5 11        	lda	<L149+filecol_1
  3426 00:0F7D: 8D xx xx     	sta	|~~E
  3427                        ;        if (E.cx >= E.screencols) {
  3428 00:0F80: CD xx xx     	cmp	|~~E+10
  3429 00:0F83: 90 3F        	bcc	L10092
  3430                        ;            shift = (E.screencols-E.cx)+1;
  3431 00:0F85: 38           	sec
  3432 00:0F86: AD xx xx     	lda	|~~E+10
  3433 00:0F89: ED xx xx     	sbc	|~~E
  3434 00:0F8C: 1A           	ina
  3435 00:0F8D: 85 0D        	sta	<L149+shift_1
  3436                        ;            E.cx -= shift;
  3437 00:0F8F: 38           	sec
  3438 00:0F90: AD xx xx     	lda	|~~E
  3439 00:0F93: E5 0D        	sbc	<L149+shift_1
  3440 00:0F95: 8D xx xx     	sta	|~~E
  3441                        ;            E.coloff += shift;
  3442 00:0F98: AD xx xx     	lda	|~~E+6
  3443 00:0F9B: 18           	clc
  3444 00:0F9C: 65 0D        	adc	<L149+shift_1
  3445 00:0F9E: 8D xx xx     	sta	|~~E+6
  3446                        ;        }
  3447                        ;    } else {
  3448 00:0FA1: 80 21        	bra	L10092
  3449                        L10088:
  3450                        ;        editorRowDelChar(row,filecol-1);
  3451 00:0FA3: A9 FF FF     	lda	#$ffff
  3452 00:0FA6: 18           	clc
  3453 00:0FA7: 65 11        	adc	<L149+filecol_1
  Sun Jan  9 2022 20:39                                                Page 64


  3454 00:0FA9: 48           	pha
  3455 00:0FAA: D4 15        	pei	<L149+row_1+2
  3456 00:0FAC: D4 13        	pei	<L149+row_1
  3457 00:0FAE: 22 xx xx xx  	jsl	~~editorRowDelChar
  3458                        ;        if (E.cx == 0 && E.coloff)
  3459                        ;            E.coloff--;
  3460 00:0FB2: AD xx xx     	lda	|~~E
  3461 00:0FB5: D0 0A        	bne	L10093
  3462 00:0FB7: AD xx xx     	lda	|~~E+6
  3463 00:0FBA: F0 05        	beq	L10093
  3464 00:0FBC: CE xx xx     	dec	|~~E+6
  3465                        ;        else
  3466 00:0FBF: 80 03        	bra	L10092
  3467                        L10093:
  3468                        ;            E.cx--;
  3469 00:0FC1: CE xx xx     	dec	|~~E
  3470                        ;    }
  3471                        L10092:
  3472                        ;    if (row) editorUpdateRow(row);
  3473 00:0FC4: A5 13        	lda	<L149+row_1
  3474 00:0FC6: 05 15        	ora	<L149+row_1+2
  3475 00:0FC8: F0 08        	beq	L10095
  3476 00:0FCA: D4 15        	pei	<L149+row_1+2
  3477 00:0FCC: D4 13        	pei	<L149+row_1
  3478 00:0FCE: 22 xx xx xx  	jsl	~~editorUpdateRow
  3479                        ;    E.dirty++;
  3480                        L10095:
  3481 00:0FD2: EE xx xx     	inc	|~~E+20
  3482                        ;}
  3483 00:0FD5: 82 DA FE     	brl	L158
  3484             00000016   L148	equ	22
  3485             0000000D   L149	equ	13
  3486                        	ends
  3487                        	efunc
  3488                        ;
  3489                        ;void int2hex(char *s, unsigned int c) {
  3490                        	code
  3491                        	xdef	~~int2hex
  3492                        	func
  3493                        ~~int2hex:
  3494                        	longa	on
  3495                        	longi	on
  3496 00:0FD8: 3B           	tsc
  3497 00:0FD9: 38           	sec
  3498 00:0FDA: E9 02 00     	sbc	#L168
  3499 00:0FDD: 1B           	tcs
  3500 00:0FDE: 0B           	phd
  3501 00:0FDF: 5B           	tcd
  3502             00000004   s_0	set	4
  3503             00000008   c_0	set	8
  3504                        ;	unsigned int n;
  3505                        ;	
  3506                        ;	n = c >> 4;
  3507             00000000   n_1	set	0
  3508 00:0FE0: A5 0A        	lda	<L168+c_0
  3509 00:0FE2: 4A           	lsr	A
  3510 00:0FE3: 4A           	lsr	A
  3511 00:0FE4: 4A           	lsr	A
  Sun Jan  9 2022 20:39                                                Page 65


  3512 00:0FE5: 4A           	lsr	A
  3513 00:0FE6: 85 01        	sta	<L169+n_1
  3514                        ;	if (n > 9) n+=7;
  3515 00:0FE8: A9 09 00     	lda	#$9
  3516 00:0FEB: C5 01        	cmp	<L169+n_1
  3517 00:0FED: B0 07        	bcs	L10096
  3518 00:0FEF: 3A           	dea
  3519 00:0FF0: 3A           	dea
  3520 00:0FF1: 18           	clc
  3521 00:0FF2: 65 01        	adc	<L169+n_1
  3522 00:0FF4: 85 01        	sta	<L169+n_1
  3523                        ;	*s = n + '0';
  3524                        L10096:
  3525 00:0FF6: A9 30 00     	lda	#$30
  3526 00:0FF9: 18           	clc
  3527 00:0FFA: 65 01        	adc	<L169+n_1
  3528 00:0FFC: E2 20        	sep	#$20
  3529                        	longa	off
  3530 00:0FFE: 87 06        	sta	[<L168+s_0]
  3531 00:1000: C2 20        	rep	#$20
  3532                        	longa	on
  3533                        ;	s++;
  3534 00:1002: E6 06        	inc	<L168+s_0
  3535 00:1004: D0 02        	bne	L171
  3536 00:1006: E6 08        	inc	<L168+s_0+2
  3537                        L171:
  3538                        ;	n = c & 0x0f;
  3539 00:1008: A5 0A        	lda	<L168+c_0
  3540 00:100A: 29 0F 00     	and	#<$f
  3541 00:100D: 85 01        	sta	<L169+n_1
  3542                        ;	if (n > 9) n+=7;
  3543 00:100F: A9 09 00     	lda	#$9
  3544 00:1012: C5 01        	cmp	<L169+n_1
  3545 00:1014: B0 07        	bcs	L10097
  3546 00:1016: 3A           	dea
  3547 00:1017: 3A           	dea
  3548 00:1018: 18           	clc
  3549 00:1019: 65 01        	adc	<L169+n_1
  3550 00:101B: 85 01        	sta	<L169+n_1
  3551                        ;	*s = n + '0';	
  3552                        L10097:
  3553 00:101D: A9 30 00     	lda	#$30
  3554 00:1020: 18           	clc
  3555 00:1021: 65 01        	adc	<L169+n_1
  3556 00:1023: E2 20        	sep	#$20
  3557                        	longa	off
  3558 00:1025: 87 06        	sta	[<L168+s_0]
  3559 00:1027: C2 20        	rep	#$20
  3560                        	longa	on
  3561                        ;}
  3562 00:1029: A5 04        	lda	<L168+2
  3563 00:102B: 85 0A        	sta	<L168+2+6
  3564 00:102D: A5 03        	lda	<L168+1
  3565 00:102F: 85 09        	sta	<L168+1+6
  3566 00:1031: 2B           	pld
  3567 00:1032: 3B           	tsc
  3568 00:1033: 18           	clc
  3569 00:1034: 69 08 00     	adc	#L168+6
  Sun Jan  9 2022 20:39                                                Page 66


  3570 00:1037: 1B           	tcs
  3571 00:1038: 6B           	rtl
  3572             00000002   L168	equ	2
  3573             00000001   L169	equ	1
  3574                        	ends
  3575                        	efunc
  3576                        ; 
  3577                        ;unsigned int editorGenerateHexline(size_t adr, ch
                    ar *line, char* data, unsigned int len) {
  3578                        	code
  3579                        	xdef	~~editorGenerateHexline
  3580                        	func
  3581                        ~~editorGenerateHexline:
  3582                        	longa	on
  3583                        	longi	on
  3584 00:1039: 3B           	tsc
  3585 00:103A: 38           	sec
  3586 00:103B: E9 10 00     	sbc	#L174
  3587 00:103E: 1B           	tcs
  3588 00:103F: 0B           	phd
  3589 00:1040: 5B           	tcd
  3590             00000004   adr_0	set	4
  3591             00000008   line_0	set	8
  3592             0000000C   data_0	set	12
  3593             00000010   len_0	set	16
  3594                        ;	unsigned int i, k;
  3595                        ;	char *a, *lineOld;
  3596                        ;	
  3597                        ;	lineOld = line;
  3598             00000000   i_1	set	0
  3599             00000002   k_1	set	2
  3600             00000004   a_1	set	4
  3601             00000008   lineOld_1	set	8
  3602 00:1041: A5 18        	lda	<L174+line_0
  3603 00:1043: 85 0D        	sta	<L175+lineOld_1
  3604 00:1045: A5 1A        	lda	<L174+line_0+2
  3605 00:1047: 85 0F        	sta	<L175+lineOld_1+2
  3606                        ;	memset(line, ' ', 80);
  3607 00:1049: F4 00 00     	pea	#^$50
  3608 00:104C: F4 50 00     	pea	#<$50
  3609 00:104F: F4 20 00     	pea	#<$20
  3610 00:1052: D4 1A        	pei	<L174+line_0+2
  3611 00:1054: D4 18        	pei	<L174+line_0
  3612 00:1056: 22 xx xx xx  	jsl	~~memset
  3613                        ;	
  3614                        ;	a = (char *)(&adr);
  3615 00:105A: 18           	clc
  3616 00:105B: 7B           	tdc
  3617 00:105C: 69 14 00     	adc	#<L174+adr_0
  3618 00:105F: 85 09        	sta	<L175+a_1
  3619 00:1061: A9 00 00     	lda	#$0
  3620 00:1064: 85 0B        	sta	<L175+a_1+2
  3621                        ;	a += 2;
  3622 00:1066: 1A           	ina
  3623 00:1067: 1A           	ina
  3624 00:1068: 18           	clc
  3625 00:1069: 65 09        	adc	<L175+a_1
  3626 00:106B: 85 09        	sta	<L175+a_1
  Sun Jan  9 2022 20:39                                                Page 67


  3627 00:106D: 90 02        	bcc	L176
  3628 00:106F: E6 0B        	inc	<L175+a_1+2
  3629                        L176:
  3630                        ;	int2hex(line, *a);
  3631 00:1071: A7 09        	lda	[<L175+a_1]
  3632 00:1073: 29 FF 00     	and	#$ff
  3633 00:1076: 48           	pha
  3634 00:1077: D4 1A        	pei	<L174+line_0+2
  3635 00:1079: D4 18        	pei	<L174+line_0
  3636 00:107B: 22 xx xx xx  	jsl	~~int2hex
  3637                        ;	a--;
  3638 00:107F: A5 09        	lda	<L175+a_1
  3639 00:1081: D0 02        	bne	L177
  3640 00:1083: C6 0B        	dec	<L175+a_1+2
  3641                        L177:
  3642 00:1085: C6 09        	dec	<L175+a_1
  3643                        ;	line += 2;
  3644 00:1087: A9 02 00     	lda	#$2
  3645 00:108A: 18           	clc
  3646 00:108B: 65 18        	adc	<L174+line_0
  3647 00:108D: 85 18        	sta	<L174+line_0
  3648 00:108F: 90 02        	bcc	L178
  3649 00:1091: E6 1A        	inc	<L174+line_0+2
  3650                        L178:
  3651                        ;	*line = ':';
  3652 00:1093: E2 20        	sep	#$20
  3653                        	longa	off
  3654 00:1095: A9 3A        	lda	#$3a
  3655 00:1097: 87 18        	sta	[<L174+line_0]
  3656 00:1099: C2 20        	rep	#$20
  3657                        	longa	on
  3658                        ;	line++;
  3659 00:109B: E6 18        	inc	<L174+line_0
  3660 00:109D: D0 02        	bne	L179
  3661 00:109F: E6 1A        	inc	<L174+line_0+2
  3662                        L179:
  3663                        ;	int2hex(line, *a);
  3664 00:10A1: A7 09        	lda	[<L175+a_1]
  3665 00:10A3: 29 FF 00     	and	#$ff
  3666 00:10A6: 48           	pha
  3667 00:10A7: D4 1A        	pei	<L174+line_0+2
  3668 00:10A9: D4 18        	pei	<L174+line_0
  3669 00:10AB: 22 xx xx xx  	jsl	~~int2hex
  3670                        ;	line += 2;
  3671 00:10AF: A9 02 00     	lda	#$2
  3672 00:10B2: 18           	clc
  3673 00:10B3: 65 18        	adc	<L174+line_0
  3674 00:10B5: 85 18        	sta	<L174+line_0
  3675 00:10B7: 90 02        	bcc	L180
  3676 00:10B9: E6 1A        	inc	<L174+line_0+2
  3677                        L180:
  3678                        ;	a--;
  3679 00:10BB: A5 09        	lda	<L175+a_1
  3680 00:10BD: D0 02        	bne	L181
  3681 00:10BF: C6 0B        	dec	<L175+a_1+2
  3682                        L181:
  3683 00:10C1: C6 09        	dec	<L175+a_1
  3684                        ;	int2hex(line, *a);
  Sun Jan  9 2022 20:39                                                Page 68


  3685 00:10C3: A7 09        	lda	[<L175+a_1]
  3686 00:10C5: 29 FF 00     	and	#$ff
  3687 00:10C8: 48           	pha
  3688 00:10C9: D4 1A        	pei	<L174+line_0+2
  3689 00:10CB: D4 18        	pei	<L174+line_0
  3690 00:10CD: 22 xx xx xx  	jsl	~~int2hex
  3691                        ;	line += 4;
  3692 00:10D1: A9 04 00     	lda	#$4
  3693 00:10D4: 18           	clc
  3694 00:10D5: 65 18        	adc	<L174+line_0
  3695 00:10D7: 85 18        	sta	<L174+line_0
  3696 00:10D9: 90 02        	bcc	L182
  3697 00:10DB: E6 1A        	inc	<L174+line_0+2
  3698                        L182:
  3699                        ;	
  3700                        ;	for (i = 0; i < len; i++) {
  3701 00:10DD: 64 05        	stz	<L175+i_1
  3702 00:10DF: 80 2F        	bra	L10101
  3703                        L10100:
  3704                        ;		int2hex(line, *data);
  3705 00:10E1: A7 1C        	lda	[<L174+data_0]
  3706 00:10E3: 29 FF 00     	and	#$ff
  3707 00:10E6: 48           	pha
  3708 00:10E7: D4 1A        	pei	<L174+line_0+2
  3709 00:10E9: D4 18        	pei	<L174+line_0
  3710 00:10EB: 22 xx xx xx  	jsl	~~int2hex
  3711                        ;		line += 3;
  3712 00:10EF: A9 03 00     	lda	#$3
  3713 00:10F2: 18           	clc
  3714 00:10F3: 65 18        	adc	<L174+line_0
  3715 00:10F5: 85 18        	sta	<L174+line_0
  3716 00:10F7: 90 02        	bcc	L183
  3717 00:10F9: E6 1A        	inc	<L174+line_0+2
  3718                        L183:
  3719                        ;		if (i == 7) line++;
  3720 00:10FB: A5 05        	lda	<L175+i_1
  3721 00:10FD: C9 07 00     	cmp	#<$7
  3722 00:1100: D0 06        	bne	L10102
  3723 00:1102: E6 18        	inc	<L174+line_0
  3724 00:1104: D0 02        	bne	L10102
  3725 00:1106: E6 1A        	inc	<L174+line_0+2
  3726                        ;		data++;
  3727                        L10102:
  3728 00:1108: E6 1C        	inc	<L174+data_0
  3729 00:110A: D0 02        	bne	L10098
  3730 00:110C: E6 1E        	inc	<L174+data_0+2
  3731                        ;	}
  3732                        L10098:
  3733 00:110E: E6 05        	inc	<L175+i_1
  3734                        L10101:
  3735 00:1110: A5 05        	lda	<L175+i_1
  3736 00:1112: C5 20        	cmp	<L174+len_0
  3737 00:1114: 90 CB        	bcc	L10100
  3738                        ;	data -= len;
  3739 00:1116: A5 20        	lda	<L174+len_0
  3740 00:1118: 85 01        	sta	<R0
  3741 00:111A: 64 03        	stz	<R0+2
  3742 00:111C: 38           	sec
  Sun Jan  9 2022 20:39                                                Page 69


  3743 00:111D: A5 1C        	lda	<L174+data_0
  3744 00:111F: E5 01        	sbc	<R0
  3745 00:1121: 85 1C        	sta	<L174+data_0
  3746 00:1123: A5 1E        	lda	<L174+data_0+2
  3747 00:1125: E5 03        	sbc	<R0+2
  3748 00:1127: 85 1E        	sta	<L174+data_0+2
  3749                        ;	
  3750                        ;	line = lineOld + 59;
  3751 00:1129: A9 3B 00     	lda	#$3b
  3752 00:112C: 18           	clc
  3753 00:112D: 65 0D        	adc	<L175+lineOld_1
  3754 00:112F: 85 18        	sta	<L174+line_0
  3755 00:1131: A9 00 00     	lda	#$0
  3756 00:1134: 65 0F        	adc	<L175+lineOld_1+2
  3757 00:1136: 85 1A        	sta	<L174+line_0+2
  3758                        ;	*line = '|';
  3759 00:1138: E2 20        	sep	#$20
  3760                        	longa	off
  3761 00:113A: A9 7C        	lda	#$7c
  3762 00:113C: 87 18        	sta	[<L174+line_0]
  3763 00:113E: C2 20        	rep	#$20
  3764                        	longa	on
  3765                        ;	line++;
  3766 00:1140: E6 18        	inc	<L174+line_0
  3767 00:1142: D0 02        	bne	L188
  3768 00:1144: E6 1A        	inc	<L174+line_0+2
  3769                        L188:
  3770                        ;	
  3771                        ;	for (i = 0; i < len; i++) {
  3772 00:1146: 64 05        	stz	<L175+i_1
  3773 00:1148: 80 2A        	bra	L10106
  3774                        L10105:
  3775                        ;		if (*data >= 32 && *data < 128) {
  3776 00:114A: E2 20        	sep	#$20
  3777                        	longa	off
  3778 00:114C: A7 1C        	lda	[<L174+data_0]
  3779 00:114E: C9 20        	cmp	#<$20
  3780 00:1150: C2 20        	rep	#$20
  3781                        	longa	on
  3782 00:1152: 90 12        	bcc	L10107
  3783 00:1154: E2 20        	sep	#$20
  3784                        	longa	off
  3785 00:1156: A7 1C        	lda	[<L174+data_0]
  3786 00:1158: C9 80        	cmp	#<$80
  3787 00:115A: C2 20        	rep	#$20
  3788                        	longa	on
  3789 00:115C: B0 08        	bcs	L10107
  3790                        ;			*line = *data;
  3791 00:115E: E2 20        	sep	#$20
  3792                        	longa	off
  3793 00:1160: A7 1C        	lda	[<L174+data_0]
  3794 00:1162: 87 18        	sta	[<L174+line_0]
  3795 00:1164: C2 20        	rep	#$20
  3796                        	longa	on
  3797                        ;		}
  3798                        ;		line++;
  3799                        L10107:
  3800 00:1166: E6 18        	inc	<L174+line_0
  Sun Jan  9 2022 20:39                                                Page 70


  3801 00:1168: D0 02        	bne	L191
  3802 00:116A: E6 1A        	inc	<L174+line_0+2
  3803                        L191:
  3804                        ;		data++;
  3805 00:116C: E6 1C        	inc	<L174+data_0
  3806 00:116E: D0 02        	bne	L10103
  3807 00:1170: E6 1E        	inc	<L174+data_0+2
  3808                        ;	}
  3809                        L10103:
  3810 00:1172: E6 05        	inc	<L175+i_1
  3811                        L10106:
  3812 00:1174: A5 05        	lda	<L175+i_1
  3813 00:1176: C5 20        	cmp	<L174+len_0
  3814 00:1178: 90 D0        	bcc	L10105
  3815                        ;	
  3816                        ;	*(lineOld+76) = '|';
  3817 00:117A: E2 20        	sep	#$20
  3818                        	longa	off
  3819 00:117C: A9 7C        	lda	#$7c
  3820 00:117E: A0 4C 00     	ldy	#$4c
  3821 00:1181: 97 0D        	sta	[<L175+lineOld_1],Y
  3822 00:1183: C2 20        	rep	#$20
  3823                        	longa	on
  3824                        ;	
  3825                        ;	return (77);
  3826 00:1185: A9 4D 00     	lda	#$4d
  3827 00:1188: A8           	tay
  3828 00:1189: A5 12        	lda	<L174+2
  3829 00:118B: 85 20        	sta	<L174+2+14
  3830 00:118D: A5 11        	lda	<L174+1
  3831 00:118F: 85 1F        	sta	<L174+1+14
  3832 00:1191: 2B           	pld
  3833 00:1192: 3B           	tsc
  3834 00:1193: 18           	clc
  3835 00:1194: 69 1E 00     	adc	#L174+14
  3836 00:1197: 1B           	tcs
  3837 00:1198: 98           	tya
  3838 00:1199: 6B           	rtl
  3839                        ;}
  3840             00000010   L174	equ	16
  3841             00000005   L175	equ	5
  3842                        	ends
  3843                        	efunc
  3844                        ;
  3845                        ;/* Load the specified program in the editor memor
                    y and returns 0 on success
  3846                        ; * or 1 on error. */
  3847                        ;int editorOpen() {
  3848                        	code
  3849                        	xdef	~~editorOpen
  3850                        	func
  3851                        ~~editorOpen:
  3852                        	longa	on
  3853                        	longi	on
  3854 00:119A: 3B           	tsc
  3855 00:119B: 38           	sec
  3856 00:119C: E9 80 00     	sbc	#L195
  3857 00:119F: 1B           	tcs
  Sun Jan  9 2022 20:39                                                Page 71


  3858 00:11A0: 0B           	phd
  3859 00:11A1: 5B           	tcd
  3860                        ;    FILE *fp;
  3861                        ;    char *line;
  3862                        ;	char *buffer;
  3863                        ;	char *p;
  3864                        ;    unsigned int linelen, buflen, bufavail;
  3865                        ;	int fd;
  3866                        ;	size_t sum, cnt;
  3867                        ;	unsigned int weiter, i;
  3868                        ;	char hexline[80];
  3869                        ;	
  3870                        ;    fp = fopen(E.filename, "rb");
  3871             00000000   fp_1	set	0
  3872             00000004   line_1	set	4
  3873             00000008   buffer_1	set	8
  3874             0000000C   p_1	set	12
  3875             00000010   linelen_1	set	16
  3876             00000012   buflen_1	set	18
  3877             00000014   bufavail_1	set	20
  3878             00000016   fd_1	set	22
  3879             00000018   sum_1	set	24
  3880             0000001C   cnt_1	set	28
  3881             00000020   weiter_1	set	32
  3882             00000022   i_1	set	34
  3883             00000024   hexline_1	set	36
  3884 00:11A2: F4 xx xx     	pea	#^L147
  3885 00:11A5: F4 xx xx     	pea	#<L147
  3886 00:11A8: AD xx xx     	lda	|~~E+26+2
  3887 00:11AB: 48           	pha
  3888 00:11AC: AD xx xx     	lda	|~~E+26
  3889 00:11AF: 48           	pha
  3890 00:11B0: 22 xx xx xx  	jsl	~~fopen
  3891 00:11B4: 85 0D        	sta	<L196+fp_1
  3892 00:11B6: 86 0F        	stx	<L196+fp_1+2
  3893                        ;    if (!fp) {
  3894 00:11B8: 05 0F        	ora	<L196+fp_1+2
  3895 00:11BA: D0 0D        	bne	L10108
  3896                        ;        return FALSE;
  3897 00:11BC: A9 00 00     	lda	#$0
  3898                        L198:
  3899 00:11BF: A8           	tay
  3900 00:11C0: 2B           	pld
  3901 00:11C1: 3B           	tsc
  3902 00:11C2: 18           	clc
  3903 00:11C3: 69 80 00     	adc	#L195
  3904 00:11C6: 1B           	tcs
  3905 00:11C7: 98           	tya
  3906 00:11C8: 6B           	rtl
  3907                        ;    }
  3908                        ;
  3909                        ;	fd = fileno(fp);
  3910                        L10108:
  3911 00:11C9: D4 0F        	pei	<L196+fp_1+2
  3912 00:11CB: D4 0D        	pei	<L196+fp_1
  3913 00:11CD: 22 xx xx xx  	jsl	~~fileno
  3914 00:11D1: 85 23        	sta	<L196+fd_1
  3915                        ;  	
  Sun Jan  9 2022 20:39                                                Page 72


  3916                        ;	sum = 0;
  3917 00:11D3: 64 25        	stz	<L196+sum_1
  3918 00:11D5: 64 27        	stz	<L196+sum_1+2
  3919                        ;	buflen = 0;		
  3920 00:11D7: 64 1F        	stz	<L196+buflen_1
  3921                        ;	linelen = 0;
  3922 00:11D9: 64 1D        	stz	<L196+linelen_1
  3923                        ;	weiter = 1;
  3924 00:11DB: A9 01 00     	lda	#$1
  3925 00:11DE: 85 2D        	sta	<L196+weiter_1
  3926                        ;	buffer = malloc(1024);
  3927 00:11E0: F4 00 00     	pea	#^$400
  3928 00:11E3: F4 00 04     	pea	#<$400
  3929 00:11E6: 22 xx xx xx  	jsl	~~malloc
  3930 00:11EA: 85 15        	sta	<L196+buffer_1
  3931 00:11EC: 86 17        	stx	<L196+buffer_1+2
  3932                        ;    line = NULL;
  3933 00:11EE: 64 11        	stz	<L196+line_1
  3934 00:11F0: 64 13        	stz	<L196+line_1+2
  3935                        ;	cnt = 0;
  3936 00:11F2: 64 29        	stz	<L196+cnt_1
  3937 00:11F4: 64 2B        	stz	<L196+cnt_1+2
  3938                        ;		
  3939                        ;	while(TRUE) {
  3940 00:11F6: 82 0B 01     	brl	L10109
  3941                        L20014:
  3942                        ;			
  3943                        ;			if (weiter == 0) {
  3944 00:11F9: A5 2D        	lda	<L196+weiter_1
  3945 00:11FB: D0 03        	bne	*+5
  3946 00:11FD: 82 29 01     	brl	L10110
  3947                        ;				break;
  3948                        ;			}
  3949                        ;			
  3950                        ;			buflen = 1024 - linelen;
  3951 00:1200: 38           	sec
  3952 00:1201: A9 00 04     	lda	#$400
  3953 00:1204: E5 1D        	sbc	<L196+linelen_1
  3954 00:1206: 85 1F        	sta	<L196+buflen_1
  3955                        ;			
  3956                        ;			memmove(buffer, line, linelen);
  3957 00:1208: A5 1D        	lda	<L196+linelen_1
  3958 00:120A: 85 01        	sta	<R0
  3959 00:120C: 64 03        	stz	<R0+2
  3960 00:120E: D4 03        	pei	<R0+2
  3961 00:1210: D4 01        	pei	<R0
  3962 00:1212: D4 13        	pei	<L196+line_1+2
  3963 00:1214: D4 11        	pei	<L196+line_1
  3964 00:1216: D4 17        	pei	<L196+buffer_1+2
  3965 00:1218: D4 15        	pei	<L196+buffer_1
  3966 00:121A: 22 xx xx xx  	jsl	~~memmove
  3967                        ;			
  3968                        ;			bufavail = read(fd, buffer + lin
                    elen, buflen);
  3969 00:121E: A5 1F        	lda	<L196+buflen_1
  3970 00:1220: 85 01        	sta	<R0
  3971 00:1222: 64 03        	stz	<R0+2
  3972 00:1224: D4 03        	pei	<R0+2
  Sun Jan  9 2022 20:39                                                Page 73


  3973 00:1226: D4 01        	pei	<R0
  3974 00:1228: A5 1D        	lda	<L196+linelen_1
  3975 00:122A: 85 05        	sta	<R1
  3976 00:122C: 64 07        	stz	<R1+2
  3977 00:122E: A5 15        	lda	<L196+buffer_1
  3978 00:1230: 18           	clc
  3979 00:1231: 65 05        	adc	<R1
  3980 00:1233: 85 09        	sta	<R2
  3981 00:1235: A5 17        	lda	<L196+buffer_1+2
  3982 00:1237: 65 07        	adc	<R1+2
  3983 00:1239: 48           	pha
  3984 00:123A: D4 09        	pei	<R2
  3985 00:123C: D4 23        	pei	<L196+fd_1
  3986 00:123E: 22 xx xx xx  	jsl	~~read
  3987 00:1242: 85 21        	sta	<L196+bufavail_1
  3988                        ;			sum += bufavail;
  3989 00:1244: 85 01        	sta	<R0
  3990 00:1246: 64 03        	stz	<R0+2
  3991 00:1248: A5 01        	lda	<R0
  3992 00:124A: 18           	clc
  3993 00:124B: 65 25        	adc	<L196+sum_1
  3994 00:124D: 85 25        	sta	<L196+sum_1
  3995 00:124F: A5 03        	lda	<R0+2
  3996 00:1251: 65 27        	adc	<L196+sum_1+2
  3997 00:1253: 85 27        	sta	<L196+sum_1+2
  3998                        ;
  3999                        ;			if (buflen != bufavail) weiter =
                     0;
  4000 00:1255: A5 1F        	lda	<L196+buflen_1
  4001 00:1257: C5 21        	cmp	<L196+bufavail_1
  4002 00:1259: F0 02        	beq	L10113
  4003 00:125B: 64 2D        	stz	<L196+weiter_1
  4004                        ;			buflen = bufavail + linelen;
  4005                        L10113:
  4006 00:125D: A5 21        	lda	<L196+bufavail_1
  4007 00:125F: 18           	clc
  4008 00:1260: 65 1D        	adc	<L196+linelen_1
  4009 00:1262: 85 1F        	sta	<L196+buflen_1
  4010                        ;
  4011                        ;			line = p = buffer;
  4012 00:1264: A5 15        	lda	<L196+buffer_1
  4013 00:1266: 85 19        	sta	<L196+p_1
  4014 00:1268: A5 17        	lda	<L196+buffer_1+2
  4015 00:126A: 85 1B        	sta	<L196+p_1+2
  4016 00:126C: A5 15        	lda	<L196+buffer_1
  4017 00:126E: 85 11        	sta	<L196+line_1
  4018 00:1270: A5 17        	lda	<L196+buffer_1+2
  4019 00:1272: 82 8B 00     	brl	L20019
  4020                        ;			linelen = 0;
  4021                        ;			continue;
  4022                        L20017:
  4023                        ;				if (linelen > 0 && *(p-1
                    ) == '\r') {
  4024 00:1275: A9 00 00     	lda	#$0
  4025 00:1278: C5 1D        	cmp	<L196+linelen_1
  4026 00:127A: B0 1B        	bcs	L10116
  4027 00:127C: A9 FF FF     	lda	#$ffff
  4028 00:127F: 18           	clc
  Sun Jan  9 2022 20:39                                                Page 74


  4029 00:1280: 65 19        	adc	<L196+p_1
  4030 00:1282: 85 01        	sta	<R0
  4031 00:1284: A9 FF FF     	lda	#$ffff
  4032 00:1287: 65 1B        	adc	<L196+p_1+2
  4033 00:1289: 85 03        	sta	<R0+2
  4034 00:128B: E2 20        	sep	#$20
  4035                        	longa	off
  4036 00:128D: A7 01        	lda	[<R0]
  4037 00:128F: C9 0D        	cmp	#<$d
  4038 00:1291: C2 20        	rep	#$20
  4039                        	longa	on
  4040 00:1293: D0 02        	bne	L10116
  4041                        ;					linelen--;
  4042 00:1295: C6 1D        	dec	<L196+linelen_1
  4043                        ;				}
  4044                        ;				
  4045                        ;				editorInsertRow(E.numrow
                    s, line, linelen);
  4046                        L10116:
  4047 00:1297: D4 1D        	pei	<L196+linelen_1
  4048 00:1299: D4 13        	pei	<L196+line_1+2
  4049 00:129B: D4 11        	pei	<L196+line_1
  4050 00:129D: AD xx xx     	lda	|~~E+12
  4051 00:12A0: 48           	pha
  4052 00:12A1: 22 xx xx xx  	jsl	~~editorInsertRow
  4053                        ;	
  4054                        ;				p++;
  4055 00:12A5: 80 4D        	bra	L20024
  4056                        ;				line = p;
  4057                        ;				linelen = 0;
  4058                        ;				continue;
  4059                        L10114:
  4060                        ;			//debugf("buflen: %d linelen: %d
                    \n", (long)buflen, (long)linelen);
  4061                        ;			
  4062                        ;			if (linelen == 15 || (buflen == 
                    0 && weiter == 0)) {
  4063 00:12A7: A5 1D        	lda	<L196+linelen_1
  4064 00:12A9: C9 0F 00     	cmp	#<$f
  4065 00:12AC: F0 08        	beq	L207
  4066 00:12AE: A5 1F        	lda	<L196+buflen_1
  4067 00:12B0: D0 6D        	bne	L10117
  4068 00:12B2: A5 2D        	lda	<L196+weiter_1
  4069 00:12B4: D0 69        	bne	L10117
  4070                        L207:
  4071                        ;	
  4072                        ;				linelen++;
  4073 00:12B6: E6 1D        	inc	<L196+linelen_1
  4074                        ;
  4075                        ;				//editorGenerateHexline(
                    cnt, hexline, line, linelen);
  4076                        ;				
  4077                        ;				editorInsertRow(E.numrow
                    s, hexline, editorGenerateHexline(cnt, hexline, line, linele
                    n));
  4078 00:12B8: D4 1D        	pei	<L196+linelen_1
  4079 00:12BA: D4 13        	pei	<L196+line_1+2
  4080 00:12BC: D4 11        	pei	<L196+line_1
  Sun Jan  9 2022 20:39                                                Page 75


  4081 00:12BE: F4 00 00     	pea	#0
  4082 00:12C1: 18           	clc
  4083 00:12C2: 7B           	tdc
  4084 00:12C3: 69 31 00     	adc	#<L196+hexline_1
  4085 00:12C6: 48           	pha
  4086 00:12C7: D4 2B        	pei	<L196+cnt_1+2
  4087 00:12C9: D4 29        	pei	<L196+cnt_1
  4088 00:12CB: 22 xx xx xx  	jsl	~~editorGenerateHexline
  4089 00:12CF: 48           	pha
  4090 00:12D0: F4 00 00     	pea	#0
  4091 00:12D3: 18           	clc
  4092 00:12D4: 7B           	tdc
  4093 00:12D5: 69 31 00     	adc	#<L196+hexline_1
  4094 00:12D8: 48           	pha
  4095 00:12D9: AD xx xx     	lda	|~~E+12
  4096 00:12DC: 48           	pha
  4097 00:12DD: 22 xx xx xx  	jsl	~~editorInsertRow
  4098                        ;				cnt += linelen;
  4099 00:12E1: A5 1D        	lda	<L196+linelen_1
  4100 00:12E3: 85 01        	sta	<R0
  4101 00:12E5: 64 03        	stz	<R0+2
  4102 00:12E7: A5 01        	lda	<R0
  4103 00:12E9: 18           	clc
  4104 00:12EA: 65 29        	adc	<L196+cnt_1
  4105 00:12EC: 85 29        	sta	<L196+cnt_1
  4106 00:12EE: A5 03        	lda	<R0+2
  4107 00:12F0: 65 2B        	adc	<L196+cnt_1+2
  4108 00:12F2: 85 2B        	sta	<L196+cnt_1+2
  4109                        ;				
  4110                        ;				p++;
  4111                        L20024:
  4112 00:12F4: E6 19        	inc	<L196+p_1
  4113 00:12F6: D0 02        	bne	L211
  4114 00:12F8: E6 1B        	inc	<L196+p_1+2
  4115                        L211:
  4116                        ;				line = p;
  4117 00:12FA: A5 19        	lda	<L196+p_1
  4118 00:12FC: 85 11        	sta	<L196+line_1
  4119 00:12FE: A5 1B        	lda	<L196+p_1+2
  4120                        L20019:
  4121 00:1300: 85 13        	sta	<L196+line_1+2
  4122                        ;				linelen = 0;
  4123 00:1302: 64 1D        	stz	<L196+linelen_1
  4124                        ;				continue;
  4125                        L10109:
  4126                        ;		
  4127                        ;		if (buflen == 0) {
  4128 00:1304: A5 1F        	lda	<L196+buflen_1
  4129 00:1306: D0 03        	bne	*+5
  4130 00:1308: 82 EE FE     	brl	L20014
  4131                        ;		}
  4132                        ;		
  4133                        ;		buflen--;
  4134 00:130B: C6 1F        	dec	<L196+buflen_1
  4135                        ;		
  4136                        ;		if (E.hex == 0) {
  4137 00:130D: AD xx xx     	lda	|~~E+24
  4138 00:1310: D0 95        	bne	L10114
  Sun Jan  9 2022 20:39                                                Page 76


  4139                        ;			if (*p == '\n') {
  4140 00:1312: E2 20        	sep	#$20
  4141                        	longa	off
  4142 00:1314: A7 19        	lda	[<L196+p_1]
  4143 00:1316: C9 0A        	cmp	#<$a
  4144 00:1318: C2 20        	rep	#$20
  4145                        	longa	on
  4146 00:131A: D0 03        	bne	*+5
  4147 00:131C: 82 56 FF     	brl	L20017
  4148                        ;			}
  4149                        ;		} else {
  4150                        L10117:
  4151                        ;
  4152                        ;		linelen++;
  4153 00:131F: E6 1D        	inc	<L196+linelen_1
  4154                        ;		p++;
  4155 00:1321: E6 19        	inc	<L196+p_1
  4156 00:1323: D0 DF        	bne	L10109
  4157 00:1325: E6 1B        	inc	<L196+p_1+2
  4158                        ;		
  4159                        ;	}
  4160 00:1327: 80 DB        	bra	L10109
  4161                        ;			}
  4162                        ;		}
  4163                        L10110:
  4164                        ;	
  4165                        ;	free(buffer);
  4166 00:1329: D4 17        	pei	<L196+buffer_1+2
  4167 00:132B: D4 15        	pei	<L196+buffer_1
  4168 00:132D: 22 xx xx xx  	jsl	~~free
  4169                        ;    fclose(fp);
  4170 00:1331: D4 0F        	pei	<L196+fp_1+2
  4171 00:1333: D4 0D        	pei	<L196+fp_1
  4172 00:1335: 22 xx xx xx  	jsl	~~fclose
  4173                        ;    E.dirty = 0;
  4174 00:1339: 9C xx xx     	stz	|~~E+20
  4175                        ;			
  4176                        ;	editorSetStatusMessage("%lu bytes read", sum);
  4177 00:133C: D4 27        	pei	<L196+sum_1+2
  4178 00:133E: D4 25        	pei	<L196+sum_1
  4179 00:1340: F4 xx xx     	pea	#^L147+3
  4180 00:1343: F4 xx xx     	pea	#<L147+3
  4181 00:1346: F4 0A 00     	pea	#10
  4182 00:1349: 22 xx xx xx  	jsl	~~editorSetStatusMessage
  4183                        ;    return TRUE;
  4184 00:134D: A9 01 00     	lda	#$1
  4185 00:1350: 82 6C FE     	brl	L198
  4186                        ;}
  4187             00000080   L195	equ	128
  4188             0000000D   L196	equ	13
  4189                        	ends
  4190                        	efunc
  4191                        	data
  4192                        L147:
  4193 00:0003: 72 62 00 25  	db	$72,$62,$00,$25,$6C,$75,$20,$62,$79,$74,
                    $65,$73,$20,$72,$65
       00:0007: 6C 75 20 62 
       00:000B: 79 74 65 73 
  Sun Jan  9 2022 20:39                                                Page 77


       00:000F: 20 72 65 
  4194 00:0012: 61 64 00     	db	$61,$64,$00
  4195 00:0015:              	ends
  4196                        ;
  4197                        ;/* Save the current file on disk. Return 0 on suc
                    cess, 1 on error. */
  4198                        ;int editorSave(void) {
  4199                        	code
  4200                        	xdef	~~editorSave
  4201                        	func
  4202                        ~~editorSave:
  4203                        	longa	on
  4204                        	longi	on
  4205 00:1353: 3B           	tsc
  4206 00:1354: 38           	sec
  4207 00:1355: E9 12 00     	sbc	#L214
  4208 00:1358: 1B           	tcs
  4209 00:1359: 0B           	phd
  4210 00:135A: 5B           	tcd
  4211                        ;    size_t len;
  4212                        ;    char *buf;
  4213                        ;	FILE *fout;
  4214                        ;	int error;
  4215                        ;	
  4216                        ;	error = TRUE;
  4217             00000000   len_1	set	0
  4218             00000004   buf_1	set	4
  4219             00000008   fout_1	set	8
  4220             0000000C   error_1	set	12
  4221 00:135B: A9 01 00     	lda	#$1
  4222 00:135E: 85 11        	sta	<L215+error_1
  4223                        ;	
  4224                        ;    buf = editorRowsToString(&len);
  4225 00:1360: F4 00 00     	pea	#0
  4226 00:1363: 18           	clc
  4227 00:1364: 7B           	tdc
  4228 00:1365: 69 05 00     	adc	#<L215+len_1
  4229 00:1368: 48           	pha
  4230 00:1369: 22 xx xx xx  	jsl	~~editorRowsToString
  4231 00:136D: 85 09        	sta	<L215+buf_1
  4232 00:136F: 86 0B        	stx	<L215+buf_1+2
  4233                        ;	
  4234                        ;    fout = fopen(E.filename, "wb");
  4235 00:1371: F4 xx xx     	pea	#^L213
  4236 00:1374: F4 xx xx     	pea	#<L213
  4237 00:1377: AD xx xx     	lda	|~~E+26+2
  4238 00:137A: 48           	pha
  4239 00:137B: AD xx xx     	lda	|~~E+26
  4240 00:137E: 48           	pha
  4241 00:137F: 22 xx xx xx  	jsl	~~fopen
  4242 00:1383: 85 0D        	sta	<L215+fout_1
  4243 00:1385: 86 0F        	stx	<L215+fout_1+2
  4244                        ; 	if (fout != NULL) {
  4245 00:1387: 05 0F        	ora	<L215+fout_1+2
  4246 00:1389: F0 2C        	beq	L10119
  4247                        ;		if (fwrite(buf, 1, len, fout) == len) {
  4248 00:138B: D4 0F        	pei	<L215+fout_1+2
  4249 00:138D: D4 0D        	pei	<L215+fout_1
  Sun Jan  9 2022 20:39                                                Page 78


  4250 00:138F: D4 07        	pei	<L215+len_1+2
  4251 00:1391: D4 05        	pei	<L215+len_1
  4252 00:1393: F4 00 00     	pea	#^$1
  4253 00:1396: F4 01 00     	pea	#<$1
  4254 00:1399: D4 0B        	pei	<L215+buf_1+2
  4255 00:139B: D4 09        	pei	<L215+buf_1
  4256 00:139D: 22 xx xx xx  	jsl	~~fwrite
  4257 00:13A1: 86 03        	stx	<R0+2
  4258 00:13A3: C5 05        	cmp	<L215+len_1
  4259 00:13A5: D0 04        	bne	L217
  4260 00:13A7: A5 03        	lda	<R0+2
  4261 00:13A9: C5 07        	cmp	<L215+len_1+2
  4262                        L217:
  4263 00:13AB: D0 02        	bne	L10120
  4264                        ;			error = FALSE;
  4265 00:13AD: 64 11        	stz	<L215+error_1
  4266                        ;		}
  4267                        ;		fclose(fout);
  4268                        L10120:
  4269 00:13AF: D4 0F        	pei	<L215+fout_1+2
  4270 00:13B1: D4 0D        	pei	<L215+fout_1
  4271 00:13B3: 22 xx xx xx  	jsl	~~fclose
  4272                        ;	}
  4273                        ;	
  4274                        ;	free(buf);
  4275                        L10119:
  4276 00:13B7: D4 0B        	pei	<L215+buf_1+2
  4277 00:13B9: D4 09        	pei	<L215+buf_1
  4278 00:13BB: 22 xx xx xx  	jsl	~~free
  4279                        ;
  4280                        ;	if (error) {
  4281 00:13BF: A5 11        	lda	<L215+error_1
  4282 00:13C1: F0 0D        	beq	L10121
  4283                        ;		return FALSE;
  4284 00:13C3: A9 00 00     	lda	#$0
  4285                        L220:
  4286 00:13C6: A8           	tay
  4287 00:13C7: 2B           	pld
  4288 00:13C8: 3B           	tsc
  4289 00:13C9: 18           	clc
  4290 00:13CA: 69 12 00     	adc	#L214
  4291 00:13CD: 1B           	tcs
  4292 00:13CE: 98           	tya
  4293 00:13CF: 6B           	rtl
  4294                        ;	}
  4295                        ;
  4296                        ;    E.dirty = 0;
  4297                        L10121:
  4298 00:13D0: 9C xx xx     	stz	|~~E+20
  4299                        ;    editorSetStatusMessage("%lu bytes written", l
                    en);
  4300 00:13D3: D4 07        	pei	<L215+len_1+2
  4301 00:13D5: D4 05        	pei	<L215+len_1
  4302 00:13D7: F4 xx xx     	pea	#^L213+3
  4303 00:13DA: F4 xx xx     	pea	#<L213+3
  4304 00:13DD: F4 0A 00     	pea	#10
  4305 00:13E0: 22 xx xx xx  	jsl	~~editorSetStatusMessage
  4306                        ;    return TRUE;
  Sun Jan  9 2022 20:39                                                Page 79


  4307 00:13E4: A9 01 00     	lda	#$1
  4308 00:13E7: 80 DD        	bra	L220
  4309                        ;}
  4310             00000012   L214	equ	18
  4311             00000005   L215	equ	5
  4312                        	ends
  4313                        	efunc
  4314                        	data
  4315                        L213:
  4316 00:0015: 77 62 00 25  	db	$77,$62,$00,$25,$6C,$75,$20,$62,$79,$74,
                    $65,$73,$20,$77,$72
       00:0019: 6C 75 20 62 
       00:001D: 79 74 65 73 
       00:0021: 20 77 72 
  4317 00:0024: 69 74 74 65  	db	$69,$74,$74,$65,$6E,$00
       00:0028: 6E 00 
  4318 00:002A:              	ends
  4319                        ;
  4320                        ;void editorSetFileName() {
  4321                        	code
  4322                        	xdef	~~editorSetFileName
  4323                        	func
  4324                        ~~editorSetFileName:
  4325                        	longa	on
  4326                        	longi	on
  4327 00:13E9: 3B           	tsc
  4328 00:13EA: 38           	sec
  4329 00:13EB: E9 07 00     	sbc	#L222
  4330 00:13EE: 1B           	tcs
  4331 00:13EF: 0B           	phd
  4332 00:13F0: 5B           	tcd
  4333                        ;	char c = 0;
  4334                        ;	int index = 0;
  4335                        ;	
  4336                        ;	printf("%c", CLS);
  4337             00000000   c_1	set	0
  4338             00000001   index_1	set	1
  4339 00:13F1: E2 20        	sep	#$20
  4340                        	longa	off
  4341 00:13F3: 64 05        	stz	<L223+c_1
  4342 00:13F5: C2 20        	rep	#$20
  4343                        	longa	on
  4344 00:13F7: 64 06        	stz	<L223+index_1
  4345 00:13F9: F4 01 00     	pea	#<$1
  4346 00:13FC: F4 xx xx     	pea	#^L221
  4347 00:13FF: F4 xx xx     	pea	#<L221
  4348 00:1402: 80 6A        	bra	L20027
  4349                        ;	
  4350                        ;	while (c != EOL) {
  4351                        L20025:
  4352                        ;		c = toupper(getchar());
  4353 00:1404: AD xx xx     	lda	|~~stdin+2
  4354 00:1407: 48           	pha
  4355 00:1408: AD xx xx     	lda	|~~stdin
  4356 00:140B: 48           	pha
  4357 00:140C: 22 xx xx xx  	jsl	~~fgetc
  4358 00:1410: 48           	pha
  4359 00:1411: 22 xx xx xx  	jsl	~~toupper
  Sun Jan  9 2022 20:39                                                Page 80


  4360 00:1415: E2 20        	sep	#$20
  4361                        	longa	off
  4362 00:1417: 85 05        	sta	<L223+c_1
  4363                        ;				
  4364                        ;		if (c >= ' ' && index < 80) {
  4365 00:1419: C9 20        	cmp	#<$20
  4366 00:141B: C2 20        	rep	#$20
  4367                        	longa	on
  4368 00:141D: 90 2D        	bcc	L10124
  4369 00:141F: 38           	sec
  4370 00:1420: A5 06        	lda	<L223+index_1
  4371 00:1422: E9 50 00     	sbc	#<$50
  4372 00:1425: 70 03        	bvs	L226
  4373 00:1427: 49 00 80     	eor	#$8000
  4374                        L226:
  4375 00:142A: 30 20        	bmi	L10124
  4376                        ;			status[index++] = c;
  4377 00:142C: E2 20        	sep	#$20
  4378                        	longa	off
  4379 00:142E: A5 05        	lda	<L223+c_1
  4380 00:1430: A6 06        	ldx	<L223+index_1
  4381 00:1432: 9D xx xx     	sta	|~~status,X
  4382 00:1435: C2 20        	rep	#$20
  4383                        	longa	on
  4384 00:1437: E6 06        	inc	<L223+index_1
  4385                        ;			printf("%c", c);
  4386 00:1439: A5 05        	lda	<L223+c_1
  4387 00:143B: 29 FF 00     	and	#$ff
  4388 00:143E: 48           	pha
  4389 00:143F: F4 xx xx     	pea	#^L221+3
  4390 00:1442: F4 xx xx     	pea	#<L221+3
  4391 00:1445: F4 08 00     	pea	#8
  4392 00:1448: 22 xx xx xx  	jsl	~~printf
  4393                        ;		}
  4394                        ;		if (c == BACK && index > 0) {
  4395                        L10124:
  4396 00:144C: E2 20        	sep	#$20
  4397                        	longa	off
  4398 00:144E: A5 05        	lda	<L223+c_1
  4399 00:1450: C9 08        	cmp	#<$8
  4400 00:1452: C2 20        	rep	#$20
  4401                        	longa	on
  4402 00:1454: D0 1F        	bne	L10125
  4403 00:1456: 38           	sec
  4404 00:1457: A9 00 00     	lda	#$0
  4405 00:145A: E5 06        	sbc	<L223+index_1
  4406 00:145C: 70 03        	bvs	L229
  4407 00:145E: 49 00 80     	eor	#$8000
  4408                        L229:
  4409 00:1461: 30 12        	bmi	L10125
  4410                        ;			index--;
  4411 00:1463: C6 06        	dec	<L223+index_1
  4412                        ;			printf("%c", BACK);
  4413 00:1465: F4 08 00     	pea	#<$8
  4414 00:1468: F4 xx xx     	pea	#^L221+6
  4415 00:146B: F4 xx xx     	pea	#<L221+6
  4416                        L20027:
  4417 00:146E: F4 08 00     	pea	#8
  Sun Jan  9 2022 20:39                                                Page 81


  4418 00:1471: 22 xx xx xx  	jsl	~~printf
  4419                        ;		}
  4420                        ;	}		
  4421                        L10125:
  4422 00:1475: E2 20        	sep	#$20
  4423                        	longa	off
  4424 00:1477: A5 05        	lda	<L223+c_1
  4425 00:1479: C9 0A        	cmp	#<$a
  4426 00:147B: C2 20        	rep	#$20
  4427                        	longa	on
  4428 00:147D: D0 85        	bne	L20025
  4429                        ;	
  4430                        ;	status[index] = 0;
  4431 00:147F: E2 20        	sep	#$20
  4432                        	longa	off
  4433 00:1481: A9 00        	lda	#$0
  4434 00:1483: A6 06        	ldx	<L223+index_1
  4435 00:1485: 9D xx xx     	sta	|~~status,X
  4436 00:1488: C2 20        	rep	#$20
  4437                        	longa	on
  4438                        ;	free(E.filename);
  4439 00:148A: AD xx xx     	lda	|~~E+26+2
  4440 00:148D: 48           	pha
  4441 00:148E: AD xx xx     	lda	|~~E+26
  4442 00:1491: 48           	pha
  4443 00:1492: 22 xx xx xx  	jsl	~~free
  4444                        ;	E.filename = strdup(status);
  4445 00:1496: A9 xx xx     	lda	#<~~status
  4446 00:1499: 85 01        	sta	<R0
  4447                        	xref	_BEG_DATA
  4448 00:149B: A9 xx xx     	lda	#_BEG_DATA>>16
  4449 00:149E: 48           	pha
  4450 00:149F: D4 01        	pei	<R0
  4451 00:14A1: 22 xx xx xx  	jsl	~~strdup
  4452 00:14A5: 8D xx xx     	sta	|~~E+26
  4453 00:14A8: 8E xx xx     	stx	|~~E+26+2
  4454                        ;}
  4455 00:14AB: 2B           	pld
  4456 00:14AC: 3B           	tsc
  4457 00:14AD: 18           	clc
  4458 00:14AE: 69 07 00     	adc	#L222
  4459 00:14B1: 1B           	tcs
  4460 00:14B2: 6B           	rtl
  4461             00000007   L222	equ	7
  4462             00000005   L223	equ	5
  4463                        	ends
  4464                        	efunc
  4465                        	data
  4466                        L221:
  4467 00:002A: 25 63 00 25  	db	$25,$63,$00,$25,$63,$00,$25,$63,$00
       00:002E: 63 00 25 63 
       00:0032: 00 
  4468 00:0033:              	ends
  4469                        ;
  4470                        ;void editorEmpty() {
  4471                        	code
  4472                        	xdef	~~editorEmpty
  4473                        	func
  Sun Jan  9 2022 20:39                                                Page 82


  4474                        ~~editorEmpty:
  4475                        	longa	on
  4476                        	longi	on
  4477                        ;	editorfreeAllRows();
  4478 00:14B3: 22 xx xx xx  	jsl	~~editorfreeAllRows
  4479                        ;	E.cx = 0;
  4480 00:14B7: 9C xx xx     	stz	|~~E
  4481                        ;    E.cy = 0;
  4482 00:14BA: 9C xx xx     	stz	|~~E+2
  4483                        ;    E.rowoff = 0;
  4484 00:14BD: 9C xx xx     	stz	|~~E+4
  4485                        ;    E.coloff = 0;
  4486 00:14C0: 9C xx xx     	stz	|~~E+6
  4487                        ;    E.numrows = 0;
  4488 00:14C3: 9C xx xx     	stz	|~~E+12
  4489                        ;    E.dirty = 0;
  4490 00:14C6: 9C xx xx     	stz	|~~E+20
  4491                        ;}
  4492 00:14C9: 6B           	rtl
  4493             00000000   L233	equ	0
  4494             00000001   L234	equ	1
  4495                        	ends
  4496                        	efunc
  4497                        ;
  4498                        ;int editorLoad() {
  4499                        	code
  4500                        	xdef	~~editorLoad
  4501                        	func
  4502                        ~~editorLoad:
  4503                        	longa	on
  4504                        	longi	on
  4505                        ;	editorEmpty();
  4506 00:14CA: 22 xx xx xx  	jsl	~~editorEmpty
  4507                        ;	editorOpen();
  4508 00:14CE: 22 xx xx xx  	jsl	~~editorOpen
  4509                        ;}
  4510 00:14D2: 6B           	rtl
  4511             00000000   L236	equ	0
  4512             00000001   L237	equ	1
  4513                        	ends
  4514                        	efunc
  4515                        ;
  4516                        ;void editorSetDefaultStatusMessage() {
  4517                        	code
  4518                        	xdef	~~editorSetDefaultStatusMessage
  4519                        	func
  4520                        ~~editorSetDefaultStatusMessage:
  4521                        	longa	on
  4522                        	longi	on
  4523 00:14D3: 3B           	tsc
  4524 00:14D4: 38           	sec
  4525 00:14D5: E9 04 00     	sbc	#L239
  4526 00:14D8: 1B           	tcs
  4527 00:14D9: 0B           	phd
  4528 00:14DA: 5B           	tcd
  4529                        ;	if (errno) {
  4530 00:14DB: 22 xx xx xx  	jsl	~~__errno_location
  4531 00:14DF: 85 01        	sta	<R0
  Sun Jan  9 2022 20:39                                                Page 83


  4532 00:14E1: 86 03        	stx	<R0+2
  4533 00:14E3: A7 01        	lda	[<R0]
  4534 00:14E5: F0 2F        	beq	L242
  4535                        ;			editorSetStatusMessage("I/O erro
                    r: %s",strerror(errno));
  4536 00:14E7: 22 xx xx xx  	jsl	~~__errno_location
  4537 00:14EB: 85 01        	sta	<R0
  4538 00:14ED: 86 03        	stx	<R0+2
  4539 00:14EF: A7 01        	lda	[<R0]
  4540 00:14F1: 48           	pha
  4541 00:14F2: 22 xx xx xx  	jsl	~~strerror
  4542 00:14F6: 85 01        	sta	<R0
  4543 00:14F8: 86 03        	stx	<R0+2
  4544 00:14FA: DA           	phx
  4545 00:14FB: 48           	pha
  4546 00:14FC: F4 xx xx     	pea	#^L232
  4547 00:14FF: F4 xx xx     	pea	#<L232
  4548 00:1502: F4 0A 00     	pea	#10
  4549 00:1505: 22 xx xx xx  	jsl	~~editorSetStatusMessage
  4550                        ;			errno = 0;
  4551 00:1509: 22 xx xx xx  	jsl	~~__errno_location
  4552 00:150D: 85 01        	sta	<R0
  4553 00:150F: 86 03        	stx	<R0+2
  4554 00:1511: A9 00 00     	lda	#$0
  4555 00:1514: 87 01        	sta	[<R0]
  4556                        ;	}
  4557                        ;}
  4558                        L242:
  4559 00:1516: 2B           	pld
  4560 00:1517: 3B           	tsc
  4561 00:1518: 18           	clc
  4562 00:1519: 69 04 00     	adc	#L239
  4563 00:151C: 1B           	tcs
  4564 00:151D: 6B           	rtl
  4565             00000004   L239	equ	4
  4566             00000005   L240	equ	5
  4567                        	ends
  4568                        	efunc
  4569                        	data
  4570                        L232:
  4571 00:0033: 49 2F 4F 20  	db	$49,$2F,$4F,$20,$65,$72,$72,$6F,$72,$3A,
                    $20,$25,$73,$00
       00:0037: 65 72 72 6F 
       00:003B: 72 3A 20 25 
       00:003F: 73 00 
  4572 00:0041:              	ends
  4573                        ;
  4574                        ;void editorToggleHex() {
  4575                        	code
  4576                        	xdef	~~editorToggleHex
  4577                        	func
  4578                        ~~editorToggleHex:
  4579                        	longa	on
  4580                        	longi	on
  4581                        ;	toggleHex();
  4582 00:151E: 22 xx xx xx  	jsl	~~toggleHex
  4583                        ;	E.readonly = E.hex;
  4584 00:1522: AD xx xx     	lda	|~~E+24
  Sun Jan  9 2022 20:39                                                Page 84


  4585 00:1525: 8D xx xx     	sta	|~~E+22
  4586                        ;	editorLoad();
  4587 00:1528: 22 xx xx xx  	jsl	~~editorLoad
  4588                        ;}
  4589 00:152C: 6B           	rtl
  4590             00000000   L244	equ	0
  4591             00000001   L245	equ	1
  4592                        	ends
  4593                        	efunc
  4594                        ;
  4595                        ;/* ============================= Terminal update 
                    ============================ */
  4596                        ;
  4597                        ;/* We define a very simple "append buffer" struct
                    ure, that is an heap
  4598                        ; * allocated string where we can append to. This 
                    is useful in order to
  4599                        ; * write all the escape sequences in a buffer and
                     flush them to the standard
  4600                        ; * output in a single call, to avoid flickering e
                    ffects. */
  4601                        ;struct abuf {
  4602                        ;    char *b;
  4603                        ;    int len;
  4604                        ;	int avail;
  4605                        ;};
  4606                        ;
  4607                        ;#define ABUF_INIT {NULL, 0, 0}
  4608                        ;#define ABUF_INCREMENT 1024
  4609                        ;
  4610                        ;void abAppend(struct abuf *ab, const char *s, int
                     len) {
  4611                        	code
  4612                        	xdef	~~abAppend
  4613                        	func
  4614                        ~~abAppend:
  4615                        	longa	on
  4616                        	longi	on
  4617 00:152D: 3B           	tsc
  4618 00:152E: 38           	sec
  4619 00:152F: E9 0C 00     	sbc	#L247
  4620 00:1532: 1B           	tcs
  4621 00:1533: 0B           	phd
  4622 00:1534: 5B           	tcd
  4623             00000004   ab_0	set	4
  4624             00000008   s_0	set	8
  4625             0000000C   len_0	set	12
  4626                        ;		
  4627                        ;	while (len > ab->avail) {
  4628 00:1535: 80 4B        	bra	L10127
  4629                        L20029:
  4630                        ;		ab->avail += ABUF_INCREMENT;
  4631 00:1537: A9 06 00     	lda	#$6
  4632 00:153A: 18           	clc
  4633 00:153B: 65 10        	adc	<L247+ab_0
  4634 00:153D: 85 01        	sta	<R0
  4635 00:153F: A9 00 00     	lda	#$0
  4636 00:1542: 65 12        	adc	<L247+ab_0+2
  Sun Jan  9 2022 20:39                                                Page 85


  4637 00:1544: 85 03        	sta	<R0+2
  4638 00:1546: A9 00 04     	lda	#$400
  4639 00:1549: 18           	clc
  4640 00:154A: 67 01        	adc	[<R0]
  4641 00:154C: 87 01        	sta	[<R0]
  4642                        ;		ab->b = realloc(ab->b, ab->len + ab->ava
                    il);
  4643 00:154E: 18           	clc
  4644 00:154F: A0 04 00     	ldy	#$4
  4645 00:1552: B7 10        	lda	[<L247+ab_0],Y
  4646 00:1554: C8           	iny
  4647 00:1555: C8           	iny
  4648 00:1556: 77 10        	adc	[<L247+ab_0],Y
  4649 00:1558: 85 01        	sta	<R0
  4650 00:155A: A0 00 00     	ldy	#$0
  4651 00:155D: A5 01        	lda	<R0
  4652 00:155F: 10 01        	bpl	L251
  4653 00:1561: 88           	dey
  4654                        L251:
  4655 00:1562: 85 01        	sta	<R0
  4656 00:1564: 84 03        	sty	<R0+2
  4657 00:1566: D4 03        	pei	<R0+2
  4658 00:1568: D4 01        	pei	<R0
  4659 00:156A: A0 02 00     	ldy	#$2
  4660 00:156D: B7 10        	lda	[<L247+ab_0],Y
  4661 00:156F: 48           	pha
  4662 00:1570: A7 10        	lda	[<L247+ab_0]
  4663 00:1572: 48           	pha
  4664 00:1573: 22 xx xx xx  	jsl	~~realloc
  4665 00:1577: 86 07        	stx	<R1+2
  4666 00:1579: 87 10        	sta	[<L247+ab_0]
  4667 00:157B: A5 07        	lda	<R1+2
  4668 00:157D: A0 02 00     	ldy	#$2
  4669 00:1580: 97 10        	sta	[<L247+ab_0],Y
  4670                        ;	}
  4671                        L10127:
  4672 00:1582: 38           	sec
  4673 00:1583: A0 06 00     	ldy	#$6
  4674 00:1586: B7 10        	lda	[<L247+ab_0],Y
  4675 00:1588: E5 18        	sbc	<L247+len_0
  4676 00:158A: 70 03        	bvs	L249
  4677 00:158C: 49 00 80     	eor	#$8000
  4678                        L249:
  4679 00:158F: 10 A6        	bpl	L20029
  4680                        ;	
  4681                        ;    //if (new == NULL) return;
  4682                        ;    memcpy(ab->b + ab->len, s, len);
  4683 00:1591: A0 00 00     	ldy	#$0
  4684 00:1594: A5 18        	lda	<L247+len_0
  4685 00:1596: 10 01        	bpl	L252
  4686 00:1598: 88           	dey
  4687                        L252:
  4688 00:1599: 85 01        	sta	<R0
  4689 00:159B: 84 03        	sty	<R0+2
  4690 00:159D: D4 03        	pei	<R0+2
  4691 00:159F: D4 01        	pei	<R0
  4692 00:15A1: D4 16        	pei	<L247+s_0+2
  4693 00:15A3: D4 14        	pei	<L247+s_0
  Sun Jan  9 2022 20:39                                                Page 86


  4694 00:15A5: A0 00 00     	ldy	#$0
  4695 00:15A8: 5A           	phy
  4696 00:15A9: A0 04 00     	ldy	#$4
  4697 00:15AC: B7 10        	lda	[<L247+ab_0],Y
  4698 00:15AE: 7A           	ply
  4699 00:15AF: 2A           	rol	A
  4700 00:15B0: 6A           	ror	A
  4701 00:15B1: 10 01        	bpl	L253
  4702 00:15B3: 88           	dey
  4703                        L253:
  4704 00:15B4: 85 05        	sta	<R1
  4705 00:15B6: 84 07        	sty	<R1+2
  4706 00:15B8: A7 10        	lda	[<L247+ab_0]
  4707 00:15BA: 18           	clc
  4708 00:15BB: 65 05        	adc	<R1
  4709 00:15BD: 85 09        	sta	<R2
  4710 00:15BF: A0 02 00     	ldy	#$2
  4711 00:15C2: B7 10        	lda	[<L247+ab_0],Y
  4712 00:15C4: 65 07        	adc	<R1+2
  4713 00:15C6: 48           	pha
  4714 00:15C7: D4 09        	pei	<R2
  4715 00:15C9: 22 xx xx xx  	jsl	~~memcpy
  4716                        ;    //ab->b = new;
  4717                        ;    ab->len += len;
  4718 00:15CD: A9 04 00     	lda	#$4
  4719 00:15D0: 18           	clc
  4720 00:15D1: 65 10        	adc	<L247+ab_0
  4721 00:15D3: 85 01        	sta	<R0
  4722 00:15D5: A9 00 00     	lda	#$0
  4723 00:15D8: 65 12        	adc	<L247+ab_0+2
  4724 00:15DA: 85 03        	sta	<R0+2
  4725 00:15DC: A7 01        	lda	[<R0]
  4726 00:15DE: 18           	clc
  4727 00:15DF: 65 18        	adc	<L247+len_0
  4728 00:15E1: 87 01        	sta	[<R0]
  4729                        ;	ab->avail -= len;
  4730 00:15E3: A9 06 00     	lda	#$6
  4731 00:15E6: 18           	clc
  4732 00:15E7: 65 10        	adc	<L247+ab_0
  4733 00:15E9: 85 01        	sta	<R0
  4734 00:15EB: A9 00 00     	lda	#$0
  4735 00:15EE: 65 12        	adc	<L247+ab_0+2
  4736 00:15F0: 85 03        	sta	<R0+2
  4737 00:15F2: 38           	sec
  4738 00:15F3: A7 01        	lda	[<R0]
  4739 00:15F5: E5 18        	sbc	<L247+len_0
  4740 00:15F7: 87 01        	sta	[<R0]
  4741                        ;}
  4742 00:15F9: A5 0E        	lda	<L247+2
  4743 00:15FB: 85 18        	sta	<L247+2+10
  4744 00:15FD: A5 0D        	lda	<L247+1
  4745 00:15FF: 85 17        	sta	<L247+1+10
  4746 00:1601: 2B           	pld
  4747 00:1602: 3B           	tsc
  4748 00:1603: 18           	clc
  4749 00:1604: 69 16 00     	adc	#L247+10
  4750 00:1607: 1B           	tcs
  4751 00:1608: 6B           	rtl
  Sun Jan  9 2022 20:39                                                Page 87


  4752             0000000C   L247	equ	12
  4753             0000000D   L248	equ	13
  4754                        	ends
  4755                        	efunc
  4756                        ;
  4757                        ;void abfree(struct abuf *ab) {
  4758                        	code
  4759                        	xdef	~~abfree
  4760                        	func
  4761                        ~~abfree:
  4762                        	longa	on
  4763                        	longi	on
  4764 00:1609: 3B           	tsc
  4765 00:160A: 38           	sec
  4766 00:160B: E9 00 00     	sbc	#L255
  4767 00:160E: 1B           	tcs
  4768 00:160F: 0B           	phd
  4769 00:1610: 5B           	tcd
  4770             00000004   ab_0	set	4
  4771                        ;    free(ab->b);
  4772 00:1611: A0 02 00     	ldy	#$2
  4773 00:1614: B7 04        	lda	[<L255+ab_0],Y
  4774 00:1616: 48           	pha
  4775 00:1617: A7 04        	lda	[<L255+ab_0]
  4776 00:1619: 48           	pha
  4777 00:161A: 22 xx xx xx  	jsl	~~free
  4778                        ;}
  4779 00:161E: A5 02        	lda	<L255+2
  4780 00:1620: 85 06        	sta	<L255+2+4
  4781 00:1622: A5 01        	lda	<L255+1
  4782 00:1624: 85 05        	sta	<L255+1+4
  4783 00:1626: 2B           	pld
  4784 00:1627: 3B           	tsc
  4785 00:1628: 18           	clc
  4786 00:1629: 69 04 00     	adc	#L255+4
  4787 00:162C: 1B           	tcs
  4788 00:162D: 6B           	rtl
  4789             00000000   L255	equ	0
  4790             00000001   L256	equ	1
  4791                        	ends
  4792                        	efunc
  4793                        ;
  4794                        ;void editorRefreshScreen(void) {
  4795                        	code
  4796                        	xdef	~~editorRefreshScreen
  4797                        	func
  4798                        ~~editorRefreshScreen:
  4799                        	longa	on
  4800                        	longi	on
  4801 00:162E: 3B           	tsc
  4802 00:162F: 38           	sec
  4803 00:1630: E9 20 00     	sbc	#L258
  4804 00:1633: 1B           	tcs
  4805 00:1634: 0B           	phd
  4806 00:1635: 5B           	tcd
  4807                        ;	unsigned int rest;
  4808                        ;	unsigned int size;
  4809                        ;	unsigned int y;
  Sun Jan  9 2022 20:39                                                Page 88


  4810                        ;	unsigned int len;
  4811                        ;	unsigned int cx;
  4812                        ;	unsigned int filerow;
  4813                        ;	erow *r;
  4814                        ;	char *p;
  4815                        ;	char *dst = (char *)SCREENADR;
  4816                        ;	
  4817                        ;    for (y = 0, r = &E.row[E.rowoff]; y < E.scree
                    nrows; y++, r++) {
  4818             00000000   rest_1	set	0
  4819             00000002   size_1	set	2
  4820             00000004   y_1	set	4
  4821             00000006   len_1	set	6
  4822             00000008   cx_1	set	8
  4823             0000000A   filerow_1	set	10
  4824             0000000C   r_1	set	12
  4825             00000010   p_1	set	16
  4826             00000014   dst_1	set	20
  4827 00:1636: A9 00 F0     	lda	#$f000
  4828 00:1639: 85 1D        	sta	<L259+dst_1
  4829 00:163B: A9 7F 00     	lda	#$7f
  4830 00:163E: 85 1F        	sta	<L259+dst_1+2
  4831 00:1640: 64 0D        	stz	<L259+y_1
  4832 00:1642: AD xx xx     	lda	|~~E+4
  4833 00:1645: 85 01        	sta	<R0
  4834 00:1647: 64 03        	stz	<R0+2
  4835 00:1649: F4 00 00     	pea	#^$14
  4836 00:164C: F4 14 00     	pea	#<$14
  4837 00:164F: D4 03        	pei	<R0+2
  4838 00:1651: D4 01        	pei	<R0
  4839                        	xref	~~~lmul
  4840 00:1653: 22 xx xx xx  	jsl	~~~lmul
  4841 00:1657: 85 01        	sta	<R0
  4842 00:1659: 86 03        	stx	<R0+2
  4843 00:165B: AD xx xx     	lda	|~~E+16
  4844 00:165E: 18           	clc
  4845 00:165F: 65 01        	adc	<R0
  4846 00:1661: 85 15        	sta	<L259+r_1
  4847 00:1663: AD xx xx     	lda	|~~E+16+2
  4848 00:1666: 65 03        	adc	<R0+2
  4849 00:1668: 85 17        	sta	<L259+r_1+2
  4850 00:166A: 82 E2 00     	brl	L10132
  4851                        L10131:
  4852                        ;       
  4853                        ;		if (E.rowoff + y >= E.numrows) {
  4854 00:166D: AD xx xx     	lda	|~~E+4
  4855 00:1670: 18           	clc
  4856 00:1671: 65 0D        	adc	<L259+y_1
  4857 00:1673: CD xx xx     	cmp	|~~E+12
  4858 00:1676: 90 30        	bcc	L10133
  4859                        ;			*dst++ = '~';
  4860 00:1678: E2 20        	sep	#$20
  4861                        	longa	off
  4862 00:167A: A9 7E        	lda	#$7e
  4863 00:167C: 87 1D        	sta	[<L259+dst_1]
  4864 00:167E: C2 20        	rep	#$20
  4865                        	longa	on
  4866 00:1680: E6 1D        	inc	<L259+dst_1
  Sun Jan  9 2022 20:39                                                Page 89


  4867 00:1682: D0 02        	bne	L261
  4868 00:1684: E6 1F        	inc	<L259+dst_1+2
  4869                        L261:
  4870                        ;			for(size = E.screencols-1; size 
                    != 0; size--) {
  4871 00:1686: A9 FF FF     	lda	#$ffff
  4872 00:1689: 18           	clc
  4873 00:168A: 6D xx xx     	adc	|~~E+10
  4874 00:168D: 85 0B        	sta	<L259+size_1
  4875 00:168F: 80 10        	bra	L10137
  4876                        L10136:
  4877                        ;				*dst++ = ' ';
  4878 00:1691: E2 20        	sep	#$20
  4879                        	longa	off
  4880 00:1693: A9 20        	lda	#$20
  4881 00:1695: 87 1D        	sta	[<L259+dst_1]
  4882 00:1697: C2 20        	rep	#$20
  4883                        	longa	on
  4884 00:1699: E6 1D        	inc	<L259+dst_1
  4885 00:169B: D0 02        	bne	L10134
  4886 00:169D: E6 1F        	inc	<L259+dst_1+2
  4887                        ;			}
  4888                        L10134:
  4889 00:169F: C6 0B        	dec	<L259+size_1
  4890                        L10137:
  4891 00:16A1: A5 0B        	lda	<L259+size_1
  4892 00:16A3: D0 EC        	bne	L10136
  4893 00:16A5: 82 99 00     	brl	L10129
  4894                        ;			continue;
  4895                        ;		}
  4896                        ;		
  4897                        ;        size = r->size;
  4898                        L10133:
  4899 00:16A8: A0 02 00     	ldy	#$2
  4900 00:16AB: B7 15        	lda	[<L259+r_1],Y
  4901 00:16AD: 85 0B        	sta	<L259+size_1
  4902                        ;		p = r->chars;
  4903 00:16AF: A0 06 00     	ldy	#$6
  4904 00:16B2: B7 15        	lda	[<L259+r_1],Y
  4905 00:16B4: 85 19        	sta	<L259+p_1
  4906 00:16B6: C8           	iny
  4907 00:16B7: C8           	iny
  4908 00:16B8: B7 15        	lda	[<L259+r_1],Y
  4909 00:16BA: 85 1B        	sta	<L259+p_1+2
  4910                        ;		
  4911                        ;		len = 0;
  4912 00:16BC: 64 0F        	stz	<L259+len_1
  4913                        ;        while (len < E.screencols && size != 0) {
  4914 00:16BE: 80 5C        	bra	L10138
  4915                        L20032:
  4916                        ;				*dst++ = ' ';
  4917 00:16C0: E2 20        	sep	#$20
  4918                        	longa	off
  4919 00:16C2: A9 20        	lda	#$20
  4920 00:16C4: 87 1D        	sta	[<L259+dst_1]
  4921 00:16C6: C2 20        	rep	#$20
  4922                        	longa	on
  4923 00:16C8: E6 1D        	inc	<L259+dst_1
  Sun Jan  9 2022 20:39                                                Page 90


  4924 00:16CA: D0 02        	bne	L267
  4925 00:16CC: E6 1F        	inc	<L259+dst_1+2
  4926                        L267:
  4927                        ;				p++;
  4928 00:16CE: E6 19        	inc	<L259+p_1
  4929 00:16D0: D0 1B        	bne	L10141
  4930 00:16D2: E6 1B        	inc	<L259+p_1+2
  4931                        ;				while( (((size_t)dst % 4
                    ) != 0) && (len < E.screencols) ) {
  4932 00:16D4: 80 17        	bra	L10141
  4933                        L20031:
  4934 00:16D6: A5 0F        	lda	<L259+len_1
  4935 00:16D8: CD xx xx     	cmp	|~~E+10
  4936 00:16DB: B0 3F        	bcs	L10138
  4937                        ;					*dst++ = ' ';
  4938 00:16DD: E2 20        	sep	#$20
  4939                        	longa	off
  4940 00:16DF: A9 20        	lda	#$20
  4941 00:16E1: 87 1D        	sta	[<L259+dst_1]
  4942 00:16E3: C2 20        	rep	#$20
  4943                        	longa	on
  4944 00:16E5: E6 1D        	inc	<L259+dst_1
  4945 00:16E7: D0 02        	bne	L271
  4946 00:16E9: E6 1F        	inc	<L259+dst_1+2
  4947                        L271:
  4948                        ;					len++;
  4949 00:16EB: E6 0F        	inc	<L259+len_1
  4950                        ;				}
  4951                        L10141:
  4952 00:16ED: A5 1D        	lda	<L259+dst_1
  4953 00:16EF: 29 03 00     	and	#<$3
  4954 00:16F2: D0 E2        	bne	L20031
  4955 00:16F4: 80 26        	bra	L10138
  4956                        L20034:
  4957 00:16F6: A5 0B        	lda	<L259+size_1
  4958 00:16F8: F0 29        	beq	L10139
  4959                        ;			
  4960                        ;			size--;
  4961 00:16FA: C6 0B        	dec	<L259+size_1
  4962                        ;			len++;
  4963 00:16FC: E6 0F        	inc	<L259+len_1
  4964                        ;			
  4965                        ;			if (*p == TAB) {
  4966 00:16FE: E2 20        	sep	#$20
  4967                        	longa	off
  4968 00:1700: A7 19        	lda	[<L259+p_1]
  4969 00:1702: C9 09        	cmp	#<$9
  4970 00:1704: C2 20        	rep	#$20
  4971                        	longa	on
  4972 00:1706: F0 B8        	beq	L20032
  4973                        ;				*dst++ = *p++;
  4974 00:1708: E2 20        	sep	#$20
  4975                        	longa	off
  4976 00:170A: A7 19        	lda	[<L259+p_1]
  4977 00:170C: 87 1D        	sta	[<L259+dst_1]
  4978 00:170E: C2 20        	rep	#$20
  4979                        	longa	on
  4980 00:1710: E6 19        	inc	<L259+p_1
  Sun Jan  9 2022 20:39                                                Page 91


  4981 00:1712: D0 02        	bne	L272
  4982 00:1714: E6 1B        	inc	<L259+p_1+2
  4983                        L272:
  4984 00:1716: E6 1D        	inc	<L259+dst_1
  4985 00:1718: D0 02        	bne	L10138
  4986 00:171A: E6 1F        	inc	<L259+dst_1+2
  4987                        ;			}
  4988                        ;		}
  4989                        ;			} else {
  4990                        L10138:
  4991 00:171C: A5 0F        	lda	<L259+len_1
  4992 00:171E: CD xx xx     	cmp	|~~E+10
  4993 00:1721: 90 D3        	bcc	L20034
  4994                        L10139:
  4995                        ;				
  4996                        ;		rest = E.screencols - len;
  4997 00:1723: 38           	sec
  4998 00:1724: AD xx xx     	lda	|~~E+10
  4999 00:1727: E5 0F        	sbc	<L259+len_1
  5000 00:1729: 85 09        	sta	<L259+rest_1
  5001                        ;		
  5002                        ;		for(; rest != 0; rest--) {
  5003 00:172B: 80 10        	bra	L10147
  5004                        L10146:
  5005                        ;			*dst++ = ' ';
  5006 00:172D: E2 20        	sep	#$20
  5007                        	longa	off
  5008 00:172F: A9 20        	lda	#$20
  5009 00:1731: 87 1D        	sta	[<L259+dst_1]
  5010 00:1733: C2 20        	rep	#$20
  5011                        	longa	on
  5012 00:1735: E6 1D        	inc	<L259+dst_1
  5013 00:1737: D0 02        	bne	L10144
  5014 00:1739: E6 1F        	inc	<L259+dst_1+2
  5015                        ;		}
  5016                        L10144:
  5017 00:173B: C6 09        	dec	<L259+rest_1
  5018                        L10147:
  5019 00:173D: A5 09        	lda	<L259+rest_1
  5020 00:173F: D0 EC        	bne	L10146
  5021                        ;	}
  5022                        L10129:
  5023 00:1741: A9 14 00     	lda	#$14
  5024 00:1744: 18           	clc
  5025 00:1745: 65 15        	adc	<L259+r_1
  5026 00:1747: 85 15        	sta	<L259+r_1
  5027 00:1749: 90 02        	bcc	L276
  5028 00:174B: E6 17        	inc	<L259+r_1+2
  5029                        L276:
  5030 00:174D: E6 0D        	inc	<L259+y_1
  5031                        L10132:
  5032 00:174F: A5 0D        	lda	<L259+y_1
  5033 00:1751: CD xx xx     	cmp	|~~E+8
  5034 00:1754: B0 03        	bcs	*+5
  5035 00:1756: 82 14 FF     	brl	L10131
  5036                        ;	
  5037                        ;	sprintf(status, "%-20.20s - % 5d lines %10s %22s
                     % 5d/% 5d", 
  Sun Jan  9 2022 20:39                                                Page 92


  5038                        ;		E.filename, E.numrows, E.dirty ? "(modif
                    ied)" : "", "", E.rowoff+E.cy+1, E.numrows);
  5039 00:1759: AD xx xx     	lda	|~~E+12
  5040 00:175C: 48           	pha
  5041 00:175D: AD xx xx     	lda	|~~E+4
  5042 00:1760: 18           	clc
  5043 00:1761: 6D xx xx     	adc	|~~E+2
  5044 00:1764: 1A           	ina
  5045 00:1765: 48           	pha
  5046 00:1766: F4 xx xx     	pea	#^L243+54
  5047 00:1769: F4 xx xx     	pea	#<L243+54
  5048 00:176C: AD xx xx     	lda	|~~E+20
  5049 00:176F: F0 09        	beq	L278
  5050 00:1771: A9 xx xx     	lda	#^L243+42
  5051 00:1774: AA           	tax
  5052 00:1775: A9 xx xx     	lda	#<L243+42
  5053 00:1778: 80 07        	bra	L280
  5054                        L278:
  5055 00:177A: A9 xx xx     	lda	#^L243+53
  5056 00:177D: AA           	tax
  5057 00:177E: A9 xx xx     	lda	#<L243+53
  5058                        L280:
  5059 00:1781: 85 01        	sta	<R0
  5060 00:1783: 86 03        	stx	<R0+2
  5061 00:1785: D4 03        	pei	<R0+2
  5062 00:1787: D4 01        	pei	<R0
  5063 00:1789: AD xx xx     	lda	|~~E+12
  5064 00:178C: 48           	pha
  5065 00:178D: AD xx xx     	lda	|~~E+26+2
  5066 00:1790: 48           	pha
  5067 00:1791: AD xx xx     	lda	|~~E+26
  5068 00:1794: 48           	pha
  5069 00:1795: F4 xx xx     	pea	#^L243
  5070 00:1798: F4 xx xx     	pea	#<L243
  5071 00:179B: A9 xx xx     	lda	#<~~status
  5072 00:179E: 85 05        	sta	<R1
  5073                        	xref	_BEG_DATA
  5074 00:17A0: A9 xx xx     	lda	#_BEG_DATA>>16
  5075 00:17A3: 48           	pha
  5076 00:17A4: D4 05        	pei	<R1
  5077 00:17A6: F4 1C 00     	pea	#28
  5078 00:17A9: 22 xx xx xx  	jsl	~~sprintf
  5079                        ;	
  5080                        ;		
  5081                        ;	p = status;
  5082 00:17AD: A9 xx xx     	lda	#<~~status
  5083 00:17B0: 85 19        	sta	<L259+p_1
  5084                        	xref	_BEG_DATA
  5085 00:17B2: A9 xx xx     	lda	#_BEG_DATA>>16
  5086 00:17B5: 85 1B        	sta	<L259+p_1+2
  5087                        ;	for (size = 80; size != 0; size--) {
  5088 00:17B7: A9 50 00     	lda	#$50
  5089 00:17BA: 85 0B        	sta	<L259+size_1
  5090                        L10150:
  5091                        ;		*dst++ = *p++;
  5092 00:17BC: E2 20        	sep	#$20
  5093                        	longa	off
  5094 00:17BE: A7 19        	lda	[<L259+p_1]
  Sun Jan  9 2022 20:39                                                Page 93


  5095 00:17C0: 87 1D        	sta	[<L259+dst_1]
  5096 00:17C2: C2 20        	rep	#$20
  5097                        	longa	on
  5098 00:17C4: E6 19        	inc	<L259+p_1
  5099 00:17C6: D0 02        	bne	L281
  5100 00:17C8: E6 1B        	inc	<L259+p_1+2
  5101                        L281:
  5102 00:17CA: E6 1D        	inc	<L259+dst_1
  5103 00:17CC: D0 02        	bne	L10148
  5104 00:17CE: E6 1F        	inc	<L259+dst_1+2
  5105                        ;	}
  5106                        L10148:
  5107 00:17D0: C6 0B        	dec	<L259+size_1
  5108 00:17D2: A5 0B        	lda	<L259+size_1
  5109 00:17D4: D0 E6        	bne	L10150
  5110                        ;
  5111                        ;	sprintf(status, "%-80s", E.statusmsg);
  5112 00:17D6: A9 xx xx     	lda	#<~~E+30
  5113 00:17D9: 85 01        	sta	<R0
  5114                        	xref	_BEG_DATA
  5115 00:17DB: A9 xx xx     	lda	#_BEG_DATA>>16
  5116 00:17DE: 48           	pha
  5117 00:17DF: D4 01        	pei	<R0
  5118 00:17E1: F4 xx xx     	pea	#^L243+55
  5119 00:17E4: F4 xx xx     	pea	#<L243+55
  5120 00:17E7: A9 xx xx     	lda	#<~~status
  5121 00:17EA: 85 05        	sta	<R1
  5122                        	xref	_BEG_DATA
  5123 00:17EC: A9 xx xx     	lda	#_BEG_DATA>>16
  5124 00:17EF: 48           	pha
  5125 00:17F0: D4 05        	pei	<R1
  5126 00:17F2: F4 0E 00     	pea	#14
  5127 00:17F5: 22 xx xx xx  	jsl	~~sprintf
  5128                        ;	
  5129                        ;	
  5130                        ;	p = status;
  5131 00:17F9: A9 xx xx     	lda	#<~~status
  5132 00:17FC: 85 19        	sta	<L259+p_1
  5133                        	xref	_BEG_DATA
  5134 00:17FE: A9 xx xx     	lda	#_BEG_DATA>>16
  5135 00:1801: 85 1B        	sta	<L259+p_1+2
  5136                        ;	for (size = 80; size != 0; size--) {
  5137 00:1803: A9 50 00     	lda	#$50
  5138 00:1806: 85 0B        	sta	<L259+size_1
  5139                        L10153:
  5140                        ;		*dst++ = *p++;
  5141 00:1808: E2 20        	sep	#$20
  5142                        	longa	off
  5143 00:180A: A7 19        	lda	[<L259+p_1]
  5144 00:180C: 87 1D        	sta	[<L259+dst_1]
  5145 00:180E: C2 20        	rep	#$20
  5146                        	longa	on
  5147 00:1810: E6 19        	inc	<L259+p_1
  5148 00:1812: D0 02        	bne	L284
  5149 00:1814: E6 1B        	inc	<L259+p_1+2
  5150                        L284:
  5151 00:1816: E6 1D        	inc	<L259+dst_1
  5152 00:1818: D0 02        	bne	L10151
  Sun Jan  9 2022 20:39                                                Page 94


  5153 00:181A: E6 1F        	inc	<L259+dst_1+2
  5154                        ;	}
  5155                        L10151:
  5156 00:181C: C6 0B        	dec	<L259+size_1
  5157 00:181E: A5 0B        	lda	<L259+size_1
  5158 00:1820: D0 E6        	bne	L10153
  5159                        ;
  5160                        ;	
  5161                        ;    cx = 0;
  5162 00:1822: 64 11        	stz	<L259+cx_1
  5163                        ;    filerow = E.rowoff+E.cy;
  5164 00:1824: AD xx xx     	lda	|~~E+4
  5165 00:1827: 18           	clc
  5166 00:1828: 6D xx xx     	adc	|~~E+2
  5167 00:182B: 85 13        	sta	<L259+filerow_1
  5168                        ;    r = (filerow >= E.numrows) ? NULL : &E.row[fi
                    lerow];
  5169 00:182D: CD xx xx     	cmp	|~~E+12
  5170 00:1830: 90 06        	bcc	L287
  5171 00:1832: A9 00 00     	lda	#$0
  5172 00:1835: AA           	tax
  5173 00:1836: 80 2B        	bra	L289
  5174                        L287:
  5175 00:1838: A5 13        	lda	<L259+filerow_1
  5176 00:183A: 85 01        	sta	<R0
  5177 00:183C: 64 03        	stz	<R0+2
  5178 00:183E: F4 00 00     	pea	#^$14
  5179 00:1841: F4 14 00     	pea	#<$14
  5180 00:1844: D4 03        	pei	<R0+2
  5181 00:1846: D4 01        	pei	<R0
  5182                        	xref	~~~lmul
  5183 00:1848: 22 xx xx xx  	jsl	~~~lmul
  5184 00:184C: 85 01        	sta	<R0
  5185 00:184E: 86 03        	stx	<R0+2
  5186 00:1850: AD xx xx     	lda	|~~E+16
  5187 00:1853: 18           	clc
  5188 00:1854: 65 01        	adc	<R0
  5189 00:1856: 85 05        	sta	<R1
  5190 00:1858: AD xx xx     	lda	|~~E+16+2
  5191 00:185B: 65 03        	adc	<R0+2
  5192 00:185D: 85 07        	sta	<R1+2
  5193 00:185F: A6 07        	ldx	<R1+2
  5194 00:1861: A5 05        	lda	<R1
  5195                        L289:
  5196 00:1863: 86 03        	stx	<R0+2
  5197 00:1865: 85 15        	sta	<L259+r_1
  5198 00:1867: A5 03        	lda	<R0+2
  5199 00:1869: 85 17        	sta	<L259+r_1+2
  5200                        ;    if (r) {
  5201 00:186B: A5 15        	lda	<L259+r_1
  5202 00:186D: 05 17        	ora	<L259+r_1+2
  5203 00:186F: F0 4E        	beq	L10154
  5204                        ;        for (size = E.coloff; size < (E.cx+E.colo
                    ff); size++) {
  5205 00:1871: AD xx xx     	lda	|~~E+6
  5206 00:1874: 85 0B        	sta	<L259+size_1
  5207 00:1876: 80 38        	bra	L10158
  5208                        L10157:
  Sun Jan  9 2022 20:39                                                Page 95


  5209                        ;            if (size < r->size && r->chars[size] 
                    == TAB) cx += 3-((cx)%4);
  5210 00:1878: A5 0B        	lda	<L259+size_1
  5211 00:187A: A0 02 00     	ldy	#$2
  5212 00:187D: D7 15        	cmp	[<L259+r_1],Y
  5213 00:187F: B0 2B        	bcs	L10159
  5214 00:1881: A0 06 00     	ldy	#$6
  5215 00:1884: B7 15        	lda	[<L259+r_1],Y
  5216 00:1886: 85 01        	sta	<R0
  5217 00:1888: C8           	iny
  5218 00:1889: C8           	iny
  5219 00:188A: B7 15        	lda	[<L259+r_1],Y
  5220 00:188C: 85 03        	sta	<R0+2
  5221 00:188E: E2 20        	sep	#$20
  5222                        	longa	off
  5223 00:1890: A4 0B        	ldy	<L259+size_1
  5224 00:1892: B7 01        	lda	[<R0],Y
  5225 00:1894: C9 09        	cmp	#<$9
  5226 00:1896: C2 20        	rep	#$20
  5227                        	longa	on
  5228 00:1898: D0 12        	bne	L10159
  5229 00:189A: A5 11        	lda	<L259+cx_1
  5230 00:189C: 29 03 00     	and	#<$3
  5231 00:189F: 85 01        	sta	<R0
  5232 00:18A1: 38           	sec
  5233 00:18A2: A9 03 00     	lda	#$3
  5234 00:18A5: E5 01        	sbc	<R0
  5235 00:18A7: 18           	clc
  5236 00:18A8: 65 11        	adc	<L259+cx_1
  5237 00:18AA: 85 11        	sta	<L259+cx_1
  5238                        ;            cx++;
  5239                        L10159:
  5240 00:18AC: E6 11        	inc	<L259+cx_1
  5241                        ;        }
  5242 00:18AE: E6 0B        	inc	<L259+size_1
  5243                        L10158:
  5244 00:18B0: AD xx xx     	lda	|~~E
  5245 00:18B3: 18           	clc
  5246 00:18B4: 6D xx xx     	adc	|~~E+6
  5247 00:18B7: 85 01        	sta	<R0
  5248 00:18B9: A5 0B        	lda	<L259+size_1
  5249 00:18BB: C5 01        	cmp	<R0
  5250 00:18BD: 90 B9        	bcc	L10157
  5251                        ;    }
  5252                        ;	
  5253                        ;	//debugf("filerow:%d E.numrows:%d r:%08X E.colof
                    f:%d E.cx:%d \n", (size_t)filerow, (size_t)E.numrows, E.row,
                     (size_t) E.coloff, (size_t) E.cx); 
  5254                        ;
  5255                        ;    setCursor(E.cy, cx);
  5256                        L10154:
  5257 00:18BF: D4 11        	pei	<L259+cx_1
  5258 00:18C1: AD xx xx     	lda	|~~E+2
  5259 00:18C4: 48           	pha
  5260 00:18C5: 22 xx xx xx  	jsl	~~setCursor
  5261                        ;}
  5262 00:18C9: 2B           	pld
  5263 00:18CA: 3B           	tsc
  Sun Jan  9 2022 20:39                                                Page 96


  5264 00:18CB: 18           	clc
  5265 00:18CC: 69 20 00     	adc	#L258
  5266 00:18CF: 1B           	tcs
  5267 00:18D0: 6B           	rtl
  5268             00000020   L258	equ	32
  5269             00000009   L259	equ	9
  5270                        	ends
  5271                        	efunc
  5272                        	data
  5273                        L243:
  5274 00:0041: 25 2D 32 30  	db	$25,$2D,$32,$30,$2E,$32,$30,$73,$20,$2D,
                    $20,$25,$20,$35,$64
       00:0045: 2E 32 30 73 
       00:0049: 20 2D 20 25 
       00:004D: 20 35 64 
  5275 00:0050: 20 6C 69 6E  	db	$20,$6C,$69,$6E,$65,$73,$20,$25,$31,$30,
                    $73,$20,$25,$32,$32
       00:0054: 65 73 20 25 
       00:0058: 31 30 73 20 
       00:005C: 25 32 32 
  5276 00:005F: 73 20 25 20  	db	$73,$20,$25,$20,$35,$64,$2F,$25,$20,$35,
                    $64,$00,$28,$6D,$6F
       00:0063: 35 64 2F 25 
       00:0067: 20 35 64 00 
       00:006B: 28 6D 6F 
  5277 00:006E: 64 69 66 69  	db	$64,$69,$66,$69,$65,$64,$29,$00,$00,$00,
                    $25,$2D,$38,$30,$73
       00:0072: 65 64 29 00 
       00:0076: 00 00 25 2D 
       00:007A: 38 30 73 
  5278 00:007D: 00           	db	$00
  5279 00:007E:              	ends
  5280                        ;
  5281                        ;#if 0
  5282                        ;/* This function writes the whole screen using VT
                    100 escape characters
  5283                        ; * starting from the logical state of the editor 
                    in the global state 'E'. */
  5284                        ;void editorRefreshScreen(void) {
  5285                        ;    static char welcome[80];
  5286                        ;    static char buf[32];
  5287                        ;    static char rstatus[80];
  5288                        ;
  5289                        ;    int welcomelen;
  5290                        ;    int padding;
  5291                        ;    unsigned int filerow;
  5292                        ;    int y;
  5293                        ;    int len, rlen;
  5294                        ;    int current_color;
  5295                        ;    erow *r;
  5296                        ;    char *c;
  5297                        ;    unsigned char *hl;
  5298                        ;    int j;
  5299                        ;    char sym;
  5300                        ;    int color;
  5301                        ;    int msglen;
  5302                        ;    int cx;
  5303                        ;    erow *row;
  Sun Jan  9 2022 20:39                                                Page 97


  5304                        ;    
  5305                        ;    struct abuf ab = ABUF_INIT;
  5306                        ;
  5307                        ;
  5308                        ;    //abAppend(&ab,"\x1b[?25l",6); /* Hide cursor
                    . */
  5309                        ;    //abAppend(&ab,"\x1b[H",3); /* Go home. */
  5310                        ;//	sym = CLS;
  5311                        ;	
  5312                        ;    //abAppend(&ab, &sym, 1); /* Go home. */
  5313                        ;//	clearScreen();
  5314                        ;
  5315                        ;	
  5316                        ;    for (y = 0; y < E.screenrows; y++) {
  5317                        ;        filerow = E.rowoff+y;
  5318                        ;		
  5319                        ;        if (filerow >= E.numrows) {
  5320                        ;            if (E.numrows == 0 && y == E.screenro
                    ws/3) {
  5321                        ;                welcomelen = snprintf(welcome, si
                    zeof(welcome),
  5322                        ;					"Kilo editor -- 
                    version %s\n", KILO_VERSION);
  5323                        ;                    //"Kilo editor -- verison %s\
                    x1b[0K\n", KILO_VERSION);
  5324                        ;                padding = (E.screencols-welcomele
                    n)/2;
  5325                        ;                if (padding) {
  5326                        ;                    abAppend(&ab,"~",1);
  5327                        ;                    padding--;
  5328                        ;                }
  5329                        ;                while(padding--) abAppend(&ab," "
                    ,1);
  5330                        ;                abAppend(&ab,welcome,welcomelen);
  5331                        ;            } else {
  5332                        ;                //abAppend(&ab,"~\x1b[0K\n",7);
  5333                        ;				abAppend(&ab,"~\n",2);
  5334                        ;            }
  5335                        ;            continue;
  5336                        ;        }
  5337                        ;
  5338                        ;        r = &E.row[filerow];
  5339                        ;
  5340                        ;        len = r->rsize - E.coloff;
  5341                        ;        current_color = -1;
  5342                        ;		
  5343                        ;        if (len > 0) {
  5344                        ;            if (len > E.screencols) len = E.scree
                    ncols;
  5345                        ;            c = r->render+E.coloff;
  5346                        ;            hl = r->hl+E.coloff;
  5347                        ;
  5348                        ;            for (j = 0; j < len; j++) {
  5349                        ;				//fprintf(stderr, "frow:
                     %d, j: %d, h[j]: %d, c: %c\n", filerow, j, hl[j], c[j]);
  5350                        ;//#if 0		
  5351                        ;                if (hl[j] == HL_NONPRINT) {
  5352                        ;                    //abAppend(&ab,"\x1b[7m",4);
  Sun Jan  9 2022 20:39                                                Page 98


  5353                        ;                    if (c[j] <= 26)
  5354                        ;                        sym = '@'+c[j];
  5355                        ;                    else
  5356                        ;                        sym = '?';
  5357                        ;                    abAppend(&ab, &sym, 1);
  5358                        ;                    abAppend(&ab,"\x1b[0m",4);
  5359                        ;                } else if (hl[j] == HL_NORMAL) {
  5360                        ;                    if (current_color != -1) {
  5361                        ;                        //abAppend(&ab,"\x1b[39m"
                    ,5);
  5362                        ;                        current_color = -1;
  5363                        ;                    }
  5364                        ;                    abAppend(&ab,c+j,1);
  5365                        ;                } else {
  5366                        ;                    color = editorSyntaxToColor(h
                    l[j]);
  5367                        ;                    if (color != current_color) {
  5368                        ;                        //char buf[16];
  5369                        ;                        int clen = snprintf(buf,s
                    izeof(buf),"\x1b[%dm",color);
  5370                        ;                        current_color = color;
  5371                        ;                        abAppend(&ab,buf,clen);
  5372                        ;                    }
  5373                        ;                    abAppend(&ab,c+j,1);
  5374                        ;                }
  5375                        ;//#endif
  5376                        ;				abAppend(&ab,c+j,1);
  5377                        ;            }
  5378                        ;        }
  5379                        ;        //abAppend(&ab,"\x1b[39m",5);
  5380                        ;        //abAppend(&ab,"\x1b[0K",4);
  5381                        ;        abAppend(&ab,"\n",1);
  5382                        ;
  5383                        ;    }
  5384                        ;
  5385                        ;//#if 0
  5386                        ;    /* Create a two rows status. First row: */
  5387                        ;    //abAppend(&ab,"\x1b[0K",4);
  5388                        ;    //abAppend(&ab,"\x1b[7m",4);
  5389                        ;    len = snprintf(status, sizeof(status), "%.20s
                     - %d lines %s",
  5390                        ;        E.filename, E.numrows, E.dirty ? "(modifi
                    ed)" : "");
  5391                        ;    rlen = snprintf(rstatus, sizeof(rstatus),
  5392                        ;        "%d/%d",E.rowoff+E.cy+1,E.numrows);
  5393                        ;    if (len > E.screencols) len = E.screencols;
  5394                        ;    abAppend(&ab,status,len);
  5395                        ;    while(len < E.screencols) {
  5396                        ;        if (E.screencols - len == rlen) {
  5397                        ;            abAppend(&ab,rstatus,rlen);
  5398                        ;            break;
  5399                        ;        } else {
  5400                        ;            abAppend(&ab," ",1);
  5401                        ;            len++;
  5402                        ;        }
  5403                        ;    }
  5404                        ;    //abAppend(&ab,"\x1b[0m\n",6);
  5405                        ;    //abAppend(&ab,"\n",1);
  Sun Jan  9 2022 20:39                                                Page 99


  5406                        ;//#endif
  5407                        ;
  5408                        ;    /* Second row depends on E.statusmsg and the 
                    status message update time. */
  5409                        ;    //abAppend(&ab,"\x1b[0K",4);
  5410                        ;    msglen = strlen(E.statusmsg);
  5411                        ;    if (msglen && time(NULL)-E.statusmsg_time < 5
                    )
  5412                        ;        abAppend(&ab,E.statusmsg,msglen <= E.scre
                    encols ? msglen : E.screencols);
  5413                        ;
  5414                        ;    /* Put cursor at its current position. Note t
                    hat the horizontal position
  5415                        ;     * at which the cursor is displayed may be di
                    fferent compared to 'E.cx'
  5416                        ;     * because of TABs. */
  5417                        ;    //int j;
  5418                        ;    cx = 1;
  5419                        ;    filerow = E.rowoff+E.cy;
  5420                        ;    row = (filerow >= E.numrows) ? NULL : &E.row[
                    filerow];
  5421                        ;    if (row) {
  5422                        ;        for (j = E.coloff; j < (E.cx+E.coloff); j
                    ++) {
  5423                        ;            if (j < row->size && row->chars[j] ==
                     TAB) cx += 3-((cx)%4);
  5424                        ;            cx++;
  5425                        ;        }
  5426                        ;    }
  5427                        ;	
  5428                        ;	
  5429                        ;    //snprintf(buf,sizeof(buf),"\x1b[%d;%dH",E.cy
                    +1,cx);
  5430                        ;    //abAppend(&ab,buf,strlen(buf));
  5431                        ;    //abAppend(&ab,"\x1b[?25h",6); /* Show cursor
                    . */
  5432                        ;
  5433                        ;	
  5434                        ;    //write(STDOUT_FILENO, ab.b, ab.len);
  5435                        ;
  5436                        ;    writeScreen(ab.b, ab.len);
  5437                        ;    
  5438                        ;    setCursor(E.cy, cx);
  5439                        ;
  5440                        ;    abfree(&ab);
  5441                        ;}
  5442                        ;#endif
  5443                        ;
  5444                        ;/* Set an editor status message for the second li
                    ne of the status, at the
  5445                        ; * end of the screen. */
  5446                        ;void editorSetStatusMessage(const char *fmt, ...)
                     {
  5447                        	code
  5448                        	xdef	~~editorSetStatusMessage
  5449                        	func
  5450                        ~~editorSetStatusMessage:
  5451                        	longa	on
  Sun Jan  9 2022 20:39                                                Page 100


  5452                        	longi	on
  5453 00:18D1: 3B           	tsc
  5454 00:18D2: 38           	sec
  5455 00:18D3: E9 08 00     	sbc	#L296
  5456 00:18D6: 1B           	tcs
  5457 00:18D7: 0B           	phd
  5458 00:18D8: 5B           	tcd
  5459             00000006   fmt_0	set	6
  5460                        ;
  5461                        ;    va_list ap;
  5462                        ;    va_start(ap, fmt);
  5463             00000000   ap_1	set	0
  5464 00:18D9: 18           	clc
  5465 00:18DA: 7B           	tdc
  5466 00:18DB: 69 12 00     	adc	#<L296+fmt_0+4
  5467 00:18DE: 85 05        	sta	<L297+ap_1
  5468 00:18E0: A9 00 00     	lda	#$0
  5469 00:18E3: 85 07        	sta	<L297+ap_1+2
  5470                        ;    vsnprintf(E.statusmsg, sizeof(E.statusmsg), f
                    mt, ap);
  5471 00:18E5: 48           	pha
  5472 00:18E6: D4 05        	pei	<L297+ap_1
  5473 00:18E8: D4 10        	pei	<L296+fmt_0+2
  5474 00:18EA: D4 0E        	pei	<L296+fmt_0
  5475 00:18EC: F4 00 00     	pea	#^$50
  5476 00:18EF: F4 50 00     	pea	#<$50
  5477 00:18F2: A9 xx xx     	lda	#<~~E+30
  5478 00:18F5: 85 01        	sta	<R0
  5479                        	xref	_BEG_DATA
  5480 00:18F7: A9 xx xx     	lda	#_BEG_DATA>>16
  5481 00:18FA: 48           	pha
  5482 00:18FB: D4 01        	pei	<R0
  5483 00:18FD: 22 xx xx xx  	jsl	~~vsnprintf
  5484                        ;    va_end(ap);
  5485                        ;	
  5486                        ;		
  5487                        ;    E.statusmsg_time = time(NULL);
  5488 00:1901: F4 00 00     	pea	#^$0
  5489 00:1904: F4 00 00     	pea	#<$0
  5490 00:1907: 22 xx xx xx  	jsl	~~time
  5491 00:190B: 8D xx xx     	sta	|~~E+110
  5492 00:190E: 8E xx xx     	stx	|~~E+110+2
  5493                        ;}
  5494 00:1911: DA           	phx
  5495 00:1912: A6 0C        	ldx	<L296+4
  5496 00:1914: A5 0A        	lda	<L296+2
  5497 00:1916: 95 0A        	sta	<L296+2,X
  5498 00:1918: A5 09        	lda	<L296+1
  5499 00:191A: 95 09        	sta	<L296+1,X
  5500 00:191C: 8A           	txa
  5501 00:191D: FA           	plx
  5502 00:191E: 2B           	pld
  5503 00:191F: 48           	pha
  5504 00:1920: 3B           	tsc
  5505 00:1921: 18           	clc
  5506 00:1922: 69 0A 00     	adc	#L296+2
  5507 00:1925: 63 01        	adc	<1,s
  5508 00:1927: 1B           	tcs
  Sun Jan  9 2022 20:39                                                Page 101


  5509 00:1928: 6B           	rtl
  5510             00000008   L296	equ	8
  5511             00000005   L297	equ	5
  5512                        	ends
  5513                        	efunc
  5514                        ;
  5515                        ;/* =============================== Find mode ====
                    ============================ */
  5516                        ;
  5517                        ;#if 0
  5518                        ;#define KILO_QUERY_LEN 256
  5519                        ;
  5520                        ;void editorFind(int fd) {
  5521                        ;    static char query[KILO_QUERY_LEN+1] = {0};
  5522                        ;
  5523                        ;    erow *row;
  5524                        ;    int c;
  5525                        ;    int diff;
  5526                        ;    char *match;
  5527                        ;    int match_offset;
  5528                        ;    int i, current;	    
  5529                        ;    int qlen = 0;
  5530                        ;    int last_match = -1; /* Last line where a mat
                    ch was found. -1 for none. */
  5531                        ;    int find_next = 0; /* if 1 search next, if -1
                     search prev. */
  5532                        ;    int saved_hl_line = -1;  /* No saved HL */
  5533                        ;    char *saved_hl = NULL;
  5534                        ;
  5535                        ;#define FIND_RESTORE_HL do { \
  5536                        ;    if (saved_hl) { \
  5537                        ;        memcpy(E.row[saved_hl_line].hl,saved_hl, 
                    E.row[saved_hl_line].rsize); \
  5538                        ;        saved_hl = NULL; \
  5539                        ;    } \
  5540                        ;} while (0)
  5541                        ;
  5542                        ;    /* Save the cursor position in order to resto
                    re it later. */
  5543                        ;    int saved_cx = E.cx, saved_cy = E.cy;
  5544                        ;    int saved_coloff = E.coloff, saved_rowoff = E
                    .rowoff;
  5545                        ;
  5546                        ;    while(1) {
  5547                        ;        editorSetStatusMessage(
  5548                        ;            "Search: %s (Use ESC/Arrows/Enter)", 
                    query);
  5549                        ;        editorRefreshScreen();
  5550                        ;
  5551                        ;        c = editorReadKey(fd);
  5552                        ;		
  5553                        ;        if (c == DEL_KEY || c == CTRL_H || c == B
                    ACKSPACE) {
  5554                        ;            if (qlen != 0) query[--qlen] = '\0';
  5555                        ;            last_match = -1;
  5556                        ;        } else if (c == ESC || c == ENTER) {
  5557                        ;            if (c == ESC) {
  5558                        ;                E.cx = saved_cx; E.cy = saved_cy;
  Sun Jan  9 2022 20:39                                                Page 102


  5559                        ;                E.coloff = saved_coloff; E.rowoff
                     = saved_rowoff;
  5560                        ;            }
  5561                        ;            FIND_RESTORE_HL;
  5562                        ;            editorSetStatusMessage("");
  5563                        ;            return;
  5564                        ;        } else if (c == ARROW_RIGHT || c == ARROW
                    _DOWN) {
  5565                        ;            find_next = 1;
  5566                        ;        } else if (c == ARROW_LEFT || c == ARROW_
                    UP) {
  5567                        ;            find_next = -1;
  5568                        ;        } else if (isprint(c)) {
  5569                        ;            if (qlen < KILO_QUERY_LEN) {
  5570                        ;                query[qlen++] = c;
  5571                        ;                query[qlen] = '\0';
  5572                        ;                last_match = -1;
  5573                        ;            }
  5574                        ;        }
  5575                        ;
  5576                        ;        /* Search occurrence. */
  5577                        ;        if (last_match == -1) find_next = 1;
  5578                        ;        if (find_next) {
  5579                        ;            match = NULL;
  5580                        ;            match_offset = 0;
  5581                        ;            current = last_match;
  5582                        ;
  5583                        ;            for (i = 0; i < E.numrows; i++) {
  5584                        ;                current += find_next;
  5585                        ;                if (current == -1) current = E.nu
                    mrows-1;
  5586                        ;                else if (current == E.numrows) cu
                    rrent = 0;
  5587                        ;                match = strstr(E.row[current].ren
                    der,query);
  5588                        ;                if (match) {
  5589                        ;                    match_offset = match-E.row[cu
                    rrent].render;
  5590                        ;                    break;
  5591                        ;                }
  5592                        ;            }
  5593                        ;            find_next = 0;
  5594                        ;
  5595                        ;            /* Highlight */
  5596                        ;            FIND_RESTORE_HL;
  5597                        ;
  5598                        ;            if (match) {
  5599                        ;                row = &E.row[current];
  5600                        ;                last_match = current;
  5601                        ;                if (row->hl) {
  5602                        ;                    saved_hl_line = current;
  5603                        ;                    saved_hl = malloc(row->rsize)
                    ;
  5604                        ;                    memcpy(saved_hl,row->hl,row->
                    rsize);
  5605                        ;                    memset(row->hl+match_offset,H
                    L_MATCH,qlen);
  5606                        ;                }
  Sun Jan  9 2022 20:39                                                Page 103


  5607                        ;                E.cy = 0;
  5608                        ;                E.cx = match_offset;
  5609                        ;                E.rowoff = current;
  5610                        ;                E.coloff = 0;
  5611                        ;                /* Scroll horizontally as needed.
                     */
  5612                        ;                if (E.cx > E.screencols) {
  5613                        ;                    diff = E.cx - E.screencols;
  5614                        ;                    E.cx -= diff;
  5615                        ;                    E.coloff += diff;
  5616                        ;                }
  5617                        ;            }
  5618                        ;        }
  5619                        ;    }
  5620                        ;}
  5621                        ;#endif
  5622                        ;
  5623                        ;/* ========================= Editor events handli
                    ng  ======================== */
  5624                        ;
  5625                        ;/* Handle cursor position change because arrow ke
                    ys were pressed. */
  5626                        ;void editorMoveCursor(int key) {
  5627                        	code
  5628                        	xdef	~~editorMoveCursor
  5629                        	func
  5630                        ~~editorMoveCursor:
  5631                        	longa	on
  5632                        	longi	on
  5633 00:1929: 3B           	tsc
  5634 00:192A: 38           	sec
  5635 00:192B: E9 16 00     	sbc	#L299
  5636 00:192E: 1B           	tcs
  5637 00:192F: 0B           	phd
  5638 00:1930: 5B           	tcd
  5639             00000004   key_0	set	4
  5640                        ;    unsigned int rowlen;
  5641                        ;    unsigned int filerow = E.rowoff+E.cy;
  5642                        ;    unsigned int filecol = E.coloff+E.cx;
  5643                        ;    erow *row = (filerow >= E.numrows) ? NULL : &
                    E.row[filerow];
  5644                        ;
  5645                        ;    switch(key) {
  5646             00000000   rowlen_1	set	0
  5647             00000002   filerow_1	set	2
  5648             00000004   filecol_1	set	4
  5649             00000006   row_1	set	6
  5650 00:1931: AD xx xx     	lda	|~~E+4
  5651 00:1934: 18           	clc
  5652 00:1935: 6D xx xx     	adc	|~~E+2
  5653 00:1938: 85 0F        	sta	<L300+filerow_1
  5654 00:193A: AD xx xx     	lda	|~~E+6
  5655 00:193D: 18           	clc
  5656 00:193E: 6D xx xx     	adc	|~~E
  5657 00:1941: 85 11        	sta	<L300+filecol_1
  5658 00:1943: A5 0F        	lda	<L300+filerow_1
  5659 00:1945: CD xx xx     	cmp	|~~E+12
  5660 00:1948: 90 06        	bcc	L301
  Sun Jan  9 2022 20:39                                                Page 104


  5661 00:194A: A9 00 00     	lda	#$0
  5662 00:194D: AA           	tax
  5663 00:194E: 80 2B        	bra	L303
  5664                        L301:
  5665 00:1950: A5 0F        	lda	<L300+filerow_1
  5666 00:1952: 85 01        	sta	<R0
  5667 00:1954: 64 03        	stz	<R0+2
  5668 00:1956: F4 00 00     	pea	#^$14
  5669 00:1959: F4 14 00     	pea	#<$14
  5670 00:195C: D4 03        	pei	<R0+2
  5671 00:195E: D4 01        	pei	<R0
  5672                        	xref	~~~lmul
  5673 00:1960: 22 xx xx xx  	jsl	~~~lmul
  5674 00:1964: 85 01        	sta	<R0
  5675 00:1966: 86 03        	stx	<R0+2
  5676 00:1968: AD xx xx     	lda	|~~E+16
  5677 00:196B: 18           	clc
  5678 00:196C: 65 01        	adc	<R0
  5679 00:196E: 85 05        	sta	<R1
  5680 00:1970: AD xx xx     	lda	|~~E+16+2
  5681 00:1973: 65 03        	adc	<R0+2
  5682 00:1975: 85 07        	sta	<R1+2
  5683 00:1977: A6 07        	ldx	<R1+2
  5684 00:1979: A5 05        	lda	<R1
  5685                        L303:
  5686 00:197B: 86 03        	stx	<R0+2
  5687 00:197D: 85 13        	sta	<L300+row_1
  5688 00:197F: A5 03        	lda	<R0+2
  5689 00:1981: 85 15        	sta	<L300+row_1+2
  5690 00:1983: A5 1A        	lda	<L299+key_0
  5691                        	xref	~~~fsw
  5692 00:1985: 22 xx xx xx  	jsl	~~~fsw
  5693 00:1989: E8 03        	dw	1000
  5694 00:198B: 0B 00        	dw	11
  5695 00:198D: xx xx        	dw	L10161-1
  5696 00:198F: xx xx        	dw	L10162-1
  5697 00:1991: xx xx        	dw	L10169-1
  5698 00:1993: xx xx        	dw	L10177-1
  5699 00:1995: xx xx        	dw	L10181-1
  5700 00:1997: xx xx        	dw	L10161-1
  5701 00:1999: xx xx        	dw	L10185-1
  5702 00:199B: xx xx        	dw	L10189-1
  5703 00:199D: xx xx        	dw	L10161-1
  5704 00:199F: xx xx        	dw	L10161-1
  5705 00:19A1: xx xx        	dw	L10186-1
  5706 00:19A3: xx xx        	dw	L10187-1
  5707                        ;    case ARROW_LEFT:
  5708                        L10162:
  5709                        ;        if (E.cx == 0) {
  5710 00:19A5: AD xx xx     	lda	|~~E
  5711 00:19A8: F0 03        	beq	*+5
  5712 00:19AA: 82 B2 00     	brl	L10163
  5713                        ;            if (E.coloff) {
  5714 00:19AD: AD xx xx     	lda	|~~E+6
  5715 00:19B0: F0 06        	beq	L10164
  5716                        ;                E.coloff--;
  5717 00:19B2: CE xx xx     	dec	|~~E+6
  5718                        ;            } else {
  Sun Jan  9 2022 20:39                                                Page 105


  5719 00:19B5: 82 60 01     	brl	L10161
  5720                        L10164:
  5721                        ;                if (filerow > 0) {
  5722 00:19B8: A9 00 00     	lda	#$0
  5723 00:19BB: C5 0F        	cmp	<L300+filerow_1
  5724 00:19BD: 90 03        	bcc	*+5
  5725 00:19BF: 82 56 01     	brl	L10161
  5726                        ;                    E.cy--;
  5727 00:19C2: CE xx xx     	dec	|~~E+2
  5728                        ;                    E.cx = E.row[filerow-1].size;
  5729 00:19C5: A9 FF FF     	lda	#$ffff
  5730 00:19C8: 18           	clc
  5731 00:19C9: 65 0F        	adc	<L300+filerow_1
  5732 00:19CB: 85 01        	sta	<R0
  5733 00:19CD: 64 03        	stz	<R0+2
  5734 00:19CF: F4 00 00     	pea	#^$14
  5735 00:19D2: F4 14 00     	pea	#<$14
  5736 00:19D5: D4 03        	pei	<R0+2
  5737 00:19D7: D4 01        	pei	<R0
  5738                        	xref	~~~lmul
  5739 00:19D9: 22 xx xx xx  	jsl	~~~lmul
  5740 00:19DD: 85 01        	sta	<R0
  5741 00:19DF: 86 03        	stx	<R0+2
  5742 00:19E1: A9 02 00     	lda	#$2
  5743 00:19E4: 18           	clc
  5744 00:19E5: 6D xx xx     	adc	|~~E+16
  5745 00:19E8: 85 05        	sta	<R1
  5746 00:19EA: A9 00 00     	lda	#$0
  5747 00:19ED: 6D xx xx     	adc	|~~E+16+2
  5748 00:19F0: 85 07        	sta	<R1+2
  5749 00:19F2: A5 05        	lda	<R1
  5750 00:19F4: 18           	clc
  5751 00:19F5: 65 01        	adc	<R0
  5752 00:19F7: 85 09        	sta	<R2
  5753 00:19F9: A5 07        	lda	<R1+2
  5754 00:19FB: 65 03        	adc	<R0+2
  5755 00:19FD: 85 0B        	sta	<R2+2
  5756 00:19FF: A7 09        	lda	[<R2]
  5757 00:1A01: 8D xx xx     	sta	|~~E
  5758                        ;                    if (E.cx > E.screencols-1) {
  5759 00:1A04: A9 FF FF     	lda	#$ffff
  5760 00:1A07: 18           	clc
  5761 00:1A08: 6D xx xx     	adc	|~~E+10
  5762 00:1A0B: CD xx xx     	cmp	|~~E
  5763 00:1A0E: 90 03        	bcc	*+5
  5764 00:1A10: 82 05 01     	brl	L10161
  5765                        ;                        E.coloff = E.cx-E.screenc
                    ols+1;
  5766 00:1A13: 38           	sec
  5767 00:1A14: AD xx xx     	lda	|~~E
  5768 00:1A17: ED xx xx     	sbc	|~~E+10
  5769 00:1A1A: 1A           	ina
  5770 00:1A1B: 8D xx xx     	sta	|~~E+6
  5771                        ;                        E.cx = E.screencols-1;
  5772 00:1A1E: A9 FF FF     	lda	#$ffff
  5773 00:1A21: 18           	clc
  5774 00:1A22: 6D xx xx     	adc	|~~E+10
  5775                        L20041:
  Sun Jan  9 2022 20:39                                                Page 106


  5776 00:1A25: 8D xx xx     	sta	|~~E
  5777                        ;                    }
  5778                        ;                }
  5779                        ;            }
  5780 00:1A28: 82 ED 00     	brl	L10161
  5781                        L20036:
  5782 00:1A2B: A5 0F        	lda	<L300+filerow_1
  5783 00:1A2D: 85 01        	sta	<R0
  5784 00:1A2F: 64 03        	stz	<R0+2
  5785 00:1A31: F4 00 00     	pea	#^$14
  5786 00:1A34: F4 14 00     	pea	#<$14
  5787 00:1A37: D4 03        	pei	<R0+2
  5788 00:1A39: D4 01        	pei	<R0
  5789                        	xref	~~~lmul
  5790 00:1A3B: 22 xx xx xx  	jsl	~~~lmul
  5791 00:1A3F: 85 01        	sta	<R0
  5792 00:1A41: 86 03        	stx	<R0+2
  5793 00:1A43: AD xx xx     	lda	|~~E+16
  5794 00:1A46: 18           	clc
  5795 00:1A47: 65 01        	adc	<R0
  5796 00:1A49: 85 05        	sta	<R1
  5797 00:1A4B: AD xx xx     	lda	|~~E+16+2
  5798 00:1A4E: 65 03        	adc	<R0+2
  5799 00:1A50: 85 07        	sta	<R1+2
  5800 00:1A52: A6 07        	ldx	<R1+2
  5801 00:1A54: A5 05        	lda	<R1
  5802 00:1A56: 82 DF 00     	brl	L321
  5803                        L20038:
  5804 00:1A59: A9 00 00     	lda	#$0
  5805 00:1A5C: 82 EF 00     	brl	L324
  5806                        L10163:
  5807                        ;            E.cx -= 1;
  5808 00:1A5F: CE xx xx     	dec	|~~E
  5809                        ;        }
  5810                        ;        break;
  5811 00:1A62: 82 B3 00     	brl	L10161
  5812                        ;    case ARROW_RIGHT:
  5813                        L10169:
  5814                        ;        if (row && filecol < row->size) {
  5815 00:1A65: A5 13        	lda	<L300+row_1
  5816 00:1A67: 05 15        	ora	<L300+row_1+2
  5817 00:1A69: F0 21        	beq	L10170
  5818 00:1A6B: A5 11        	lda	<L300+filecol_1
  5819 00:1A6D: A0 02 00     	ldy	#$2
  5820 00:1A70: D7 13        	cmp	[<L300+row_1],Y
  5821 00:1A72: B0 18        	bcs	L10170
  5822                        ;            if (E.cx == E.screencols-1) {
  5823 00:1A74: A9 FF FF     	lda	#$ffff
  5824 00:1A77: 18           	clc
  5825 00:1A78: 6D xx xx     	adc	|~~E+10
  5826 00:1A7B: CD xx xx     	cmp	|~~E
  5827 00:1A7E: D0 06        	bne	L10171
  5828                        ;                E.coloff++;
  5829 00:1A80: EE xx xx     	inc	|~~E+6
  5830                        ;            } else {
  5831 00:1A83: 82 92 00     	brl	L10161
  5832                        L10171:
  5833                        ;                E.cx += 1;
  Sun Jan  9 2022 20:39                                                Page 107


  5834 00:1A86: EE xx xx     	inc	|~~E
  5835                        ;            }
  5836                        ;        } else if (row && filecol == row->size) {
  5837 00:1A89: 82 8C 00     	brl	L10161
  5838                        L10170:
  5839 00:1A8C: A5 13        	lda	<L300+row_1
  5840 00:1A8E: 05 15        	ora	<L300+row_1+2
  5841 00:1A90: D0 03        	bne	*+5
  5842 00:1A92: 82 83 00     	brl	L10161
  5843 00:1A95: A5 11        	lda	<L300+filecol_1
  5844 00:1A97: A0 02 00     	ldy	#$2
  5845 00:1A9A: D7 13        	cmp	[<L300+row_1],Y
  5846 00:1A9C: D0 7A        	bne	L10161
  5847                        ;            E.cx = 0;
  5848 00:1A9E: 9C xx xx     	stz	|~~E
  5849                        ;            E.coloff = 0;
  5850 00:1AA1: 9C xx xx     	stz	|~~E+6
  5851                        ;            if (E.cy == E.screenrows-1) {
  5852                        L20047:
  5853 00:1AA4: A9 FF FF     	lda	#$ffff
  5854 00:1AA7: 18           	clc
  5855 00:1AA8: 6D xx xx     	adc	|~~E+8
  5856 00:1AAB: CD xx xx     	cmp	|~~E+2
  5857 00:1AAE: D0 05        	bne	L10175
  5858                        ;                E.rowoff++;
  5859 00:1AB0: EE xx xx     	inc	|~~E+4
  5860                        ;            } else {
  5861 00:1AB3: 80 63        	bra	L10161
  5862                        L10175:
  5863                        ;                E.cy += 1;
  5864 00:1AB5: EE xx xx     	inc	|~~E+2
  5865                        ;            }
  5866                        ;        }
  5867                        ;        break;
  5868 00:1AB8: 80 5E        	bra	L10161
  5869                        ;    case ARROW_UP:
  5870                        L10177:
  5871                        ;        if (E.cy == 0) {
  5872 00:1ABA: AD xx xx     	lda	|~~E+2
  5873 00:1ABD: D0 0A        	bne	L10178
  5874                        ;            if (E.rowoff) E.rowoff--;
  5875 00:1ABF: AD xx xx     	lda	|~~E+4
  5876 00:1AC2: F0 54        	beq	L10161
  5877 00:1AC4: CE xx xx     	dec	|~~E+4
  5878                        ;        } else {
  5879 00:1AC7: 80 4F        	bra	L10161
  5880                        L10178:
  5881                        ;            E.cy -= 1;
  5882 00:1AC9: CE xx xx     	dec	|~~E+2
  5883                        ;        }
  5884                        ;        break;
  5885 00:1ACC: 80 4A        	bra	L10161
  5886                        ;    case ARROW_DOWN:
  5887                        L10181:
  5888                        ;        if (filerow < E.numrows) {
  5889 00:1ACE: A5 0F        	lda	<L300+filerow_1
  5890 00:1AD0: CD xx xx     	cmp	|~~E+12
  5891 00:1AD3: 90 CF        	bcc	L20047
  Sun Jan  9 2022 20:39                                                Page 108


  5892                        ;            if (E.cy == E.screenrows-1) {
  5893 00:1AD5: 80 41        	bra	L10161
  5894                        ;                E.rowoff++;
  5895                        ;            } else {
  5896                        ;                E.cy += 1;
  5897                        ;            }
  5898                        ;        }
  5899                        ;        break;
  5900                        ;	case HOME_KEY:
  5901                        L10185:
  5902                        ;		E.cy = E.cx = E.rowoff = E.coloff = 0;
  5903 00:1AD7: 9C xx xx     	stz	|~~E+6
  5904 00:1ADA: 9C xx xx     	stz	|~~E+4
  5905 00:1ADD: 9C xx xx     	stz	|~~E
  5906 00:1AE0: 9C xx xx     	stz	|~~E+2
  5907                        ;		break;
  5908 00:1AE3: 80 33        	bra	L10161
  5909                        ;	case HOME_LINE:
  5910                        L10186:
  5911                        ;		E.cx = E.coloff = 0;
  5912 00:1AE5: 9C xx xx     	stz	|~~E+6
  5913 00:1AE8: 9C xx xx     	stz	|~~E
  5914                        ;		break;
  5915 00:1AEB: 80 2B        	bra	L10161
  5916                        ;	case END_LINE:
  5917                        L10187:
  5918                        ;		if (row) {
  5919 00:1AED: A5 13        	lda	<L300+row_1
  5920 00:1AEF: 05 15        	ora	<L300+row_1+2
  5921 00:1AF1: F0 25        	beq	L10161
  5922                        ;			E.coloff = 0;
  5923 00:1AF3: 9C xx xx     	stz	|~~E+6
  5924                        ;			E.cx = row->size;
  5925 00:1AF6: A0 02 00     	ldy	#$2
  5926 00:1AF9: B7 13        	lda	[<L300+row_1],Y
  5927                        ;		}
  5928                        ;		break;		
  5929 00:1AFB: 82 27 FF     	brl	L20041
  5930                        ;	case END_KEY:
  5931                        L10189:
  5932                        ;		E.cx = E.coloff = 0;
  5933 00:1AFE: 9C xx xx     	stz	|~~E+6
  5934 00:1B01: 9C xx xx     	stz	|~~E
  5935                        ;		E.rowoff = E.numrows - E.screenrows;
  5936 00:1B04: 38           	sec
  5937 00:1B05: AD xx xx     	lda	|~~E+12
  5938 00:1B08: ED xx xx     	sbc	|~~E+8
  5939 00:1B0B: 8D xx xx     	sta	|~~E+4
  5940                        ;		E.cy = E.screenrows-1;
  5941 00:1B0E: A9 FF FF     	lda	#$ffff
  5942 00:1B11: 18           	clc
  5943 00:1B12: 6D xx xx     	adc	|~~E+8
  5944 00:1B15: 8D xx xx     	sta	|~~E+2
  5945                        ;		break;
  5946                        ;        } else {
  5947                        L10161:
  5948                        ;		
  5949                        ;    /* Fix cx if the current line has not enough 
  Sun Jan  9 2022 20:39                                                Page 109


                    chars. */
  5950                        ;    filerow = E.rowoff+E.cy;
  5951 00:1B18: AD xx xx     	lda	|~~E+4
  5952 00:1B1B: 18           	clc
  5953 00:1B1C: 6D xx xx     	adc	|~~E+2
  5954 00:1B1F: 85 0F        	sta	<L300+filerow_1
  5955                        ;    filecol = E.coloff+E.cx;
  5956 00:1B21: AD xx xx     	lda	|~~E+6
  5957 00:1B24: 18           	clc
  5958 00:1B25: 6D xx xx     	adc	|~~E
  5959 00:1B28: 85 11        	sta	<L300+filecol_1
  5960                        ;    row = (filerow >= E.numrows) ? NULL : &E.row[
                    filerow];
  5961 00:1B2A: A5 0F        	lda	<L300+filerow_1
  5962 00:1B2C: CD xx xx     	cmp	|~~E+12
  5963 00:1B2F: B0 03        	bcs	*+5
  5964 00:1B31: 82 F7 FE     	brl	L20036
  5965                        ;	}
  5966 00:1B34: A9 00 00     	lda	#$0
  5967 00:1B37: AA           	tax
  5968                        L321:
  5969 00:1B38: 86 03        	stx	<R0+2
  5970 00:1B3A: 85 13        	sta	<L300+row_1
  5971 00:1B3C: A5 03        	lda	<R0+2
  5972 00:1B3E: 85 15        	sta	<L300+row_1+2
  5973                        ;    rowlen = row ? row->size : 0;
  5974 00:1B40: A5 13        	lda	<L300+row_1
  5975 00:1B42: 05 15        	ora	<L300+row_1+2
  5976 00:1B44: D0 03        	bne	*+5
  5977 00:1B46: 82 10 FF     	brl	L20038
  5978 00:1B49: A0 02 00     	ldy	#$2
  5979 00:1B4C: B7 13        	lda	[<L300+row_1],Y
  5980                        L324:
  5981 00:1B4E: 85 0D        	sta	<L300+rowlen_1
  5982                        ;    if (filecol > rowlen) {
  5983 00:1B50: C5 11        	cmp	<L300+filecol_1
  5984 00:1B52: B0 22        	bcs	L327
  5985                        ;        E.cx -= filecol-rowlen;
  5986 00:1B54: 38           	sec
  5987 00:1B55: A5 11        	lda	<L300+filecol_1
  5988 00:1B57: E5 0D        	sbc	<L300+rowlen_1
  5989 00:1B59: 85 01        	sta	<R0
  5990 00:1B5B: 38           	sec
  5991 00:1B5C: AD xx xx     	lda	|~~E
  5992 00:1B5F: E5 01        	sbc	<R0
  5993 00:1B61: 8D xx xx     	sta	|~~E
  5994                        ;        if (E.cx < 0) {
  5995 00:1B64: C9 00 00     	cmp	#<$0
  5996 00:1B67: B0 0D        	bcs	L327
  5997                        ;            E.coloff += E.cx;
  5998 00:1B69: AD xx xx     	lda	|~~E+6
  5999 00:1B6C: 18           	clc
  6000 00:1B6D: 6D xx xx     	adc	|~~E
  6001 00:1B70: 8D xx xx     	sta	|~~E+6
  6002                        ;            E.cx = 0;
  6003 00:1B73: 9C xx xx     	stz	|~~E
  6004                        ;        }
  6005                        ;    }
  Sun Jan  9 2022 20:39                                                Page 110


  6006                        ;}
  6007                        L327:
  6008 00:1B76: A5 18        	lda	<L299+2
  6009 00:1B78: 85 1A        	sta	<L299+2+2
  6010 00:1B7A: A5 17        	lda	<L299+1
  6011 00:1B7C: 85 19        	sta	<L299+1+2
  6012 00:1B7E: 2B           	pld
  6013 00:1B7F: 3B           	tsc
  6014 00:1B80: 18           	clc
  6015 00:1B81: 69 18 00     	adc	#L299+2
  6016 00:1B84: 1B           	tcs
  6017 00:1B85: 6B           	rtl
  6018             00000016   L299	equ	22
  6019             0000000D   L300	equ	13
  6020                        	ends
  6021                        	efunc
  6022                        ;
  6023                        ;/* Process events arriving from the standard inpu
                    t, which is, the user
  6024                        ; * is typing stuff on the terminal. */
  6025                        ;#define KILO_QUIT_TIMES 1
  6026                        ;void editorProcessKeypress(int fd) {
  6027                        	code
  6028                        	xdef	~~editorProcessKeypress
  6029                        	func
  6030                        ~~editorProcessKeypress:
  6031                        	longa	on
  6032                        	longi	on
  6033 00:1B86: 3B           	tsc
  6034 00:1B87: 38           	sec
  6035 00:1B88: E9 08 00     	sbc	#L328
  6036 00:1B8B: 1B           	tcs
  6037 00:1B8C: 0B           	phd
  6038 00:1B8D: 5B           	tcd
  6039             00000004   fd_0	set	4
  6040                        ;    /* When the file is modified, requires Ctrl-q
                     to be pressed N times
  6041                        ;     * before actually quitting. */
  6042                        ;    static int quit_times = KILO_QUIT_TIMES;
  6043                        ;
  6044                        ;    int c = editorReadKey(fd);
  6045                        ;	
  6046                        ;    switch(c) {
  6047             00000000   c_1	set	0
  6048 00:1B8E: D4 0C        	pei	<L328+fd_0
  6049 00:1B90: 22 xx xx xx  	jsl	~~editorReadKey
  6050 00:1B94: 85 05        	sta	<L329+c_1
  6051                        	xref	~~~swt
  6052 00:1B96: 22 xx xx xx  	jsl	~~~swt
  6053 00:1B9A: 17 00        	dw	23
  6054 00:1B9C: 03 00        	dw	3
  6055 00:1B9E: xx xx        	dw	L10197-1
  6056 00:1BA0: 05 00        	dw	5
  6057 00:1BA2: xx xx        	dw	L10199-1
  6058 00:1BA4: 06 00        	dw	6
  6059 00:1BA6: xx xx        	dw	L10193-1
  6060 00:1BA8: 08 00        	dw	8
  6061 00:1BAA: xx xx        	dw	L10206-1
  Sun Jan  9 2022 20:39                                                Page 111


  6062 00:1BAC: 0A 00        	dw	10
  6063 00:1BAE: xx xx        	dw	L10194-1
  6064 00:1BB0: 0C 00        	dw	12
  6065 00:1BB2: xx xx        	dw	L10224-1
  6066 00:1BB4: 0E 00        	dw	14
  6067 00:1BB6: xx xx        	dw	L10201-1
  6068 00:1BB8: 11 00        	dw	17
  6069 00:1BBA: xx xx        	dw	L10197-1
  6070 00:1BBC: 13 00        	dw	19
  6071 00:1BBE: xx xx        	dw	L10202-1
  6072 00:1BC0: 18 00        	dw	24
  6073 00:1BC2: xx xx        	dw	L10208-1
  6074 00:1BC4: 1B 00        	dw	27
  6075 00:1BC6: xx xx        	dw	L10193-1
  6076 00:1BC8: 7F 00        	dw	127
  6077 00:1BCA: xx xx        	dw	L10206-1
  6078 00:1BCC: E8 03        	dw	1000
  6079 00:1BCE: xx xx        	dw	L10223-1
  6080 00:1BD0: E9 03        	dw	1001
  6081 00:1BD2: xx xx        	dw	L10223-1
  6082 00:1BD4: EA 03        	dw	1002
  6083 00:1BD6: xx xx        	dw	L10223-1
  6084 00:1BD8: EB 03        	dw	1003
  6085 00:1BDA: xx xx        	dw	L10223-1
  6086 00:1BDC: EC 03        	dw	1004
  6087 00:1BDE: xx xx        	dw	L10206-1
  6088 00:1BE0: ED 03        	dw	1005
  6089 00:1BE2: xx xx        	dw	L10223-1
  6090 00:1BE4: EE 03        	dw	1006
  6091 00:1BE6: xx xx        	dw	L10223-1
  6092 00:1BE8: EF 03        	dw	1007
  6093 00:1BEA: xx xx        	dw	L10210-1
  6094 00:1BEC: F0 03        	dw	1008
  6095 00:1BEE: xx xx        	dw	L10210-1
  6096 00:1BF0: F1 03        	dw	1009
  6097 00:1BF2: xx xx        	dw	L10223-1
  6098 00:1BF4: F2 03        	dw	1010
  6099 00:1BF6: xx xx        	dw	L10223-1
  6100 00:1BF8: xx xx        	dw	L10226-1
  6101                        ;    case ENTER:         /* Enter */
  6102                        L10194:
  6103                        ;		if (!E.readonly) {
  6104 00:1BFA: AD xx xx     	lda	|~~E+22
  6105 00:1BFD: D0 04        	bne	L10193
  6106                        ;			editorInsertNewline();
  6107 00:1BFF: 22 xx xx xx  	jsl	~~editorInsertNewline
  6108                        ;		}
  6109                        ;        break;
  6110                        L10193:
  6111                        ;
  6112                        ;    quit_times = KILO_QUIT_TIMES; /* Reset it to 
                    the original value. */
  6113 00:1C03: A9 01 00     	lda	#$1
  6114 00:1C06: 8D xx xx     	sta	|L330
  6115                        ;}
  6116 00:1C09: 80 1E        	bra	L334
  6117                        ;    case CTRL_C:        /* Ctrl-c */
  6118                        ;    case CTRL_Q:        /* Ctrl-q */
  Sun Jan  9 2022 20:39                                                Page 112


  6119                        L10197:
  6120                        ;        /* Quit if the file was already saved. */
  6121                        ;        if (E.dirty && quit_times) {
  6122 00:1C0B: AD xx xx     	lda	|~~E+20
  6123 00:1C0E: F0 29        	beq	L10198
  6124 00:1C10: AD xx xx     	lda	|L330
  6125 00:1C13: F0 24        	beq	L10198
  6126                        ;            editorSetStatusMessage("WARNING!!! Fi
                    le has unsaved changes. "
  6127                        ;                "Press Ctrl-Q %d more times to qu
                    it.", quit_times);
  6128 00:1C15: AD xx xx     	lda	|L330
  6129 00:1C18: 48           	pha
  6130 00:1C19: F4 xx xx     	pea	#^L295
  6131 00:1C1C: F4 xx xx     	pea	#<L295
  6132 00:1C1F: F4 08 00     	pea	#8
  6133 00:1C22: 22 xx xx xx  	jsl	~~editorSetStatusMessage
  6134                        ;            quit_times--;
  6135 00:1C26: CE xx xx     	dec	|L330
  6136                        ;            return;
  6137                        L334:
  6138 00:1C29: A5 0A        	lda	<L328+2
  6139 00:1C2B: 85 0C        	sta	<L328+2+2
  6140 00:1C2D: A5 09        	lda	<L328+1
  6141 00:1C2F: 85 0B        	sta	<L328+1+2
  6142 00:1C31: 2B           	pld
  6143 00:1C32: 3B           	tsc
  6144 00:1C33: 18           	clc
  6145 00:1C34: 69 0A 00     	adc	#L328+2
  6146 00:1C37: 1B           	tcs
  6147 00:1C38: 6B           	rtl
  6148                        ;        }
  6149                        ;		end++;
  6150                        L10198:
  6151 00:1C39: EE xx xx     	inc	|~~end
  6152                        ;        //exit(0);
  6153                        ;        break;
  6154 00:1C3C: 80 C5        	bra	L10193
  6155                        ;    case CTRL_E:
  6156                        L10199:
  6157                        ;        editorEmpty();
  6158 00:1C3E: 22 xx xx xx  	jsl	~~editorEmpty
  6159                        ;        break;
  6160 00:1C42: 80 BF        	bra	L10193
  6161                        ;    case CTRL_F:
  6162                        ;        //editorFind(fd);
  6163                        ;        break;
  6164                        ;	case CTRL_N:
  6165                        L10201:
  6166                        ;		editorSetFileName();
  6167 00:1C44: 22 xx xx xx  	jsl	~~editorSetFileName
  6168                        ;		break;
  6169 00:1C48: 80 B9        	bra	L10193
  6170                        ;    case CTRL_S:        /* Ctrl-s */
  6171                        L10202:
  6172                        ;		if (!E.readonly) {
  6173 00:1C4A: AD xx xx     	lda	|~~E+22
  6174 00:1C4D: D0 B4        	bne	L10193
  Sun Jan  9 2022 20:39                                                Page 113


  6175                        ;			editorSave();
  6176 00:1C4F: 22 xx xx xx  	jsl	~~editorSave
  6177                        ;		}
  6178                        ;        break;
  6179 00:1C53: 80 AE        	bra	L10193
  6180                        ;    case BACKSPACE:     /* Backspace */
  6181                        ;    case CTRL_H:        /* Ctrl-h */
  6182                        ;    case DEL_KEY:
  6183                        L10206:
  6184                        ;		if (!E.readonly) {
  6185 00:1C55: AD xx xx     	lda	|~~E+22
  6186 00:1C58: D0 A9        	bne	L10193
  6187                        ;			editorDelChar();
  6188 00:1C5A: 22 xx xx xx  	jsl	~~editorDelChar
  6189                        ;		}
  6190                        ;        break;
  6191 00:1C5E: 80 A3        	bra	L10193
  6192                        ;	case CTRL_X:
  6193                        L10208:
  6194                        ;		editorToggleHex();
  6195 00:1C60: 22 xx xx xx  	jsl	~~editorToggleHex
  6196                        ;		break;
  6197 00:1C64: 80 9D        	bra	L10193
  6198                        ;    case PAGE_UP:
  6199                        ;    case PAGE_DOWN:
  6200                        L10210:
  6201                        ;        if (c == PAGE_UP && E.cy != 0)
  6202                        ;            E.cy = 0;
  6203 00:1C66: A5 05        	lda	<L329+c_1
  6204 00:1C68: C9 EF 03     	cmp	#<$3ef
  6205 00:1C6B: D0 0A        	bne	L10211
  6206 00:1C6D: AD xx xx     	lda	|~~E+2
  6207 00:1C70: F0 05        	beq	L10211
  6208 00:1C72: 9C xx xx     	stz	|~~E+2
  6209                        ;        else if (c == PAGE_DOWN && E.cy != E.scre
                    enrows-1)
  6210 00:1C75: 80 1D        	bra	L10212
  6211                        L10211:
  6212                        ;            E.cy = E.screenrows-1;
  6213 00:1C77: A5 05        	lda	<L329+c_1
  6214 00:1C79: C9 F0 03     	cmp	#<$3f0
  6215 00:1C7C: D0 16        	bne	L10212
  6216 00:1C7E: A9 FF FF     	lda	#$ffff
  6217 00:1C81: 18           	clc
  6218 00:1C82: 6D xx xx     	adc	|~~E+8
  6219 00:1C85: CD xx xx     	cmp	|~~E+2
  6220 00:1C88: F0 0A        	beq	L10212
  6221 00:1C8A: A9 FF FF     	lda	#$ffff
  6222 00:1C8D: 18           	clc
  6223 00:1C8E: 6D xx xx     	adc	|~~E+8
  6224 00:1C91: 8D xx xx     	sta	|~~E+2
  6225                        ;        {
  6226                        L10212:
  6227                        ;        int times = E.screenrows;
  6228                        ;        while(times--)
  6229             00000002   times_2	set	2
  6230 00:1C94: AD xx xx     	lda	|~~E+8
  6231 00:1C97: 85 07        	sta	<L329+times_2
  Sun Jan  9 2022 20:39                                                Page 114


  6232 00:1C99: 80 14        	bra	L10214
  6233                        L20049:
  6234                        ;            editorMoveCursor(c == PAGE_UP ? ARROW
                    _UP:
  6235                        ;                                            ARROW
                    _DOWN);
  6236 00:1C9B: A5 05        	lda	<L329+c_1
  6237 00:1C9D: C9 EF 03     	cmp	#<$3ef
  6238 00:1CA0: D0 05        	bne	L342
  6239 00:1CA2: A9 EA 03     	lda	#$3ea
  6240 00:1CA5: 80 03        	bra	L344
  6241                        L342:
  6242 00:1CA7: A9 EB 03     	lda	#$3eb
  6243                        L344:
  6244 00:1CAA: 48           	pha
  6245 00:1CAB: 22 xx xx xx  	jsl	~~editorMoveCursor
  6246                        L10214:
  6247 00:1CAF: A5 07        	lda	<L329+times_2
  6248 00:1CB1: 85 01        	sta	<R0
  6249 00:1CB3: C6 07        	dec	<L329+times_2
  6250 00:1CB5: A5 01        	lda	<R0
  6251 00:1CB7: D0 E2        	bne	L20049
  6252                        ;        }
  6253                        ;        break;
  6254 00:1CB9: 82 47 FF     	brl	L10193
  6255                        ;
  6256                        ;    case ARROW_UP:
  6257                        ;    case ARROW_DOWN:
  6258                        ;    case ARROW_LEFT:
  6259                        ;    case ARROW_RIGHT:
  6260                        ;	case HOME_KEY:
  6261                        ;	case HOME_LINE:
  6262                        ;	case END_LINE:
  6263                        ;	case END_KEY:
  6264                        L10223:
  6265                        ;        editorMoveCursor(c);
  6266 00:1CBC: D4 05        	pei	<L329+c_1
  6267 00:1CBE: 22 xx xx xx  	jsl	~~editorMoveCursor
  6268                        ;        break;
  6269 00:1CC2: 82 3E FF     	brl	L10193
  6270                        ;    case CTRL_L: 
  6271                        L10224:
  6272                        ;        editorLoad();
  6273 00:1CC5: 22 xx xx xx  	jsl	~~editorLoad
  6274                        ;        break;
  6275 00:1CC9: 82 37 FF     	brl	L10193
  6276                        ;    case ESC:
  6277                        ;        /* Nothing to do for ESC in this mode. */
  6278                        ;        break;
  6279                        ;    default:
  6280                        L10226:
  6281                        ;		if (!E.readonly) {
  6282 00:1CCC: AD xx xx     	lda	|~~E+22
  6283 00:1CCF: F0 03        	beq	*+5
  6284 00:1CD1: 82 2F FF     	brl	L10193
  6285                        ;			editorInsertChar(c);
  6286 00:1CD4: D4 05        	pei	<L329+c_1
  6287 00:1CD6: 22 xx xx xx  	jsl	~~editorInsertChar
  Sun Jan  9 2022 20:39                                                Page 115


  6288                        ;		}
  6289                        ;        break;
  6290 00:1CDA: 82 26 FF     	brl	L10193
  6291                        ;    }
  6292             00000008   L328	equ	8
  6293             00000005   L329	equ	5
  6294                        	ends
  6295                        	efunc
  6296                        	data
  6297                        L330:
  6298 00:007E: 01 00        	dw	$1
  6299 00:0080:              	ends
  6300                        	data
  6301                        L295:
  6302 00:0080: 57 41 52 4E  	db	$57,$41,$52,$4E,$49,$4E,$47,$21,$21,$21,
                    $20,$46,$69,$6C,$65
       00:0084: 49 4E 47 21 
       00:0088: 21 21 20 46 
       00:008C: 69 6C 65 
  6303 00:008F: 20 68 61 73  	db	$20,$68,$61,$73,$20,$75,$6E,$73,$61,$76,
                    $65,$64,$20,$63,$68
       00:0093: 20 75 6E 73 
       00:0097: 61 76 65 64 
       00:009B: 20 63 68 
  6304 00:009E: 61 6E 67 65  	db	$61,$6E,$67,$65,$73,$2E,$20,$50,$72,$65,
                    $73,$73,$20,$43,$74
       00:00A2: 73 2E 20 50 
       00:00A6: 72 65 73 73 
       00:00AA: 20 43 74 
  6305 00:00AD: 72 6C 2D 51  	db	$72,$6C,$2D,$51,$20,$25,$64,$20,$6D,$6F,
                    $72,$65,$20,$74,$69
       00:00B1: 20 25 64 20 
       00:00B5: 6D 6F 72 65 
       00:00B9: 20 74 69 
  6306 00:00BC: 6D 65 73 20  	db	$6D,$65,$73,$20,$74,$6F,$20,$71,$75,$69,
                    $74,$2E,$00
       00:00C0: 74 6F 20 71 
       00:00C4: 75 69 74 2E 
       00:00C8: 00 
  6307 00:00C9:              	ends
  6308                        ;
  6309                        ;int editorFileWasModified(void) {
  6310                        	code
  6311                        	xdef	~~editorFileWasModified
  6312                        	func
  6313                        ~~editorFileWasModified:
  6314                        	longa	on
  6315                        	longi	on
  6316                        ;    return E.dirty;
  6317 00:1CDD: AD xx xx     	lda	|~~E+20
  6318 00:1CE0: 6B           	rtl
  6319                        ;}
  6320             00000000   L347	equ	0
  6321             00000001   L348	equ	1
  6322                        	ends
  6323                        	efunc
  6324                        ;
  6325                        ;void initEditor(void) {
  Sun Jan  9 2022 20:39                                                Page 116


  6326                        	code
  6327                        	xdef	~~initEditor
  6328                        	func
  6329                        ~~initEditor:
  6330                        	longa	on
  6331                        	longi	on
  6332 00:1CE1: 3B           	tsc
  6333 00:1CE2: 38           	sec
  6334 00:1CE3: E9 0C 00     	sbc	#L350
  6335 00:1CE6: 1B           	tcs
  6336 00:1CE7: 0B           	phd
  6337 00:1CE8: 5B           	tcd
  6338                        ;    E.cx = 0;
  6339 00:1CE9: 9C xx xx     	stz	|~~E
  6340                        ;    E.cy = 0;
  6341 00:1CEC: 9C xx xx     	stz	|~~E+2
  6342                        ;    E.rowoff = 0;
  6343 00:1CEF: 9C xx xx     	stz	|~~E+4
  6344                        ;    E.coloff = 0;
  6345 00:1CF2: 9C xx xx     	stz	|~~E+6
  6346                        ;    E.numrows = 0;
  6347 00:1CF5: 9C xx xx     	stz	|~~E+12
  6348                        ;    E.dirty = 0;
  6349 00:1CF8: 9C xx xx     	stz	|~~E+20
  6350                        ;	E.readonly = 0;
  6351 00:1CFB: 9C xx xx     	stz	|~~E+22
  6352                        ;	E.hex = 0;
  6353 00:1CFE: 9C xx xx     	stz	|~~E+24
  6354                        ;    E.row = NULL;
  6355 00:1D01: 9C xx xx     	stz	|~~E+16
  6356 00:1D04: 9C xx xx     	stz	|~~E+16+2
  6357                        ;    E.filename = NULL;
  6358 00:1D07: 9C xx xx     	stz	|~~E+26
  6359 00:1D0A: 9C xx xx     	stz	|~~E+26+2
  6360                        ;    E.syntax = NULL;
  6361 00:1D0D: 9C xx xx     	stz	|~~E+114
  6362 00:1D10: 9C xx xx     	stz	|~~E+114+2
  6363                        ;    if (getWindowSize(STDIN_FILENO,STDOUT_FILENO,
  6364                        ;                      &E.screenrows, &E.screencol
                    s) == -1)
  6365                        ;    {
  6366 00:1D13: A9 xx xx     	lda	#<~~E+10
  6367 00:1D16: 85 01        	sta	<R0
  6368                        	xref	_BEG_DATA
  6369 00:1D18: A9 xx xx     	lda	#_BEG_DATA>>16
  6370 00:1D1B: 48           	pha
  6371 00:1D1C: D4 01        	pei	<R0
  6372 00:1D1E: A9 xx xx     	lda	#<~~E+8
  6373 00:1D21: 85 05        	sta	<R1
  6374                        	xref	_BEG_DATA
  6375 00:1D23: A9 xx xx     	lda	#_BEG_DATA>>16
  6376 00:1D26: 48           	pha
  6377 00:1D27: D4 05        	pei	<R1
  6378 00:1D29: F4 01 00     	pea	#<$1
  6379 00:1D2C: F4 00 00     	pea	#<$0
  6380 00:1D2F: 22 xx xx xx  	jsl	~~getWindowSize
  6381 00:1D33: C9 FF FF     	cmp	#<$ffffffff
  6382 00:1D36: D0 11        	bne	L10228
  Sun Jan  9 2022 20:39                                                Page 117


  6383                        ;        perror("Unable to query the screen for si
                    ze (columns / rows)");
  6384 00:1D38: F4 xx xx     	pea	#^L346
  6385 00:1D3B: F4 xx xx     	pea	#<L346
  6386 00:1D3E: 22 xx xx xx  	jsl	~~perror
  6387                        ;        exit(1);
  6388 00:1D42: F4 01 00     	pea	#<$1
  6389 00:1D45: 22 xx xx xx  	jsl	~~exit
  6390                        ;    }
  6391                        ;    E.screenrows -= 2; /* Get room for status bar
                    . */
  6392                        L10228:
  6393 00:1D49: CE xx xx     	dec	|~~E+8
  6394 00:1D4C: CE xx xx     	dec	|~~E+8
  6395                        ;	E.rowsavail = 0;
  6396 00:1D4F: 9C xx xx     	stz	|~~E+118
  6397                        ;	
  6398                        ;}
  6399 00:1D52: 2B           	pld
  6400 00:1D53: 3B           	tsc
  6401 00:1D54: 18           	clc
  6402 00:1D55: 69 0C 00     	adc	#L350
  6403 00:1D58: 1B           	tcs
  6404 00:1D59: 6B           	rtl
  6405             0000000C   L350	equ	12
  6406             0000000D   L351	equ	13
  6407                        	ends
  6408                        	efunc
  6409                        	data
  6410                        L346:
  6411 00:00C9: 55 6E 61 62  	db	$55,$6E,$61,$62,$6C,$65,$20,$74,$6F,$20,
                    $71,$75,$65,$72,$79
       00:00CD: 6C 65 20 74 
       00:00D1: 6F 20 71 75 
       00:00D5: 65 72 79 
  6412 00:00D8: 20 74 68 65  	db	$20,$74,$68,$65,$20,$73,$63,$72,$65,$65,
                    $6E,$20,$66,$6F,$72
       00:00DC: 20 73 63 72 
       00:00E0: 65 65 6E 20 
       00:00E4: 66 6F 72 
  6413 00:00E7: 20 73 69 7A  	db	$20,$73,$69,$7A,$65,$20,$28,$63,$6F,$6C,
                    $75,$6D,$6E,$73,$20
       00:00EB: 65 20 28 63 
       00:00EF: 6F 6C 75 6D 
       00:00F3: 6E 73 20 
  6414 00:00F6: 2F 20 72 6F  	db	$2F,$20,$72,$6F,$77,$73,$29,$00
       00:00FA: 77 73 29 00 
  6415 00:00FE:              	ends
  6416                        ;
  6417                        ;int main(int argc, char **argv) {
  6418                        	code
  6419                        	xdef	~~main
  6420                        	func
  6421                        ~~main:
  6422                        	longa	on
  6423                        	longi	on
  6424 00:1D5A: 3B           	tsc
  6425 00:1D5B: 38           	sec
  Sun Jan  9 2022 20:39                                                Page 118


  6426 00:1D5C: E9 00 00     	sbc	#L355
  6427 00:1D5F: 1B           	tcs
  6428 00:1D60: 0B           	phd
  6429 00:1D61: 5B           	tcd
  6430             00000004   argc_0	set	4
  6431             00000006   argv_0	set	6
  6432                        ;	
  6433                        ;	end = 0;
  6434 00:1D62: 9C xx xx     	stz	|~~end
  6435                        ;	
  6436                        ;    initEditor();
  6437 00:1D65: 22 xx xx xx  	jsl	~~initEditor
  6438                        ;	
  6439                        ;    if (argc < 2) {
  6440 00:1D69: A5 04        	lda	<L355+argc_0
  6441 00:1D6B: 30 04        	bmi	L357
  6442 00:1D6D: 3A           	dea
  6443 00:1D6E: 3A           	dea
  6444 00:1D6F: 10 0C        	bpl	L10229
  6445                        L357:
  6446                        ;		
  6447                        ;        //fprintf(stderr,"Usage: kilo <filename>\
                    n");
  6448                        ;        //exit(1);
  6449                        ;		
  6450                        ;		E.filename = strdup("D:KILL.C");
  6451 00:1D71: F4 xx xx     	pea	#^L354
  6452 00:1D74: F4 xx xx     	pea	#<L354
  6453 00:1D77: 22 xx xx xx  	jsl	~~strdup
  6454 00:1D7B: 80 12        	bra	L20053
  6455                        ;    } else {
  6456                        L10229:
  6457                        ;		E.filename = adjustFilename(argv[1], 0);
  6458 00:1D7D: F4 00 00     	pea	#<$0
  6459 00:1D80: A0 06 00     	ldy	#$6
  6460 00:1D83: B7 06        	lda	[<L355+argv_0],Y
  6461 00:1D85: 48           	pha
  6462 00:1D86: 88           	dey
  6463 00:1D87: 88           	dey
  6464 00:1D88: B7 06        	lda	[<L355+argv_0],Y
  6465 00:1D8A: 48           	pha
  6466 00:1D8B: 22 xx xx xx  	jsl	~~adjustFilename
  6467                        L20053:
  6468 00:1D8F: 8D xx xx     	sta	|~~E+26
  6469 00:1D92: 8E xx xx     	stx	|~~E+26+2
  6470                        ;	}	
  6471                        ;	
  6472                        ;//    editorSelectSyntaxHighlight(argv[1]);
  6473                        ;//    editorSelectSyntaxHighlight(filename);
  6474                        ;
  6475                        ;//    editorOpen(argv[1]);
  6476                        ;
  6477                        ;    //editorOpen(filename);
  6478                        ;	
  6479                        ;	//getchar();
  6480                        ;	
  6481                        ;    enableRawMode(STDIN_FILENO);
  6482 00:1D95: F4 00 00     	pea	#<$0
  Sun Jan  9 2022 20:39                                                Page 119


  6483 00:1D98: 22 xx xx xx  	jsl	~~enableRawMode
  6484                        ;    editorSetStatusMessage(
  6485                        ;     	   "HELP: Ctrl-S = save | Ctrl-Q = quit 
                    | Ctrl-F = find | CTRL-X hex");
  6486 00:1D9C: F4 xx xx     	pea	#^L354+9
  6487 00:1D9F: F4 xx xx     	pea	#<L354+9
  6488 00:1DA2: F4 06 00     	pea	#6
  6489 00:1DA5: 22 xx xx xx  	jsl	~~editorSetStatusMessage
  6490                        ;
  6491                        ;    while(!end) {
  6492 00:1DA9: 80 0F        	bra	L10231
  6493                        L20052:
  6494                        ;		editorRefreshScreen();
  6495 00:1DAB: 22 xx xx xx  	jsl	~~editorRefreshScreen
  6496                        ;		editorProcessKeypress(STDIN_FILENO);
  6497 00:1DAF: F4 00 00     	pea	#<$0
  6498 00:1DB2: 22 xx xx xx  	jsl	~~editorProcessKeypress
  6499                        ;		editorSetDefaultStatusMessage();
  6500 00:1DB6: 22 xx xx xx  	jsl	~~editorSetDefaultStatusMessage
  6501                        ;    }
  6502                        L10231:
  6503 00:1DBA: AD xx xx     	lda	|~~end
  6504 00:1DBD: F0 EC        	beq	L20052
  6505                        ;	
  6506                        ;	printf("%c", CLS);
  6507 00:1DBF: F4 01 00     	pea	#<$1
  6508 00:1DC2: F4 xx xx     	pea	#^L354+74
  6509 00:1DC5: F4 xx xx     	pea	#<L354+74
  6510 00:1DC8: F4 08 00     	pea	#8
  6511 00:1DCB: 22 xx xx xx  	jsl	~~printf
  6512                        ;/*
  6513                        ;	aclose(0);
  6514                        ;	aopen(0, "E:", 12, 0);
  6515                        ;	aclose(1);
  6516                        ;
  6517                        ;	editorfreeAllRows();
  6518                        ;	free(E.row);
  6519                        ;	free(E.filename);
  6520                        ;*/	
  6521                        ;    return 0;
  6522 00:1DCF: A9 00 00     	lda	#$0
  6523 00:1DD2: A8           	tay
  6524 00:1DD3: A5 02        	lda	<L355+2
  6525 00:1DD5: 85 08        	sta	<L355+2+6
  6526 00:1DD7: A5 01        	lda	<L355+1
  6527 00:1DD9: 85 07        	sta	<L355+1+6
  6528 00:1DDB: 2B           	pld
  6529 00:1DDC: 3B           	tsc
  6530 00:1DDD: 18           	clc
  6531 00:1DDE: 69 06 00     	adc	#L355+6
  6532 00:1DE1: 1B           	tcs
  6533 00:1DE2: 98           	tya
  6534 00:1DE3: 6B           	rtl
  6535                        ;}
  6536             00000000   L355	equ	0
  6537             00000001   L356	equ	1
  6538                        	ends
  6539                        	efunc
  Sun Jan  9 2022 20:39                                                Page 120


  6540                        	data
  6541                        L354:
  6542 00:00FE: 44 3A 4B 49  	db	$44,$3A,$4B,$49,$4C,$4C,$2E,$43,$00,$48,
                    $45,$4C,$50,$3A,$20
       00:0102: 4C 4C 2E 43 
       00:0106: 00 48 45 4C 
       00:010A: 50 3A 20 
  6543 00:010D: 43 74 72 6C  	db	$43,$74,$72,$6C,$2D,$53,$20,$3D,$20,$73,
                    $61,$76,$65,$20,$7C
       00:0111: 2D 53 20 3D 
       00:0115: 20 73 61 76 
       00:0119: 65 20 7C 
  6544 00:011C: 20 43 74 72  	db	$20,$43,$74,$72,$6C,$2D,$51,$20,$3D,$20,
                    $71,$75,$69,$74,$20
       00:0120: 6C 2D 51 20 
       00:0124: 3D 20 71 75 
       00:0128: 69 74 20 
  6545 00:012B: 7C 20 43 74  	db	$7C,$20,$43,$74,$72,$6C,$2D,$46,$20,$3D,
                    $20,$66,$69,$6E,$64
       00:012F: 72 6C 2D 46 
       00:0133: 20 3D 20 66 
       00:0137: 69 6E 64 
  6546 00:013A: 20 7C 20 43  	db	$20,$7C,$20,$43,$54,$52,$4C,$2D,$58,$20,
                    $68,$65,$78,$00,$25
       00:013E: 54 52 4C 2D 
       00:0142: 58 20 68 65 
       00:0146: 78 00 25 
  6547 00:0149: 63 00        	db	$63,$00
  6548 00:014B:              	ends
  6549                        ;
  6550                        	xref	~~toupper
  6551                        	xref	~~adjustFilename
  6552                        	xref	~~read
  6553                        	xref	~~__errno_location
  6554                        	xref	~~strerror
  6555                        	xref	~~strdup
  6556                        	xref	~~memcpy
  6557                        	xref	~~memset
  6558                        	xref	~~memmove
  6559                        	xref	~~realloc
  6560                        	xref	~~free
  6561                        	xref	~~malloc
  6562                        	xref	~~perror
  6563                        	xref	~~fileno
  6564                        	xref	~~fclose
  6565                        	xref	~~fwrite
  6566                        	xref	~~fgetc
  6567                        	xref	~~vsnprintf
  6568                        	xref	~~sprintf
  6569                        	xref	~~printf
  6570                        	xref	~~fopen
  6571                        	udata
  6572                        ~~status
  6573 00:0000:              	ds	81
  6574 00:0051:              	ends
  6575                        	udata
  6576                        ~~end
  6577 00:0051:              	ds	2
  Sun Jan  9 2022 20:39                                                Page 121


  6578 00:0053:              	ends
  6579                        	udata
  6580                        ~~E
  6581 00:0053:              	ds	120
  6582 00:00CB:              	ends
  6583                        	xref	~~stdin


      Lines assembled: 6583
      Errors: 0
