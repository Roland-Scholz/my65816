  Wed Jan 19 2022 17:05                                                Page 1


                     ***************************************
                     **      WDC 65C816 Macro Assembler   **
                     **                                   **
                     **     Version 3.49.1- Feb  6 2006    **
                     ***************************************

     1                        ;:ts=8
     2             00000001   R0	equ	1
     3             00000005   R1	equ	5
     4             00000009   R2	equ	9
     5             0000000D   R3	equ	13
     6                        ;#include <stdio.h>
     7                        ;#include <stdlib.h>
     8                        ;#include <string.h>
     9                        ;
    10                        ;#include "homebrew.h"
    11                        ;
    12                        ;#define WIDTH_MIN	10
    13                        ;#define WIDTH_MAX	78
    14                        ;#define HEIGHT_MIN	5
    15                        ;#define HEIGHT_MAX	23
    16                        ;
    17                        ;#define FILEDESC	100
    18                        ;
    19                        ;#define VT100_SCREEN_WIDTH		80
    20                        ;#define VT100_SCREEN_HEIGHT		25
    21                        ;#define VT100_CHAR_WIDTH		0
    22                        ;#define VT100_CHAR_HEIGHT		1
    23                        ;#define VT100_HEIGHT			(term->h
                    eight)
    24                        ;#define VT100_WIDTH				
                    (term->width)
    25                        ;#define MAX_COMMAND_ARGS		4
    26                        ;#define KEY_ESC					
                    0x1b
    27                        ;#define KEY_DEL					
                    0x7f
    28                        ;#define KEY_BELL				0x07
    29                        ;
    30                        ;#define STATE(NAME, TERM, EV, ARG)	void NAM
                    E(win_t *TERM, uint8_t EV, uint16_t ARG)
    31                        ;
    32                        ;// states 
    33                        ;enum {
    34                        ;	STATE_IDLE,
    35                        ;	STATE_ESCAPE,
    36                        ;	STATE_COMMAND
    37                        ;};
    38                        ;
    39                        ;// events that are passed into states
    40                        ;enum {
    41                        ;	EV_CHAR = 1
    42                        ;};
    43                        ;
    44                        ;/*
    45                        ;static struct vt100 {
    46                        ;	union flags {
    47                        ;		uint8_t val;
  Wed Jan 19 2022 17:05                                                Page 2


    48                        ;		struct {
    49                        ;			// 0 = cursor remains on last co
                    lumn when it gets there
    50                        ;			// 1 = lines wrap after last col
                    umn to next line
    51                        ;			uint8_t cursor_wrap : 1; 
    52                        ;			uint8_t scroll_mode : 1;
    53                        ;			uint8_t origin_mode : 1; 
    54                        ;		}; 
    55                        ;	} flags;
    56                        ;	
    57                        ;	//uint16_t screen_width, screen_height;
    58                        ;	// cursor position on the screen (0, 0) = top le
                    ft corner. 
    59                        ;	int16_t cursor_x, cursor_y;
    60                        ;	int16_t saved_cursor_x, saved_cursor_y; // used 
                    for cursor save restore
    61                        ;	int16_t scroll_start_row, scroll_end_row; 
    62                        ;	// character width and height
    63                        ;	int8_t char_width, char_height;
    64                        ;	// colors used for rendering current characters
    65                        ;	uint16_t back_color, front_color;
    66                        ;	// the starting y-position of the screen scroll
    67                        ;	uint16_t scroll_value; 
    68                        ;	// command arguments that get parsed as they app
                    ear in the terminal
    69                        ;	uint8_t narg; uint16_t args[MAX_COMMAND_ARGS];
    70                        ;	// current arg pointer (we use it for parsing) 
    71                        ;	uint8_t carg;
    72                        ;	
    73                        ;	void (*state)(win_t *w, uint8_t ev, uint16_t arg
                    );
    74                        ;	void (*send_response)(char *str);
    75                        ;	void (*ret_state)(win_t *w, uint8_t ev, uint16_t
                     arg); 
    76                        ;} term;*/
    77                        ;
    78                        ;
    79                        ;typedef struct window win_t;
    80                        ;typedef union flags flags_t;
    81                        ;
    82                        ;union flags {
    83                        ;	uint8_t val;
    84                        ;	struct {
    85                        ;		// 0 = cursor remains on last column whe
                    n it gets there
    86                        ;		// 1 = lines wrap after last column to n
                    ext line
    87                        ;		uint8_t cursor_wrap : 1; 
    88                        ;		uint8_t scroll_mode : 1;
    89                        ;		uint8_t origin_mode : 1; 
    90                        ;	} f; 
    91                        ;};
    92                        ;	
    93                        ;
    94                        ;struct window {
    95                        ;	flags_t flags;
    96                        ;	uint16_t x0;
  Wed Jan 19 2022 17:05                                                Page 3


    97                        ;	uint16_t y0;
    98                        ;	uint16_t width;
    99                        ;	uint16_t height;
   100                        ;	uint16_t z;
   101                        ;	char title[16];
   102                        ;	uint16_t fd;
   103                        ;	win_t *next;
   104                        ;	win_t *prev;
   105                        ;	uint16_t cursor_x;
   106                        ;	uint16_t cursor_y;
   107                        ;	uint16_t saved_cursor_x;
   108                        ;	uint16_t saved_cursor_y;
   109                        ;	uint16_t scroll_start_row;
   110                        ;	uint16_t scroll_end_row;
   111                        ;	uint16_t scroll_value; 
   112                        ;	uint16_t front_color;
   113                        ;	uint16_t back_color;
   114                        ;	char data[2000];
   115                        ;	char *pdata;
   116                        ;	uint16_t narg;
   117                        ;	uint16_t args[MAX_COMMAND_ARGS];
   118                        ;	void (*state)(win_t *w, uint8_t ev, uint16_t arg
                    );
   119                        ;	void (*send_response)(char *str);
   120                        ;	void (*ret_state)(win_t *w, uint8_t ev, uint16_t
                     arg); 
   121                        ;};
   122                        ;
   123                        ;struct windows {
   124                        ;	win_t *anchor;
   125                        ;	uint16_t maxFileDesc;
   126                        ;};
   127                        ;typedef struct windows wins_t;
   128                        ;
   129                        ;/*----------------------S T A T I C--------------
                    -----*/
   130                        ;static wins_t wins;
   131                        ;static const char hextab[] = "0123456789abcdef"; 
   132                        	data
   133                        ~~hextab:
   134 00:0000: 30 31 32 33  	db	$30,$31,$32,$33,$34,$35,$36,$37,$38,$39
       00:0004: 34 35 36 37 
       00:0008: 38 39 
   135 00:000A: 61 62 63 64  	db	$61,$62,$63,$64,$65,$66,$0
       00:000E: 65 66 00 
   136 00:0011:              	ends
   137                        ;static const uint16_t colors[] = {
   138                        	data
   139                        ~~colors:
   140                        ;	0x0000, // black
   141 00:0011: 00 00        	dw	$0
   142                        ;	0xf800, // red
   143 00:0013: 00 F8        	dw	$F800
   144                        ;	0x0780, // green
   145 00:0015: 80 07        	dw	$780
   146                        ;	0xfe00, // yellow
   147 00:0017: 00 FE        	dw	$FE00
   148                        ;	0x001f, // blue
  Wed Jan 19 2022 17:05                                                Page 4


   149 00:0019: 1F 00        	dw	$1F
   150                        ;	0xf81f, // magenta
   151 00:001B: 1F F8        	dw	$F81F
   152                        ;	0x07ff, // cyan
   153 00:001D: FF 07        	dw	$7FF
   154                        ;	0xffff  // white
   155                        ;};
   156 00:001F: FF FF        	dw	$FFFF
   157 00:0021:              	ends
   158                        ;
   159                        ;/*-----------------------------------------------
                    -----*/
   160                        ;
   161                        ;
   162                        ;/*-----------------D E C L A R A T I O N S-------
                    -----*/
   163                        ;STATE(_st_idle, term, ev, arg);
   164                        ;STATE(_st_esc_sq_bracket, term, ev, arg);
   165                        ;STATE(_st_esc_question, term, ev, arg);
   166                        ;STATE(_st_esc_hash, term, ev, arg);
   167                        ;STATE(_st_command_arg, term, ev, arg);
   168                        ;
   169                        ;
   170                        ;
   171                        ;/*-----------------C O M M O N  F U N C----------
                    -----*/
   172                        ;
   173                        ;void ili9340_setBackColor(uint16_t col) {
   174                        	code
   175                        	xdef	~~ili9340_setBackColor
   176                        	func
   177                        ~~ili9340_setBackColor:
   178                        	longa	on
   179                        	longi	on
   180 00:0000: 3B           	tsc
   181 00:0001: 38           	sec
   182 00:0002: E9 00 00     	sbc	#L2
   183 00:0005: 1B           	tcs
   184 00:0006: 0B           	phd
   185 00:0007: 5B           	tcd
   186             00000004   col_0	set	4
   187                        ;	//debugf("ili9340_setBackColor: %d\n", (long)col
                    );
   188                        ;}; 
   189 00:0008: A5 02        	lda	<L2+2
   190 00:000A: 85 04        	sta	<L2+2+2
   191 00:000C: A5 01        	lda	<L2+1
   192 00:000E: 85 03        	sta	<L2+1+2
   193 00:0010: 2B           	pld
   194 00:0011: 3B           	tsc
   195 00:0012: 18           	clc
   196 00:0013: 69 02 00     	adc	#L2+2
   197 00:0016: 1B           	tcs
   198 00:0017: 6B           	rtl
   199             00000000   L2	equ	0
   200             00000001   L3	equ	1
   201                        	ends
   202                        	efunc
  Wed Jan 19 2022 17:05                                                Page 5


   203                        ;
   204                        ;void ili9340_setFrontColor(uint16_t col) {
   205                        	code
   206                        	xdef	~~ili9340_setFrontColor
   207                        	func
   208                        ~~ili9340_setFrontColor:
   209                        	longa	on
   210                        	longi	on
   211 00:0018: 3B           	tsc
   212 00:0019: 38           	sec
   213 00:001A: E9 00 00     	sbc	#L5
   214 00:001D: 1B           	tcs
   215 00:001E: 0B           	phd
   216 00:001F: 5B           	tcd
   217             00000004   col_0	set	4
   218                        ;	//debugf("ili9340_setFrontColor: %d\n", (long)co
                    l);
   219                        ;}; 
   220 00:0020: A5 02        	lda	<L5+2
   221 00:0022: 85 04        	sta	<L5+2+2
   222 00:0024: A5 01        	lda	<L5+1
   223 00:0026: 85 03        	sta	<L5+1+2
   224 00:0028: 2B           	pld
   225 00:0029: 3B           	tsc
   226 00:002A: 18           	clc
   227 00:002B: 69 02 00     	adc	#L5+2
   228 00:002E: 1B           	tcs
   229 00:002F: 6B           	rtl
   230             00000000   L5	equ	0
   231             00000001   L6	equ	1
   232                        	ends
   233                        	efunc
   234                        ;
   235                        ;void ili9340_fillRect(uint16_t x, uint16_t y, uin
                    t16_t w, uint16_t h, uint16_t color) {
   236                        	code
   237                        	xdef	~~ili9340_fillRect
   238                        	func
   239                        ~~ili9340_fillRect:
   240                        	longa	on
   241                        	longi	on
   242 00:0030: 3B           	tsc
   243 00:0031: 38           	sec
   244 00:0032: E9 14 00     	sbc	#L8
   245 00:0035: 1B           	tcs
   246 00:0036: 0B           	phd
   247 00:0037: 5B           	tcd
   248             00000004   x_0	set	4
   249             00000006   y_0	set	6
   250             00000008   w_0	set	8
   251             0000000A   h_0	set	10
   252             0000000C   color_0	set	12
   253                        ;	debugf("ili9340_fillRect: %d %d %d %d %d\n", (lo
                    ng)x, (long)y, (long)w, (long)h, (long)color);
   254 00:0038: A5 20        	lda	<L8+color_0
   255 00:003A: 85 01        	sta	<R0
   256 00:003C: 64 03        	stz	<R0+2
   257 00:003E: D4 03        	pei	<R0+2
  Wed Jan 19 2022 17:05                                                Page 6


   258 00:0040: D4 01        	pei	<R0
   259 00:0042: A5 1E        	lda	<L8+h_0
   260 00:0044: 85 05        	sta	<R1
   261 00:0046: 64 07        	stz	<R1+2
   262 00:0048: D4 07        	pei	<R1+2
   263 00:004A: D4 05        	pei	<R1
   264 00:004C: A5 1C        	lda	<L8+w_0
   265 00:004E: 85 09        	sta	<R2
   266 00:0050: 64 0B        	stz	<R2+2
   267 00:0052: D4 0B        	pei	<R2+2
   268 00:0054: D4 09        	pei	<R2
   269 00:0056: A5 1A        	lda	<L8+y_0
   270 00:0058: 85 0D        	sta	<R3
   271 00:005A: 64 0F        	stz	<R3+2
   272 00:005C: D4 0F        	pei	<R3+2
   273 00:005E: D4 0D        	pei	<R3
   274 00:0060: A5 18        	lda	<L8+x_0
   275 00:0062: 85 11        	sta	<17
   276 00:0064: 64 13        	stz	<17+2
   277 00:0066: D4 13        	pei	<17+2
   278 00:0068: D4 11        	pei	<17
   279 00:006A: F4 xx xx     	pea	#^L1
   280 00:006D: F4 xx xx     	pea	#<L1
   281 00:0070: F4 1A 00     	pea	#26
   282 00:0073: 22 xx xx xx  	jsl	~~debugf
   283                        ;}; 
   284 00:0077: A5 16        	lda	<L8+2
   285 00:0079: 85 20        	sta	<L8+2+10
   286 00:007B: A5 15        	lda	<L8+1
   287 00:007D: 85 1F        	sta	<L8+1+10
   288 00:007F: 2B           	pld
   289 00:0080: 3B           	tsc
   290 00:0081: 18           	clc
   291 00:0082: 69 1E 00     	adc	#L8+10
   292 00:0085: 1B           	tcs
   293 00:0086: 6B           	rtl
   294             00000014   L8	equ	20
   295             00000015   L9	equ	21
   296                        	ends
   297                        	efunc
   298                        	data
   299                        L1:
   300 00:0021: 69 6C 69 39  	db	$69,$6C,$69,$39,$33,$34,$30,$5F,$66,$69,
                    $6C,$6C,$52,$65,$63
       00:0025: 33 34 30 5F 
       00:0029: 66 69 6C 6C 
       00:002D: 52 65 63 
   301 00:0030: 74 3A 20 25  	db	$74,$3A,$20,$25,$64,$20,$25,$64,$20,$25,
                    $64,$20,$25,$64,$20
       00:0034: 64 20 25 64 
       00:0038: 20 25 64 20 
       00:003C: 25 64 20 
   302 00:003F: 25 64 0A 00  	db	$25,$64,$0A,$00
   303 00:0043:              	ends
   304                        ;
   305                        ;
   306                        ;void ili9340_setScrollStart(uint16_t start) {
   307                        	code
  Wed Jan 19 2022 17:05                                                Page 7


   308                        	xdef	~~ili9340_setScrollStart
   309                        	func
   310                        ~~ili9340_setScrollStart:
   311                        	longa	on
   312                        	longi	on
   313 00:0087: 3B           	tsc
   314 00:0088: 38           	sec
   315 00:0089: E9 04 00     	sbc	#L12
   316 00:008C: 1B           	tcs
   317 00:008D: 0B           	phd
   318 00:008E: 5B           	tcd
   319             00000004   start_0	set	4
   320                        ;	debugf("ili9340_setScrollStart: %d\n", (long)sta
                    rt);
   321 00:008F: A5 08        	lda	<L12+start_0
   322 00:0091: 85 01        	sta	<R0
   323 00:0093: 64 03        	stz	<R0+2
   324 00:0095: D4 03        	pei	<R0+2
   325 00:0097: D4 01        	pei	<R0
   326 00:0099: F4 xx xx     	pea	#^L11
   327 00:009C: F4 xx xx     	pea	#<L11
   328 00:009F: F4 0A 00     	pea	#10
   329 00:00A2: 22 xx xx xx  	jsl	~~debugf
   330                        ;}; 
   331 00:00A6: A5 06        	lda	<L12+2
   332 00:00A8: 85 08        	sta	<L12+2+2
   333 00:00AA: A5 05        	lda	<L12+1
   334 00:00AC: 85 07        	sta	<L12+1+2
   335 00:00AE: 2B           	pld
   336 00:00AF: 3B           	tsc
   337 00:00B0: 18           	clc
   338 00:00B1: 69 06 00     	adc	#L12+2
   339 00:00B4: 1B           	tcs
   340 00:00B5: 6B           	rtl
   341             00000004   L12	equ	4
   342             00000005   L13	equ	5
   343                        	ends
   344                        	efunc
   345                        	data
   346                        L11:
   347 00:0043: 69 6C 69 39  	db	$69,$6C,$69,$39,$33,$34,$30,$5F,$73,$65,
                    $74,$53,$63,$72,$6F
       00:0047: 33 34 30 5F 
       00:004B: 73 65 74 53 
       00:004F: 63 72 6F 
   348 00:0052: 6C 6C 53 74  	db	$6C,$6C,$53,$74,$61,$72,$74,$3A,$20,$25,
                    $64,$0A,$00
       00:0056: 61 72 74 3A 
       00:005A: 20 25 64 0A 
       00:005E: 00 
   349 00:005F:              	ends
   350                        ;
   351                        ;void ili9340_setScrollMargins(uint16_t top, uint1
                    6_t bottom) {
   352                        	code
   353                        	xdef	~~ili9340_setScrollMargins
   354                        	func
   355                        ~~ili9340_setScrollMargins:
  Wed Jan 19 2022 17:05                                                Page 8


   356                        	longa	on
   357                        	longi	on
   358 00:00B6: 3B           	tsc
   359 00:00B7: 38           	sec
   360 00:00B8: E9 08 00     	sbc	#L16
   361 00:00BB: 1B           	tcs
   362 00:00BC: 0B           	phd
   363 00:00BD: 5B           	tcd
   364             00000004   top_0	set	4
   365             00000006   bottom_0	set	6
   366                        ;	debugf("ili9340_setScrollMargins: %d %d\n", (lon
                    g)top, (long)bottom);
   367 00:00BE: A5 0E        	lda	<L16+bottom_0
   368 00:00C0: 85 01        	sta	<R0
   369 00:00C2: 64 03        	stz	<R0+2
   370 00:00C4: D4 03        	pei	<R0+2
   371 00:00C6: D4 01        	pei	<R0
   372 00:00C8: A5 0C        	lda	<L16+top_0
   373 00:00CA: 85 05        	sta	<R1
   374 00:00CC: 64 07        	stz	<R1+2
   375 00:00CE: D4 07        	pei	<R1+2
   376 00:00D0: D4 05        	pei	<R1
   377 00:00D2: F4 xx xx     	pea	#^L15
   378 00:00D5: F4 xx xx     	pea	#<L15
   379 00:00D8: F4 0E 00     	pea	#14
   380 00:00DB: 22 xx xx xx  	jsl	~~debugf
   381                        ;}; 
   382 00:00DF: A5 0A        	lda	<L16+2
   383 00:00E1: 85 0E        	sta	<L16+2+4
   384 00:00E3: A5 09        	lda	<L16+1
   385 00:00E5: 85 0D        	sta	<L16+1+4
   386 00:00E7: 2B           	pld
   387 00:00E8: 3B           	tsc
   388 00:00E9: 18           	clc
   389 00:00EA: 69 0C 00     	adc	#L16+4
   390 00:00ED: 1B           	tcs
   391 00:00EE: 6B           	rtl
   392             00000008   L16	equ	8
   393             00000009   L17	equ	9
   394                        	ends
   395                        	efunc
   396                        	data
   397                        L15:
   398 00:005F: 69 6C 69 39  	db	$69,$6C,$69,$39,$33,$34,$30,$5F,$73,$65,
                    $74,$53,$63,$72,$6F
       00:0063: 33 34 30 5F 
       00:0067: 73 65 74 53 
       00:006B: 63 72 6F 
   399 00:006E: 6C 6C 4D 61  	db	$6C,$6C,$4D,$61,$72,$67,$69,$6E,$73,$3A,
                    $20,$25,$64,$20,$25
       00:0072: 72 67 69 6E 
       00:0076: 73 3A 20 25 
       00:007A: 64 20 25 
   400 00:007D: 64 0A 00     	db	$64,$0A,$00
   401 00:0080:              	ends
   402                        ;
   403                        ;void ili9340_drawChar(win_t *w, uint16_t ch) {
   404                        	code
  Wed Jan 19 2022 17:05                                                Page 9


   405                        	xdef	~~ili9340_drawChar
   406                        	func
   407                        ~~ili9340_drawChar:
   408                        	longa	on
   409                        	longi	on
   410 00:00EF: 3B           	tsc
   411 00:00F0: 38           	sec
   412 00:00F1: E9 08 00     	sbc	#L20
   413 00:00F4: 1B           	tcs
   414 00:00F5: 0B           	phd
   415 00:00F6: 5B           	tcd
   416             00000004   w_0	set	4
   417             00000008   ch_0	set	8
   418                        ;	w->data[w->cursor_x + w->cursor_y * 80] = ch;
   419 00:00F7: A0 27 00     	ldy	#$27
   420 00:00FA: B7 0C        	lda	[<L20+w_0],Y
   421 00:00FC: A2 50 00     	ldx	#<$50
   422                        	xref	~~~mul
   423 00:00FF: 22 xx xx xx  	jsl	~~~mul
   424 00:0103: 18           	clc
   425 00:0104: A0 25 00     	ldy	#$25
   426 00:0107: 77 0C        	adc	[<L20+w_0],Y
   427 00:0109: 18           	clc
   428 00:010A: 69 37 00     	adc	#$37
   429 00:010D: A8           	tay
   430 00:010E: E2 20        	sep	#$20
   431                        	longa	off
   432 00:0110: A5 10        	lda	<L20+ch_0
   433 00:0112: 97 0C        	sta	[<L20+w_0],Y
   434 00:0114: C2 20        	rep	#$20
   435                        	longa	on
   436                        ;}
   437 00:0116: A5 0A        	lda	<L20+2
   438 00:0118: 85 10        	sta	<L20+2+6
   439 00:011A: A5 09        	lda	<L20+1
   440 00:011C: 85 0F        	sta	<L20+1+6
   441 00:011E: 2B           	pld
   442 00:011F: 3B           	tsc
   443 00:0120: 18           	clc
   444 00:0121: 69 0E 00     	adc	#L20+6
   445 00:0124: 1B           	tcs
   446 00:0125: 6B           	rtl
   447             00000008   L20	equ	8
   448             00000009   L21	equ	9
   449                        	ends
   450                        	efunc
   451                        ;
   452                        ;void ili9340_drawCursor(win_t *w) {
   453                        	code
   454                        	xdef	~~ili9340_drawCursor
   455                        	func
   456                        ~~ili9340_drawCursor:
   457                        	longa	on
   458                        	longi	on
   459 00:0126: 3B           	tsc
   460 00:0127: 38           	sec
   461 00:0128: E9 08 00     	sbc	#L23
   462 00:012B: 1B           	tcs
  Wed Jan 19 2022 17:05                                                Page 10


   463 00:012C: 0B           	phd
   464 00:012D: 5B           	tcd
   465             00000004   w_0	set	4
   466                        ;	w->data[w->cursor_x + w->cursor_y * 80] = '_';
   467 00:012E: A0 27 00     	ldy	#$27
   468 00:0131: B7 0C        	lda	[<L23+w_0],Y
   469 00:0133: A2 50 00     	ldx	#<$50
   470                        	xref	~~~mul
   471 00:0136: 22 xx xx xx  	jsl	~~~mul
   472 00:013A: 18           	clc
   473 00:013B: A0 25 00     	ldy	#$25
   474 00:013E: 77 0C        	adc	[<L23+w_0],Y
   475 00:0140: 18           	clc
   476 00:0141: 69 37 00     	adc	#$37
   477 00:0144: A8           	tay
   478 00:0145: E2 20        	sep	#$20
   479                        	longa	off
   480 00:0147: A9 5F        	lda	#$5f
   481 00:0149: 97 0C        	sta	[<L23+w_0],Y
   482 00:014B: C2 20        	rep	#$20
   483                        	longa	on
   484                        ;}
   485 00:014D: A5 0A        	lda	<L23+2
   486 00:014F: 85 0E        	sta	<L23+2+4
   487 00:0151: A5 09        	lda	<L23+1
   488 00:0153: 85 0D        	sta	<L23+1+4
   489 00:0155: 2B           	pld
   490 00:0156: 3B           	tsc
   491 00:0157: 18           	clc
   492 00:0158: 69 0C 00     	adc	#L23+4
   493 00:015B: 1B           	tcs
   494 00:015C: 6B           	rtl
   495             00000008   L23	equ	8
   496             00000009   L24	equ	9
   497                        	ends
   498                        	efunc
   499                        ;
   500                        ;win_t* findWindow(int fd) {
   501                        	code
   502                        	xdef	~~findWindow
   503                        	func
   504                        ~~findWindow:
   505                        	longa	on
   506                        	longi	on
   507 00:015D: 3B           	tsc
   508 00:015E: 38           	sec
   509 00:015F: E9 08 00     	sbc	#L26
   510 00:0162: 1B           	tcs
   511 00:0163: 0B           	phd
   512 00:0164: 5B           	tcd
   513             00000004   fd_0	set	4
   514                        ;	win_t *w;
   515                        ;	
   516                        ;	w = wins.anchor;
   517             00000000   w_1	set	0
   518 00:0165: AD xx xx     	lda	|~~wins
   519 00:0168: 85 05        	sta	<L27+w_1
   520 00:016A: AD xx xx     	lda	|~~wins+2
  Wed Jan 19 2022 17:05                                                Page 11


   521                        L20000:
   522 00:016D: 85 07        	sta	<L27+w_1+2
   523                        ;	while (w) {
   524 00:016F: A5 05        	lda	<L27+w_1
   525 00:0171: 05 07        	ora	<L27+w_1+2
   526 00:0173: D0 20        	bne	L20002
   527                        ;	
   528                        ;	strcpy(w->title, "Dummy");
   529 00:0175: F4 xx xx     	pea	#^L19
   530 00:0178: F4 xx xx     	pea	#<L19
   531 00:017B: A9 0B 00     	lda	#$b
   532 00:017E: 18           	clc
   533 00:017F: 65 05        	adc	<L27+w_1
   534 00:0181: 85 01        	sta	<R0
   535 00:0183: A9 00 00     	lda	#$0
   536 00:0186: 65 07        	adc	<L27+w_1+2
   537 00:0188: 48           	pha
   538 00:0189: D4 01        	pei	<R0
   539 00:018B: 22 xx xx xx  	jsl	~~strcpy
   540                        ;	
   541                        ;	return NULL;
   542 00:018F: A9 00 00     	lda	#$0
   543 00:0192: AA           	tax
   544 00:0193: 80 0D        	bra	L30
   545                        L20002:
   546                        ;		if (w->fd == fd) return w; 
   547 00:0195: A0 1B 00     	ldy	#$1b
   548 00:0198: B7 05        	lda	[<L27+w_1],Y
   549 00:019A: C5 0C        	cmp	<L26+fd_0
   550 00:019C: D0 16        	bne	L10003
   551 00:019E: A6 07        	ldx	<L27+w_1+2
   552 00:01A0: A5 05        	lda	<L27+w_1
   553                        L30:
   554 00:01A2: A8           	tay
   555 00:01A3: A5 0A        	lda	<L26+2
   556 00:01A5: 85 0C        	sta	<L26+2+2
   557 00:01A7: A5 09        	lda	<L26+1
   558 00:01A9: 85 0B        	sta	<L26+1+2
   559 00:01AB: 2B           	pld
   560 00:01AC: 3B           	tsc
   561 00:01AD: 18           	clc
   562 00:01AE: 69 0A 00     	adc	#L26+2
   563 00:01B1: 1B           	tcs
   564 00:01B2: 98           	tya
   565 00:01B3: 6B           	rtl
   566                        ;		w = w->next;
   567                        L10003:
   568 00:01B4: A0 1D 00     	ldy	#$1d
   569 00:01B7: B7 05        	lda	[<L27+w_1],Y
   570 00:01B9: 85 01        	sta	<R0
   571 00:01BB: C8           	iny
   572 00:01BC: C8           	iny
   573 00:01BD: B7 05        	lda	[<L27+w_1],Y
   574 00:01BF: 85 03        	sta	<R0+2
   575 00:01C1: A5 01        	lda	<R0
   576 00:01C3: 85 05        	sta	<L27+w_1
   577 00:01C5: A5 03        	lda	<R0+2
   578 00:01C7: 80 A4        	bra	L20000
  Wed Jan 19 2022 17:05                                                Page 12


   579                        ;	}
   580                        ;}
   581             00000008   L26	equ	8
   582             00000005   L27	equ	5
   583                        	ends
   584                        	efunc
   585                        	data
   586                        L19:
   587 00:0080: 44 75 6D 6D  	db	$44,$75,$6D,$6D,$79,$00
       00:0084: 79 00 
   588 00:0086:              	ends
   589                        ;
   590                        ;
   591                        ;void _vt100_reset(win_t *term){
   592                        	code
   593                        	xdef	~~_vt100_reset
   594                        	func
   595                        ~~_vt100_reset:
   596                        	longa	on
   597                        	longi	on
   598 00:01C9: 3B           	tsc
   599 00:01CA: 38           	sec
   600 00:01CB: E9 04 00     	sbc	#L32
   601 00:01CE: 1B           	tcs
   602 00:01CF: 0B           	phd
   603 00:01D0: 5B           	tcd
   604             00000004   term_0	set	4
   605                        ;	//term->char_height = 8;
   606                        ;	//term->char_width = 6;
   607                        ;	term->x0 = 0;
   608 00:01D1: A9 00 00     	lda	#$0
   609 00:01D4: A0 01 00     	ldy	#$1
   610 00:01D7: 97 08        	sta	[<L32+term_0],Y
   611                        ;	term->y0 = 0;
   612 00:01D9: C8           	iny
   613 00:01DA: C8           	iny
   614 00:01DB: 97 08        	sta	[<L32+term_0],Y
   615                        ;	term->width = 39;
   616 00:01DD: A9 27 00     	lda	#$27
   617 00:01E0: C8           	iny
   618 00:01E1: C8           	iny
   619 00:01E2: 97 08        	sta	[<L32+term_0],Y
   620                        ;	term->height = 19;
   621 00:01E4: A9 13 00     	lda	#$13
   622 00:01E7: C8           	iny
   623 00:01E8: C8           	iny
   624 00:01E9: 97 08        	sta	[<L32+term_0],Y
   625                        ;	term->z = 0;
   626 00:01EB: A9 00 00     	lda	#$0
   627 00:01EE: C8           	iny
   628 00:01EF: C8           	iny
   629 00:01F0: 97 08        	sta	[<L32+term_0],Y
   630                        ;	term->next = NULL;
   631 00:01F2: A0 1D 00     	ldy	#$1d
   632 00:01F5: 97 08        	sta	[<L32+term_0],Y
   633 00:01F7: C8           	iny
   634 00:01F8: C8           	iny
   635 00:01F9: 97 08        	sta	[<L32+term_0],Y
  Wed Jan 19 2022 17:05                                                Page 13


   636                        ;	term->prev = NULL;
   637 00:01FB: C8           	iny
   638 00:01FC: C8           	iny
   639 00:01FD: 97 08        	sta	[<L32+term_0],Y
   640 00:01FF: C8           	iny
   641 00:0200: C8           	iny
   642 00:0201: 97 08        	sta	[<L32+term_0],Y
   643                        ;	term->fd = wins.maxFileDesc;
   644 00:0203: AD xx xx     	lda	|~~wins+4
   645 00:0206: A0 1B 00     	ldy	#$1b
   646 00:0209: 97 08        	sta	[<L32+term_0],Y
   647                        ;	term->pdata = term->data;
   648 00:020B: A9 37 00     	lda	#$37
   649 00:020E: 18           	clc
   650 00:020F: 65 08        	adc	<L32+term_0
   651 00:0211: 85 01        	sta	<R0
   652 00:0213: A9 00 00     	lda	#$0
   653 00:0216: 65 0A        	adc	<L32+term_0+2
   654 00:0218: 85 03        	sta	<R0+2
   655 00:021A: A5 01        	lda	<R0
   656 00:021C: A0 07 08     	ldy	#$807
   657 00:021F: 97 08        	sta	[<L32+term_0],Y
   658 00:0221: A5 03        	lda	<R0+2
   659 00:0223: C8           	iny
   660 00:0224: C8           	iny
   661 00:0225: 97 08        	sta	[<L32+term_0],Y
   662                        ;	term->narg = 0;
   663 00:0227: A9 00 00     	lda	#$0
   664 00:022A: C8           	iny
   665 00:022B: C8           	iny
   666 00:022C: 97 08        	sta	[<L32+term_0],Y
   667                        ;	term->state = _st_idle;
   668 00:022E: A9 xx xx     	lda	#<~~_st_idle
   669 00:0231: A0 15 08     	ldy	#$815
   670 00:0234: 97 08        	sta	[<L32+term_0],Y
   671 00:0236: A9 xx xx     	lda	#^~~_st_idle
   672 00:0239: C8           	iny
   673 00:023A: C8           	iny
   674 00:023B: 97 08        	sta	[<L32+term_0],Y
   675                        ;	//*term->pdata = '_';
   676                        ;
   677                        ;	term->back_color = 0x0000;
   678 00:023D: A9 00 00     	lda	#$0
   679 00:0240: A0 35 00     	ldy	#$35
   680 00:0243: 97 08        	sta	[<L32+term_0],Y
   681                        ;	term->front_color = 0xffff;
   682 00:0245: A9 FF FF     	lda	#$ffff
   683 00:0248: 88           	dey
   684 00:0249: 88           	dey
   685 00:024A: 97 08        	sta	[<L32+term_0],Y
   686                        ;	term->cursor_x = term->cursor_y = term->saved_cu
                    rsor_x = term->saved_cursor_y = 0;
   687 00:024C: A9 00 00     	lda	#$0
   688 00:024F: A0 2B 00     	ldy	#$2b
   689 00:0252: 97 08        	sta	[<L32+term_0],Y
   690 00:0254: 88           	dey
   691 00:0255: 88           	dey
   692 00:0256: 97 08        	sta	[<L32+term_0],Y
  Wed Jan 19 2022 17:05                                                Page 14


   693 00:0258: 88           	dey
   694 00:0259: 88           	dey
   695 00:025A: 97 08        	sta	[<L32+term_0],Y
   696 00:025C: 88           	dey
   697 00:025D: 88           	dey
   698 00:025E: 97 08        	sta	[<L32+term_0],Y
   699                        ;	term->narg = 0;
   700 00:0260: A0 0B 08     	ldy	#$80b
   701 00:0263: 97 08        	sta	[<L32+term_0],Y
   702                        ;	term->state = _st_idle;
   703 00:0265: A9 xx xx     	lda	#<~~_st_idle
   704 00:0268: A0 15 08     	ldy	#$815
   705 00:026B: 97 08        	sta	[<L32+term_0],Y
   706 00:026D: A9 xx xx     	lda	#^~~_st_idle
   707 00:0270: C8           	iny
   708 00:0271: C8           	iny
   709 00:0272: 97 08        	sta	[<L32+term_0],Y
   710                        ;	term->ret_state = 0;
   711 00:0274: A9 00 00     	lda	#$0
   712 00:0277: A0 1D 08     	ldy	#$81d
   713 00:027A: 97 08        	sta	[<L32+term_0],Y
   714 00:027C: C8           	iny
   715 00:027D: C8           	iny
   716 00:027E: 97 08        	sta	[<L32+term_0],Y
   717                        ;	term->scroll_value = 0; 
   718 00:0280: A0 31 00     	ldy	#$31
   719 00:0283: 97 08        	sta	[<L32+term_0],Y
   720                        ;	term->scroll_start_row = 0;
   721 00:0285: A0 2D 00     	ldy	#$2d
   722 00:0288: 97 08        	sta	[<L32+term_0],Y
   723                        ;	term->scroll_end_row = VT100_HEIGHT - 1; // outs
                    ide of screen = whole screen scrollable
   724 00:028A: 18           	clc
   725 00:028B: A9 FF FF     	lda	#$ffff
   726 00:028E: A0 07 00     	ldy	#$7
   727 00:0291: 77 08        	adc	[<L32+term_0],Y
   728 00:0293: A0 2F 00     	ldy	#$2f
   729 00:0296: 97 08        	sta	[<L32+term_0],Y
   730                        ;	term->flags.f.cursor_wrap = 1;
   731 00:0298: E2 20        	sep	#$20
   732                        	longa	off
   733 00:029A: A7 08        	lda	[<L32+term_0]
   734 00:029C: 09 01        	ora	#<$1
   735                        ;	term->flags.f.origin_mode = 0; 
   736 00:029E: 29 FB        	and	#<$fffffffb
   737 00:02A0: 87 08        	sta	[<L32+term_0]
   738 00:02A2: C2 20        	rep	#$20
   739                        	longa	on
   740                        ;	
   741                        ; 	memset(term->data, ' ', 2000);
   742 00:02A4: F4 00 00     	pea	#^$7d0
   743 00:02A7: F4 D0 07     	pea	#<$7d0
   744 00:02AA: F4 20 00     	pea	#<$20
   745 00:02AD: A9 37 00     	lda	#$37
   746 00:02B0: 18           	clc
   747 00:02B1: 65 08        	adc	<L32+term_0
   748 00:02B3: 85 01        	sta	<R0
   749 00:02B5: A9 00 00     	lda	#$0
  Wed Jan 19 2022 17:05                                                Page 15


   750 00:02B8: 65 0A        	adc	<L32+term_0+2
   751 00:02BA: 48           	pha
   752 00:02BB: D4 01        	pei	<R0
   753 00:02BD: 22 xx xx xx  	jsl	~~memset
   754                        ;   
   755                        ;	ili9340_setFrontColor(term->front_color);
   756 00:02C1: A0 33 00     	ldy	#$33
   757 00:02C4: B7 08        	lda	[<L32+term_0],Y
   758 00:02C6: 48           	pha
   759 00:02C7: 22 xx xx xx  	jsl	~~ili9340_setFrontColor
   760                        ;	ili9340_setBackColor(term->back_color);
   761 00:02CB: A0 35 00     	ldy	#$35
   762 00:02CE: B7 08        	lda	[<L32+term_0],Y
   763 00:02D0: 48           	pha
   764 00:02D1: 22 xx xx xx  	jsl	~~ili9340_setBackColor
   765                        ;	ili9340_setScrollMargins(0, 0); 
   766 00:02D5: F4 00 00     	pea	#<$0
   767 00:02D8: F4 00 00     	pea	#<$0
   768 00:02DB: 22 xx xx xx  	jsl	~~ili9340_setScrollMargins
   769                        ;	ili9340_setScrollStart(0);   
   770 00:02DF: F4 00 00     	pea	#<$0
   771 00:02E2: 22 xx xx xx  	jsl	~~ili9340_setScrollStart
   772                        ;}
   773 00:02E6: A5 06        	lda	<L32+2
   774 00:02E8: 85 0A        	sta	<L32+2+4
   775 00:02EA: A5 05        	lda	<L32+1
   776 00:02EC: 85 09        	sta	<L32+1+4
   777 00:02EE: 2B           	pld
   778 00:02EF: 3B           	tsc
   779 00:02F0: 18           	clc
   780 00:02F1: 69 08 00     	adc	#L32+4
   781 00:02F4: 1B           	tcs
   782 00:02F5: 6B           	rtl
   783             00000004   L32	equ	4
   784             00000005   L33	equ	5
   785                        	ends
   786                        	efunc
   787                        ;
   788                        ;win_t* initWindow() {
   789                        	code
   790                        	xdef	~~initWindow
   791                        	func
   792                        ~~initWindow:
   793                        	longa	on
   794                        	longi	on
   795 00:02F6: 3B           	tsc
   796 00:02F7: 38           	sec
   797 00:02F8: E9 04 00     	sbc	#L35
   798 00:02FB: 1B           	tcs
   799 00:02FC: 0B           	phd
   800 00:02FD: 5B           	tcd
   801                        ;	win_t *w;
   802                        ;	
   803                        ;	w = (win_t *)malloc(sizeof(win_t));
   804             00000000   w_1	set	0
   805 00:02FE: F4 00 00     	pea	#^$821
   806 00:0301: F4 21 08     	pea	#<$821
   807 00:0304: 22 xx xx xx  	jsl	~~malloc
  Wed Jan 19 2022 17:05                                                Page 16


   808 00:0308: 85 01        	sta	<L36+w_1
   809 00:030A: 86 03        	stx	<L36+w_1+2
   810                        ;	if (!w) {
   811 00:030C: 05 03        	ora	<L36+w_1+2
   812 00:030E: D0 1B        	bne	L10004
   813                        ;		printf("can't alloc window\n");
   814 00:0310: F4 xx xx     	pea	#^L31
   815 00:0313: F4 xx xx     	pea	#<L31
   816 00:0316: F4 06 00     	pea	#6
   817 00:0319: 22 xx xx xx  	jsl	~~printf
   818                        ;		return NULL;
   819 00:031D: A9 00 00     	lda	#$0
   820 00:0320: AA           	tax
   821                        L38:
   822 00:0321: A8           	tay
   823 00:0322: 2B           	pld
   824 00:0323: 3B           	tsc
   825 00:0324: 18           	clc
   826 00:0325: 69 04 00     	adc	#L35
   827 00:0328: 1B           	tcs
   828 00:0329: 98           	tya
   829 00:032A: 6B           	rtl
   830                        ;	}
   831                        ;	
   832                        ;	_vt100_reset(w);
   833                        L10004:
   834 00:032B: D4 03        	pei	<L36+w_1+2
   835 00:032D: D4 01        	pei	<L36+w_1
   836 00:032F: 22 xx xx xx  	jsl	~~_vt100_reset
   837                        ;	wins.maxFileDesc++;
   838 00:0333: EE xx xx     	inc	|~~wins+4
   839                        ;
   840                        ;	return w;
   841 00:0336: A6 03        	ldx	<L36+w_1+2
   842 00:0338: A5 01        	lda	<L36+w_1
   843 00:033A: 80 E5        	bra	L38
   844                        ;}
   845             00000004   L35	equ	4
   846             00000001   L36	equ	1
   847                        	ends
   848                        	efunc
   849                        	data
   850                        L31:
   851 00:0086: 63 61 6E 27  	db	$63,$61,$6E,$27,$74,$20,$61,$6C,$6C,$6F,
                    $63,$20,$77,$69,$6E
       00:008A: 74 20 61 6C 
       00:008E: 6C 6F 63 20 
       00:0092: 77 69 6E 
   852 00:0095: 64 6F 77 0A  	db	$64,$6F,$77,$0A,$00
       00:0099: 00 
   853 00:009A:              	ends
   854                        ;
   855                        ;void printWindow(win_t *w) {
   856                        	code
   857                        	xdef	~~printWindow
   858                        	func
   859                        ~~printWindow:
   860                        	longa	on
  Wed Jan 19 2022 17:05                                                Page 17


   861                        	longi	on
   862 00:033C: 3B           	tsc
   863 00:033D: 38           	sec
   864 00:033E: E9 04 00     	sbc	#L40
   865 00:0341: 1B           	tcs
   866 00:0342: 0B           	phd
   867 00:0343: 5B           	tcd
   868             00000004   w_0	set	4
   869                        ;	printf("Title :%s*\n", w->title);
   870 00:0344: A9 0B 00     	lda	#$b
   871 00:0347: 18           	clc
   872 00:0348: 65 08        	adc	<L40+w_0
   873 00:034A: 85 01        	sta	<R0
   874 00:034C: A9 00 00     	lda	#$0
   875 00:034F: 65 0A        	adc	<L40+w_0+2
   876 00:0351: 48           	pha
   877 00:0352: D4 01        	pei	<R0
   878 00:0354: F4 xx xx     	pea	#^L39
   879 00:0357: F4 xx xx     	pea	#<L39
   880 00:035A: F4 0A 00     	pea	#10
   881 00:035D: 22 xx xx xx  	jsl	~~printf
   882                        ;	printf("   x0 :%d\n", w->x0);
   883 00:0361: A0 01 00     	ldy	#$1
   884 00:0364: B7 08        	lda	[<L40+w_0],Y
   885 00:0366: 48           	pha
   886 00:0367: F4 xx xx     	pea	#^L39+12
   887 00:036A: F4 xx xx     	pea	#<L39+12
   888 00:036D: F4 08 00     	pea	#8
   889 00:0370: 22 xx xx xx  	jsl	~~printf
   890                        ;	printf("   y0 :%d\n", w->y0);
   891 00:0374: A0 03 00     	ldy	#$3
   892 00:0377: B7 08        	lda	[<L40+w_0],Y
   893 00:0379: 48           	pha
   894 00:037A: F4 xx xx     	pea	#^L39+23
   895 00:037D: F4 xx xx     	pea	#<L39+23
   896 00:0380: F4 08 00     	pea	#8
   897 00:0383: 22 xx xx xx  	jsl	~~printf
   898                        ;	printf("width :%d\n", w->width);
   899 00:0387: A0 05 00     	ldy	#$5
   900 00:038A: B7 08        	lda	[<L40+w_0],Y
   901 00:038C: 48           	pha
   902 00:038D: F4 xx xx     	pea	#^L39+34
   903 00:0390: F4 xx xx     	pea	#<L39+34
   904 00:0393: F4 08 00     	pea	#8
   905 00:0396: 22 xx xx xx  	jsl	~~printf
   906                        ;	printf("height:%d\n", w->height);
   907 00:039A: A0 07 00     	ldy	#$7
   908 00:039D: B7 08        	lda	[<L40+w_0],Y
   909 00:039F: 48           	pha
   910 00:03A0: F4 xx xx     	pea	#^L39+45
   911 00:03A3: F4 xx xx     	pea	#<L39+45
   912 00:03A6: F4 08 00     	pea	#8
   913 00:03A9: 22 xx xx xx  	jsl	~~printf
   914                        ;	printf("     Z:%d\n", w->z);
   915 00:03AD: A0 09 00     	ldy	#$9
   916 00:03B0: B7 08        	lda	[<L40+w_0],Y
   917 00:03B2: 48           	pha
   918 00:03B3: F4 xx xx     	pea	#^L39+56
  Wed Jan 19 2022 17:05                                                Page 18


   919 00:03B6: F4 xx xx     	pea	#<L39+56
   920 00:03B9: F4 08 00     	pea	#8
   921 00:03BC: 22 xx xx xx  	jsl	~~printf
   922                        ;	printf("    fd:%d\n", w->fd);
   923 00:03C0: A0 1B 00     	ldy	#$1b
   924 00:03C3: B7 08        	lda	[<L40+w_0],Y
   925 00:03C5: 48           	pha
   926 00:03C6: F4 xx xx     	pea	#^L39+67
   927 00:03C9: F4 xx xx     	pea	#<L39+67
   928 00:03CC: F4 08 00     	pea	#8
   929 00:03CF: 22 xx xx xx  	jsl	~~printf
   930                        ;}
   931 00:03D3: A5 06        	lda	<L40+2
   932 00:03D5: 85 0A        	sta	<L40+2+4
   933 00:03D7: A5 05        	lda	<L40+1
   934 00:03D9: 85 09        	sta	<L40+1+4
   935 00:03DB: 2B           	pld
   936 00:03DC: 3B           	tsc
   937 00:03DD: 18           	clc
   938 00:03DE: 69 08 00     	adc	#L40+4
   939 00:03E1: 1B           	tcs
   940 00:03E2: 6B           	rtl
   941             00000004   L40	equ	4
   942             00000005   L41	equ	5
   943                        	ends
   944                        	efunc
   945                        	data
   946                        L39:
   947 00:009A: 54 69 74 6C  	db	$54,$69,$74,$6C,$65,$20,$3A,$25,$73,$2A,
                    $0A,$00,$20,$20,$20
       00:009E: 65 20 3A 25 
       00:00A2: 73 2A 0A 00 
       00:00A6: 20 20 20 
   948 00:00A9: 78 30 20 3A  	db	$78,$30,$20,$3A,$25,$64,$0A,$00,$20,$20,
                    $20,$79,$30,$20,$3A
       00:00AD: 25 64 0A 00 
       00:00B1: 20 20 20 79 
       00:00B5: 30 20 3A 
   949 00:00B8: 25 64 0A 00  	db	$25,$64,$0A,$00,$77,$69,$64,$74,$68,$20,
                    $3A,$25,$64,$0A,$00
       00:00BC: 77 69 64 74 
       00:00C0: 68 20 3A 25 
       00:00C4: 64 0A 00 
   950 00:00C7: 68 65 69 67  	db	$68,$65,$69,$67,$68,$74,$3A,$25,$64,$0A,
                    $00,$20,$20,$20,$20
       00:00CB: 68 74 3A 25 
       00:00CF: 64 0A 00 20 
       00:00D3: 20 20 20 
   951 00:00D6: 20 5A 3A 25  	db	$20,$5A,$3A,$25,$64,$0A,$00,$20,$20,$20,
                    $20,$66,$64,$3A,$25
       00:00DA: 64 0A 00 20 
       00:00DE: 20 20 20 66 
       00:00E2: 64 3A 25 
   952 00:00E5: 64 0A 00     	db	$64,$0A,$00
   953 00:00E8:              	ends
   954                        ;
   955                        ;void printWindows() {
   956                        	code
  Wed Jan 19 2022 17:05                                                Page 19


   957                        	xdef	~~printWindows
   958                        	func
   959                        ~~printWindows:
   960                        	longa	on
   961                        	longi	on
   962 00:03E3: 3B           	tsc
   963 00:03E4: 38           	sec
   964 00:03E5: E9 08 00     	sbc	#L44
   965 00:03E8: 1B           	tcs
   966 00:03E9: 0B           	phd
   967 00:03EA: 5B           	tcd
   968                        ;	win_t *w;
   969                        ;	
   970                        ;	w = wins.anchor;
   971             00000000   w_1	set	0
   972 00:03EB: AD xx xx     	lda	|~~wins
   973 00:03EE: 85 05        	sta	<L45+w_1
   974 00:03F0: AD xx xx     	lda	|~~wins+2
   975                        L20003:
   976 00:03F3: 85 07        	sta	<L45+w_1+2
   977                        ;	while (w) {
   978 00:03F5: A5 05        	lda	<L45+w_1
   979 00:03F7: 05 07        	ora	<L45+w_1+2
   980 00:03F9: D0 08        	bne	L20005
   981                        ;}
   982 00:03FB: 2B           	pld
   983 00:03FC: 3B           	tsc
   984 00:03FD: 18           	clc
   985 00:03FE: 69 08 00     	adc	#L44
   986 00:0401: 1B           	tcs
   987 00:0402: 6B           	rtl
   988                        L20005:
   989                        ;		printWindow(w);
   990 00:0403: D4 07        	pei	<L45+w_1+2
   991 00:0405: D4 05        	pei	<L45+w_1
   992 00:0407: 22 xx xx xx  	jsl	~~printWindow
   993                        ;		w = w->next;
   994 00:040B: A0 1D 00     	ldy	#$1d
   995 00:040E: B7 05        	lda	[<L45+w_1],Y
   996 00:0410: 85 01        	sta	<R0
   997 00:0412: C8           	iny
   998 00:0413: C8           	iny
   999 00:0414: B7 05        	lda	[<L45+w_1],Y
  1000 00:0416: 85 03        	sta	<R0+2
  1001 00:0418: A5 01        	lda	<R0
  1002 00:041A: 85 05        	sta	<L45+w_1
  1003 00:041C: A5 03        	lda	<R0+2
  1004 00:041E: 80 D3        	bra	L20003
  1005                        ;	}
  1006             00000008   L44	equ	8
  1007             00000005   L45	equ	5
  1008                        	ends
  1009                        	efunc
  1010                        ;
  1011                        ;void foregroundWindow(win_t *fg) {
  1012                        	code
  1013                        	xdef	~~foregroundWindow
  1014                        	func
  Wed Jan 19 2022 17:05                                                Page 20


  1015                        ~~foregroundWindow:
  1016                        	longa	on
  1017                        	longi	on
  1018 00:0420: 3B           	tsc
  1019 00:0421: 38           	sec
  1020 00:0422: E9 08 00     	sbc	#L48
  1021 00:0425: 1B           	tcs
  1022 00:0426: 0B           	phd
  1023 00:0427: 5B           	tcd
  1024             00000004   fg_0	set	4
  1025                        ;	win_t *w;
  1026                        ;	
  1027                        ;	w = findWindow(fg->fd);
  1028             00000000   w_1	set	0
  1029 00:0428: A0 1B 00     	ldy	#$1b
  1030 00:042B: B7 0C        	lda	[<L48+fg_0],Y
  1031 00:042D: 48           	pha
  1032 00:042E: 22 xx xx xx  	jsl	~~findWindow
  1033 00:0432: 85 05        	sta	<L49+w_1
  1034 00:0434: 86 07        	stx	<L49+w_1+2
  1035                        ;	if (!w) return;
  1036 00:0436: 05 07        	ora	<L49+w_1+2
  1037 00:0438: D0 10        	bne	L10007
  1038                        L51:
  1039 00:043A: A5 0A        	lda	<L48+2
  1040 00:043C: 85 0E        	sta	<L48+2+4
  1041 00:043E: A5 09        	lda	<L48+1
  1042 00:0440: 85 0D        	sta	<L48+1+4
  1043 00:0442: 2B           	pld
  1044 00:0443: 3B           	tsc
  1045 00:0444: 18           	clc
  1046 00:0445: 69 0C 00     	adc	#L48+4
  1047 00:0448: 1B           	tcs
  1048 00:0449: 6B           	rtl
  1049                        ;	
  1050                        ;	w = wins.anchor;
  1051                        L10007:
  1052 00:044A: AD xx xx     	lda	|~~wins
  1053 00:044D: 85 05        	sta	<L49+w_1
  1054 00:044F: AD xx xx     	lda	|~~wins+2
  1055                        L20007:
  1056 00:0452: 85 07        	sta	<L49+w_1+2
  1057                        ;	while (w) {
  1058 00:0454: A5 05        	lda	<L49+w_1
  1059 00:0456: 05 07        	ora	<L49+w_1+2
  1060 00:0458: F0 E0        	beq	L51
  1061                        ;
  1062                        ;}
  1063                        ;		if (w->fd == fg->fd)
  1064                        ;			w->z = 0; 
  1065 00:045A: A0 1B 00     	ldy	#$1b
  1066 00:045D: B7 05        	lda	[<L49+w_1],Y
  1067 00:045F: D7 0C        	cmp	[<L48+fg_0],Y
  1068 00:0461: D0 05        	bne	L10010
  1069 00:0463: A9 00 00     	lda	#$0
  1070 00:0466: 80 06        	bra	L20010
  1071                        ;		else
  1072                        L10010:
  Wed Jan 19 2022 17:05                                                Page 21


  1073                        ;			w->z++;
  1074 00:0468: A0 09 00     	ldy	#$9
  1075 00:046B: B7 05        	lda	[<L49+w_1],Y
  1076 00:046D: 1A           	ina
  1077                        L20010:
  1078 00:046E: A0 09 00     	ldy	#$9
  1079 00:0471: 97 05        	sta	[<L49+w_1],Y
  1080                        ;
  1081                        ;		w = w->next;
  1082 00:0473: A0 1D 00     	ldy	#$1d
  1083 00:0476: B7 05        	lda	[<L49+w_1],Y
  1084 00:0478: 85 01        	sta	<R0
  1085 00:047A: C8           	iny
  1086 00:047B: C8           	iny
  1087 00:047C: B7 05        	lda	[<L49+w_1],Y
  1088 00:047E: 85 03        	sta	<R0+2
  1089 00:0480: A5 01        	lda	<R0
  1090 00:0482: 85 05        	sta	<L49+w_1
  1091 00:0484: A5 03        	lda	<R0+2
  1092 00:0486: 80 CA        	bra	L20007
  1093                        ;	}
  1094             00000008   L48	equ	8
  1095             00000005   L49	equ	5
  1096                        	ends
  1097                        	efunc
  1098                        ;
  1099                        ;void addWindow(win_t *w) {
  1100                        	code
  1101                        	xdef	~~addWindow
  1102                        	func
  1103                        ~~addWindow:
  1104                        	longa	on
  1105                        	longi	on
  1106 00:0488: 3B           	tsc
  1107 00:0489: 38           	sec
  1108 00:048A: E9 04 00     	sbc	#L54
  1109 00:048D: 1B           	tcs
  1110 00:048E: 0B           	phd
  1111 00:048F: 5B           	tcd
  1112             00000004   w_0	set	4
  1113                        ;	if (wins.anchor != NULL) {
  1114 00:0490: AD xx xx     	lda	|~~wins
  1115 00:0493: 0D xx xx     	ora	|~~wins+2
  1116 00:0496: F0 25        	beq	L10012
  1117                        ;		w->next = wins.anchor;
  1118 00:0498: AD xx xx     	lda	|~~wins
  1119 00:049B: A0 1D 00     	ldy	#$1d
  1120 00:049E: 97 08        	sta	[<L54+w_0],Y
  1121 00:04A0: AD xx xx     	lda	|~~wins+2
  1122 00:04A3: C8           	iny
  1123 00:04A4: C8           	iny
  1124 00:04A5: 97 08        	sta	[<L54+w_0],Y
  1125                        ;		wins.anchor->prev = w;
  1126 00:04A7: AD xx xx     	lda	|~~wins
  1127 00:04AA: 85 01        	sta	<R0
  1128 00:04AC: AD xx xx     	lda	|~~wins+2
  1129 00:04AF: 85 03        	sta	<R0+2
  1130 00:04B1: A5 08        	lda	<L54+w_0
  Wed Jan 19 2022 17:05                                                Page 22


  1131 00:04B3: C8           	iny
  1132 00:04B4: C8           	iny
  1133 00:04B5: 97 01        	sta	[<R0],Y
  1134 00:04B7: A5 0A        	lda	<L54+w_0+2
  1135 00:04B9: C8           	iny
  1136 00:04BA: C8           	iny
  1137 00:04BB: 97 01        	sta	[<R0],Y
  1138                        ;	}
  1139                        ;	wins.anchor = w;
  1140                        L10012:
  1141 00:04BD: A5 08        	lda	<L54+w_0
  1142 00:04BF: 8D xx xx     	sta	|~~wins
  1143 00:04C2: A5 0A        	lda	<L54+w_0+2
  1144 00:04C4: 8D xx xx     	sta	|~~wins+2
  1145                        ;}
  1146 00:04C7: A5 06        	lda	<L54+2
  1147 00:04C9: 85 0A        	sta	<L54+2+4
  1148 00:04CB: A5 05        	lda	<L54+1
  1149 00:04CD: 85 09        	sta	<L54+1+4
  1150 00:04CF: 2B           	pld
  1151 00:04D0: 3B           	tsc
  1152 00:04D1: 18           	clc
  1153 00:04D2: 69 08 00     	adc	#L54+4
  1154 00:04D5: 1B           	tcs
  1155 00:04D6: 6B           	rtl
  1156             00000004   L54	equ	4
  1157             00000005   L55	equ	5
  1158                        	ends
  1159                        	efunc
  1160                        ;
  1161                        ;void clearWindow(win_t *w) {
  1162                        	code
  1163                        	xdef	~~clearWindow
  1164                        	func
  1165                        ~~clearWindow:
  1166                        	longa	on
  1167                        	longi	on
  1168 00:04D7: 3B           	tsc
  1169 00:04D8: 38           	sec
  1170 00:04D9: E9 12 00     	sbc	#L58
  1171 00:04DC: 1B           	tcs
  1172 00:04DD: 0B           	phd
  1173 00:04DE: 5B           	tcd
  1174             00000004   w_0	set	4
  1175                        ;	uint16_t y;
  1176                        ;	char *p;
  1177                        ;	
  1178                        ;	for (y = w->y0; y <= w->height + w->y0 + 1; y++)
                     {
  1179             00000000   y_1	set	0
  1180             00000002   p_1	set	2
  1181 00:04DF: A0 03 00     	ldy	#$3
  1182 00:04E2: B7 16        	lda	[<L58+w_0],Y
  1183 00:04E4: 85 0D        	sta	<L59+y_1
  1184 00:04E6: 80 50        	bra	L10016
  1185                        L10015:
  1186                        ;		p = SCREEN + 80 * y + w->x0;
  1187 00:04E8: A0 01 00     	ldy	#$1
  Wed Jan 19 2022 17:05                                                Page 23


  1188 00:04EB: B7 16        	lda	[<L58+w_0],Y
  1189 00:04ED: 85 01        	sta	<R0
  1190 00:04EF: 64 03        	stz	<R0+2
  1191 00:04F1: A5 0D        	lda	<L59+y_1
  1192 00:04F3: A2 50 00     	ldx	#<$50
  1193                        	xref	~~~mul
  1194 00:04F6: 22 xx xx xx  	jsl	~~~mul
  1195 00:04FA: 85 05        	sta	<R1
  1196 00:04FC: 64 07        	stz	<R1+2
  1197 00:04FE: A5 05        	lda	<R1
  1198 00:0500: 18           	clc
  1199 00:0501: 65 01        	adc	<R0
  1200 00:0503: 85 09        	sta	<R2
  1201 00:0505: A5 07        	lda	<R1+2
  1202 00:0507: 65 03        	adc	<R0+2
  1203 00:0509: 85 0B        	sta	<R2+2
  1204 00:050B: A9 00 F0     	lda	#$f000
  1205 00:050E: 18           	clc
  1206 00:050F: 65 09        	adc	<R2
  1207 00:0511: 85 0F        	sta	<L59+p_1
  1208 00:0513: A9 7F 00     	lda	#$7f
  1209 00:0516: 65 0B        	adc	<R2+2
  1210 00:0518: 85 11        	sta	<L59+p_1+2
  1211                        ;		memset(p, ' ', w->width + 2);
  1212 00:051A: 18           	clc
  1213 00:051B: A9 02 00     	lda	#$2
  1214 00:051E: A0 05 00     	ldy	#$5
  1215 00:0521: 77 16        	adc	[<L58+w_0],Y
  1216 00:0523: 85 01        	sta	<R0
  1217 00:0525: 64 03        	stz	<R0+2
  1218 00:0527: D4 03        	pei	<R0+2
  1219 00:0529: D4 01        	pei	<R0
  1220 00:052B: F4 20 00     	pea	#<$20
  1221 00:052E: D4 11        	pei	<L59+p_1+2
  1222 00:0530: D4 0F        	pei	<L59+p_1
  1223 00:0532: 22 xx xx xx  	jsl	~~memset
  1224                        ;	}
  1225 00:0536: E6 0D        	inc	<L59+y_1
  1226                        L10016:
  1227 00:0538: 18           	clc
  1228 00:0539: A0 07 00     	ldy	#$7
  1229 00:053C: B7 16        	lda	[<L58+w_0],Y
  1230 00:053E: A0 03 00     	ldy	#$3
  1231 00:0541: 77 16        	adc	[<L58+w_0],Y
  1232 00:0543: 1A           	ina
  1233 00:0544: C5 0D        	cmp	<L59+y_1
  1234 00:0546: B0 A0        	bcs	L10015
  1235                        ;	
  1236                        ;}
  1237 00:0548: A5 14        	lda	<L58+2
  1238 00:054A: 85 18        	sta	<L58+2+4
  1239 00:054C: A5 13        	lda	<L58+1
  1240 00:054E: 85 17        	sta	<L58+1+4
  1241 00:0550: 2B           	pld
  1242 00:0551: 3B           	tsc
  1243 00:0552: 18           	clc
  1244 00:0553: 69 16 00     	adc	#L58+4
  1245 00:0556: 1B           	tcs
  Wed Jan 19 2022 17:05                                                Page 24


  1246 00:0557: 6B           	rtl
  1247             00000012   L58	equ	18
  1248             0000000D   L59	equ	13
  1249                        	ends
  1250                        	efunc
  1251                        ;
  1252                        ;void drawWindow(win_t *w) {
  1253                        	code
  1254                        	xdef	~~drawWindow
  1255                        	func
  1256                        ~~drawWindow:
  1257                        	longa	on
  1258                        	longi	on
  1259 00:0558: 3B           	tsc
  1260 00:0559: 38           	sec
  1261 00:055A: E9 1D 00     	sbc	#L62
  1262 00:055D: 1B           	tcs
  1263 00:055E: 0B           	phd
  1264 00:055F: 5B           	tcd
  1265             00000004   w_0	set	4
  1266                        ;	uint16_t i, k;
  1267                        ;	uint16_t tlen;
  1268                        ;	uint16_t tmax;
  1269                        ;	char *p, c;
  1270                        ;	
  1271                        ;	tlen = strlen(w->title);
  1272             00000000   i_1	set	0
  1273             00000002   k_1	set	2
  1274             00000004   tlen_1	set	4
  1275             00000006   tmax_1	set	6
  1276             00000008   p_1	set	8
  1277             0000000C   c_1	set	12
  1278 00:0560: A9 0B 00     	lda	#$b
  1279 00:0563: 18           	clc
  1280 00:0564: 65 21        	adc	<L62+w_0
  1281 00:0566: 85 01        	sta	<R0
  1282 00:0568: A9 00 00     	lda	#$0
  1283 00:056B: 65 23        	adc	<L62+w_0+2
  1284 00:056D: 85 03        	sta	<R0+2
  1285 00:056F: 48           	pha
  1286 00:0570: D4 01        	pei	<R0
  1287 00:0572: 22 xx xx xx  	jsl	~~strlen
  1288 00:0576: 85 15        	sta	<L63+tlen_1
  1289                        ;	tmax = w->width - 6;
  1290 00:0578: 18           	clc
  1291 00:0579: A9 FA FF     	lda	#$fffa
  1292 00:057C: A0 05 00     	ldy	#$5
  1293 00:057F: 77 21        	adc	[<L62+w_0],Y
  1294 00:0581: 85 17        	sta	<L63+tmax_1
  1295                        ;	
  1296                        ;	p = SCREEN + 80 * w->y0 + w->x0;
  1297 00:0583: A0 01 00     	ldy	#$1
  1298 00:0586: B7 21        	lda	[<L62+w_0],Y
  1299 00:0588: 85 01        	sta	<R0
  1300 00:058A: 64 03        	stz	<R0+2
  1301 00:058C: C8           	iny
  1302 00:058D: C8           	iny
  1303 00:058E: B7 21        	lda	[<L62+w_0],Y
  Wed Jan 19 2022 17:05                                                Page 25


  1304 00:0590: A2 50 00     	ldx	#<$50
  1305                        	xref	~~~mul
  1306 00:0593: 22 xx xx xx  	jsl	~~~mul
  1307 00:0597: 85 05        	sta	<R1
  1308 00:0599: 64 07        	stz	<R1+2
  1309 00:059B: A5 05        	lda	<R1
  1310 00:059D: 18           	clc
  1311 00:059E: 65 01        	adc	<R0
  1312 00:05A0: 85 09        	sta	<R2
  1313 00:05A2: A5 07        	lda	<R1+2
  1314 00:05A4: 65 03        	adc	<R0+2
  1315 00:05A6: 85 0B        	sta	<R2+2
  1316 00:05A8: A9 00 F0     	lda	#$f000
  1317 00:05AB: 18           	clc
  1318 00:05AC: 65 09        	adc	<R2
  1319 00:05AE: 85 19        	sta	<L63+p_1
  1320 00:05B0: A9 7F 00     	lda	#$7f
  1321 00:05B3: 65 0B        	adc	<R2+2
  1322 00:05B5: 85 1B        	sta	<L63+p_1+2
  1323                        ;	
  1324                        ;	if (tlen > tmax) tlen = tmax;
  1325 00:05B7: A5 17        	lda	<L63+tmax_1
  1326 00:05B9: C5 15        	cmp	<L63+tlen_1
  1327 00:05BB: B0 04        	bcs	L10017
  1328 00:05BD: A5 17        	lda	<L63+tmax_1
  1329 00:05BF: 85 15        	sta	<L63+tlen_1
  1330                        ;	
  1331                        ;
  1332                        ;	/*	185:	186:	187:	188:	200:
  1333                        ;		201:	202:	203:	204:	205:	
                    206:	*/
  1334                        ;
  1335                        ;	for (i = 0, k = 0; i <= w->width+1; i++) {
  1336                        L10017:
  1337 00:05C1: 64 11        	stz	<L63+i_1
  1338 00:05C3: 64 13        	stz	<L63+k_1
  1339 00:05C5: 82 D1 00     	brl	L10021
  1340                        L10020:
  1341                        ;		if (i == 0) c = 201;
  1342 00:05C8: A5 11        	lda	<L63+i_1
  1343 00:05CA: D0 08        	bne	L10022
  1344 00:05CC: E2 20        	sep	#$20
  1345                        	longa	off
  1346 00:05CE: A9 C9        	lda	#$c9
  1347 00:05D0: 85 1D        	sta	<L63+c_1
  1348 00:05D2: C2 20        	rep	#$20
  1349                        	longa	on
  1350                        ;		if (i > 0) c = 205;
  1351                        L10022:
  1352 00:05D4: A9 00 00     	lda	#$0
  1353 00:05D7: C5 11        	cmp	<L63+i_1
  1354 00:05D9: B0 08        	bcs	L10023
  1355 00:05DB: E2 20        	sep	#$20
  1356                        	longa	off
  1357 00:05DD: A9 CD        	lda	#$cd
  1358 00:05DF: 85 1D        	sta	<L63+c_1
  1359 00:05E1: C2 20        	rep	#$20
  1360                        	longa	on
  Wed Jan 19 2022 17:05                                                Page 26


  1361                        ;		if (i > 2 && k < tlen) {
  1362                        L10023:
  1363 00:05E3: A9 02 00     	lda	#$2
  1364 00:05E6: C5 11        	cmp	<L63+i_1
  1365 00:05E8: B0 17        	bcs	L10024
  1366 00:05EA: A5 13        	lda	<L63+k_1
  1367 00:05EC: C5 15        	cmp	<L63+tlen_1
  1368 00:05EE: B0 11        	bcs	L10024
  1369                        ;			c = w->title[k];
  1370 00:05F0: A9 0B 00     	lda	#$b
  1371 00:05F3: 18           	clc
  1372 00:05F4: 65 13        	adc	<L63+k_1
  1373 00:05F6: A8           	tay
  1374 00:05F7: E2 20        	sep	#$20
  1375                        	longa	off
  1376 00:05F9: B7 21        	lda	[<L62+w_0],Y
  1377 00:05FB: 85 1D        	sta	<L63+c_1
  1378 00:05FD: C2 20        	rep	#$20
  1379                        	longa	on
  1380                        ;			k++;
  1381 00:05FF: E6 13        	inc	<L63+k_1
  1382                        ;		}			
  1383                        ;		if (i == w->width - 5) c = '[';
  1384                        L10024:
  1385 00:0601: 18           	clc
  1386 00:0602: A9 FB FF     	lda	#$fffb
  1387 00:0605: A0 05 00     	ldy	#$5
  1388 00:0608: 77 21        	adc	[<L62+w_0],Y
  1389 00:060A: C5 11        	cmp	<L63+i_1
  1390 00:060C: D0 08        	bne	L10025
  1391 00:060E: E2 20        	sep	#$20
  1392                        	longa	off
  1393 00:0610: A9 5B        	lda	#$5b
  1394 00:0612: 85 1D        	sta	<L63+c_1
  1395 00:0614: C2 20        	rep	#$20
  1396                        	longa	on
  1397                        ;		if (i == w->width - 4) c = '_';
  1398                        L10025:
  1399 00:0616: 18           	clc
  1400 00:0617: A9 FC FF     	lda	#$fffc
  1401 00:061A: A0 05 00     	ldy	#$5
  1402 00:061D: 77 21        	adc	[<L62+w_0],Y
  1403 00:061F: C5 11        	cmp	<L63+i_1
  1404 00:0621: D0 08        	bne	L10026
  1405 00:0623: E2 20        	sep	#$20
  1406                        	longa	off
  1407 00:0625: A9 5F        	lda	#$5f
  1408 00:0627: 85 1D        	sta	<L63+c_1
  1409 00:0629: C2 20        	rep	#$20
  1410                        	longa	on
  1411                        ;		if (i == w->width - 3) c = '-';
  1412                        L10026:
  1413 00:062B: 18           	clc
  1414 00:062C: A9 FD FF     	lda	#$fffd
  1415 00:062F: A0 05 00     	ldy	#$5
  1416 00:0632: 77 21        	adc	[<L62+w_0],Y
  1417 00:0634: C5 11        	cmp	<L63+i_1
  1418 00:0636: D0 08        	bne	L10027
  Wed Jan 19 2022 17:05                                                Page 27


  1419 00:0638: E2 20        	sep	#$20
  1420                        	longa	off
  1421 00:063A: A9 2D        	lda	#$2d
  1422 00:063C: 85 1D        	sta	<L63+c_1
  1423 00:063E: C2 20        	rep	#$20
  1424                        	longa	on
  1425                        ;		if (i == w->width - 2) c = 'X';
  1426                        L10027:
  1427 00:0640: 18           	clc
  1428 00:0641: A9 FE FF     	lda	#$fffe
  1429 00:0644: A0 05 00     	ldy	#$5
  1430 00:0647: 77 21        	adc	[<L62+w_0],Y
  1431 00:0649: C5 11        	cmp	<L63+i_1
  1432 00:064B: D0 08        	bne	L10028
  1433 00:064D: E2 20        	sep	#$20
  1434                        	longa	off
  1435 00:064F: A9 58        	lda	#$58
  1436 00:0651: 85 1D        	sta	<L63+c_1
  1437 00:0653: C2 20        	rep	#$20
  1438                        	longa	on
  1439                        ;		if (i == w->width - 1) c = ']';
  1440                        L10028:
  1441 00:0655: 18           	clc
  1442 00:0656: A9 FF FF     	lda	#$ffff
  1443 00:0659: A0 05 00     	ldy	#$5
  1444 00:065C: 77 21        	adc	[<L62+w_0],Y
  1445 00:065E: C5 11        	cmp	<L63+i_1
  1446 00:0660: D0 08        	bne	L10029
  1447 00:0662: E2 20        	sep	#$20
  1448                        	longa	off
  1449 00:0664: A9 5D        	lda	#$5d
  1450 00:0666: 85 1D        	sta	<L63+c_1
  1451 00:0668: C2 20        	rep	#$20
  1452                        	longa	on
  1453                        ;//		if (i == w->width - 0) c = 205;
  1454                        ;		if (i == w->width + 1) c = 187;
  1455                        L10029:
  1456 00:066A: A0 05 00     	ldy	#$5
  1457 00:066D: B7 21        	lda	[<L62+w_0],Y
  1458 00:066F: 1A           	ina
  1459 00:0670: C5 11        	cmp	<L63+i_1
  1460 00:0672: D0 08        	bne	L10030
  1461 00:0674: E2 20        	sep	#$20
  1462                        	longa	off
  1463 00:0676: A9 BB        	lda	#$bb
  1464 00:0678: 85 1D        	sta	<L63+c_1
  1465 00:067A: C2 20        	rep	#$20
  1466                        	longa	on
  1467                        ;
  1468                        ;		if (w->x0 + i < 80) {
  1469                        L10030:
  1470 00:067C: 18           	clc
  1471 00:067D: A0 01 00     	ldy	#$1
  1472 00:0680: B7 21        	lda	[<L62+w_0],Y
  1473 00:0682: 65 11        	adc	<L63+i_1
  1474 00:0684: C9 50 00     	cmp	#<$50
  1475 00:0687: B0 0E        	bcs	L10018
  1476                        ;			*p = c;
  Wed Jan 19 2022 17:05                                                Page 28


  1477 00:0689: E2 20        	sep	#$20
  1478                        	longa	off
  1479 00:068B: A5 1D        	lda	<L63+c_1
  1480 00:068D: 87 19        	sta	[<L63+p_1]
  1481 00:068F: C2 20        	rep	#$20
  1482                        	longa	on
  1483                        ;			p++;
  1484 00:0691: E6 19        	inc	<L63+p_1
  1485 00:0693: D0 02        	bne	L10018
  1486 00:0695: E6 1B        	inc	<L63+p_1+2
  1487                        ;		}
  1488                        ;	}
  1489                        L10018:
  1490 00:0697: E6 11        	inc	<L63+i_1
  1491                        L10021:
  1492 00:0699: A0 05 00     	ldy	#$5
  1493 00:069C: B7 21        	lda	[<L62+w_0],Y
  1494 00:069E: 1A           	ina
  1495 00:069F: C5 11        	cmp	<L63+i_1
  1496 00:06A1: 90 03        	bcc	*+5
  1497 00:06A3: 82 22 FF     	brl	L10020
  1498                        ;	
  1499                        ;	for (i = 1; i <= w->height; i++) {
  1500 00:06A6: A9 01 00     	lda	#$1
  1501 00:06A9: 85 11        	sta	<L63+i_1
  1502 00:06AB: 82 AF 00     	brl	L10035
  1503                        L10034:
  1504                        ;		p = SCREEN + 80 * (w->y0 + i) + w->x0;
  1505 00:06AE: A0 01 00     	ldy	#$1
  1506 00:06B1: B7 21        	lda	[<L62+w_0],Y
  1507 00:06B3: 85 01        	sta	<R0
  1508 00:06B5: 64 03        	stz	<R0+2
  1509 00:06B7: 18           	clc
  1510 00:06B8: C8           	iny
  1511 00:06B9: C8           	iny
  1512 00:06BA: B7 21        	lda	[<L62+w_0],Y
  1513 00:06BC: 65 11        	adc	<L63+i_1
  1514 00:06BE: A2 50 00     	ldx	#<$50
  1515                        	xref	~~~mul
  1516 00:06C1: 22 xx xx xx  	jsl	~~~mul
  1517 00:06C5: 85 05        	sta	<R1
  1518 00:06C7: 64 07        	stz	<R1+2
  1519 00:06C9: A5 05        	lda	<R1
  1520 00:06CB: 18           	clc
  1521 00:06CC: 65 01        	adc	<R0
  1522 00:06CE: 85 09        	sta	<R2
  1523 00:06D0: A5 07        	lda	<R1+2
  1524 00:06D2: 65 03        	adc	<R0+2
  1525 00:06D4: 85 0B        	sta	<R2+2
  1526 00:06D6: A9 00 F0     	lda	#$f000
  1527 00:06D9: 18           	clc
  1528 00:06DA: 65 09        	adc	<R2
  1529 00:06DC: 85 19        	sta	<L63+p_1
  1530 00:06DE: A9 7F 00     	lda	#$7f
  1531 00:06E1: 65 0B        	adc	<R2+2
  1532 00:06E3: 85 1B        	sta	<L63+p_1+2
  1533                        ;		memcpy(p+1, w->data + 80 * (i-1), w->wid
                    th);
  Wed Jan 19 2022 17:05                                                Page 29


  1534 00:06E5: A0 05 00     	ldy	#$5
  1535 00:06E8: B7 21        	lda	[<L62+w_0],Y
  1536 00:06EA: 85 01        	sta	<R0
  1537 00:06EC: 64 03        	stz	<R0+2
  1538 00:06EE: D4 03        	pei	<R0+2
  1539 00:06F0: D4 01        	pei	<R0
  1540 00:06F2: A5 11        	lda	<L63+i_1
  1541 00:06F4: A2 50 00     	ldx	#<$50
  1542                        	xref	~~~mul
  1543 00:06F7: 22 xx xx xx  	jsl	~~~mul
  1544 00:06FB: 18           	clc
  1545 00:06FC: 69 B0 FF     	adc	#$ffb0
  1546 00:06FF: 85 05        	sta	<R1
  1547 00:0701: 64 07        	stz	<R1+2
  1548 00:0703: A9 37 00     	lda	#$37
  1549 00:0706: 18           	clc
  1550 00:0707: 65 05        	adc	<R1
  1551 00:0709: 85 09        	sta	<R2
  1552 00:070B: A9 00 00     	lda	#$0
  1553 00:070E: 65 07        	adc	<R1+2
  1554 00:0710: 85 0B        	sta	<R2+2
  1555 00:0712: A5 21        	lda	<L62+w_0
  1556 00:0714: 18           	clc
  1557 00:0715: 65 09        	adc	<R2
  1558 00:0717: 85 05        	sta	<R1
  1559 00:0719: A5 23        	lda	<L62+w_0+2
  1560 00:071B: 65 0B        	adc	<R2+2
  1561 00:071D: 48           	pha
  1562 00:071E: D4 05        	pei	<R1
  1563 00:0720: A9 01 00     	lda	#$1
  1564 00:0723: 18           	clc
  1565 00:0724: 65 19        	adc	<L63+p_1
  1566 00:0726: 85 0D        	sta	<R3
  1567 00:0728: A9 00 00     	lda	#$0
  1568 00:072B: 65 1B        	adc	<L63+p_1+2
  1569 00:072D: 48           	pha
  1570 00:072E: D4 0D        	pei	<R3
  1571 00:0730: 22 xx xx xx  	jsl	~~memcpy
  1572                        ;		*p = 186;
  1573 00:0734: E2 20        	sep	#$20
  1574                        	longa	off
  1575 00:0736: A9 BA        	lda	#$ba
  1576 00:0738: 87 19        	sta	[<L63+p_1]
  1577 00:073A: C2 20        	rep	#$20
  1578                        	longa	on
  1579                        ;		p += w->width + 1;
  1580 00:073C: A0 05 00     	ldy	#$5
  1581 00:073F: B7 21        	lda	[<L62+w_0],Y
  1582 00:0741: 1A           	ina
  1583 00:0742: 85 01        	sta	<R0
  1584 00:0744: 64 03        	stz	<R0+2
  1585 00:0746: A5 19        	lda	<L63+p_1
  1586 00:0748: 18           	clc
  1587 00:0749: 65 01        	adc	<R0
  1588 00:074B: 85 19        	sta	<L63+p_1
  1589 00:074D: A5 1B        	lda	<L63+p_1+2
  1590 00:074F: 65 03        	adc	<R0+2
  1591 00:0751: 85 1B        	sta	<L63+p_1+2
  Wed Jan 19 2022 17:05                                                Page 30


  1592                        ;		*p = 186;
  1593 00:0753: E2 20        	sep	#$20
  1594                        	longa	off
  1595 00:0755: A9 BA        	lda	#$ba
  1596 00:0757: 87 19        	sta	[<L63+p_1]
  1597 00:0759: C2 20        	rep	#$20
  1598                        	longa	on
  1599                        ;	}
  1600 00:075B: E6 11        	inc	<L63+i_1
  1601                        L10035:
  1602 00:075D: A0 07 00     	ldy	#$7
  1603 00:0760: B7 21        	lda	[<L62+w_0],Y
  1604 00:0762: C5 11        	cmp	<L63+i_1
  1605 00:0764: 90 03        	bcc	*+5
  1606 00:0766: 82 45 FF     	brl	L10034
  1607                        ;	
  1608                        ;	p = SCREEN + 80 * (w->y0 + w->height + 1) + w->x
                    0;
  1609 00:0769: A0 01 00     	ldy	#$1
  1610 00:076C: B7 21        	lda	[<L62+w_0],Y
  1611 00:076E: 85 01        	sta	<R0
  1612 00:0770: 64 03        	stz	<R0+2
  1613 00:0772: 18           	clc
  1614 00:0773: C8           	iny
  1615 00:0774: C8           	iny
  1616 00:0775: B7 21        	lda	[<L62+w_0],Y
  1617 00:0777: A0 07 00     	ldy	#$7
  1618 00:077A: 77 21        	adc	[<L62+w_0],Y
  1619 00:077C: A2 50 00     	ldx	#<$50
  1620                        	xref	~~~mul
  1621 00:077F: 22 xx xx xx  	jsl	~~~mul
  1622 00:0783: 18           	clc
  1623 00:0784: 69 50 00     	adc	#$50
  1624 00:0787: 85 05        	sta	<R1
  1625 00:0789: 64 07        	stz	<R1+2
  1626 00:078B: A5 05        	lda	<R1
  1627 00:078D: 18           	clc
  1628 00:078E: 65 01        	adc	<R0
  1629 00:0790: 85 09        	sta	<R2
  1630 00:0792: A5 07        	lda	<R1+2
  1631 00:0794: 65 03        	adc	<R0+2
  1632 00:0796: 85 0B        	sta	<R2+2
  1633 00:0798: A9 00 F0     	lda	#$f000
  1634 00:079B: 18           	clc
  1635 00:079C: 65 09        	adc	<R2
  1636 00:079E: 85 19        	sta	<L63+p_1
  1637 00:07A0: A9 7F 00     	lda	#$7f
  1638 00:07A3: 65 0B        	adc	<R2+2
  1639 00:07A5: 85 1B        	sta	<L63+p_1+2
  1640                        ;
  1641                        ;	for (i = 0, k = 0; i <= w->width+1; i++) {
  1642 00:07A7: 64 11        	stz	<L63+i_1
  1643 00:07A9: 64 13        	stz	<L63+k_1
  1644 00:07AB: 80 3D        	bra	L10039
  1645                        L10038:
  1646                        ;		if (i == 0) c = 200;
  1647 00:07AD: A5 11        	lda	<L63+i_1
  1648 00:07AF: D0 08        	bne	L10040
  Wed Jan 19 2022 17:05                                                Page 31


  1649 00:07B1: E2 20        	sep	#$20
  1650                        	longa	off
  1651 00:07B3: A9 C8        	lda	#$c8
  1652 00:07B5: 85 1D        	sta	<L63+c_1
  1653 00:07B7: C2 20        	rep	#$20
  1654                        	longa	on
  1655                        ;		if (i > 0) c = 205;
  1656                        L10040:
  1657 00:07B9: A9 00 00     	lda	#$0
  1658 00:07BC: C5 11        	cmp	<L63+i_1
  1659 00:07BE: B0 08        	bcs	L10041
  1660 00:07C0: E2 20        	sep	#$20
  1661                        	longa	off
  1662 00:07C2: A9 CD        	lda	#$cd
  1663 00:07C4: 85 1D        	sta	<L63+c_1
  1664 00:07C6: C2 20        	rep	#$20
  1665                        	longa	on
  1666                        ;		if (i == w->width + 1) c = 188;
  1667                        L10041:
  1668 00:07C8: A0 05 00     	ldy	#$5
  1669 00:07CB: B7 21        	lda	[<L62+w_0],Y
  1670 00:07CD: 1A           	ina
  1671 00:07CE: C5 11        	cmp	<L63+i_1
  1672 00:07D0: D0 08        	bne	L10042
  1673 00:07D2: E2 20        	sep	#$20
  1674                        	longa	off
  1675 00:07D4: A9 BC        	lda	#$bc
  1676 00:07D6: 85 1D        	sta	<L63+c_1
  1677 00:07D8: C2 20        	rep	#$20
  1678                        	longa	on
  1679                        ;		*p = c;
  1680                        L10042:
  1681 00:07DA: E2 20        	sep	#$20
  1682                        	longa	off
  1683 00:07DC: A5 1D        	lda	<L63+c_1
  1684 00:07DE: 87 19        	sta	[<L63+p_1]
  1685 00:07E0: C2 20        	rep	#$20
  1686                        	longa	on
  1687                        ;		p++;
  1688 00:07E2: E6 19        	inc	<L63+p_1
  1689 00:07E4: D0 02        	bne	L10036
  1690 00:07E6: E6 1B        	inc	<L63+p_1+2
  1691                        ;	}	
  1692                        L10036:
  1693 00:07E8: E6 11        	inc	<L63+i_1
  1694                        L10039:
  1695 00:07EA: A0 05 00     	ldy	#$5
  1696 00:07ED: B7 21        	lda	[<L62+w_0],Y
  1697 00:07EF: 1A           	ina
  1698 00:07F0: C5 11        	cmp	<L63+i_1
  1699 00:07F2: B0 B9        	bcs	L10038
  1700                        ;}
  1701 00:07F4: A5 1F        	lda	<L62+2
  1702 00:07F6: 85 23        	sta	<L62+2+4
  1703 00:07F8: A5 1E        	lda	<L62+1
  1704 00:07FA: 85 22        	sta	<L62+1+4
  1705 00:07FC: 2B           	pld
  1706 00:07FD: 3B           	tsc
  Wed Jan 19 2022 17:05                                                Page 32


  1707 00:07FE: 18           	clc
  1708 00:07FF: 69 21 00     	adc	#L62+4
  1709 00:0802: 1B           	tcs
  1710 00:0803: 6B           	rtl
  1711             0000001D   L62	equ	29
  1712             00000011   L63	equ	17
  1713                        	ends
  1714                        	efunc
  1715                        ;
  1716                        ;void drawWindows() {
  1717                        	code
  1718                        	xdef	~~drawWindows
  1719                        	func
  1720                        ~~drawWindows:
  1721                        	longa	on
  1722                        	longi	on
  1723 00:0804: 3B           	tsc
  1724 00:0805: 38           	sec
  1725 00:0806: E9 08 00     	sbc	#L85
  1726 00:0809: 1B           	tcs
  1727 00:080A: 0B           	phd
  1728 00:080B: 5B           	tcd
  1729                        ;	win_t *w;
  1730                        ;	
  1731                        ;	w = wins.anchor;
  1732             00000000   w_1	set	0
  1733 00:080C: AD xx xx     	lda	|~~wins
  1734 00:080F: 85 05        	sta	<L86+w_1
  1735 00:0811: AD xx xx     	lda	|~~wins+2
  1736                        L20011:
  1737 00:0814: 85 07        	sta	<L86+w_1+2
  1738                        ;	while(w) {
  1739 00:0816: A5 05        	lda	<L86+w_1
  1740 00:0818: 05 07        	ora	<L86+w_1+2
  1741 00:081A: F0 3C        	beq	L10045
  1742                        ;	
  1743                        ;	while(w) {
  1744                        ;		if (w->next == NULL) break;
  1745 00:081C: A0 1D 00     	ldy	#$1d
  1746 00:081F: B7 05        	lda	[<L86+w_1],Y
  1747 00:0821: C8           	iny
  1748 00:0822: C8           	iny
  1749 00:0823: 17 05        	ora	[<L86+w_1],Y
  1750 00:0825: F0 31        	beq	L10045
  1751                        ;		w = w->next;
  1752 00:0827: 88           	dey
  1753 00:0828: 88           	dey
  1754 00:0829: B7 05        	lda	[<L86+w_1],Y
  1755 00:082B: 85 01        	sta	<R0
  1756 00:082D: C8           	iny
  1757 00:082E: C8           	iny
  1758 00:082F: B7 05        	lda	[<L86+w_1],Y
  1759 00:0831: 85 03        	sta	<R0+2
  1760 00:0833: A5 01        	lda	<R0
  1761 00:0835: 85 05        	sta	<L86+w_1
  1762 00:0837: A5 03        	lda	<R0+2
  1763 00:0839: 80 D9        	bra	L20011
  1764                        ;	}
  Wed Jan 19 2022 17:05                                                Page 33


  1765                        L20015:
  1766                        ;		drawWindow(w);
  1767 00:083B: D4 07        	pei	<L86+w_1+2
  1768 00:083D: D4 05        	pei	<L86+w_1
  1769 00:083F: 22 xx xx xx  	jsl	~~drawWindow
  1770                        ;		w = w->prev;
  1771 00:0843: A0 21 00     	ldy	#$21
  1772 00:0846: B7 05        	lda	[<L86+w_1],Y
  1773 00:0848: 85 01        	sta	<R0
  1774 00:084A: C8           	iny
  1775 00:084B: C8           	iny
  1776 00:084C: B7 05        	lda	[<L86+w_1],Y
  1777 00:084E: 85 03        	sta	<R0+2
  1778 00:0850: A5 01        	lda	<R0
  1779 00:0852: 85 05        	sta	<L86+w_1
  1780 00:0854: A5 03        	lda	<R0+2
  1781 00:0856: 85 07        	sta	<L86+w_1+2
  1782                        ;	}
  1783                        L10045:
  1784 00:0858: A5 05        	lda	<L86+w_1
  1785 00:085A: 05 07        	ora	<L86+w_1+2
  1786 00:085C: D0 DD        	bne	L20015
  1787                        ;}
  1788 00:085E: 2B           	pld
  1789 00:085F: 3B           	tsc
  1790 00:0860: 18           	clc
  1791 00:0861: 69 08 00     	adc	#L85
  1792 00:0864: 1B           	tcs
  1793 00:0865: 6B           	rtl
  1794             00000008   L85	equ	8
  1795             00000005   L86	equ	5
  1796                        	ends
  1797                        	efunc
  1798                        ;
  1799                        ;int w_open(char *path, int oflags) {
  1800                        	code
  1801                        	xdef	~~w_open
  1802                        	func
  1803                        ~~w_open:
  1804                        	longa	on
  1805                        	longi	on
  1806 00:0866: 3B           	tsc
  1807 00:0867: 38           	sec
  1808 00:0868: E9 17 00     	sbc	#L91
  1809 00:086B: 1B           	tcs
  1810 00:086C: 0B           	phd
  1811 00:086D: 5B           	tcd
  1812             00000004   path_0	set	4
  1813             00000008   oflags_0	set	8
  1814                        ;	
  1815                        ;	uint16_t i;
  1816                        ;	uint16_t tlen;
  1817                        ;	uint16_t state;
  1818                        ;	uint16_t start;
  1819                        ;	win_t *w;
  1820                        ;	char cnum[3];
  1821                        ;
  1822                        ;	w = initWindow();
  Wed Jan 19 2022 17:05                                                Page 34


  1823             00000000   i_1	set	0
  1824             00000002   tlen_1	set	2
  1825             00000004   state_1	set	4
  1826             00000006   start_1	set	6
  1827             00000008   w_1	set	8
  1828             0000000C   cnum_1	set	12
  1829 00:086E: 22 xx xx xx  	jsl	~~initWindow
  1830 00:0872: 85 11        	sta	<L92+w_1
  1831 00:0874: 86 13        	stx	<L92+w_1+2
  1832                        ;	if (!w) return -1;
  1833 00:0876: 05 13        	ora	<L92+w_1+2
  1834 00:0878: D0 15        	bne	L10047
  1835 00:087A: A9 FF FF     	lda	#$ffff
  1836                        L94:
  1837 00:087D: A8           	tay
  1838 00:087E: A5 19        	lda	<L91+2
  1839 00:0880: 85 1F        	sta	<L91+2+6
  1840 00:0882: A5 18        	lda	<L91+1
  1841 00:0884: 85 1E        	sta	<L91+1+6
  1842 00:0886: 2B           	pld
  1843 00:0887: 3B           	tsc
  1844 00:0888: 18           	clc
  1845 00:0889: 69 1D 00     	adc	#L91+6
  1846 00:088C: 1B           	tcs
  1847 00:088D: 98           	tya
  1848 00:088E: 6B           	rtl
  1849                        ;	
  1850                        ;	state = 0;
  1851                        L10047:
  1852 00:088F: 64 0D        	stz	<L92+state_1
  1853                        ;	start = 0;
  1854 00:0891: 64 0F        	stz	<L92+start_1
  1855                        ;	cnum[2] = 0;
  1856 00:0893: E2 20        	sep	#$20
  1857                        	longa	off
  1858 00:0895: 64 17        	stz	<L92+cnum_1+2
  1859 00:0897: C2 20        	rep	#$20
  1860                        	longa	on
  1861                        ;
  1862                        ;	//printf("%s\n", path);
  1863                        ;	
  1864                        ;	for (i = 0;; i++) {
  1865 00:0899: 64 09        	stz	<L92+i_1
  1866                        L10050:
  1867                        ;		switch (path[i]) {
  1868 00:089B: A4 09        	ldy	<L92+i_1
  1869 00:089D: B7 1B        	lda	[<L91+path_0],Y
  1870 00:089F: 29 FF 00     	and	#$ff
  1871                        	xref	~~~swt
  1872 00:08A2: 22 xx xx xx  	jsl	~~~swt
  1873 00:08A6: 06 00        	dw	6
  1874 00:08A8: 00 00        	dw	0
  1875 00:08AA: xx xx        	dw	L10062-1
  1876 00:08AC: 2C 00        	dw	44
  1877 00:08AE: xx xx        	dw	L10062-1
  1878 00:08B0: 48 00        	dw	72
  1879 00:08B2: xx xx        	dw	L10059-1
  1880 00:08B4: 57 00        	dw	87
  Wed Jan 19 2022 17:05                                                Page 35


  1881 00:08B6: xx xx        	dw	L10057-1
  1882 00:08B8: 58 00        	dw	88
  1883 00:08BA: xx xx        	dw	L10053-1
  1884 00:08BC: 59 00        	dw	89
  1885 00:08BE: xx xx        	dw	L10055-1
  1886 00:08C0: xx xx        	dw	L10052-1
  1887                        ;			
  1888                        ;		case 'X':
  1889                        L10053:
  1890                        ;			if (state != 0) {
  1891 00:08C2: A5 0D        	lda	<L92+state_1
  1892 00:08C4: F0 04        	beq	L10052
  1893                        ;				start = i;
  1894                        L20018:
  1895 00:08C6: A5 09        	lda	<L92+i_1
  1896 00:08C8: 85 0F        	sta	<L92+start_1
  1897                        ;			}
  1898                        ;			break;
  1899                        ;			break;
  1900                        L10052:
  1901                        ;		if (path[i] == 0) break;
  1902 00:08CA: A4 09        	ldy	<L92+i_1
  1903 00:08CC: B7 1B        	lda	[<L91+path_0],Y
  1904 00:08CE: 29 FF 00     	and	#$ff
  1905 00:08D1: F0 04        	beq	L20016
  1906                        ;		default:
  1907                        ;			break;
  1908                        ;		}
  1909                        ;	}
  1910 00:08D3: E6 09        	inc	<L92+i_1
  1911 00:08D5: 80 C4        	bra	L10050
  1912                        L20016:
  1913                        ;	
  1914                        ;	w->scroll_end_row = w->height;
  1915 00:08D7: A0 07 00     	ldy	#$7
  1916 00:08DA: B7 11        	lda	[<L92+w_1],Y
  1917 00:08DC: A0 2F 00     	ldy	#$2f
  1918 00:08DF: 97 11        	sta	[<L92+w_1],Y
  1919                        ;	
  1920                        ;	addWindow(w);
  1921 00:08E1: D4 13        	pei	<L92+w_1+2
  1922 00:08E3: D4 11        	pei	<L92+w_1
  1923 00:08E5: 22 xx xx xx  	jsl	~~addWindow
  1924                        ;	foregroundWindow(w);
  1925 00:08E9: D4 13        	pei	<L92+w_1+2
  1926 00:08EB: D4 11        	pei	<L92+w_1
  1927 00:08ED: 22 xx xx xx  	jsl	~~foregroundWindow
  1928                        ;	drawWindows();
  1929 00:08F1: 22 xx xx xx  	jsl	~~drawWindows
  1930                        ;	
  1931                        ;	//printWindow(w);
  1932                        ;	
  1933                        ;	return w->fd;
  1934 00:08F5: A0 1B 00     	ldy	#$1b
  1935 00:08F8: B7 11        	lda	[<L92+w_1],Y
  1936 00:08FA: 80 81        	bra	L94
  1937                        ;		case 'Y':
  1938                        L10055:
  Wed Jan 19 2022 17:05                                                Page 36


  1939                        ;			if (state != 0) {
  1940 00:08FC: A5 0D        	lda	<L92+state_1
  1941 00:08FE: F0 CA        	beq	L10052
  1942                        ;				state = 2;
  1943 00:0900: A9 02 00     	lda	#$2
  1944                        L20019:
  1945 00:0903: 85 0D        	sta	<L92+state_1
  1946                        ;				start = i;
  1947 00:0905: 80 BF        	bra	L20018
  1948                        ;			}
  1949                        ;			break;
  1950                        ;		case 'W':
  1951                        L10057:
  1952                        ;			if (state != 0) {
  1953 00:0907: A5 0D        	lda	<L92+state_1
  1954 00:0909: F0 BF        	beq	L10052
  1955                        ;				state = 3;
  1956 00:090B: A9 03 00     	lda	#$3
  1957                        ;				start = i;
  1958 00:090E: 80 F3        	bra	L20019
  1959                        ;			}
  1960                        ;			break;
  1961                        ;		case 'H':
  1962                        L10059:
  1963                        ;			if (state != 0) {
  1964 00:0910: A5 0D        	lda	<L92+state_1
  1965 00:0912: F0 B6        	beq	L10052
  1966                        ;				state = 4;
  1967 00:0914: A9 04 00     	lda	#$4
  1968                        ;				start = i;
  1969 00:0917: 80 EA        	bra	L20019
  1970                        ;			}
  1971                        ;			break;
  1972                        ;		case 0:
  1973                        ;		case ',':
  1974                        L10062:
  1975                        ;			
  1976                        ;			cnum[0] = path[start+1];
  1977 00:0919: A5 0F        	lda	<L92+start_1
  1978 00:091B: 1A           	ina
  1979 00:091C: A8           	tay
  1980 00:091D: E2 20        	sep	#$20
  1981                        	longa	off
  1982 00:091F: B7 1B        	lda	[<L91+path_0],Y
  1983 00:0921: 85 15        	sta	<L92+cnum_1
  1984 00:0923: C2 20        	rep	#$20
  1985                        	longa	on
  1986                        ;			cnum[1] = path[start+2];
  1987 00:0925: A9 02 00     	lda	#$2
  1988 00:0928: 18           	clc
  1989 00:0929: 65 0F        	adc	<L92+start_1
  1990 00:092B: A8           	tay
  1991 00:092C: E2 20        	sep	#$20
  1992                        	longa	off
  1993 00:092E: B7 1B        	lda	[<L91+path_0],Y
  1994 00:0930: 85 16        	sta	<L92+cnum_1+1
  1995 00:0932: C2 20        	rep	#$20
  1996                        	longa	on
  Wed Jan 19 2022 17:05                                                Page 37


  1997                        ;			
  1998                        ;			switch (state) {
  1999 00:0934: A5 0D        	lda	<L92+state_1
  2000                        	xref	~~~fsw
  2001 00:0936: 22 xx xx xx  	jsl	~~~fsw
  2002 00:093A: 00 00        	dw	0
  2003 00:093C: 05 00        	dw	5
  2004 00:093E: xx xx        	dw	L10052-1
  2005 00:0940: xx xx        	dw	L10065-1
  2006 00:0942: xx xx        	dw	L10068-1
  2007 00:0944: xx xx        	dw	L10069-1
  2008 00:0946: xx xx        	dw	L10070-1
  2009 00:0948: xx xx        	dw	L10073-1
  2010                        ;			case 0:
  2011                        L10065:
  2012                        ;				tlen = i;
  2013 00:094A: A5 09        	lda	<L92+i_1
  2014 00:094C: 85 0B        	sta	<L92+tlen_1
  2015                        ;				if (tlen > 15) tlen = 15
                    ;
  2016 00:094E: A9 0F 00     	lda	#$f
  2017 00:0951: C5 0B        	cmp	<L92+tlen_1
  2018 00:0953: B0 02        	bcs	L10066
  2019 00:0955: 85 0B        	sta	<L92+tlen_1
  2020                        ;				//printf("tlen: %d\n", t
                    len);
  2021                        ;				if (tlen) {
  2022                        L10066:
  2023 00:0957: A5 0B        	lda	<L92+tlen_1
  2024 00:0959: F0 41        	beq	L10067
  2025                        ;					memset(w->title,
                     0, sizeof(w->title));
  2026 00:095B: F4 00 00     	pea	#^$10
  2027 00:095E: F4 10 00     	pea	#<$10
  2028 00:0961: F4 00 00     	pea	#<$0
  2029 00:0964: A9 0B 00     	lda	#$b
  2030 00:0967: 18           	clc
  2031 00:0968: 65 11        	adc	<L92+w_1
  2032 00:096A: 85 01        	sta	<R0
  2033 00:096C: A9 00 00     	lda	#$0
  2034 00:096F: 65 13        	adc	<L92+w_1+2
  2035 00:0971: 85 03        	sta	<R0+2
  2036 00:0973: 48           	pha
  2037 00:0974: D4 01        	pei	<R0
  2038 00:0976: 22 xx xx xx  	jsl	~~memset
  2039                        ;					memcpy(w->title,
                     path, tlen);
  2040 00:097A: A5 0B        	lda	<L92+tlen_1
  2041 00:097C: 85 01        	sta	<R0
  2042 00:097E: 64 03        	stz	<R0+2
  2043 00:0980: D4 03        	pei	<R0+2
  2044 00:0982: D4 01        	pei	<R0
  2045 00:0984: D4 1D        	pei	<L91+path_0+2
  2046 00:0986: D4 1B        	pei	<L91+path_0
  2047 00:0988: A9 0B 00     	lda	#$b
  2048 00:098B: 18           	clc
  2049 00:098C: 65 11        	adc	<L92+w_1
  2050 00:098E: 85 05        	sta	<R1
  Wed Jan 19 2022 17:05                                                Page 38


  2051 00:0990: A9 00 00     	lda	#$0
  2052 00:0993: 65 13        	adc	<L92+w_1+2
  2053 00:0995: 48           	pha
  2054 00:0996: D4 05        	pei	<R1
  2055 00:0998: 22 xx xx xx  	jsl	~~memcpy
  2056                        ;				}
  2057                        ;				state++;
  2058                        L10067:
  2059 00:099C: E6 0D        	inc	<L92+state_1
  2060                        ;				break;
  2061 00:099E: 82 29 FF     	brl	L10052
  2062                        ;			case 1:
  2063                        L10068:
  2064                        ;				w->x0 = atoi(cnum);
  2065 00:09A1: F4 00 00     	pea	#0
  2066 00:09A4: 18           	clc
  2067 00:09A5: 7B           	tdc
  2068 00:09A6: 69 15 00     	adc	#<L92+cnum_1
  2069 00:09A9: 48           	pha
  2070 00:09AA: 22 xx xx xx  	jsl	~~atoi
  2071 00:09AE: A0 01 00     	ldy	#$1
  2072                        L20020:
  2073 00:09B1: 97 11        	sta	[<L92+w_1],Y
  2074                        ;				//printf("start: %d, end
                    : %d num: %s\n", start, i, cnum);
  2075                        ;				break;
  2076 00:09B3: 82 14 FF     	brl	L10052
  2077                        ;			case 2:
  2078                        L10069:
  2079                        ;				w->y0 = atoi(cnum);
  2080 00:09B6: F4 00 00     	pea	#0
  2081 00:09B9: 18           	clc
  2082 00:09BA: 7B           	tdc
  2083 00:09BB: 69 15 00     	adc	#<L92+cnum_1
  2084 00:09BE: 48           	pha
  2085 00:09BF: 22 xx xx xx  	jsl	~~atoi
  2086 00:09C3: A0 03 00     	ldy	#$3
  2087                        ;				break;
  2088 00:09C6: 80 E9        	bra	L20020
  2089                        ;			case 3:
  2090                        L10070:
  2091                        ;				w->width = atoi(cnum);
  2092 00:09C8: F4 00 00     	pea	#0
  2093 00:09CB: 18           	clc
  2094 00:09CC: 7B           	tdc
  2095 00:09CD: 69 15 00     	adc	#<L92+cnum_1
  2096 00:09D0: 48           	pha
  2097 00:09D1: 22 xx xx xx  	jsl	~~atoi
  2098 00:09D5: A0 05 00     	ldy	#$5
  2099 00:09D8: 97 11        	sta	[<L92+w_1],Y
  2100                        ;				if (w->width > WIDTH_MAX
                    ) w->width = WIDTH_MAX; 
  2101 00:09DA: A9 4E 00     	lda	#$4e
  2102 00:09DD: D7 11        	cmp	[<L92+w_1],Y
  2103 00:09DF: B0 02        	bcs	L10071
  2104 00:09E1: 97 11        	sta	[<L92+w_1],Y
  2105                        ;				if (w->width < WIDTH_MIN
                    ) w->width = WIDTH_MIN; 
  Wed Jan 19 2022 17:05                                                Page 39


  2106                        L10071:
  2107 00:09E3: A0 05 00     	ldy	#$5
  2108 00:09E6: B7 11        	lda	[<L92+w_1],Y
  2109 00:09E8: C9 0A 00     	cmp	#<$a
  2110 00:09EB: 90 03        	bcc	*+5
  2111 00:09ED: 82 DA FE     	brl	L10052
  2112 00:09F0: A9 0A 00     	lda	#$a
  2113                        ;				
  2114                        ;				break;
  2115 00:09F3: 80 BC        	bra	L20020
  2116                        ;			case 4:
  2117                        L10073:
  2118                        ;				w->height = atoi(cnum);
  2119 00:09F5: F4 00 00     	pea	#0
  2120 00:09F8: 18           	clc
  2121 00:09F9: 7B           	tdc
  2122 00:09FA: 69 15 00     	adc	#<L92+cnum_1
  2123 00:09FD: 48           	pha
  2124 00:09FE: 22 xx xx xx  	jsl	~~atoi
  2125 00:0A02: A0 07 00     	ldy	#$7
  2126 00:0A05: 97 11        	sta	[<L92+w_1],Y
  2127                        ;				if (w->height > HEIGHT_M
                    AX) w->height = HEIGHT_MAX; 
  2128 00:0A07: A9 17 00     	lda	#$17
  2129 00:0A0A: D7 11        	cmp	[<L92+w_1],Y
  2130 00:0A0C: B0 02        	bcs	L10074
  2131 00:0A0E: 97 11        	sta	[<L92+w_1],Y
  2132                        ;				if (w->height < HEIGHT_M
                    IN) w->height = HEIGHT_MIN; 
  2133                        L10074:
  2134 00:0A10: A0 07 00     	ldy	#$7
  2135 00:0A13: B7 11        	lda	[<L92+w_1],Y
  2136 00:0A15: C9 05 00     	cmp	#<$5
  2137 00:0A18: 90 03        	bcc	*+5
  2138 00:0A1A: 82 AD FE     	brl	L10052
  2139 00:0A1D: A9 05 00     	lda	#$5
  2140                        ;				break;
  2141 00:0A20: 80 8F        	bra	L20020
  2142                        ;			default:
  2143                        ;				break;
  2144                        ;			}
  2145                        ;}
  2146             00000017   L91	equ	23
  2147             00000009   L92	equ	9
  2148                        	ends
  2149                        	efunc
  2150                        ;
  2151                        ;int w_close(int fd) {
  2152                        	code
  2153                        	xdef	~~w_close
  2154                        	func
  2155                        ~~w_close:
  2156                        	longa	on
  2157                        	longi	on
  2158 00:0A22: 3B           	tsc
  2159 00:0A23: 38           	sec
  2160 00:0A24: E9 0C 00     	sbc	#L106
  2161 00:0A27: 1B           	tcs
  Wed Jan 19 2022 17:05                                                Page 40


  2162 00:0A28: 0B           	phd
  2163 00:0A29: 5B           	tcd
  2164             00000004   fd_0	set	4
  2165                        ;	win_t *w, *pred;
  2166                        ;	
  2167                        ;	w = findWindow(fd);
  2168             00000000   w_1	set	0
  2169             00000004   pred_1	set	4
  2170 00:0A2A: D4 10        	pei	<L106+fd_0
  2171 00:0A2C: 22 xx xx xx  	jsl	~~findWindow
  2172 00:0A30: 85 05        	sta	<L107+w_1
  2173 00:0A32: 86 07        	stx	<L107+w_1+2
  2174                        ;	if (w) {
  2175 00:0A34: 05 07        	ora	<L107+w_1+2
  2176 00:0A36: F0 7B        	beq	L111
  2177                        ;		if (w == wins.anchor) {
  2178 00:0A38: A5 05        	lda	<L107+w_1
  2179 00:0A3A: CD xx xx     	cmp	|~~wins
  2180 00:0A3D: D0 05        	bne	L109
  2181 00:0A3F: A5 07        	lda	<L107+w_1+2
  2182 00:0A41: CD xx xx     	cmp	|~~wins+2
  2183                        L109:
  2184 00:0A44: D0 24        	bne	L10079
  2185                        ;			wins.anchor = w->next;
  2186 00:0A46: A0 1D 00     	ldy	#$1d
  2187 00:0A49: B7 05        	lda	[<L107+w_1],Y
  2188 00:0A4B: 8D xx xx     	sta	|~~wins
  2189 00:0A4E: C8           	iny
  2190 00:0A4F: C8           	iny
  2191 00:0A50: B7 05        	lda	[<L107+w_1],Y
  2192 00:0A52: 8D xx xx     	sta	|~~wins+2
  2193                        ;			w->next->prev = NULL;
  2194 00:0A55: 88           	dey
  2195 00:0A56: 88           	dey
  2196 00:0A57: B7 05        	lda	[<L107+w_1],Y
  2197 00:0A59: 85 01        	sta	<R0
  2198 00:0A5B: C8           	iny
  2199 00:0A5C: C8           	iny
  2200 00:0A5D: B7 05        	lda	[<L107+w_1],Y
  2201 00:0A5F: 85 03        	sta	<R0+2
  2202 00:0A61: A9 00 00     	lda	#$0
  2203 00:0A64: C8           	iny
  2204 00:0A65: C8           	iny
  2205 00:0A66: 97 01        	sta	[<R0],Y
  2206 00:0A68: 80 30        	bra	L20022
  2207                        ;		} else {
  2208                        L10079:
  2209                        ;			w->prev->next = w->next;
  2210 00:0A6A: A0 21 00     	ldy	#$21
  2211 00:0A6D: B7 05        	lda	[<L107+w_1],Y
  2212 00:0A6F: 85 01        	sta	<R0
  2213 00:0A71: C8           	iny
  2214 00:0A72: C8           	iny
  2215 00:0A73: B7 05        	lda	[<L107+w_1],Y
  2216 00:0A75: 85 03        	sta	<R0+2
  2217 00:0A77: A0 1D 00     	ldy	#$1d
  2218 00:0A7A: B7 05        	lda	[<L107+w_1],Y
  2219 00:0A7C: 97 01        	sta	[<R0],Y
  Wed Jan 19 2022 17:05                                                Page 41


  2220 00:0A7E: C8           	iny
  2221 00:0A7F: C8           	iny
  2222 00:0A80: B7 05        	lda	[<L107+w_1],Y
  2223 00:0A82: 97 01        	sta	[<R0],Y
  2224                        ;			w->next->prev = w->prev;
  2225 00:0A84: 88           	dey
  2226 00:0A85: 88           	dey
  2227 00:0A86: B7 05        	lda	[<L107+w_1],Y
  2228 00:0A88: 85 01        	sta	<R0
  2229 00:0A8A: C8           	iny
  2230 00:0A8B: C8           	iny
  2231 00:0A8C: B7 05        	lda	[<L107+w_1],Y
  2232 00:0A8E: 85 03        	sta	<R0+2
  2233 00:0A90: C8           	iny
  2234 00:0A91: C8           	iny
  2235 00:0A92: B7 05        	lda	[<L107+w_1],Y
  2236 00:0A94: 97 01        	sta	[<R0],Y
  2237 00:0A96: C8           	iny
  2238 00:0A97: C8           	iny
  2239 00:0A98: B7 05        	lda	[<L107+w_1],Y
  2240                        L20022:
  2241 00:0A9A: A0 23 00     	ldy	#$23
  2242 00:0A9D: 97 01        	sta	[<R0],Y
  2243                        ;		}
  2244                        ;		clearWindow(w);
  2245 00:0A9F: D4 07        	pei	<L107+w_1+2
  2246 00:0AA1: D4 05        	pei	<L107+w_1
  2247 00:0AA3: 22 xx xx xx  	jsl	~~clearWindow
  2248                        ;		free(w);
  2249 00:0AA7: D4 07        	pei	<L107+w_1+2
  2250 00:0AA9: D4 05        	pei	<L107+w_1
  2251 00:0AAB: 22 xx xx xx  	jsl	~~free
  2252                        ;		drawWindows();
  2253 00:0AAF: 22 xx xx xx  	jsl	~~drawWindows
  2254                        ;	}
  2255                        ;}
  2256                        L111:
  2257 00:0AB3: A8           	tay
  2258 00:0AB4: A5 0E        	lda	<L106+2
  2259 00:0AB6: 85 10        	sta	<L106+2+2
  2260 00:0AB8: A5 0D        	lda	<L106+1
  2261 00:0ABA: 85 0F        	sta	<L106+1+2
  2262 00:0ABC: 2B           	pld
  2263 00:0ABD: 3B           	tsc
  2264 00:0ABE: 18           	clc
  2265 00:0ABF: 69 0E 00     	adc	#L106+2
  2266 00:0AC2: 1B           	tcs
  2267 00:0AC3: 98           	tya
  2268 00:0AC4: 6B           	rtl
  2269             0000000C   L106	equ	12
  2270             00000005   L107	equ	5
  2271                        	ends
  2272                        	efunc
  2273                        ;
  2274                        ;#define VT100_CURSOR_X(TERM) (TERM->cursor_x)
  2275                        ;
  2276                        ;uint16_t VT100_CURSOR_Y(win_t *t){
  2277                        	code
  Wed Jan 19 2022 17:05                                                Page 42


  2278                        	xdef	~~VT100_CURSOR_Y
  2279                        	func
  2280                        ~~VT100_CURSOR_Y:
  2281                        	longa	on
  2282                        	longi	on
  2283 00:0AC5: 3B           	tsc
  2284 00:0AC6: 38           	sec
  2285 00:0AC7: E9 08 00     	sbc	#L112
  2286 00:0ACA: 1B           	tcs
  2287 00:0ACB: 0B           	phd
  2288 00:0ACC: 5B           	tcd
  2289             00000004   t_0	set	4
  2290                        ;	uint16_t scroll_height;
  2291                        ;	uint16_t row;
  2292                        ;	
  2293                        ;	// if within the top or bottom margin areas then
                     normal addressing
  2294                        ;	if(t->cursor_y < t->scroll_start_row || t->curso
                    r_y >= t->scroll_end_row){
  2295             00000000   scroll_height_1	set	0
  2296             00000002   row_1	set	2
  2297 00:0ACD: A0 27 00     	ldy	#$27
  2298 00:0AD0: B7 0C        	lda	[<L112+t_0],Y
  2299 00:0AD2: A0 2D 00     	ldy	#$2d
  2300 00:0AD5: D7 0C        	cmp	[<L112+t_0],Y
  2301 00:0AD7: 90 0C        	bcc	L114
  2302 00:0AD9: A0 27 00     	ldy	#$27
  2303 00:0ADC: B7 0C        	lda	[<L112+t_0],Y
  2304 00:0ADE: A0 2F 00     	ldy	#$2f
  2305 00:0AE1: D7 0C        	cmp	[<L112+t_0],Y
  2306 00:0AE3: 90 17        	bcc	L10081
  2307                        L114:
  2308                        ;		return t->cursor_y * VT100_CHAR_HEIGHT; 
  2309 00:0AE5: A0 27 00     	ldy	#$27
  2310 00:0AE8: B7 0C        	lda	[<L112+t_0],Y
  2311                        L117:
  2312 00:0AEA: A8           	tay
  2313 00:0AEB: A5 0A        	lda	<L112+2
  2314 00:0AED: 85 0E        	sta	<L112+2+4
  2315 00:0AEF: A5 09        	lda	<L112+1
  2316 00:0AF1: 85 0D        	sta	<L112+1+4
  2317 00:0AF3: 2B           	pld
  2318 00:0AF4: 3B           	tsc
  2319 00:0AF5: 18           	clc
  2320 00:0AF6: 69 0C 00     	adc	#L112+4
  2321 00:0AF9: 1B           	tcs
  2322 00:0AFA: 98           	tya
  2323 00:0AFB: 6B           	rtl
  2324                        ;	} else {
  2325                        L10081:
  2326                        ;		// otherwise we are inside scroll area
  2327                        ;		scroll_height = t->scroll_end_row - t->s
                    croll_start_row;
  2328 00:0AFC: 38           	sec
  2329 00:0AFD: A0 2F 00     	ldy	#$2f
  2330 00:0B00: B7 0C        	lda	[<L112+t_0],Y
  2331 00:0B02: 88           	dey
  2332 00:0B03: 88           	dey
  Wed Jan 19 2022 17:05                                                Page 43


  2333 00:0B04: F7 0C        	sbc	[<L112+t_0],Y
  2334 00:0B06: 85 05        	sta	<L113+scroll_height_1
  2335                        ;		row = t->cursor_y + t->scroll_value; 
  2336 00:0B08: 18           	clc
  2337 00:0B09: A0 27 00     	ldy	#$27
  2338 00:0B0C: B7 0C        	lda	[<L112+t_0],Y
  2339 00:0B0E: A0 31 00     	ldy	#$31
  2340 00:0B11: 77 0C        	adc	[<L112+t_0],Y
  2341 00:0B13: 85 07        	sta	<L113+row_1
  2342                        ;		if(t->cursor_y + t->scroll_value >= t->s
                    croll_end_row)
  2343                        ;			row -= scroll_height; 
  2344 00:0B15: 18           	clc
  2345 00:0B16: A0 27 00     	ldy	#$27
  2346 00:0B19: B7 0C        	lda	[<L112+t_0],Y
  2347 00:0B1B: A0 31 00     	ldy	#$31
  2348 00:0B1E: 77 0C        	adc	[<L112+t_0],Y
  2349 00:0B20: 88           	dey
  2350 00:0B21: 88           	dey
  2351 00:0B22: D7 0C        	cmp	[<L112+t_0],Y
  2352 00:0B24: 90 07        	bcc	L10082
  2353 00:0B26: 38           	sec
  2354 00:0B27: A5 07        	lda	<L113+row_1
  2355 00:0B29: E5 05        	sbc	<L113+scroll_height_1
  2356 00:0B2B: 85 07        	sta	<L113+row_1
  2357                        ;		return row * VT100_CHAR_HEIGHT; 
  2358                        L10082:
  2359 00:0B2D: A5 07        	lda	<L113+row_1
  2360 00:0B2F: 80 B9        	bra	L117
  2361                        ;	}
  2362                        ;
  2363                        ;}
  2364             00000008   L112	equ	8
  2365             00000005   L113	equ	5
  2366                        	ends
  2367                        	efunc
  2368                        ;
  2369                        ;
  2370                        ;void _vt100_clearLines(win_t *t, uint16_t start_l
                    ine, uint16_t end_line){
  2371                        	code
  2372                        	xdef	~~_vt100_clearLines
  2373                        	func
  2374                        ~~_vt100_clearLines:
  2375                        	longa	on
  2376                        	longi	on
  2377 00:0B31: 3B           	tsc
  2378 00:0B32: 38           	sec
  2379 00:0B33: E9 0C 00     	sbc	#L119
  2380 00:0B36: 1B           	tcs
  2381 00:0B37: 0B           	phd
  2382 00:0B38: 5B           	tcd
  2383             00000004   t_0	set	4
  2384             00000008   start_line_0	set	8
  2385             0000000A   end_line_0	set	10
  2386                        ;	int c, cy;
  2387                        ;	debugf("_vt100_clearLines start_line:%d, end_lin
                    e:%d\n", (long)start_line, (long)end_line);
  Wed Jan 19 2022 17:05                                                Page 44


  2388             00000000   c_1	set	0
  2389             00000002   cy_1	set	2
  2390 00:0B39: A5 16        	lda	<L119+end_line_0
  2391 00:0B3B: 85 01        	sta	<R0
  2392 00:0B3D: 64 03        	stz	<R0+2
  2393 00:0B3F: D4 03        	pei	<R0+2
  2394 00:0B41: D4 01        	pei	<R0
  2395 00:0B43: A5 14        	lda	<L119+start_line_0
  2396 00:0B45: 85 05        	sta	<R1
  2397 00:0B47: 64 07        	stz	<R1+2
  2398 00:0B49: D4 07        	pei	<R1+2
  2399 00:0B4B: D4 05        	pei	<R1
  2400 00:0B4D: F4 xx xx     	pea	#^L43
  2401 00:0B50: F4 xx xx     	pea	#<L43
  2402 00:0B53: F4 0E 00     	pea	#14
  2403 00:0B56: 22 xx xx xx  	jsl	~~debugf
  2404                        ;	
  2405                        ;	for(c = start_line; c <= end_line; c++){
  2406 00:0B5A: A5 14        	lda	<L119+start_line_0
  2407 00:0B5C: 85 09        	sta	<L120+c_1
  2408 00:0B5E: 80 2D        	bra	L10086
  2409                        L10085:
  2410                        ;		cy = t->cursor_y;
  2411 00:0B60: A0 27 00     	ldy	#$27
  2412 00:0B63: B7 10        	lda	[<L119+t_0],Y
  2413 00:0B65: 85 0B        	sta	<L120+cy_1
  2414                        ;		t->cursor_y = c; 
  2415 00:0B67: A5 09        	lda	<L120+c_1
  2416 00:0B69: 97 10        	sta	[<L119+t_0],Y
  2417                        ;		ili9340_fillRect(0, VT100_CURSOR_Y(t), V
                    T100_SCREEN_WIDTH, VT100_CHAR_HEIGHT, 0x0000);
  2418 00:0B6B: F4 00 00     	pea	#<$0
  2419 00:0B6E: F4 01 00     	pea	#<$1
  2420 00:0B71: F4 50 00     	pea	#<$50
  2421 00:0B74: D4 12        	pei	<L119+t_0+2
  2422 00:0B76: D4 10        	pei	<L119+t_0
  2423 00:0B78: 22 xx xx xx  	jsl	~~VT100_CURSOR_Y
  2424 00:0B7C: 48           	pha
  2425 00:0B7D: F4 00 00     	pea	#<$0
  2426 00:0B80: 22 xx xx xx  	jsl	~~ili9340_fillRect
  2427                        ;		t->cursor_y = cy;
  2428 00:0B84: A5 0B        	lda	<L120+cy_1
  2429 00:0B86: A0 27 00     	ldy	#$27
  2430 00:0B89: 97 10        	sta	[<L119+t_0],Y
  2431                        ;	}
  2432 00:0B8B: E6 09        	inc	<L120+c_1
  2433                        L10086:
  2434 00:0B8D: A5 16        	lda	<L119+end_line_0
  2435 00:0B8F: C5 09        	cmp	<L120+c_1
  2436 00:0B91: B0 CD        	bcs	L10085
  2437                        ;}
  2438 00:0B93: A5 0E        	lda	<L119+2
  2439 00:0B95: 85 16        	sta	<L119+2+8
  2440 00:0B97: A5 0D        	lda	<L119+1
  2441 00:0B99: 85 15        	sta	<L119+1+8
  2442 00:0B9B: 2B           	pld
  2443 00:0B9C: 3B           	tsc
  2444 00:0B9D: 18           	clc
  Wed Jan 19 2022 17:05                                                Page 45


  2445 00:0B9E: 69 14 00     	adc	#L119+8
  2446 00:0BA1: 1B           	tcs
  2447 00:0BA2: 6B           	rtl
  2448             0000000C   L119	equ	12
  2449             00000009   L120	equ	9
  2450                        	ends
  2451                        	efunc
  2452                        	data
  2453                        L43:
  2454 00:00E8: 5F 76 74 31  	db	$5F,$76,$74,$31,$30,$30,$5F,$63,$6C,$65,
                    $61,$72,$4C,$69,$6E
       00:00EC: 30 30 5F 63 
       00:00F0: 6C 65 61 72 
       00:00F4: 4C 69 6E 
  2455 00:00F7: 65 73 20 73  	db	$65,$73,$20,$73,$74,$61,$72,$74,$5F,$6C,
                    $69,$6E,$65,$3A,$25
       00:00FB: 74 61 72 74 
       00:00FF: 5F 6C 69 6E 
       00:0103: 65 3A 25 
  2456 00:0106: 64 2C 20 65  	db	$64,$2C,$20,$65,$6E,$64,$5F,$6C,$69,$6E,
                    $65,$3A,$25,$64,$0A
       00:010A: 6E 64 5F 6C 
       00:010E: 69 6E 65 3A 
       00:0112: 25 64 0A 
  2457 00:0115: 00           	db	$00
  2458 00:0116:              	ends
  2459                        ;
  2460                        ;
  2461                        ;// scrolls the scroll region up (lines > 0) or do
                    wn (lines < 0)
  2462                        ;void _vt100_scroll(win_t *t, int16_t lines){
  2463                        	code
  2464                        	xdef	~~_vt100_scroll
  2465                        	func
  2466                        ~~_vt100_scroll:
  2467                        	longa	on
  2468                        	longi	on
  2469 00:0BA3: 3B           	tsc
  2470 00:0BA4: 38           	sec
  2471 00:0BA5: E9 14 00     	sbc	#L124
  2472 00:0BA8: 1B           	tcs
  2473 00:0BA9: 0B           	phd
  2474 00:0BAA: 5B           	tcd
  2475             00000004   t_0	set	4
  2476             00000008   lines_0	set	8
  2477                        ;	uint16_t scroll_height;
  2478                        ;	uint16_t scroll_start;
  2479                        ;	uint8_t *srcp, *dstp;
  2480                        ;	
  2481                        ;	if(!lines) return;
  2482             00000000   scroll_height_1	set	0
  2483             00000002   scroll_start_1	set	2
  2484             00000004   srcp_1	set	4
  2485             00000008   dstp_1	set	8
  2486 00:0BAB: A5 1C        	lda	<L124+lines_0
  2487 00:0BAD: D0 10        	bne	L10087
  2488                        L127:
  2489 00:0BAF: A5 16        	lda	<L124+2
  Wed Jan 19 2022 17:05                                                Page 46


  2490 00:0BB1: 85 1C        	sta	<L124+2+6
  2491 00:0BB3: A5 15        	lda	<L124+1
  2492 00:0BB5: 85 1B        	sta	<L124+1+6
  2493 00:0BB7: 2B           	pld
  2494 00:0BB8: 3B           	tsc
  2495 00:0BB9: 18           	clc
  2496 00:0BBA: 69 1A 00     	adc	#L124+6
  2497 00:0BBD: 1B           	tcs
  2498 00:0BBE: 6B           	rtl
  2499                        ;
  2500                        ;	// get height of scroll area in rows
  2501                        ;	scroll_height = t->scroll_end_row - t->scroll_st
                    art_row; 
  2502                        L10087:
  2503 00:0BBF: 38           	sec
  2504 00:0BC0: A0 2F 00     	ldy	#$2f
  2505 00:0BC3: B7 18        	lda	[<L124+t_0],Y
  2506 00:0BC5: 88           	dey
  2507 00:0BC6: 88           	dey
  2508 00:0BC7: F7 18        	sbc	[<L124+t_0],Y
  2509 00:0BC9: 85 09        	sta	<L125+scroll_height_1
  2510                        ;	// clearing of lines that we have scrolled up or
                     down
  2511                        ;	
  2512                        ;	
  2513                        ;	if(lines > 0){
  2514 00:0BCB: 38           	sec
  2515 00:0BCC: A9 00 00     	lda	#$0
  2516 00:0BCF: E5 1C        	sbc	<L124+lines_0
  2517 00:0BD1: 70 03        	bvs	L128
  2518 00:0BD3: 49 00 80     	eor	#$8000
  2519                        L128:
  2520 00:0BD6: 10 03        	bpl	*+5
  2521 00:0BD8: 82 A5 00     	brl	L10088
  2522                        ;		//_vt100_clearLines(t, t->scroll_start_r
                    ow, t->scroll_start_row+lines-1); 
  2523                        ;		// update the scroll value (wraps around
                     scroll_height)
  2524                        ;		//t->scroll_value = (t->scroll_value + l
                    ines) % scroll_height;
  2525                        ;		// scrolling up so clear first line of s
                    croll area
  2526                        ;		//uint16_t y = (t->scroll_start_row + t-
                    >scroll_value) * VT100_CHAR_HEIGHT; 
  2527                        ;		//ili9340_fillRect(0, y, VT100_SCREEN_WI
                    DTH, lines * VT100_CHAR_HEIGHT, 0x0000);
  2528                        ;		
  2529                        ;		dstp = t->data + t->scroll_start_row * 8
                    0;
  2530 00:0BDB: A0 2D 00     	ldy	#$2d
  2531 00:0BDE: B7 18        	lda	[<L124+t_0],Y
  2532 00:0BE0: A2 50 00     	ldx	#<$50
  2533                        	xref	~~~mul
  2534 00:0BE3: 22 xx xx xx  	jsl	~~~mul
  2535 00:0BE7: 85 01        	sta	<R0
  2536 00:0BE9: 64 03        	stz	<R0+2
  2537 00:0BEB: A9 37 00     	lda	#$37
  2538 00:0BEE: 18           	clc
  Wed Jan 19 2022 17:05                                                Page 47


  2539 00:0BEF: 65 01        	adc	<R0
  2540 00:0BF1: 85 05        	sta	<R1
  2541 00:0BF3: A9 00 00     	lda	#$0
  2542 00:0BF6: 65 03        	adc	<R0+2
  2543 00:0BF8: 85 07        	sta	<R1+2
  2544 00:0BFA: A5 18        	lda	<L124+t_0
  2545 00:0BFC: 18           	clc
  2546 00:0BFD: 65 05        	adc	<R1
  2547 00:0BFF: 85 11        	sta	<L125+dstp_1
  2548 00:0C01: A5 1A        	lda	<L124+t_0+2
  2549 00:0C03: 65 07        	adc	<R1+2
  2550 00:0C05: 85 13        	sta	<L125+dstp_1+2
  2551                        ;		srcp = dstp + 80;
  2552 00:0C07: A9 50 00     	lda	#$50
  2553 00:0C0A: 18           	clc
  2554 00:0C0B: 65 11        	adc	<L125+dstp_1
  2555 00:0C0D: 85 0D        	sta	<L125+srcp_1
  2556 00:0C0F: A9 00 00     	lda	#$0
  2557 00:0C12: 65 13        	adc	<L125+dstp_1+2
  2558 00:0C14: 85 0F        	sta	<L125+srcp_1+2
  2559                        ;		memmove(dstp, srcp, (t->scroll_end_row -
                     t->scroll_start_row - 1) * 80);
  2560 00:0C16: 38           	sec
  2561 00:0C17: A0 2F 00     	ldy	#$2f
  2562 00:0C1A: B7 18        	lda	[<L124+t_0],Y
  2563 00:0C1C: 88           	dey
  2564 00:0C1D: 88           	dey
  2565 00:0C1E: F7 18        	sbc	[<L124+t_0],Y
  2566 00:0C20: A2 50 00     	ldx	#<$50
  2567                        	xref	~~~mul
  2568 00:0C23: 22 xx xx xx  	jsl	~~~mul
  2569 00:0C27: 18           	clc
  2570 00:0C28: 69 B0 FF     	adc	#$ffb0
  2571 00:0C2B: 85 01        	sta	<R0
  2572 00:0C2D: 64 03        	stz	<R0+2
  2573 00:0C2F: D4 03        	pei	<R0+2
  2574 00:0C31: D4 01        	pei	<R0
  2575 00:0C33: D4 0F        	pei	<L125+srcp_1+2
  2576 00:0C35: D4 0D        	pei	<L125+srcp_1
  2577 00:0C37: D4 13        	pei	<L125+dstp_1+2
  2578 00:0C39: D4 11        	pei	<L125+dstp_1
  2579 00:0C3B: 22 xx xx xx  	jsl	~~memmove
  2580                        ;		memset(t->data + (t->scroll_end_row - 1)
                     * 80, ' ', 80); 
  2581 00:0C3F: F4 00 00     	pea	#^$50
  2582 00:0C42: F4 50 00     	pea	#<$50
  2583 00:0C45: F4 20 00     	pea	#<$20
  2584 00:0C48: A0 2F 00     	ldy	#$2f
  2585 00:0C4B: B7 18        	lda	[<L124+t_0],Y
  2586 00:0C4D: A2 50 00     	ldx	#<$50
  2587                        	xref	~~~mul
  2588 00:0C50: 22 xx xx xx  	jsl	~~~mul
  2589 00:0C54: 18           	clc
  2590 00:0C55: 69 B0 FF     	adc	#$ffb0
  2591 00:0C58: 85 01        	sta	<R0
  2592 00:0C5A: 64 03        	stz	<R0+2
  2593 00:0C5C: A9 37 00     	lda	#$37
  2594 00:0C5F: 18           	clc
  Wed Jan 19 2022 17:05                                                Page 48


  2595 00:0C60: 65 01        	adc	<R0
  2596 00:0C62: 85 05        	sta	<R1
  2597 00:0C64: A9 00 00     	lda	#$0
  2598 00:0C67: 65 03        	adc	<R0+2
  2599 00:0C69: 85 07        	sta	<R1+2
  2600 00:0C6B: A5 18        	lda	<L124+t_0
  2601 00:0C6D: 18           	clc
  2602 00:0C6E: 65 05        	adc	<R1
  2603 00:0C70: 85 01        	sta	<R0
  2604 00:0C72: A5 1A        	lda	<L124+t_0+2
  2605 00:0C74: 65 07        	adc	<R1+2
  2606 00:0C76: 48           	pha
  2607 00:0C77: D4 01        	pei	<R0
  2608 00:0C79: 22 xx xx xx  	jsl	~~memset
  2609                        ;	} else if(lines < 0){
  2610 00:0C7D: 82 2F FF     	brl	L127
  2611                        L10088:
  2612 00:0C80: A5 1C        	lda	<L124+lines_0
  2613 00:0C82: 30 03        	bmi	*+5
  2614 00:0C84: 82 28 FF     	brl	L127
  2615                        ;		_vt100_clearLines(t, t->scroll_end_row -
                     lines, t->scroll_end_row - 1); 
  2616 00:0C87: 18           	clc
  2617 00:0C88: A9 FF FF     	lda	#$ffff
  2618 00:0C8B: A0 2F 00     	ldy	#$2f
  2619 00:0C8E: 77 18        	adc	[<L124+t_0],Y
  2620 00:0C90: 48           	pha
  2621 00:0C91: 38           	sec
  2622 00:0C92: B7 18        	lda	[<L124+t_0],Y
  2623 00:0C94: E5 1C        	sbc	<L124+lines_0
  2624 00:0C96: 48           	pha
  2625 00:0C97: D4 1A        	pei	<L124+t_0+2
  2626 00:0C99: D4 18        	pei	<L124+t_0
  2627 00:0C9B: 22 xx xx xx  	jsl	~~_vt100_clearLines
  2628                        ;		// make sure that the value wraps down 
  2629                        ;		//t->scroll_value = (scroll_height + t->
                    scroll_value + lines) % scroll_height; 
  2630                        ;		// scrolling down - so clear last line o
                    f the scroll area
  2631                        ;		//uint16_t y = (t->scroll_start_row + t-
                    >scroll_value) * VT100_CHAR_HEIGHT; 
  2632                        ;		//ili9340_fillRect(0, y, VT100_SCREEN_WI
                    DTH, lines * VT100_CHAR_HEIGHT, 0x0000);
  2633                        ;	}
  2634                        ;	/*
  2635                        ;	scroll_start = (t->scroll_start_row + t->scroll_
                    value) * VT100_CHAR_HEIGHT; 
  2636                        ;	
  2637                        ;	ili9340_setScrollStart(scroll_start); 
  2638                        ;	*/
  2639                        ;	
  2640                        ;	
  2641                        ;	//debugf("_vt100_scroll line:%d, scr_height:%d, 
                    scr_start_row:%d, scr_end_row:%d \n", (long)lines, (long)scr
                    oll_height, (long)t->scroll_start_row, (long)t->scroll_end_r
                    ow);
  2642                        ;	
  2643                        ;}
  Wed Jan 19 2022 17:05                                                Page 49


  2644 00:0C9F: 82 0D FF     	brl	L127
  2645             00000014   L124	equ	20
  2646             00000009   L125	equ	9
  2647                        	ends
  2648                        	efunc
  2649                        ;
  2650                        ;
  2651                        ;// moves the cursor relative to current cursor po
                    sition and scrolls the screen
  2652                        ;void _vt100_move(win_t *term, int16_t right_left,
                     int16_t bottom_top){
  2653                        	code
  2654                        	xdef	~~_vt100_move
  2655                        	func
  2656                        ~~_vt100_move:
  2657                        	longa	on
  2658                        	longi	on
  2659 00:0CA2: 3B           	tsc
  2660 00:0CA3: 38           	sec
  2661 00:0CA4: E9 0A 00     	sbc	#L131
  2662 00:0CA7: 1B           	tcs
  2663 00:0CA8: 0B           	phd
  2664 00:0CA9: 5B           	tcd
  2665             00000004   term_0	set	4
  2666             00000008   right_left_0	set	8
  2667             0000000A   bottom_top_0	set	10
  2668                        ;	// calculate how many lines we need to move down
                     or up if x movement goes outside screen
  2669                        ;	int16_t new_y;
  2670                        ;	int16_t to_scroll;
  2671                        ;	int16_t new_x;
  2672                        ;
  2673                        ;	new_x = right_left + term->cursor_x; 
  2674             00000000   new_y_1	set	0
  2675             00000002   to_scroll_1	set	2
  2676             00000004   new_x_1	set	4
  2677 00:0CAA: 18           	clc
  2678 00:0CAB: A5 12        	lda	<L131+right_left_0
  2679 00:0CAD: A0 25 00     	ldy	#$25
  2680 00:0CB0: 77 0E        	adc	[<L131+term_0],Y
  2681 00:0CB2: 85 09        	sta	<L132+new_x_1
  2682                        ;		
  2683                        ;	if(new_x >= (int16_t)(VT100_WIDTH)){
  2684 00:0CB4: 38           	sec
  2685 00:0CB5: A0 05 00     	ldy	#$5
  2686 00:0CB8: F7 0E        	sbc	[<L131+term_0],Y
  2687 00:0CBA: 70 03        	bvs	L133
  2688 00:0CBC: 49 00 80     	eor	#$8000
  2689                        L133:
  2690 00:0CBF: 10 2D        	bpl	L10091
  2691                        ;		if(term->flags.f.cursor_wrap){
  2692 00:0CC1: A7 0E        	lda	[<L131+term_0]
  2693 00:0CC3: 89 01 00     	bit	#$1
  2694 00:0CC6: F0 1F        	beq	L10092
  2695                        ;			bottom_top += new_x / VT100_WIDT
                    H;
  2696 00:0CC8: A0 05 00     	ldy	#$5
  2697 00:0CCB: B7 0E        	lda	[<L131+term_0],Y
  Wed Jan 19 2022 17:05                                                Page 50


  2698 00:0CCD: AA           	tax
  2699 00:0CCE: A5 09        	lda	<L132+new_x_1
  2700                        	xref	~~~udv
  2701 00:0CD0: 22 xx xx xx  	jsl	~~~udv
  2702 00:0CD4: 18           	clc
  2703 00:0CD5: 65 14        	adc	<L131+bottom_top_0
  2704 00:0CD7: 85 14        	sta	<L131+bottom_top_0
  2705                        ;			term->cursor_x = new_x % VT100_W
                    IDTH /*- 1*/;
  2706 00:0CD9: A0 05 00     	ldy	#$5
  2707 00:0CDC: B7 0E        	lda	[<L131+term_0],Y
  2708 00:0CDE: AA           	tax
  2709 00:0CDF: A5 09        	lda	<L132+new_x_1
  2710                        	xref	~~~umd
  2711 00:0CE1: 22 xx xx xx  	jsl	~~~umd
  2712 00:0CE5: 80 0D        	bra	L20025
  2713                        ;		} else {
  2714                        L10092:
  2715                        ;			term->cursor_x = VT100_WIDTH;
  2716 00:0CE7: A0 05 00     	ldy	#$5
  2717 00:0CEA: B7 0E        	lda	[<L131+term_0],Y
  2718 00:0CEC: 80 06        	bra	L20025
  2719                        ;		}
  2720                        ;	} else if(new_x < 0){
  2721                        L10091:
  2722 00:0CEE: A5 09        	lda	<L132+new_x_1
  2723 00:0CF0: 30 07        	bmi	L10094
  2724                        ;		//bottom_top += new_x / VT100_WIDTH - 1;
  2725                        ;		//term->cursor_x = VT100_WIDTH - (abs(ne
                    w_x) % VT100_WIDTH) + 1;
  2726                        ;	} else {
  2727                        ;		term->cursor_x = new_x;
  2728 00:0CF2: A5 09        	lda	<L132+new_x_1
  2729                        L20025:
  2730 00:0CF4: A0 25 00     	ldy	#$25
  2731 00:0CF7: 97 0E        	sta	[<L131+term_0],Y
  2732                        ;	}
  2733                        L10094:
  2734                        ;
  2735                        ;	//debugf("move: new_x:%d, term->cursor_x:%d, bot
                    tom_top:%d \n", (long)new_x, (long)term->cursor_x, (long)bot
                    tom_top);
  2736                        ;	
  2737                        ;	if(bottom_top){
  2738 00:0CF9: A5 14        	lda	<L131+bottom_top_0
  2739 00:0CFB: F0 4A        	beq	L140
  2740                        ;		new_y = term->cursor_y + bottom_top;
  2741 00:0CFD: 18           	clc
  2742 00:0CFE: A0 27 00     	ldy	#$27
  2743 00:0D01: B7 0E        	lda	[<L131+term_0],Y
  2744 00:0D03: 65 14        	adc	<L131+bottom_top_0
  2745 00:0D05: 85 05        	sta	<L132+new_y_1
  2746                        ;		to_scroll = 0;
  2747 00:0D07: 64 07        	stz	<L132+to_scroll_1
  2748                        ;		// bottom margin 39 marks last line as s
                    tatic on 40 line display
  2749                        ;		// therefore, we would scroll when new c
                    ursor has moved to line 39
  Wed Jan 19 2022 17:05                                                Page 51


  2750                        ;		// (or we could use new_y > VT100_HEIGHT
                     here
  2751                        ;		// NOTE: new_y >= term->scroll_end_row #
                    # to_scroll = (new_y - term->scroll_end_row) +1
  2752                        ;		if(new_y >= term->scroll_end_row){
  2753 00:0D09: A5 05        	lda	<L132+new_y_1
  2754 00:0D0B: A0 2F 00     	ldy	#$2f
  2755 00:0D0E: D7 0E        	cmp	[<L131+term_0],Y
  2756 00:0D10: 90 10        	bcc	L10098
  2757                        ;			//scroll = new_y / VT100_HEIGHT;
  2758                        ;			//term->cursor_y = VT100_HEIGHT;
  2759                        ;			to_scroll = (new_y - term->scrol
                    l_end_row) + 1; 
  2760 00:0D12: 38           	sec
  2761 00:0D13: A5 05        	lda	<L132+new_y_1
  2762 00:0D15: F7 0E        	sbc	[<L131+term_0],Y
  2763 00:0D17: 1A           	ina
  2764 00:0D18: 85 07        	sta	<L132+to_scroll_1
  2765                        ;			// place cursor back within the 
                    scroll region
  2766                        ;			term->cursor_y = term->scroll_en
                    d_row - 1; //new_y - to_scroll; 
  2767 00:0D1A: A9 FF FF     	lda	#$ffff
  2768 00:0D1D: 18           	clc
  2769 00:0D1E: 77 0E        	adc	[<L131+term_0],Y
  2770 00:0D20: 80 16        	bra	L20026
  2771                        ;			//scroll = new_y - term->bottom_
                    margin; 
  2772                        ;			//term->cursor_y = term->bottom_
                    margin; 
  2773                        ;		} else if(new_y < term->scroll_start_row
                    ){
  2774                        L10098:
  2775 00:0D22: A5 05        	lda	<L132+new_y_1
  2776 00:0D24: A0 2D 00     	ldy	#$2d
  2777 00:0D27: D7 0E        	cmp	[<L131+term_0],Y
  2778 00:0D29: B0 0B        	bcs	L10100
  2779                        ;			to_scroll = (new_y - term->scrol
                    l_start_row); 
  2780 00:0D2B: 38           	sec
  2781 00:0D2C: A5 05        	lda	<L132+new_y_1
  2782 00:0D2E: F7 0E        	sbc	[<L131+term_0],Y
  2783 00:0D30: 85 07        	sta	<L132+to_scroll_1
  2784                        ;			term->cursor_y = term->scroll_st
                    art_row; //new_y - to_scroll; 
  2785 00:0D32: B7 0E        	lda	[<L131+term_0],Y
  2786 00:0D34: 80 02        	bra	L20026
  2787                        ;			//scroll = new_y / (term->bottom
                    _margin - term->top_margin) - 1;
  2788                        ;			//term->cursor_y = term->top_mar
                    gin; 
  2789                        ;		} else {
  2790                        L10100:
  2791                        ;			// otherwise we move as normal i
                    nside the screen
  2792                        ;			term->cursor_y = new_y;
  2793 00:0D36: A5 05        	lda	<L132+new_y_1
  2794                        L20026:
  Wed Jan 19 2022 17:05                                                Page 52


  2795 00:0D38: A0 27 00     	ldy	#$27
  2796 00:0D3B: 97 0E        	sta	[<L131+term_0],Y
  2797                        ;		}
  2798                        ;		_vt100_scroll(term, to_scroll);
  2799 00:0D3D: D4 07        	pei	<L132+to_scroll_1
  2800 00:0D3F: D4 10        	pei	<L131+term_0+2
  2801 00:0D41: D4 0E        	pei	<L131+term_0
  2802 00:0D43: 22 xx xx xx  	jsl	~~_vt100_scroll
  2803                        ;		
  2804                        ;		//debugf("move: new_y:%d, term->cursor_y
                    :%d, to_scroll:%d \n", (long)new_y, (long)term->cursor_y, (l
                    ong)to_scroll);
  2805                        ;
  2806                        ;	}
  2807                        ;}
  2808                        L140:
  2809 00:0D47: A5 0C        	lda	<L131+2
  2810 00:0D49: 85 14        	sta	<L131+2+8
  2811 00:0D4B: A5 0B        	lda	<L131+1
  2812 00:0D4D: 85 13        	sta	<L131+1+8
  2813 00:0D4F: 2B           	pld
  2814 00:0D50: 3B           	tsc
  2815 00:0D51: 18           	clc
  2816 00:0D52: 69 12 00     	adc	#L131+8
  2817 00:0D55: 1B           	tcs
  2818 00:0D56: 6B           	rtl
  2819             0000000A   L131	equ	10
  2820             00000005   L132	equ	5
  2821                        	ends
  2822                        	efunc
  2823                        ;
  2824                        ;
  2825                        ;void _vt100_putc(win_t *w, uint8_t ch){
  2826                        	code
  2827                        	xdef	~~_vt100_putc
  2828                        	func
  2829                        ~~_vt100_putc:
  2830                        	longa	on
  2831                        	longi	on
  2832 00:0D57: 3B           	tsc
  2833 00:0D58: 38           	sec
  2834 00:0D59: E9 08 00     	sbc	#L141
  2835 00:0D5C: 1B           	tcs
  2836 00:0D5D: 0B           	phd
  2837 00:0D5E: 5B           	tcd
  2838             00000004   w_0	set	4
  2839             00000008   ch_0	set	8
  2840                        ;	uint16_t x;
  2841                        ;	uint16_t y;
  2842                        ;	
  2843                        ;	if(ch < 0x20 || ch > 0x7e){
  2844             00000000   x_1	set	0
  2845             00000002   y_1	set	2
  2846 00:0D5F: E2 20        	sep	#$20
  2847                        	longa	off
  2848 00:0D61: A5 10        	lda	<L141+ch_0
  2849 00:0D63: C9 20        	cmp	#<$20
  2850 00:0D65: C2 20        	rep	#$20
  Wed Jan 19 2022 17:05                                                Page 53


  2851                        	longa	on
  2852 00:0D67: 90 0A        	bcc	L143
  2853 00:0D69: E2 20        	sep	#$20
  2854                        	longa	off
  2855 00:0D6B: A9 7E        	lda	#$7e
  2856 00:0D6D: C5 10        	cmp	<L141+ch_0
  2857 00:0D6F: C2 20        	rep	#$20
  2858                        	longa	on
  2859 00:0D71: B0 51        	bcs	L10102
  2860                        L143:
  2861                        ;		_vt100_putc(w, '0'); 
  2862 00:0D73: F4 30 00     	pea	#<$30
  2863 00:0D76: D4 0E        	pei	<L141+w_0+2
  2864 00:0D78: D4 0C        	pei	<L141+w_0
  2865 00:0D7A: 22 xx xx xx  	jsl	~~_vt100_putc
  2866                        ;		_vt100_putc(w, 'x'); 
  2867 00:0D7E: F4 78 00     	pea	#<$78
  2868 00:0D81: D4 0E        	pei	<L141+w_0+2
  2869 00:0D83: D4 0C        	pei	<L141+w_0
  2870 00:0D85: 22 xx xx xx  	jsl	~~_vt100_putc
  2871                        ;		_vt100_putc(w, hextab[((ch & 0xf0) >> 4)
                    ]);
  2872 00:0D89: A5 10        	lda	<L141+ch_0
  2873 00:0D8B: 29 F0 00     	and	#<$f0
  2874 00:0D8E: A2 04 00     	ldx	#<$4
  2875                        	xref	~~~asr
  2876 00:0D91: 22 xx xx xx  	jsl	~~~asr
  2877 00:0D95: AA           	tax
  2878 00:0D96: BD xx xx     	lda	|~~hextab,X
  2879 00:0D99: 48           	pha
  2880 00:0D9A: D4 0E        	pei	<L141+w_0+2
  2881 00:0D9C: D4 0C        	pei	<L141+w_0
  2882 00:0D9E: 22 xx xx xx  	jsl	~~_vt100_putc
  2883                        ;		_vt100_putc(w, hextab[(ch & 0x0f)]);
  2884 00:0DA2: A5 10        	lda	<L141+ch_0
  2885 00:0DA4: 29 0F 00     	and	#<$f
  2886 00:0DA7: AA           	tax
  2887 00:0DA8: BD xx xx     	lda	|~~hextab,X
  2888 00:0DAB: 48           	pha
  2889 00:0DAC: D4 0E        	pei	<L141+w_0+2
  2890 00:0DAE: D4 0C        	pei	<L141+w_0
  2891 00:0DB0: 22 xx xx xx  	jsl	~~_vt100_putc
  2892                        ;		return;
  2893                        L146:
  2894 00:0DB4: A5 0A        	lda	<L141+2
  2895 00:0DB6: 85 10        	sta	<L141+2+6
  2896 00:0DB8: A5 09        	lda	<L141+1
  2897 00:0DBA: 85 0F        	sta	<L141+1+6
  2898 00:0DBC: 2B           	pld
  2899 00:0DBD: 3B           	tsc
  2900 00:0DBE: 18           	clc
  2901 00:0DBF: 69 0E 00     	adc	#L141+6
  2902 00:0DC2: 1B           	tcs
  2903 00:0DC3: 6B           	rtl
  2904                        ;	}
  2905                        ;	
  2906                        ;	// calculate current cursor position in the disp
                    lay ram
  Wed Jan 19 2022 17:05                                                Page 54


  2907                        ;	x = VT100_CURSOR_X(w);
  2908                        L10102:
  2909 00:0DC4: A0 25 00     	ldy	#$25
  2910 00:0DC7: B7 0C        	lda	[<L141+w_0],Y
  2911 00:0DC9: 85 05        	sta	<L142+x_1
  2912                        ;	y = VT100_CURSOR_Y(w);
  2913 00:0DCB: D4 0E        	pei	<L141+w_0+2
  2914 00:0DCD: D4 0C        	pei	<L141+w_0
  2915 00:0DCF: 22 xx xx xx  	jsl	~~VT100_CURSOR_Y
  2916 00:0DD3: 85 07        	sta	<L142+y_1
  2917                        ;
  2918                        ;	//debugf("_vt100_putc x:%d y:%d addr:%d\n", (lon
                    g)x, (long)y, (long)(x + y * w->width));
  2919                        ;	
  2920                        ;	ili9340_setFrontColor(w->front_color);
  2921 00:0DD5: A0 33 00     	ldy	#$33
  2922 00:0DD8: B7 0C        	lda	[<L141+w_0],Y
  2923 00:0DDA: 48           	pha
  2924 00:0DDB: 22 xx xx xx  	jsl	~~ili9340_setFrontColor
  2925                        ;	ili9340_setBackColor(w->back_color); 
  2926 00:0DDF: A0 35 00     	ldy	#$35
  2927 00:0DE2: B7 0C        	lda	[<L141+w_0],Y
  2928 00:0DE4: 48           	pha
  2929 00:0DE5: 22 xx xx xx  	jsl	~~ili9340_setBackColor
  2930                        ;	
  2931                        ;	ili9340_drawChar(w, ch);
  2932 00:0DE9: A5 10        	lda	<L141+ch_0
  2933 00:0DEB: 29 FF 00     	and	#$ff
  2934 00:0DEE: 48           	pha
  2935 00:0DEF: D4 0E        	pei	<L141+w_0+2
  2936 00:0DF1: D4 0C        	pei	<L141+w_0
  2937 00:0DF3: 22 xx xx xx  	jsl	~~ili9340_drawChar
  2938                        ;	
  2939                        ;	// move cursor right
  2940                        ;	_vt100_move(w, 1, 0); 
  2941 00:0DF7: F4 00 00     	pea	#<$0
  2942 00:0DFA: F4 01 00     	pea	#<$1
  2943 00:0DFD: D4 0E        	pei	<L141+w_0+2
  2944 00:0DFF: D4 0C        	pei	<L141+w_0
  2945 00:0E01: 22 xx xx xx  	jsl	~~_vt100_move
  2946                        ;	ili9340_drawCursor(w);
  2947 00:0E05: D4 0E        	pei	<L141+w_0+2
  2948 00:0E07: D4 0C        	pei	<L141+w_0
  2949 00:0E09: 22 xx xx xx  	jsl	~~ili9340_drawCursor
  2950                        ;}
  2951 00:0E0D: 80 A5        	bra	L146
  2952             00000008   L141	equ	8
  2953             00000005   L142	equ	5
  2954                        	ends
  2955                        	efunc
  2956                        ;
  2957                        ;void vt100_putc(win_t *w, uint8_t c){	
  2958                        	code
  2959                        	xdef	~~vt100_putc
  2960                        	func
  2961                        ~~vt100_putc:
  2962                        	longa	on
  2963                        	longi	on
  Wed Jan 19 2022 17:05                                                Page 55


  2964 00:0E0F: 3B           	tsc
  2965 00:0E10: 38           	sec
  2966 00:0E11: E9 00 00     	sbc	#L147
  2967 00:0E14: 1B           	tcs
  2968 00:0E15: 0B           	phd
  2969 00:0E16: 5B           	tcd
  2970             00000004   w_0	set	4
  2971             00000008   c_0	set	8
  2972                        ;	w->state(w, EV_CHAR, 0x0000 | c);
  2973 00:0E17: A5 08        	lda	<L147+c_0
  2974 00:0E19: 29 FF 00     	and	#$ff
  2975 00:0E1C: 48           	pha
  2976 00:0E1D: F4 01 00     	pea	#<$1
  2977 00:0E20: D4 06        	pei	<L147+w_0+2
  2978 00:0E22: D4 04        	pei	<L147+w_0
  2979 00:0E24: A0 17 08     	ldy	#$817
  2980 00:0E27: B7 04        	lda	[<L147+w_0],Y
  2981 00:0E29: AA           	tax
  2982 00:0E2A: 88           	dey
  2983 00:0E2B: 88           	dey
  2984 00:0E2C: B7 04        	lda	[<L147+w_0],Y
  2985                        	xref	~~~lcal
  2986 00:0E2E: 22 xx xx xx  	jsl	~~~lcal
  2987                        ;}
  2988 00:0E32: A5 02        	lda	<L147+2
  2989 00:0E34: 85 08        	sta	<L147+2+6
  2990 00:0E36: A5 01        	lda	<L147+1
  2991 00:0E38: 85 07        	sta	<L147+1+6
  2992 00:0E3A: 2B           	pld
  2993 00:0E3B: 3B           	tsc
  2994 00:0E3C: 18           	clc
  2995 00:0E3D: 69 06 00     	adc	#L147+6
  2996 00:0E40: 1B           	tcs
  2997 00:0E41: 6B           	rtl
  2998             00000000   L147	equ	0
  2999             00000001   L148	equ	1
  3000                        	ends
  3001                        	efunc
  3002                        ;
  3003                        ;ssize_t w_write(int fd, char *buf, size_t len) {
  3004                        	code
  3005                        	xdef	~~w_write
  3006                        	func
  3007                        ~~w_write:
  3008                        	longa	on
  3009                        	longi	on
  3010 00:0E42: 3B           	tsc
  3011 00:0E43: 38           	sec
  3012 00:0E44: E9 08 00     	sbc	#L150
  3013 00:0E47: 1B           	tcs
  3014 00:0E48: 0B           	phd
  3015 00:0E49: 5B           	tcd
  3016             00000004   fd_0	set	4
  3017             00000006   buf_0	set	6
  3018             0000000A   len_0	set	10
  3019                        ;	
  3020                        ;	win_t *w;
  3021                        ;	size_t l;
  Wed Jan 19 2022 17:05                                                Page 56


  3022                        ;	
  3023                        ;	l = len;
  3024             00000000   w_1	set	0
  3025             00000004   l_1	set	4
  3026 00:0E4A: A5 12        	lda	<L150+len_0
  3027 00:0E4C: 85 05        	sta	<L151+l_1
  3028 00:0E4E: A5 14        	lda	<L150+len_0+2
  3029 00:0E50: 85 07        	sta	<L151+l_1+2
  3030                        ;	
  3031                        ;	w = findWindow(fd);
  3032 00:0E52: D4 0C        	pei	<L150+fd_0
  3033 00:0E54: 22 xx xx xx  	jsl	~~findWindow
  3034 00:0E58: 85 01        	sta	<L151+w_1
  3035 00:0E5A: 86 03        	stx	<L151+w_1+2
  3036                        ;	if (!w) return -1;
  3037 00:0E5C: 05 03        	ora	<L151+w_1+2
  3038 00:0E5E: D0 3F        	bne	L10107
  3039 00:0E60: A9 FF FF     	lda	#$ffff
  3040 00:0E63: AA           	tax
  3041                        L153:
  3042 00:0E64: A8           	tay
  3043 00:0E65: A5 0A        	lda	<L150+2
  3044 00:0E67: 85 14        	sta	<L150+2+10
  3045 00:0E69: A5 09        	lda	<L150+1
  3046 00:0E6B: 85 13        	sta	<L150+1+10
  3047 00:0E6D: 2B           	pld
  3048 00:0E6E: 3B           	tsc
  3049 00:0E6F: 18           	clc
  3050 00:0E70: 69 12 00     	adc	#L150+10
  3051 00:0E73: 1B           	tcs
  3052 00:0E74: 98           	tya
  3053 00:0E75: 6B           	rtl
  3054                        ;	
  3055                        ;	for (; len; len--, buf++) {	
  3056                        L10106:
  3057                        ;		w->state(w, EV_CHAR, 0x0000 | *buf);
  3058 00:0E76: A7 0E        	lda	[<L150+buf_0]
  3059 00:0E78: 29 FF 00     	and	#$ff
  3060 00:0E7B: 48           	pha
  3061 00:0E7C: F4 01 00     	pea	#<$1
  3062 00:0E7F: D4 03        	pei	<L151+w_1+2
  3063 00:0E81: D4 01        	pei	<L151+w_1
  3064 00:0E83: A0 17 08     	ldy	#$817
  3065 00:0E86: B7 01        	lda	[<L151+w_1],Y
  3066 00:0E88: AA           	tax
  3067 00:0E89: 88           	dey
  3068 00:0E8A: 88           	dey
  3069 00:0E8B: B7 01        	lda	[<L151+w_1],Y
  3070                        	xref	~~~lcal
  3071 00:0E8D: 22 xx xx xx  	jsl	~~~lcal
  3072                        ;		//vt100_putc(w, *buf);
  3073                        ;	}
  3074 00:0E91: E6 0E        	inc	<L150+buf_0
  3075 00:0E93: D0 02        	bne	L154
  3076 00:0E95: E6 10        	inc	<L150+buf_0+2
  3077                        L154:
  3078 00:0E97: A5 12        	lda	<L150+len_0
  3079 00:0E99: D0 02        	bne	L155
  Wed Jan 19 2022 17:05                                                Page 57


  3080 00:0E9B: C6 14        	dec	<L150+len_0+2
  3081                        L155:
  3082 00:0E9D: C6 12        	dec	<L150+len_0
  3083                        L10107:
  3084 00:0E9F: A5 12        	lda	<L150+len_0
  3085 00:0EA1: 05 14        	ora	<L150+len_0+2
  3086 00:0EA3: D0 D1        	bne	L10106
  3087                        ;	
  3088                        ;	drawWindows();
  3089 00:0EA5: 22 xx xx xx  	jsl	~~drawWindows
  3090                        ;	return l;
  3091 00:0EA9: A6 07        	ldx	<L151+l_1+2
  3092 00:0EAB: A5 05        	lda	<L151+l_1
  3093 00:0EAD: 80 B5        	bra	L153
  3094                        ;}
  3095             00000008   L150	equ	8
  3096             00000001   L151	equ	1
  3097                        	ends
  3098                        	efunc
  3099                        ;
  3100                        ;
  3101                        ;void _vt100_resetScroll(win_t *term){
  3102                        	code
  3103                        	xdef	~~_vt100_resetScroll
  3104                        	func
  3105                        ~~_vt100_resetScroll:
  3106                        	longa	on
  3107                        	longi	on
  3108 00:0EAF: 3B           	tsc
  3109 00:0EB0: 38           	sec
  3110 00:0EB1: E9 00 00     	sbc	#L157
  3111 00:0EB4: 1B           	tcs
  3112 00:0EB5: 0B           	phd
  3113 00:0EB6: 5B           	tcd
  3114             00000004   term_0	set	4
  3115                        ;	term->scroll_start_row = 0;
  3116 00:0EB7: A9 00 00     	lda	#$0
  3117 00:0EBA: A0 2D 00     	ldy	#$2d
  3118 00:0EBD: 97 04        	sta	[<L157+term_0],Y
  3119                        ;	term->scroll_end_row = VT100_HEIGHT;
  3120 00:0EBF: A0 07 00     	ldy	#$7
  3121 00:0EC2: B7 04        	lda	[<L157+term_0],Y
  3122 00:0EC4: A0 2F 00     	ldy	#$2f
  3123 00:0EC7: 97 04        	sta	[<L157+term_0],Y
  3124                        ;	term->scroll_value = 0; 
  3125 00:0EC9: A9 00 00     	lda	#$0
  3126 00:0ECC: C8           	iny
  3127 00:0ECD: C8           	iny
  3128 00:0ECE: 97 04        	sta	[<L157+term_0],Y
  3129                        ;	ili9340_setScrollMargins(0, 0);
  3130 00:0ED0: F4 00 00     	pea	#<$0
  3131 00:0ED3: F4 00 00     	pea	#<$0
  3132 00:0ED6: 22 xx xx xx  	jsl	~~ili9340_setScrollMargins
  3133                        ;	ili9340_setScrollStart(0); 
  3134 00:0EDA: F4 00 00     	pea	#<$0
  3135 00:0EDD: 22 xx xx xx  	jsl	~~ili9340_setScrollStart
  3136                        ;}
  3137 00:0EE1: A5 02        	lda	<L157+2
  Wed Jan 19 2022 17:05                                                Page 58


  3138 00:0EE3: 85 06        	sta	<L157+2+4
  3139 00:0EE5: A5 01        	lda	<L157+1
  3140 00:0EE7: 85 05        	sta	<L157+1+4
  3141 00:0EE9: 2B           	pld
  3142 00:0EEA: 3B           	tsc
  3143 00:0EEB: 18           	clc
  3144 00:0EEC: 69 04 00     	adc	#L157+4
  3145 00:0EEF: 1B           	tcs
  3146 00:0EF0: 6B           	rtl
  3147             00000000   L157	equ	0
  3148             00000001   L158	equ	1
  3149                        	ends
  3150                        	efunc
  3151                        ;
  3152                        ;STATE(_st_esc_question, term, ev, arg){
  3153                        	code
  3154                        	xdef	~~_st_esc_question
  3155                        	func
  3156                        ~~_st_esc_question:
  3157                        	longa	on
  3158                        	longi	on
  3159 00:0EF1: 3B           	tsc
  3160 00:0EF2: 38           	sec
  3161 00:0EF3: E9 04 00     	sbc	#L160
  3162 00:0EF6: 1B           	tcs
  3163 00:0EF7: 0B           	phd
  3164 00:0EF8: 5B           	tcd
  3165             00000004   term_0	set	4
  3166             00000008   ev_0	set	8
  3167             0000000A   arg_0	set	10
  3168                        ;	// DEC mode commands
  3169                        ;	switch(ev){
  3170 00:0EF9: A5 0C        	lda	<L160+ev_0
  3171 00:0EFB: 29 FF 00     	and	#$ff
  3172                        	xref	~~~swt
  3173 00:0EFE: 22 xx xx xx  	jsl	~~~swt
  3174 00:0F02: 01 00        	dw	1
  3175 00:0F04: 01 00        	dw	1
  3176 00:0F06: xx xx        	dw	L10110-1
  3177 00:0F08: xx xx        	dw	L170-1
  3178                        ;		case EV_CHAR: {
  3179                        L10110:
  3180                        ;			if(isdigit(arg)){ // start of an
                     argument
  3181 00:0F0A: D4 0E        	pei	<L160+arg_0
  3182 00:0F0C: 22 xx xx xx  	jsl	~~isdigit
  3183 00:0F10: AA           	tax
  3184 00:0F11: F0 3B        	beq	L10111
  3185                        ;				term->ret_state = _st_es
                    c_question; 
  3186 00:0F13: A9 xx xx     	lda	#<~~_st_esc_question
  3187 00:0F16: A0 1D 08     	ldy	#$81d
  3188 00:0F19: 97 08        	sta	[<L160+term_0],Y
  3189 00:0F1B: A9 xx xx     	lda	#^~~_st_esc_question
  3190 00:0F1E: C8           	iny
  3191 00:0F1F: C8           	iny
  3192 00:0F20: 97 08        	sta	[<L160+term_0],Y
  3193                        ;				_st_command_arg(term, ev
  Wed Jan 19 2022 17:05                                                Page 59


                    , arg);
  3194 00:0F22: D4 0E        	pei	<L160+arg_0
  3195 00:0F24: D4 0C        	pei	<L160+ev_0
  3196 00:0F26: D4 0A        	pei	<L160+term_0+2
  3197 00:0F28: D4 08        	pei	<L160+term_0
  3198 00:0F2A: 22 xx xx xx  	jsl	~~_st_command_arg
  3199                        ;				term->state = _st_comman
                    d_arg;
  3200 00:0F2E: A9 xx xx     	lda	#<~~_st_command_arg
  3201 00:0F31: A0 15 08     	ldy	#$815
  3202 00:0F34: 97 08        	sta	[<L160+term_0],Y
  3203 00:0F36: A9 xx xx     	lda	#^~~_st_command_arg
  3204                        L20032:
  3205 00:0F39: A0 17 08     	ldy	#$817
  3206 00:0F3C: 97 08        	sta	[<L160+term_0],Y
  3207                        ;			} else if(arg == ';'){ // arg se
                    parator. 
  3208                        L170:
  3209 00:0F3E: A5 06        	lda	<L160+2
  3210 00:0F40: 85 0E        	sta	<L160+2+8
  3211 00:0F42: A5 05        	lda	<L160+1
  3212 00:0F44: 85 0D        	sta	<L160+1+8
  3213 00:0F46: 2B           	pld
  3214 00:0F47: 3B           	tsc
  3215 00:0F48: 18           	clc
  3216 00:0F49: 69 0C 00     	adc	#L160+8
  3217 00:0F4C: 1B           	tcs
  3218 00:0F4D: 6B           	rtl
  3219                        L10111:
  3220 00:0F4E: A5 0E        	lda	<L160+arg_0
  3221 00:0F50: C9 3B 00     	cmp	#<$3b
  3222 00:0F53: F0 E9        	beq	L170
  3223                        ;				// skip. And also stay i
                    n the command state
  3224                        ;			} else {
  3225                        ;				switch(arg) {
  3226 00:0F55: A5 0E        	lda	<L160+arg_0
  3227                        	xref	~~~fsw
  3228 00:0F57: 22 xx xx xx  	jsl	~~~fsw
  3229 00:0F5B: 68 00        	dw	104
  3230 00:0F5D: 07 00        	dw	7
  3231 00:0F5F: xx xx        	dw	L10120-1
  3232 00:0F61: xx xx        	dw	L10118-1
  3233 00:0F63: xx xx        	dw	L10120-1
  3234 00:0F65: xx xx        	dw	L10120-1
  3235 00:0F67: xx xx        	dw	L10120-1
  3236 00:0F69: xx xx        	dw	L10118-1
  3237 00:0F6B: xx xx        	dw	L10120-1
  3238 00:0F6D: xx xx        	dw	L10120-1
  3239                        ;					case 'l': 
  3240                        ;						// dec m
                    ode: OFF (arg[0] = function)
  3241                        ;					case 'h': {
  3242                        L10118:
  3243                        ;						// dec m
                    ode: ON (arg[0] = function)
  3244                        ;						switch(t
                    erm->args[0]){
  Wed Jan 19 2022 17:05                                                Page 60


  3245 00:0F6F: A0 0D 08     	ldy	#$80d
  3246 00:0F72: B7 08        	lda	[<L160+term_0],Y
  3247                        	xref	~~~fsw
  3248 00:0F74: 22 xx xx xx  	jsl	~~~fsw
  3249 00:0F78: 01 00        	dw	1
  3250 00:0F7A: 09 00        	dw	9
  3251 00:0F7C: xx xx        	dw	L10120-1
  3252 00:0F7E: xx xx        	dw	L10120-1
  3253 00:0F80: xx xx        	dw	L10120-1
  3254 00:0F82: xx xx        	dw	L10120-1
  3255 00:0F84: xx xx        	dw	L10120-1
  3256 00:0F86: xx xx        	dw	L10120-1
  3257 00:0F88: xx xx        	dw	L10126-1
  3258 00:0F8A: xx xx        	dw	L10127-1
  3259 00:0F8C: xx xx        	dw	L10120-1
  3260 00:0F8E: xx xx        	dw	L10120-1
  3261                        ;							
                    case 1: { // cursor keys mode
  3262                        ;							
                    	// h = esc 0 A for cursor up
  3263                        ;							
                    	// l = cursor keys send ansi commands
  3264                        ;							
                    	break;
  3265                        ;							
                    }
  3266                        ;							
                    case 2: { // ansi / vt52
  3267                        ;							
                    	// h = ansi mode
  3268                        ;							
                    	// l = vt52 mode
  3269                        ;							
                    	break;
  3270                        ;							
                    }
  3271                        ;							
                    case 3: {
  3272                        ;							
                    	// h = 132 chars per line
  3273                        ;							
                    	// l = 80 chars per line
  3274                        ;							
                    	break;
  3275                        ;							
                    }
  3276                        ;							
                    case 4: {
  3277                        ;							
                    	// h = smooth scroll
  3278                        ;							
                    	// l = jump scroll
  3279                        ;							
                    	break;
  3280                        ;							
                    }
  3281                        ;							
                    case 5: {
  Wed Jan 19 2022 17:05                                                Page 61


  3282                        ;							
                    	// h = black on white bg
  3283                        ;							
                    	// l = white on black bg
  3284                        ;							
                    	break;
  3285                        ;							
                    }
  3286                        ;							
                    case 6: {
  3287                        L10126:
  3288                        ;							
                    	// h = cursor relative to scroll region
  3289                        ;							
                    	// l = cursor independent of scroll region
  3290                        ;							
                    	term->flags.f.origin_mode = (arg == 'h')?1:0; 
  3291 00:0F90: A5 0E        	lda	<L160+arg_0
  3292 00:0F92: C9 68 00     	cmp	#<$68
  3293 00:0F95: D0 07        	bne	L164
  3294 00:0F97: A9 01 00     	lda	#$1
  3295 00:0F9A: 85 01        	sta	<R0
  3296 00:0F9C: 80 02        	bra	L20027
  3297                        L164:
  3298 00:0F9E: 64 01        	stz	<R0
  3299                        L20027:
  3300 00:0FA0: A5 01        	lda	<R0
  3301 00:0FA2: 85 01        	sta	<R0
  3302 00:0FA4: E2 20        	sep	#$20
  3303                        	longa	off
  3304 00:0FA6: 06 01        	asl	<R0
  3305 00:0FA8: 06 01        	asl	<R0
  3306 00:0FAA: A5 01        	lda	<R0
  3307 00:0FAC: 29 04        	and	#<$4
  3308 00:0FAE: 85 01        	sta	<R0
  3309 00:0FB0: A7 08        	lda	[<L160+term_0]
  3310 00:0FB2: 29 FB        	and	#<$fffffffb
  3311 00:0FB4: 05 01        	ora	<R0
  3312 00:0FB6: 87 08        	sta	[<L160+term_0]
  3313 00:0FB8: C2 20        	rep	#$20
  3314                        	longa	on
  3315                        ;							
                    	break;
  3316                        L10120:
  3317                        ;						term->st
                    ate = _st_idle;
  3318 00:0FBA: A9 xx xx     	lda	#<~~_st_idle
  3319 00:0FBD: A0 15 08     	ldy	#$815
  3320 00:0FC0: 97 08        	sta	[<L160+term_0],Y
  3321 00:0FC2: A9 xx xx     	lda	#^~~_st_idle
  3322 00:0FC5: C8           	iny
  3323 00:0FC6: C8           	iny
  3324 00:0FC7: 97 08        	sta	[<L160+term_0],Y
  3325                        ;						break; 
  3326                        ;				term->state = _st_idle;
  3327 00:0FC9: A9 xx xx     	lda	#<~~_st_idle
  3328 00:0FCC: 88           	dey
  3329 00:0FCD: 88           	dey
  Wed Jan 19 2022 17:05                                                Page 62


  3330 00:0FCE: 97 08        	sta	[<L160+term_0],Y
  3331 00:0FD0: A9 xx xx     	lda	#^~~_st_idle
  3332 00:0FD3: 82 63 FF     	brl	L20032
  3333                        ;			}
  3334                        ;		}
  3335                        ;	}
  3336                        ;							
                    }
  3337                        ;							
                    case 7: {
  3338                        L10127:
  3339                        ;							
                    	// h = new line after last column
  3340                        ;							
                    	// l = cursor stays at the end of line
  3341                        ;							
                    	term->flags.f.cursor_wrap = (arg == 'h')?1:0; 
  3342 00:0FD6: A5 0E        	lda	<L160+arg_0
  3343 00:0FD8: C9 68 00     	cmp	#<$68
  3344 00:0FDB: D0 07        	bne	L167
  3345 00:0FDD: A9 01 00     	lda	#$1
  3346 00:0FE0: 85 01        	sta	<R0
  3347 00:0FE2: 80 02        	bra	L20028
  3348                        L167:
  3349 00:0FE4: 64 01        	stz	<R0
  3350                        L20028:
  3351 00:0FE6: A5 01        	lda	<R0
  3352 00:0FE8: E2 20        	sep	#$20
  3353                        	longa	off
  3354 00:0FEA: 29 01        	and	#<$1
  3355 00:0FEC: 85 01        	sta	<R0
  3356 00:0FEE: A7 08        	lda	[<L160+term_0]
  3357 00:0FF0: 29 FE        	and	#<$fffffffe
  3358 00:0FF2: 05 01        	ora	<R0
  3359 00:0FF4: 87 08        	sta	[<L160+term_0]
  3360 00:0FF6: C2 20        	rep	#$20
  3361                        	longa	on
  3362                        ;							
                    	break;
  3363 00:0FF8: 80 C0        	bra	L10120
  3364                        ;							
                    }
  3365                        ;							
                    case 8: {
  3366                        ;							
                    	// h = keys will auto repeat
  3367                        ;							
                    	// l = keys do not auto repeat when held down
  3368                        ;							
                    	break;
  3369                        ;							
                    }
  3370                        ;							
                    case 9: {
  3371                        ;							
                    	// h = display interlaced
  3372                        ;							
                    	// l = display not interlaced
  Wed Jan 19 2022 17:05                                                Page 63


  3373                        ;							
                    	break;
  3374                        ;							
                    }
  3375                        ;							
                    // 10-38 - all quite DEC speciffic commands so omitted here
  3376                        ;						}
  3377                        ;					}
  3378                        ;					case 'i': /* Pri
                    nting */  
  3379                        ;					case 'n': /* Req
                    uest printer status */
  3380                        ;					default:  
  3381                        ;						term->st
                    ate = _st_idle; 
  3382                        ;						break;
  3383                        ;				}
  3384                        ;}
  3385             00000004   L160	equ	4
  3386             00000005   L161	equ	5
  3387                        	ends
  3388                        	efunc
  3389                        ;
  3390                        ;STATE(_st_esc_left_br, term, ev, arg){
  3391                        	code
  3392                        	xdef	~~_st_esc_left_br
  3393                        	func
  3394                        ~~_st_esc_left_br:
  3395                        	longa	on
  3396                        	longi	on
  3397 00:0FFA: 3B           	tsc
  3398 00:0FFB: 38           	sec
  3399 00:0FFC: E9 00 00     	sbc	#L171
  3400 00:0FFF: 1B           	tcs
  3401 00:1000: 0B           	phd
  3402 00:1001: 5B           	tcd
  3403             00000004   term_0	set	4
  3404             00000008   ev_0	set	8
  3405             0000000A   arg_0	set	10
  3406                        ;	switch(ev){
  3407 00:1002: A5 08        	lda	<L171+ev_0
  3408 00:1004: 29 FF 00     	and	#$ff
  3409                        	xref	~~~swt
  3410 00:1007: 22 xx xx xx  	jsl	~~~swt
  3411 00:100B: 01 00        	dw	1
  3412 00:100D: 01 00        	dw	1
  3413 00:100F: xx xx        	dw	L10135-1
  3414 00:1011: xx xx        	dw	L173-1
  3415                        ;		case EV_CHAR: {
  3416                        L10135:
  3417                        ;			switch(arg) {  
  3418 00:1013: A5 0A        	lda	<L171+arg_0
  3419                        	xref	~~~swt
  3420 00:1015: 22 xx xx xx  	jsl	~~~swt
  3421 00:1019: 04 00        	dw	4
  3422 00:101B: 30 00        	dw	48
  3423 00:101D: xx xx        	dw	L10141-1
  3424 00:101F: 41 00        	dw	65
  Wed Jan 19 2022 17:05                                                Page 64


  3425 00:1021: xx xx        	dw	L10141-1
  3426 00:1023: 42 00        	dw	66
  3427 00:1025: xx xx        	dw	L10141-1
  3428 00:1027: 4F 00        	dw	79
  3429 00:1029: xx xx        	dw	L10141-1
  3430 00:102B: xx xx        	dw	L10141-1
  3431                        ;				case 'A':  
  3432                        ;				case 'B':  
  3433                        ;					// translation m
                    ap command?
  3434                        ;				case '0':  
  3435                        ;				case 'O':
  3436                        L10141:
  3437                        ;					// another trans
                    lation map command?
  3438                        ;					term->state = _s
                    t_idle;
  3439 00:102D: A9 xx xx     	lda	#<~~_st_idle
  3440 00:1030: A0 15 08     	ldy	#$815
  3441 00:1033: 97 04        	sta	[<L171+term_0],Y
  3442 00:1035: A9 xx xx     	lda	#^~~_st_idle
  3443 00:1038: C8           	iny
  3444 00:1039: C8           	iny
  3445 00:103A: 97 04        	sta	[<L171+term_0],Y
  3446                        ;					break;
  3447                        L173:
  3448 00:103C: A5 02        	lda	<L171+2
  3449 00:103E: 85 0A        	sta	<L171+2+8
  3450 00:1040: A5 01        	lda	<L171+1
  3451 00:1042: 85 09        	sta	<L171+1+8
  3452 00:1044: 2B           	pld
  3453 00:1045: 3B           	tsc
  3454 00:1046: 18           	clc
  3455 00:1047: 69 08 00     	adc	#L171+8
  3456 00:104A: 1B           	tcs
  3457 00:104B: 6B           	rtl
  3458                        ;				default:
  3459                        ;					term->state = _s
                    t_idle;
  3460                        ;			}
  3461                        ;			//term->state = _st_idle;
  3462                        ;		}
  3463                        ;	}
  3464                        ;}
  3465             00000000   L171	equ	0
  3466             00000001   L172	equ	1
  3467                        	ends
  3468                        	efunc
  3469                        ;
  3470                        ;STATE(_st_esc_right_br, term, ev, arg){
  3471                        	code
  3472                        	xdef	~~_st_esc_right_br
  3473                        	func
  3474                        ~~_st_esc_right_br:
  3475                        	longa	on
  3476                        	longi	on
  3477 00:104C: 3B           	tsc
  3478 00:104D: 38           	sec
  Wed Jan 19 2022 17:05                                                Page 65


  3479 00:104E: E9 00 00     	sbc	#L174
  3480 00:1051: 1B           	tcs
  3481 00:1052: 0B           	phd
  3482 00:1053: 5B           	tcd
  3483             00000004   term_0	set	4
  3484             00000008   ev_0	set	8
  3485             0000000A   arg_0	set	10
  3486                        ;	switch(ev){
  3487 00:1054: A5 08        	lda	<L174+ev_0
  3488 00:1056: 29 FF 00     	and	#$ff
  3489                        	xref	~~~swt
  3490 00:1059: 22 xx xx xx  	jsl	~~~swt
  3491 00:105D: 01 00        	dw	1
  3492 00:105F: 01 00        	dw	1
  3493 00:1061: xx xx        	dw	L10145-1
  3494 00:1063: xx xx        	dw	L176-1
  3495                        ;		case EV_CHAR: {
  3496                        L10145:
  3497                        ;			switch(arg) {  
  3498 00:1065: A5 0A        	lda	<L174+arg_0
  3499                        	xref	~~~swt
  3500 00:1067: 22 xx xx xx  	jsl	~~~swt
  3501 00:106B: 04 00        	dw	4
  3502 00:106D: 30 00        	dw	48
  3503 00:106F: xx xx        	dw	L10151-1
  3504 00:1071: 41 00        	dw	65
  3505 00:1073: xx xx        	dw	L10151-1
  3506 00:1075: 42 00        	dw	66
  3507 00:1077: xx xx        	dw	L10151-1
  3508 00:1079: 4F 00        	dw	79
  3509 00:107B: xx xx        	dw	L10151-1
  3510 00:107D: xx xx        	dw	L10151-1
  3511                        ;				case 'A':  
  3512                        ;				case 'B':  
  3513                        ;					// translation m
                    ap command?
  3514                        ;				case '0':  
  3515                        ;				case 'O':
  3516                        L10151:
  3517                        ;					// another trans
                    lation map command?
  3518                        ;					term->state = _s
                    t_idle;
  3519 00:107F: A9 xx xx     	lda	#<~~_st_idle
  3520 00:1082: A0 15 08     	ldy	#$815
  3521 00:1085: 97 04        	sta	[<L174+term_0],Y
  3522 00:1087: A9 xx xx     	lda	#^~~_st_idle
  3523 00:108A: C8           	iny
  3524 00:108B: C8           	iny
  3525 00:108C: 97 04        	sta	[<L174+term_0],Y
  3526                        ;					break;
  3527                        L176:
  3528 00:108E: A5 02        	lda	<L174+2
  3529 00:1090: 85 0A        	sta	<L174+2+8
  3530 00:1092: A5 01        	lda	<L174+1
  3531 00:1094: 85 09        	sta	<L174+1+8
  3532 00:1096: 2B           	pld
  3533 00:1097: 3B           	tsc
  Wed Jan 19 2022 17:05                                                Page 66


  3534 00:1098: 18           	clc
  3535 00:1099: 69 08 00     	adc	#L174+8
  3536 00:109C: 1B           	tcs
  3537 00:109D: 6B           	rtl
  3538                        ;				default:
  3539                        ;					term->state = _s
                    t_idle;
  3540                        ;			}
  3541                        ;			//term->state = _st_idle;
  3542                        ;		}
  3543                        ;	}
  3544                        ;}
  3545             00000000   L174	equ	0
  3546             00000001   L175	equ	1
  3547                        	ends
  3548                        	efunc
  3549                        ;
  3550                        ;STATE(_st_esc_hash, term, ev, arg){
  3551                        	code
  3552                        	xdef	~~_st_esc_hash
  3553                        	func
  3554                        ~~_st_esc_hash:
  3555                        	longa	on
  3556                        	longi	on
  3557 00:109E: 3B           	tsc
  3558 00:109F: 38           	sec
  3559 00:10A0: E9 00 00     	sbc	#L177
  3560 00:10A3: 1B           	tcs
  3561 00:10A4: 0B           	phd
  3562 00:10A5: 5B           	tcd
  3563             00000004   term_0	set	4
  3564             00000008   ev_0	set	8
  3565             0000000A   arg_0	set	10
  3566                        ;	switch(ev){
  3567 00:10A6: A5 08        	lda	<L177+ev_0
  3568 00:10A8: 29 FF 00     	and	#$ff
  3569                        	xref	~~~swt
  3570 00:10AB: 22 xx xx xx  	jsl	~~~swt
  3571 00:10AF: 01 00        	dw	1
  3572 00:10B1: 01 00        	dw	1
  3573 00:10B3: xx xx        	dw	L10155-1
  3574 00:10B5: xx xx        	dw	L179-1
  3575                        ;		case EV_CHAR: {
  3576                        L10155:
  3577                        ;			switch(arg) {  
  3578 00:10B7: A5 0A        	lda	<L177+arg_0
  3579                        	xref	~~~swt
  3580 00:10B9: 22 xx xx xx  	jsl	~~~swt
  3581 00:10BD: 01 00        	dw	1
  3582 00:10BF: 38 00        	dw	56
  3583 00:10C1: xx xx        	dw	L10158-1
  3584 00:10C3: xx xx        	dw	L10158-1
  3585                        ;				case '8': {
  3586                        L10158:
  3587                        ;					// self test: fi
                    ll the screen with 'E'
  3588                        ;					
  3589                        ;					term->state = _s
  Wed Jan 19 2022 17:05                                                Page 67


                    t_idle;
  3590 00:10C5: A9 xx xx     	lda	#<~~_st_idle
  3591 00:10C8: A0 15 08     	ldy	#$815
  3592 00:10CB: 97 04        	sta	[<L177+term_0],Y
  3593 00:10CD: A9 xx xx     	lda	#^~~_st_idle
  3594 00:10D0: C8           	iny
  3595 00:10D1: C8           	iny
  3596 00:10D2: 97 04        	sta	[<L177+term_0],Y
  3597                        ;					break;
  3598                        L179:
  3599 00:10D4: A5 02        	lda	<L177+2
  3600 00:10D6: 85 0A        	sta	<L177+2+8
  3601 00:10D8: A5 01        	lda	<L177+1
  3602 00:10DA: 85 09        	sta	<L177+1+8
  3603 00:10DC: 2B           	pld
  3604 00:10DD: 3B           	tsc
  3605 00:10DE: 18           	clc
  3606 00:10DF: 69 08 00     	adc	#L177+8
  3607 00:10E2: 1B           	tcs
  3608 00:10E3: 6B           	rtl
  3609                        ;				}
  3610                        ;				default:
  3611                        ;					term->state = _s
                    t_idle;
  3612                        ;			}
  3613                        ;		}
  3614                        ;	}
  3615                        ;}
  3616             00000000   L177	equ	0
  3617             00000001   L178	equ	1
  3618                        	ends
  3619                        	efunc
  3620                        ;
  3621                        ;STATE(_st_escape, term, ev, arg){
  3622                        	code
  3623                        	xdef	~~_st_escape
  3624                        	func
  3625                        ~~_st_escape:
  3626                        	longa	on
  3627                        	longi	on
  3628 00:10E4: 3B           	tsc
  3629 00:10E5: 38           	sec
  3630 00:10E6: E9 12 00     	sbc	#L180
  3631 00:10E9: 1B           	tcs
  3632 00:10EA: 0B           	phd
  3633 00:10EB: 5B           	tcd
  3634             00000004   term_0	set	4
  3635             00000008   ev_0	set	8
  3636             0000000A   arg_0	set	10
  3637                        ;	uint16_t c;
  3638                        ;	
  3639                        ;	switch(ev){
  3640             00000000   c_1	set	0
  3641 00:10EC: A5 1A        	lda	<L180+ev_0
  3642 00:10EE: 29 FF 00     	and	#$ff
  3643                        	xref	~~~swt
  3644 00:10F1: 22 xx xx xx  	jsl	~~~swt
  3645 00:10F5: 01 00        	dw	1
  Wed Jan 19 2022 17:05                                                Page 68


  3646 00:10F7: 01 00        	dw	1
  3647 00:10F9: xx xx        	dw	L10162-1
  3648 00:10FB: xx xx        	dw	L10185-1
  3649                        ;		case EV_CHAR: {
  3650                        L10162:
  3651                        ;			#define CLEAR_ARGS \
  3652                        ;				{ term->narg = 0;\
  3653                        ;				for(c = 0; c < MAX_COMMA
                    ND_ARGS; c++)\
  3654                        ;					term->args[c] = 
                    0; }\
  3655                        ;			
  3656                        ;			switch(arg){
  3657 00:10FD: A5 1C        	lda	<L180+arg_0
  3658                        	xref	~~~swt
  3659 00:10FF: 22 xx xx xx  	jsl	~~~swt
  3660 00:1103: 15 00        	dw	21
  3661 00:1105: 1B 00        	dw	27
  3662 00:1107: xx xx        	dw	L186-1
  3663 00:1109: 23 00        	dw	35
  3664 00:110B: xx xx        	dw	L10180-1
  3665 00:110D: 28 00        	dw	40
  3666 00:110F: xx xx        	dw	L10170-1
  3667 00:1111: 29 00        	dw	41
  3668 00:1113: xx xx        	dw	L10175-1
  3669 00:1115: 37 00        	dw	55
  3670 00:1117: xx xx        	dw	L10190-1
  3671 00:1119: 38 00        	dw	56
  3672 00:111B: xx xx        	dw	L10192-1
  3673 00:111D: 3C 00        	dw	60
  3674 00:111F: xx xx        	dw	L10185-1
  3675 00:1121: 3D 00        	dw	61
  3676 00:1123: xx xx        	dw	L10185-1
  3677 00:1125: 3E 00        	dw	62
  3678 00:1127: xx xx        	dw	L10185-1
  3679 00:1129: 44 00        	dw	68
  3680 00:112B: xx xx        	dw	L10186-1
  3681 00:112D: 45 00        	dw	69
  3682 00:112F: xx xx        	dw	L10188-1
  3683 00:1131: 48 00        	dw	72
  3684 00:1133: xx xx        	dw	L10185-1
  3685 00:1135: 4D 00        	dw	77
  3686 00:1137: xx xx        	dw	L10187-1
  3687 00:1139: 4E 00        	dw	78
  3688 00:113B: xx xx        	dw	L10185-1
  3689 00:113D: 4F 00        	dw	79
  3690 00:113F: xx xx        	dw	L10185-1
  3691 00:1141: 50 00        	dw	80
  3692 00:1143: xx xx        	dw	L10185-1
  3693 00:1145: 5A 00        	dw	90
  3694 00:1147: xx xx        	dw	L10195-1
  3695 00:1149: 5B 00        	dw	91
  3696 00:114B: xx xx        	dw	L10165-1
  3697 00:114D: 63 00        	dw	99
  3698 00:114F: xx xx        	dw	L10196-1
  3699 00:1151: 73 00        	dw	115
  3700 00:1153: xx xx        	dw	L10190-1
  3701 00:1155: 75 00        	dw	117
  Wed Jan 19 2022 17:05                                                Page 69


  3702 00:1157: xx xx        	dw	L10192-1
  3703 00:1159: xx xx        	dw	L10185-1
  3704                        ;				case '[': { // command
  3705                        L10165:
  3706                        ;					// prepare comma
                    nd state and switch to it
  3707                        ;					CLEAR_ARGS; 
  3708 00:115B: A9 00 00     	lda	#$0
  3709 00:115E: A0 0B 08     	ldy	#$80b
  3710 00:1161: 97 16        	sta	[<L180+term_0],Y
  3711 00:1163: 64 11        	stz	<L181+c_1
  3712 00:1165: 80 38        	bra	L10169
  3713                        L10168:
  3714 00:1167: A5 11        	lda	<L181+c_1
  3715 00:1169: 85 05        	sta	<R1
  3716 00:116B: 64 07        	stz	<R1+2
  3717 00:116D: D4 07        	pei	<R1+2
  3718 00:116F: D4 05        	pei	<R1
  3719 00:1171: A9 01 00     	lda	#$1
  3720                        	xref	~~~lasl
  3721 00:1174: 22 xx xx xx  	jsl	~~~lasl
  3722 00:1178: 85 01        	sta	<R0
  3723 00:117A: 86 03        	stx	<R0+2
  3724 00:117C: A9 0D 08     	lda	#$80d
  3725 00:117F: 18           	clc
  3726 00:1180: 65 16        	adc	<L180+term_0
  3727 00:1182: 85 09        	sta	<R2
  3728 00:1184: A9 00 00     	lda	#$0
  3729 00:1187: 65 18        	adc	<L180+term_0+2
  3730 00:1189: 85 0B        	sta	<R2+2
  3731 00:118B: A5 09        	lda	<R2
  3732 00:118D: 18           	clc
  3733 00:118E: 65 01        	adc	<R0
  3734 00:1190: 85 0D        	sta	<R3
  3735 00:1192: A5 0B        	lda	<R2+2
  3736 00:1194: 65 03        	adc	<R0+2
  3737 00:1196: 85 0F        	sta	<R3+2
  3738 00:1198: A9 00 00     	lda	#$0
  3739 00:119B: 87 0D        	sta	[<R3]
  3740 00:119D: E6 11        	inc	<L181+c_1
  3741                        L10169:
  3742 00:119F: A5 11        	lda	<L181+c_1
  3743 00:11A1: C9 04 00     	cmp	#<$4
  3744 00:11A4: 90 C1        	bcc	L10168
  3745                        ;					term->state = _s
                    t_esc_sq_bracket;
  3746 00:11A6: A9 xx xx     	lda	#<~~_st_esc_sq_bracket
  3747 00:11A9: A0 15 08     	ldy	#$815
  3748 00:11AC: 97 16        	sta	[<L180+term_0],Y
  3749 00:11AE: A9 xx xx     	lda	#^~~_st_esc_sq_bracket
  3750                        L20052:
  3751 00:11B1: A0 17 08     	ldy	#$817
  3752 00:11B4: 97 16        	sta	[<L180+term_0],Y
  3753                        ;					break;
  3754                        L186:
  3755 00:11B6: A5 14        	lda	<L180+2
  3756 00:11B8: 85 1C        	sta	<L180+2+8
  3757 00:11BA: A5 13        	lda	<L180+1
  Wed Jan 19 2022 17:05                                                Page 70


  3758 00:11BC: 85 1B        	sta	<L180+1+8
  3759 00:11BE: 2B           	pld
  3760 00:11BF: 3B           	tsc
  3761 00:11C0: 18           	clc
  3762 00:11C1: 69 1A 00     	adc	#L180+8
  3763 00:11C4: 1B           	tcs
  3764 00:11C5: 6B           	rtl
  3765                        ;				}
  3766                        ;				case '(': /* ESC ( */  
  3767                        L10170:
  3768                        ;					CLEAR_ARGS;
  3769 00:11C6: A9 00 00     	lda	#$0
  3770 00:11C9: A0 0B 08     	ldy	#$80b
  3771 00:11CC: 97 16        	sta	[<L180+term_0],Y
  3772 00:11CE: 64 11        	stz	<L181+c_1
  3773 00:11D0: 80 38        	bra	L10174
  3774                        L10173:
  3775 00:11D2: A5 11        	lda	<L181+c_1
  3776 00:11D4: 85 05        	sta	<R1
  3777 00:11D6: 64 07        	stz	<R1+2
  3778 00:11D8: D4 07        	pei	<R1+2
  3779 00:11DA: D4 05        	pei	<R1
  3780 00:11DC: A9 01 00     	lda	#$1
  3781                        	xref	~~~lasl
  3782 00:11DF: 22 xx xx xx  	jsl	~~~lasl
  3783 00:11E3: 85 01        	sta	<R0
  3784 00:11E5: 86 03        	stx	<R0+2
  3785 00:11E7: A9 0D 08     	lda	#$80d
  3786 00:11EA: 18           	clc
  3787 00:11EB: 65 16        	adc	<L180+term_0
  3788 00:11ED: 85 09        	sta	<R2
  3789 00:11EF: A9 00 00     	lda	#$0
  3790 00:11F2: 65 18        	adc	<L180+term_0+2
  3791 00:11F4: 85 0B        	sta	<R2+2
  3792 00:11F6: A5 09        	lda	<R2
  3793 00:11F8: 18           	clc
  3794 00:11F9: 65 01        	adc	<R0
  3795 00:11FB: 85 0D        	sta	<R3
  3796 00:11FD: A5 0B        	lda	<R2+2
  3797 00:11FF: 65 03        	adc	<R0+2
  3798 00:1201: 85 0F        	sta	<R3+2
  3799 00:1203: A9 00 00     	lda	#$0
  3800 00:1206: 87 0D        	sta	[<R3]
  3801 00:1208: E6 11        	inc	<L181+c_1
  3802                        L10174:
  3803 00:120A: A5 11        	lda	<L181+c_1
  3804 00:120C: C9 04 00     	cmp	#<$4
  3805 00:120F: 90 C1        	bcc	L10173
  3806                        ;					term->state = _s
                    t_esc_left_br;
  3807 00:1211: A9 xx xx     	lda	#<~~_st_esc_left_br
  3808 00:1214: A0 15 08     	ldy	#$815
  3809 00:1217: 97 16        	sta	[<L180+term_0],Y
  3810 00:1219: A9 xx xx     	lda	#^~~_st_esc_left_br
  3811 00:121C: 80 93        	bra	L20052
  3812                        ;					break; 
  3813                        ;				case ')': /* ESC ) */  
  3814                        L10175:
  Wed Jan 19 2022 17:05                                                Page 71


  3815                        ;					CLEAR_ARGS;
  3816 00:121E: A9 00 00     	lda	#$0
  3817 00:1221: A0 0B 08     	ldy	#$80b
  3818 00:1224: 97 16        	sta	[<L180+term_0],Y
  3819 00:1226: 64 11        	stz	<L181+c_1
  3820 00:1228: 80 38        	bra	L10179
  3821                        L10178:
  3822 00:122A: A5 11        	lda	<L181+c_1
  3823 00:122C: 85 05        	sta	<R1
  3824 00:122E: 64 07        	stz	<R1+2
  3825 00:1230: D4 07        	pei	<R1+2
  3826 00:1232: D4 05        	pei	<R1
  3827 00:1234: A9 01 00     	lda	#$1
  3828                        	xref	~~~lasl
  3829 00:1237: 22 xx xx xx  	jsl	~~~lasl
  3830 00:123B: 85 01        	sta	<R0
  3831 00:123D: 86 03        	stx	<R0+2
  3832 00:123F: A9 0D 08     	lda	#$80d
  3833 00:1242: 18           	clc
  3834 00:1243: 65 16        	adc	<L180+term_0
  3835 00:1245: 85 09        	sta	<R2
  3836 00:1247: A9 00 00     	lda	#$0
  3837 00:124A: 65 18        	adc	<L180+term_0+2
  3838 00:124C: 85 0B        	sta	<R2+2
  3839 00:124E: A5 09        	lda	<R2
  3840 00:1250: 18           	clc
  3841 00:1251: 65 01        	adc	<R0
  3842 00:1253: 85 0D        	sta	<R3
  3843 00:1255: A5 0B        	lda	<R2+2
  3844 00:1257: 65 03        	adc	<R0+2
  3845 00:1259: 85 0F        	sta	<R3+2
  3846 00:125B: A9 00 00     	lda	#$0
  3847 00:125E: 87 0D        	sta	[<R3]
  3848 00:1260: E6 11        	inc	<L181+c_1
  3849                        L10179:
  3850 00:1262: A5 11        	lda	<L181+c_1
  3851 00:1264: C9 04 00     	cmp	#<$4
  3852 00:1267: 90 C1        	bcc	L10178
  3853                        ;					term->state = _s
                    t_esc_right_br;
  3854 00:1269: A9 xx xx     	lda	#<~~_st_esc_right_br
  3855 00:126C: A0 15 08     	ldy	#$815
  3856 00:126F: 97 16        	sta	[<L180+term_0],Y
  3857 00:1271: A9 xx xx     	lda	#^~~_st_esc_right_br
  3858 00:1274: 82 3A FF     	brl	L20052
  3859                        ;					break;  
  3860                        ;				case '#': // ESC # 
  3861                        L10180:
  3862                        ;					CLEAR_ARGS;
  3863 00:1277: A9 00 00     	lda	#$0
  3864 00:127A: A0 0B 08     	ldy	#$80b
  3865 00:127D: 97 16        	sta	[<L180+term_0],Y
  3866 00:127F: 64 11        	stz	<L181+c_1
  3867 00:1281: 80 38        	bra	L10184
  3868                        L10183:
  3869 00:1283: A5 11        	lda	<L181+c_1
  3870 00:1285: 85 05        	sta	<R1
  3871 00:1287: 64 07        	stz	<R1+2
  Wed Jan 19 2022 17:05                                                Page 72


  3872 00:1289: D4 07        	pei	<R1+2
  3873 00:128B: D4 05        	pei	<R1
  3874 00:128D: A9 01 00     	lda	#$1
  3875                        	xref	~~~lasl
  3876 00:1290: 22 xx xx xx  	jsl	~~~lasl
  3877 00:1294: 85 01        	sta	<R0
  3878 00:1296: 86 03        	stx	<R0+2
  3879 00:1298: A9 0D 08     	lda	#$80d
  3880 00:129B: 18           	clc
  3881 00:129C: 65 16        	adc	<L180+term_0
  3882 00:129E: 85 09        	sta	<R2
  3883 00:12A0: A9 00 00     	lda	#$0
  3884 00:12A3: 65 18        	adc	<L180+term_0+2
  3885 00:12A5: 85 0B        	sta	<R2+2
  3886 00:12A7: A5 09        	lda	<R2
  3887 00:12A9: 18           	clc
  3888 00:12AA: 65 01        	adc	<R0
  3889 00:12AC: 85 0D        	sta	<R3
  3890 00:12AE: A5 0B        	lda	<R2+2
  3891 00:12B0: 65 03        	adc	<R0+2
  3892 00:12B2: 85 0F        	sta	<R3+2
  3893 00:12B4: A9 00 00     	lda	#$0
  3894 00:12B7: 87 0D        	sta	[<R3]
  3895 00:12B9: E6 11        	inc	<L181+c_1
  3896                        L10184:
  3897 00:12BB: A5 11        	lda	<L181+c_1
  3898 00:12BD: C9 04 00     	cmp	#<$4
  3899 00:12C0: 90 C1        	bcc	L10183
  3900                        ;					term->state = _s
                    t_esc_hash;
  3901 00:12C2: A9 xx xx     	lda	#<~~_st_esc_hash
  3902 00:12C5: A0 15 08     	ldy	#$815
  3903 00:12C8: 97 16        	sta	[<L180+term_0],Y
  3904 00:12CA: A9 xx xx     	lda	#^~~_st_esc_hash
  3905 00:12CD: 82 E1 FE     	brl	L20052
  3906                        ;					break;  
  3907                        ;				case 'P': //ESC P (DCS, 
                    Device Control String)
  3908                        ;					break;
  3909                        ;				case 'D': // moves curso
                    r down one line and scrolls if necessary
  3910                        L10186:
  3911                        ;					// move cursor d
                    own one line and scroll window if at bottom line
  3912                        ;					_vt100_move(term
                    , 0, 1); 
  3913 00:12D0: F4 01 00     	pea	#<$1
  3914                        L20092:
  3915 00:12D3: F4 00 00     	pea	#<$0
  3916 00:12D6: D4 18        	pei	<L180+term_0+2
  3917 00:12D8: D4 16        	pei	<L180+term_0
  3918 00:12DA: 22 xx xx xx  	jsl	~~_vt100_move
  3919                        ;					term->state = _s
                    t_idle;
  3920                        L10185:
  3921                        ;					term->state = _s
                    t_idle; 
  3922 00:12DE: A9 xx xx     	lda	#<~~_st_idle
  Wed Jan 19 2022 17:05                                                Page 73


  3923 00:12E1: A0 15 08     	ldy	#$815
  3924 00:12E4: 97 16        	sta	[<L180+term_0],Y
  3925 00:12E6: A9 xx xx     	lda	#^~~_st_idle
  3926 00:12E9: 82 C5 FE     	brl	L20052
  3927                        ;					break; 
  3928                        ;				case 'M': // Cursor up
  3929                        L10187:
  3930                        ;					// move cursor u
                    p one line and scroll window if at top line
  3931                        ;					_vt100_move(term
                    , 0, -1); 
  3932 00:12EC: F4 FF FF     	pea	#<$ffffffff
  3933                        ;					term->state = _s
                    t_idle;
  3934 00:12EF: 80 E2        	bra	L20092
  3935                        ;					break; 
  3936                        ;				case 'E': // next line
  3937                        L10188:
  3938                        ;					// same as '\r\n
                    '
  3939                        ;					_vt100_move(term
                    , 0, 1);
  3940 00:12F1: F4 01 00     	pea	#<$1
  3941 00:12F4: F4 00 00     	pea	#<$0
  3942 00:12F7: D4 18        	pei	<L180+term_0+2
  3943 00:12F9: D4 16        	pei	<L180+term_0
  3944 00:12FB: 22 xx xx xx  	jsl	~~_vt100_move
  3945                        ;					term->cursor_x =
                     0; 
  3946 00:12FF: A9 00 00     	lda	#$0
  3947 00:1302: A0 25 00     	ldy	#$25
  3948                        L20093:
  3949 00:1305: 97 16        	sta	[<L180+term_0],Y
  3950                        ;					term->state = _s
                    t_idle;
  3951 00:1307: 80 D5        	bra	L10185
  3952                        ;					break;  
  3953                        ;				case '7': // Save attrib
                    utes and cursor position  
  3954                        ;				case 's':  
  3955                        L10190:
  3956                        ;					term->saved_curs
                    or_x = term->cursor_x;
  3957 00:1309: A0 25 00     	ldy	#$25
  3958 00:130C: B7 16        	lda	[<L180+term_0],Y
  3959 00:130E: A0 29 00     	ldy	#$29
  3960 00:1311: 97 16        	sta	[<L180+term_0],Y
  3961                        ;					term->saved_curs
                    or_y = term->cursor_y;
  3962 00:1313: 88           	dey
  3963 00:1314: 88           	dey
  3964 00:1315: B7 16        	lda	[<L180+term_0],Y
  3965 00:1317: A0 2B 00     	ldy	#$2b
  3966                        ;					term->state = _s
                    t_idle;
  3967 00:131A: 80 E9        	bra	L20093
  3968                        ;					break;  
  3969                        ;				case '8': // Restore the
  Wed Jan 19 2022 17:05                                                Page 74


                    m  
  3970                        ;				case 'u': 
  3971                        L10192:
  3972                        ;					term->cursor_x =
                     term->saved_cursor_x;
  3973 00:131C: A0 29 00     	ldy	#$29
  3974 00:131F: B7 16        	lda	[<L180+term_0],Y
  3975 00:1321: A0 25 00     	ldy	#$25
  3976 00:1324: 97 16        	sta	[<L180+term_0],Y
  3977                        ;					term->cursor_y =
                     term->saved_cursor_y; 
  3978 00:1326: A0 2B 00     	ldy	#$2b
  3979 00:1329: B7 16        	lda	[<L180+term_0],Y
  3980 00:132B: A0 27 00     	ldy	#$27
  3981                        ;					term->state = _s
                    t_idle;
  3982 00:132E: 80 D5        	bra	L20093
  3983                        ;					break; 
  3984                        ;				case '=': // Keypad into
                     applications mode 
  3985                        ;					term->state = _s
                    t_idle;
  3986                        ;					break; 
  3987                        ;				case '>': // Keypad into
                     numeric mode   
  3988                        ;					term->state = _s
                    t_idle;
  3989                        ;					break;  
  3990                        ;				case 'Z': // Report term
                    inal type 
  3991                        L10195:
  3992                        ;					// vt 100 respon
                    se
  3993                        ;					term->send_respo
                    nse("\033[?1;0c");  
  3994 00:1330: F4 xx xx     	pea	#^L123
  3995 00:1333: F4 xx xx     	pea	#<L123
  3996 00:1336: A0 1B 08     	ldy	#$81b
  3997 00:1339: B7 16        	lda	[<L180+term_0],Y
  3998 00:133B: AA           	tax
  3999 00:133C: 88           	dey
  4000 00:133D: 88           	dey
  4001 00:133E: B7 16        	lda	[<L180+term_0],Y
  4002                        	xref	~~~lcal
  4003 00:1340: 22 xx xx xx  	jsl	~~~lcal
  4004                        ;					// unknown termi
                    nal     
  4005                        ;						//out("\
                    033[?c");
  4006                        ;					term->state = _s
                    t_idle;
  4007 00:1344: 80 98        	bra	L10185
  4008                        ;					break;    
  4009                        ;				case 'c': // Reset termi
                    nal to initial state 
  4010                        L10196:
  4011                        ;					_vt100_reset(ter
                    m);
  Wed Jan 19 2022 17:05                                                Page 75


  4012 00:1346: D4 18        	pei	<L180+term_0+2
  4013 00:1348: D4 16        	pei	<L180+term_0
  4014 00:134A: 22 xx xx xx  	jsl	~~_vt100_reset
  4015                        ;					term->state = _s
                    t_idle;
  4016 00:134E: 80 8E        	bra	L10185
  4017                        ;					break;  
  4018                        ;				case 'H': // Set tab in 
                    current position 
  4019                        ;				case 'N': // G2 characte
                    r set for next character only  
  4020                        ;				case 'O': // G3 "       
                            "     
  4021                        ;				case '<': // Exit vt52 m
                    ode
  4022                        ;					// ignore
  4023                        ;					term->state = _s
                    t_idle;
  4024                        ;					break; 
  4025                        ;				case KEY_ESC: { // marks
                     start of next escape sequence
  4026                        ;					// stay in escap
                    e state
  4027                        ;					break;
  4028                        ;				}
  4029                        ;				default: { // unknown se
                    quence - return to normal mode
  4030                        ;					term->state = _s
                    t_idle;
  4031                        ;					break;
  4032                        ;				}
  4033                        ;			}
  4034                        ;			#undef CLEAR_ARGS
  4035                        ;			break;
  4036                        ;		}
  4037                        ;		default: {
  4038                        ;			// for all other events restore 
                    normal mode
  4039                        ;			term->state = _st_idle; 
  4040                        ;		}
  4041                        ;	}
  4042                        ;}
  4043             00000012   L180	equ	18
  4044             00000011   L181	equ	17
  4045                        	ends
  4046                        	efunc
  4047                        	data
  4048                        L123:
  4049 00:0116: 1B 5B 3F 31  	db	$1B,$5B,$3F,$31,$3B,$30,$63,$00
       00:011A: 3B 30 63 00 
  4050 00:011E:              	ends
  4051                        ;
  4052                        ;
  4053                        ;STATE(_st_idle, term, ev, arg){
  4054                        	code
  4055                        	xdef	~~_st_idle
  4056                        	func
  4057                        ~~_st_idle:
  Wed Jan 19 2022 17:05                                                Page 76


  4058                        	longa	on
  4059                        	longi	on
  4060 00:1350: 3B           	tsc
  4061 00:1351: 38           	sec
  4062 00:1352: E9 08 00     	sbc	#L188
  4063 00:1355: 1B           	tcs
  4064 00:1356: 0B           	phd
  4065 00:1357: 5B           	tcd
  4066             00000004   term_0	set	4
  4067             00000008   ev_0	set	8
  4068             0000000A   arg_0	set	10
  4069                        ;	//debugf("idle\n");
  4070                        ;	ili9340_drawChar(term, ' ');
  4071 00:1358: F4 20 00     	pea	#<$20
  4072 00:135B: D4 0E        	pei	<L188+term_0+2
  4073 00:135D: D4 0C        	pei	<L188+term_0
  4074 00:135F: 22 xx xx xx  	jsl	~~ili9340_drawChar
  4075                        ;
  4076                        ;	switch(ev){
  4077 00:1363: A5 10        	lda	<L188+ev_0
  4078 00:1365: 29 FF 00     	and	#$ff
  4079                        	xref	~~~swt
  4080 00:1368: 22 xx xx xx  	jsl	~~~swt
  4081 00:136C: 01 00        	dw	1
  4082 00:136E: 01 00        	dw	1
  4083 00:1370: xx xx        	dw	L10206-1
  4084 00:1372: xx xx        	dw	L10205-1
  4085                        ;		case EV_CHAR: {
  4086                        L10206:
  4087                        ;			switch(arg){
  4088 00:1374: A5 12        	lda	<L188+arg_0
  4089                        	xref	~~~swt
  4090 00:1376: 22 xx xx xx  	jsl	~~~swt
  4091 00:137A: 08 00        	dw	8
  4092 00:137C: 05 00        	dw	5
  4093 00:137E: xx xx        	dw	L10209-1
  4094 00:1380: 07 00        	dw	7
  4095 00:1382: xx xx        	dw	L10205-1
  4096 00:1384: 08 00        	dw	8
  4097 00:1386: xx xx        	dw	L10212-1
  4098 00:1388: 09 00        	dw	9
  4099 00:138A: xx xx        	dw	L10214-1
  4100 00:138C: 0A 00        	dw	10
  4101 00:138E: xx xx        	dw	L10210-1
  4102 00:1390: 0D 00        	dw	13
  4103 00:1392: xx xx        	dw	L20098-1
  4104 00:1394: 1B 00        	dw	27
  4105 00:1396: xx xx        	dw	L10218-1
  4106 00:1398: 7F 00        	dw	127
  4107 00:139A: xx xx        	dw	L10213-1
  4108 00:139C: xx xx        	dw	L10219-1
  4109                        ;				
  4110                        ;				case 5: // AnswerBack fo
                    r vt100's  
  4111                        L10209:
  4112                        ;					term->send_respo
                    nse("X"); // should send SCCS_ID?
  4113 00:139E: F4 xx xx     	pea	#^L187
  Wed Jan 19 2022 17:05                                                Page 77


  4114 00:13A1: F4 xx xx     	pea	#<L187
  4115 00:13A4: A0 1B 08     	ldy	#$81b
  4116 00:13A7: B7 0C        	lda	[<L188+term_0],Y
  4117 00:13A9: AA           	tax
  4118 00:13AA: 88           	dey
  4119 00:13AB: 88           	dey
  4120 00:13AC: B7 0C        	lda	[<L188+term_0],Y
  4121                        	xref	~~~lcal
  4122 00:13AE: 22 xx xx xx  	jsl	~~~lcal
  4123                        ;					break;  
  4124                        L10205:
  4125                        ;	ili9340_drawCursor(term);
  4126 00:13B2: D4 0E        	pei	<L188+term_0+2
  4127 00:13B4: D4 0C        	pei	<L188+term_0
  4128 00:13B6: 22 xx xx xx  	jsl	~~ili9340_drawCursor
  4129                        ;}
  4130 00:13BA: A5 0A        	lda	<L188+2
  4131 00:13BC: 85 12        	sta	<L188+2+8
  4132 00:13BE: A5 09        	lda	<L188+1
  4133 00:13C0: 85 11        	sta	<L188+1+8
  4134 00:13C2: 2B           	pld
  4135 00:13C3: 3B           	tsc
  4136 00:13C4: 18           	clc
  4137 00:13C5: 69 10 00     	adc	#L188+8
  4138 00:13C8: 1B           	tcs
  4139 00:13C9: 6B           	rtl
  4140                        ;				case '\n': { // new line
  4141                        L10210:
  4142                        ;					_vt100_move(term
                    , 0, 1);
  4143 00:13CA: F4 01 00     	pea	#<$1
  4144 00:13CD: F4 00 00     	pea	#<$0
  4145 00:13D0: D4 0E        	pei	<L188+term_0+2
  4146 00:13D2: D4 0C        	pei	<L188+term_0
  4147 00:13D4: 22 xx xx xx  	jsl	~~_vt100_move
  4148                        ;					term->cursor_x =
                     0; 
  4149                        L20098:
  4150 00:13D8: A9 00 00     	lda	#$0
  4151 00:13DB: A0 25 00     	ldy	#$25
  4152                        L20099:
  4153 00:13DE: 97 0C        	sta	[<L188+term_0],Y
  4154                        ;					//_vt100_moveCur
                    sor(term, 0, term->cursor_y + 1);
  4155                        ;					// do scrolling 
                    here! 
  4156                        ;					break;
  4157 00:13E0: 80 D0        	bra	L10205
  4158                        ;				}
  4159                        ;				case '\r': { // carrage 
                    return (0x0d)
  4160                        ;					term->cursor_x =
                     0; 
  4161                        ;					//_vt100_move(te
                    rm, 0, 1);
  4162                        ;					//_vt100_moveCur
                    sor(term, 0, term->cursor_y); 
  4163                        ;					break;
  Wed Jan 19 2022 17:05                                                Page 78


  4164                        ;				}
  4165                        ;				case '\b': { // backspac
                    e 0x08
  4166                        ;				}
  4167                        ;				case KEY_DEL: { // del -
                     delete character under cursor
  4168                        L10213:
  4169                        ;					// Problem: with
                     current implementation, we can't move the rest of line
  4170                        ;					// to the left a
                    s is the proper behavior of the delete character
  4171                        ;					// fill the curr
                    ent position with background color
  4172                        ;					_vt100_putc(term
                    , ' ');
  4173 00:13E2: F4 20 00     	pea	#<$20
  4174 00:13E5: D4 0E        	pei	<L188+term_0+2
  4175 00:13E7: D4 0C        	pei	<L188+term_0
  4176 00:13E9: 22 xx xx xx  	jsl	~~_vt100_putc
  4177                        ;					_vt100_move(term
                    , -1, 0);
  4178                        ;					//_vt100_clearCh
                    ar(term, term->cursor_x, term->cursor_y); 
  4179                        ;					break;
  4180                        L10212:
  4181                        ;					_vt100_move(term
                    , -1, 0); 
  4182 00:13ED: F4 00 00     	pea	#<$0
  4183 00:13F0: F4 FF FF     	pea	#<$ffffffff
  4184 00:13F3: D4 0E        	pei	<L188+term_0+2
  4185 00:13F5: D4 0C        	pei	<L188+term_0
  4186 00:13F7: 22 xx xx xx  	jsl	~~_vt100_move
  4187                        ;					// backspace doe
                    s not delete the character! Only moves cursor!
  4188                        ;					//ili9340_drawCh
                    ar(term->cursor_x * term->char_width,
  4189                        ;					//	term->cu
                    rsor_y * term->char_height, ' ');
  4190                        ;					break;
  4191 00:13FB: 80 B5        	bra	L10205
  4192                        ;				}
  4193                        ;				case '\t': { // tab
  4194                        L10214:
  4195                        ;					// tab fills cha
                    racters on the line until we reach a multiple of tab_stop
  4196                        ;					int tab_stop = 4
                    ;
  4197                        ;					int to_put = tab
                    _stop - (term->cursor_x % tab_stop); 
  4198                        ;					while(to_put--) 
                    _vt100_putc(term, ' ');
  4199             00000000   tab_stop_2	set	0
  4200             00000002   to_put_2	set	2
  4201 00:13FD: A9 04 00     	lda	#$4
  4202 00:1400: 85 05        	sta	<L189+tab_stop_2
  4203 00:1402: A0 25 00     	ldy	#$25
  4204 00:1405: B7 0C        	lda	[<L188+term_0],Y
  4205 00:1407: A6 05        	ldx	<L189+tab_stop_2
  Wed Jan 19 2022 17:05                                                Page 79


  4206                        	xref	~~~umd
  4207 00:1409: 22 xx xx xx  	jsl	~~~umd
  4208 00:140D: 85 01        	sta	<R0
  4209 00:140F: 38           	sec
  4210 00:1410: A5 05        	lda	<L189+tab_stop_2
  4211 00:1412: E5 01        	sbc	<R0
  4212 00:1414: 85 07        	sta	<L189+to_put_2
  4213 00:1416: 80 0B        	bra	L10215
  4214                        L20095:
  4215 00:1418: F4 20 00     	pea	#<$20
  4216 00:141B: D4 0E        	pei	<L188+term_0+2
  4217 00:141D: D4 0C        	pei	<L188+term_0
  4218 00:141F: 22 xx xx xx  	jsl	~~_vt100_putc
  4219                        L10215:
  4220 00:1423: A5 07        	lda	<L189+to_put_2
  4221 00:1425: 85 01        	sta	<R0
  4222 00:1427: C6 07        	dec	<L189+to_put_2
  4223 00:1429: A5 01        	lda	<R0
  4224 00:142B: D0 EB        	bne	L20095
  4225                        ;					break;
  4226 00:142D: 80 83        	bra	L10205
  4227                        ;				}
  4228                        ;				case KEY_BELL: { // bell
                     is sent by bash for ex. when doing tab completion
  4229                        ;					// sound the spe
                    aker bell?
  4230                        ;					// skip
  4231                        ;					break; 
  4232                        ;				}
  4233                        ;				case KEY_ESC: {// escape
  4234                        L10218:
  4235                        ;					term->state = _s
                    t_escape;
  4236 00:142F: A9 xx xx     	lda	#<~~_st_escape
  4237 00:1432: A0 15 08     	ldy	#$815
  4238 00:1435: 97 0C        	sta	[<L188+term_0],Y
  4239 00:1437: A9 xx xx     	lda	#^~~_st_escape
  4240 00:143A: C8           	iny
  4241 00:143B: C8           	iny
  4242                        ;					break;
  4243 00:143C: 80 A0        	bra	L20099
  4244                        ;				}
  4245                        ;				default: {
  4246                        L10219:
  4247                        ;					_vt100_putc(term
                    , arg);
  4248 00:143E: D4 12        	pei	<L188+arg_0
  4249 00:1440: D4 0E        	pei	<L188+term_0+2
  4250 00:1442: D4 0C        	pei	<L188+term_0
  4251 00:1444: 22 xx xx xx  	jsl	~~_vt100_putc
  4252                        ;					break;
  4253 00:1448: 82 67 FF     	brl	L10205
  4254                        ;				}
  4255                        ;			}
  4256                        ;			break;
  4257                        ;		}
  4258                        ;		default: {}
  4259                        ;	}
  Wed Jan 19 2022 17:05                                                Page 80


  4260             00000008   L188	equ	8
  4261             00000005   L189	equ	5
  4262                        	ends
  4263                        	efunc
  4264                        	data
  4265                        L187:
  4266 00:011E: 58 00        	db	$58,$00
  4267 00:0120:              	ends
  4268                        ;
  4269                        ;STATE(_st_command_arg, term, ev, arg){
  4270                        	code
  4271                        	xdef	~~_st_command_arg
  4272                        	func
  4273                        ~~_st_command_arg:
  4274                        	longa	on
  4275                        	longi	on
  4276 00:144B: 3B           	tsc
  4277 00:144C: 38           	sec
  4278 00:144D: E9 18 00     	sbc	#L193
  4279 00:1450: 1B           	tcs
  4280 00:1451: 0B           	phd
  4281 00:1452: 5B           	tcd
  4282             00000004   term_0	set	4
  4283             00000008   ev_0	set	8
  4284             0000000A   arg_0	set	10
  4285                        ;	switch(ev){
  4286 00:1453: A5 20        	lda	<L193+ev_0
  4287 00:1455: 29 FF 00     	and	#$ff
  4288                        	xref	~~~swt
  4289 00:1458: 22 xx xx xx  	jsl	~~~swt
  4290 00:145C: 01 00        	dw	1
  4291 00:145E: 01 00        	dw	1
  4292 00:1460: xx xx        	dw	L10223-1
  4293 00:1462: xx xx        	dw	L198-1
  4294                        ;		case EV_CHAR: {
  4295                        L10223:
  4296                        ;			if(isdigit(arg)){ // a digit arg
                    ument
  4297 00:1464: D4 22        	pei	<L193+arg_0
  4298 00:1466: 22 xx xx xx  	jsl	~~isdigit
  4299 00:146A: AA           	tax
  4300 00:146B: D0 03        	bne	*+5
  4301 00:146D: 82 94 00     	brl	L10224
  4302                        ;				term->args[term->narg] =
                     term->args[term->narg] * 10 + (arg - '0');
  4303 00:1470: A0 0B 08     	ldy	#$80b
  4304 00:1473: B7 1C        	lda	[<L193+term_0],Y
  4305 00:1475: 85 05        	sta	<R1
  4306 00:1477: 64 07        	stz	<R1+2
  4307 00:1479: D4 07        	pei	<R1+2
  4308 00:147B: D4 05        	pei	<R1
  4309 00:147D: A9 01 00     	lda	#$1
  4310                        	xref	~~~lasl
  4311 00:1480: 22 xx xx xx  	jsl	~~~lasl
  4312 00:1484: 85 01        	sta	<R0
  4313 00:1486: 86 03        	stx	<R0+2
  4314 00:1488: A9 0D 08     	lda	#$80d
  4315 00:148B: 18           	clc
  Wed Jan 19 2022 17:05                                                Page 81


  4316 00:148C: 65 1C        	adc	<L193+term_0
  4317 00:148E: 85 09        	sta	<R2
  4318 00:1490: A9 00 00     	lda	#$0
  4319 00:1493: 65 1E        	adc	<L193+term_0+2
  4320 00:1495: 85 0B        	sta	<R2+2
  4321 00:1497: A5 09        	lda	<R2
  4322 00:1499: 18           	clc
  4323 00:149A: 65 01        	adc	<R0
  4324 00:149C: 85 0D        	sta	<R3
  4325 00:149E: A5 0B        	lda	<R2+2
  4326 00:14A0: 65 03        	adc	<R0+2
  4327 00:14A2: 85 0F        	sta	<R3+2
  4328 00:14A4: A0 0B 08     	ldy	#$80b
  4329 00:14A7: B7 1C        	lda	[<L193+term_0],Y
  4330 00:14A9: 85 09        	sta	<R2
  4331 00:14AB: 64 0B        	stz	<R2+2
  4332 00:14AD: D4 0B        	pei	<R2+2
  4333 00:14AF: D4 09        	pei	<R2
  4334 00:14B1: A9 01 00     	lda	#$1
  4335                        	xref	~~~lasl
  4336 00:14B4: 22 xx xx xx  	jsl	~~~lasl
  4337 00:14B8: 85 01        	sta	<R0
  4338 00:14BA: 86 03        	stx	<R0+2
  4339 00:14BC: A9 0D 08     	lda	#$80d
  4340 00:14BF: 18           	clc
  4341 00:14C0: 65 1C        	adc	<L193+term_0
  4342 00:14C2: 85 11        	sta	<17
  4343 00:14C4: A9 00 00     	lda	#$0
  4344 00:14C7: 65 1E        	adc	<L193+term_0+2
  4345 00:14C9: 85 13        	sta	<17+2
  4346 00:14CB: A5 11        	lda	<17
  4347 00:14CD: 18           	clc
  4348 00:14CE: 65 01        	adc	<R0
  4349 00:14D0: 85 15        	sta	<21
  4350 00:14D2: A5 13        	lda	<17+2
  4351 00:14D4: 65 03        	adc	<R0+2
  4352 00:14D6: 85 17        	sta	<21+2
  4353 00:14D8: A7 15        	lda	[<21]
  4354 00:14DA: 0A           	asl	A
  4355 00:14DB: 0A           	asl	A
  4356 00:14DC: 67 15        	adc	[<21]
  4357 00:14DE: 0A           	asl	A
  4358 00:14DF: 18           	clc
  4359 00:14E0: 65 22        	adc	<L193+arg_0
  4360 00:14E2: 85 11        	sta	<17
  4361 00:14E4: 18           	clc
  4362 00:14E5: 69 D0 FF     	adc	#$ffd0
  4363 00:14E8: 87 0D        	sta	[<R3]
  4364                        ;			} else if(arg == ';') { // separ
                    ator
  4365 00:14EA: 80 08        	bra	L198
  4366                        L20105:
  4367                        ;				term->narg++;
  4368 00:14EC: A0 0B 08     	ldy	#$80b
  4369 00:14EF: B7 1C        	lda	[<L193+term_0],Y
  4370 00:14F1: 1A           	ina
  4371 00:14F2: 97 1C        	sta	[<L193+term_0],Y
  4372                        ;			} else { // no more arguments
  Wed Jan 19 2022 17:05                                                Page 82


  4373                        L198:
  4374 00:14F4: A5 1A        	lda	<L193+2
  4375 00:14F6: 85 22        	sta	<L193+2+8
  4376 00:14F8: A5 19        	lda	<L193+1
  4377 00:14FA: 85 21        	sta	<L193+1+8
  4378 00:14FC: 2B           	pld
  4379 00:14FD: 3B           	tsc
  4380 00:14FE: 18           	clc
  4381 00:14FF: 69 20 00     	adc	#L193+8
  4382 00:1502: 1B           	tcs
  4383 00:1503: 6B           	rtl
  4384                        L10224:
  4385 00:1504: A5 22        	lda	<L193+arg_0
  4386 00:1506: C9 3B 00     	cmp	#<$3b
  4387 00:1509: F0 E1        	beq	L20105
  4388                        ;				// go back to command st
                    ate 
  4389                        ;				term->narg++;
  4390 00:150B: A0 0B 08     	ldy	#$80b
  4391 00:150E: B7 1C        	lda	[<L193+term_0],Y
  4392 00:1510: 1A           	ina
  4393 00:1511: 97 1C        	sta	[<L193+term_0],Y
  4394                        ;				if(term->ret_state){
  4395 00:1513: A0 1D 08     	ldy	#$81d
  4396 00:1516: B7 1C        	lda	[<L193+term_0],Y
  4397 00:1518: C8           	iny
  4398 00:1519: C8           	iny
  4399 00:151A: 17 1C        	ora	[<L193+term_0],Y
  4400 00:151C: F0 10        	beq	L10228
  4401                        ;					term->state = te
                    rm->ret_state;
  4402 00:151E: 88           	dey
  4403 00:151F: 88           	dey
  4404 00:1520: B7 1C        	lda	[<L193+term_0],Y
  4405 00:1522: A0 15 08     	ldy	#$815
  4406 00:1525: 97 1C        	sta	[<L193+term_0],Y
  4407 00:1527: A0 1F 08     	ldy	#$81f
  4408 00:152A: B7 1C        	lda	[<L193+term_0],Y
  4409 00:152C: 80 0B        	bra	L20107
  4410                        ;				}
  4411                        ;				else {
  4412                        L10228:
  4413                        ;					term->state = _s
                    t_idle;
  4414 00:152E: A9 xx xx     	lda	#<~~_st_idle
  4415 00:1531: A0 15 08     	ldy	#$815
  4416 00:1534: 97 1C        	sta	[<L193+term_0],Y
  4417 00:1536: A9 xx xx     	lda	#^~~_st_idle
  4418                        L20107:
  4419 00:1539: A0 17 08     	ldy	#$817
  4420 00:153C: 97 1C        	sta	[<L193+term_0],Y
  4421                        ;				}
  4422                        ;				// execute next state as
                     well because we have already consumed a char!
  4423                        ;				term->state(term, ev, ar
                    g);
  4424 00:153E: D4 22        	pei	<L193+arg_0
  4425 00:1540: D4 20        	pei	<L193+ev_0
  Wed Jan 19 2022 17:05                                                Page 83


  4426 00:1542: D4 1E        	pei	<L193+term_0+2
  4427 00:1544: D4 1C        	pei	<L193+term_0
  4428 00:1546: B7 1C        	lda	[<L193+term_0],Y
  4429 00:1548: AA           	tax
  4430 00:1549: 88           	dey
  4431 00:154A: 88           	dey
  4432 00:154B: B7 1C        	lda	[<L193+term_0],Y
  4433                        	xref	~~~lcal
  4434 00:154D: 22 xx xx xx  	jsl	~~~lcal
  4435                        ;			}
  4436                        ;			break;
  4437 00:1551: 80 A1        	bra	L198
  4438                        ;		}
  4439                        ;	}
  4440                        ;}
  4441             00000018   L193	equ	24
  4442             00000019   L194	equ	25
  4443                        	ends
  4444                        	efunc
  4445                        ;
  4446                        ;STATE(_st_esc_sq_bracket, term, ev, arg){
  4447                        	code
  4448                        	xdef	~~_st_esc_sq_bracket
  4449                        	func
  4450                        ~~_st_esc_sq_bracket:
  4451                        	longa	on
  4452                        	longi	on
  4453 00:1553: 3B           	tsc
  4454 00:1554: 38           	sec
  4455 00:1555: E9 1C 00     	sbc	#L199
  4456 00:1558: 1B           	tcs
  4457 00:1559: 0B           	phd
  4458 00:155A: 5B           	tcd
  4459             00000004   term_0	set	4
  4460             00000008   ev_0	set	8
  4461             0000000A   arg_0	set	10
  4462                        ;	uint16_t n;
  4463                        ;	uint16_t x;
  4464                        ;	uint16_t y;
  4465                        ;	uint16_t top_margin;
  4466                        ;	uint16_t bottom_margin;
  4467                        ;	uint16_t c;
  4468                        ;	
  4469                        ;	switch(ev){
  4470             00000000   n_1	set	0
  4471             00000002   x_1	set	2
  4472             00000004   y_1	set	4
  4473             00000006   top_margin_1	set	6
  4474             00000008   bottom_margin_1	set	8
  4475             0000000A   c_1	set	10
  4476 00:155B: A5 24        	lda	<L199+ev_0
  4477 00:155D: 29 FF 00     	and	#$ff
  4478                        	xref	~~~swt
  4479 00:1560: 22 xx xx xx  	jsl	~~~swt
  4480 00:1564: 01 00        	dw	1
  4481 00:1566: 01 00        	dw	1
  4482 00:1568: xx xx        	dw	L10232-1
  4483 00:156A: xx xx        	dw	L10240-1
  Wed Jan 19 2022 17:05                                                Page 84


  4484                        ;		case EV_CHAR: {
  4485                        L10232:
  4486                        ;			if(isdigit(arg)){ // start of an
                     argument
  4487 00:156C: D4 26        	pei	<L199+arg_0
  4488 00:156E: 22 xx xx xx  	jsl	~~isdigit
  4489 00:1572: AA           	tax
  4490 00:1573: D0 03        	bne	*+5
  4491 00:1575: 82 04 05     	brl	L10233
  4492                        ;				term->ret_state = _st_es
                    c_sq_bracket; 
  4493 00:1578: A9 xx xx     	lda	#<~~_st_esc_sq_bracket
  4494 00:157B: A0 1D 08     	ldy	#$81d
  4495 00:157E: 97 20        	sta	[<L199+term_0],Y
  4496 00:1580: A9 xx xx     	lda	#^~~_st_esc_sq_bracket
  4497 00:1583: C8           	iny
  4498 00:1584: C8           	iny
  4499 00:1585: 97 20        	sta	[<L199+term_0],Y
  4500                        ;				_st_command_arg(term, ev
                    , arg);
  4501 00:1587: D4 26        	pei	<L199+arg_0
  4502 00:1589: D4 24        	pei	<L199+ev_0
  4503 00:158B: D4 22        	pei	<L199+term_0+2
  4504 00:158D: D4 20        	pei	<L199+term_0
  4505 00:158F: 22 xx xx xx  	jsl	~~_st_command_arg
  4506                        ;				term->state = _st_comman
                    d_arg;
  4507 00:1593: A9 xx xx     	lda	#<~~_st_command_arg
  4508 00:1596: A0 15 08     	ldy	#$815
  4509 00:1599: 97 20        	sta	[<L199+term_0],Y
  4510 00:159B: A9 xx xx     	lda	#^~~_st_command_arg
  4511                        L20113:
  4512 00:159E: A0 17 08     	ldy	#$817
  4513 00:15A1: 97 20        	sta	[<L199+term_0],Y
  4514                        ;			} else if(arg == ';'){ // arg se
                    parator. 
  4515 00:15A3: 82 E0 04     	brl	L258
  4516                        L20112:
  4517                        ;				// skip. And also stay i
                    n the command state
  4518                        ;			} else { // otherwise we execute
                     the command and go back to idle
  4519                        ;				switch(arg){
  4520 00:15A6: A5 26        	lda	<L199+arg_0
  4521                        	xref	~~~fsw
  4522 00:15A8: 22 xx xx xx  	jsl	~~~fsw
  4523 00:15AC: 3D 00        	dw	61
  4524 00:15AE: 3D 00        	dw	61
  4525 00:15B0: xx xx        	dw	L10240-1
  4526 00:15B2: xx xx        	dw	L10240-1
  4527 00:15B4: xx xx        	dw	L10240-1
  4528 00:15B6: xx xx        	dw	L10294-1
  4529 00:15B8: xx xx        	dw	L10240-1
  4530 00:15BA: xx xx        	dw	L10239-1
  4531 00:15BC: xx xx        	dw	L10241-1
  4532 00:15BE: xx xx        	dw	L10243-1
  4533 00:15C0: xx xx        	dw	L10245-1
  4534 00:15C2: xx xx        	dw	L10240-1
  Wed Jan 19 2022 17:05                                                Page 85


  4535 00:15C4: xx xx        	dw	L10240-1
  4536 00:15C6: xx xx        	dw	L10240-1
  4537 00:15C8: xx xx        	dw	L10248-1
  4538 00:15CA: xx xx        	dw	L10240-1
  4539 00:15CC: xx xx        	dw	L10253-1
  4540 00:15CE: xx xx        	dw	L10259-1
  4541 00:15D0: xx xx        	dw	L10240-1
  4542 00:15D2: xx xx        	dw	L10240-1
  4543 00:15D4: xx xx        	dw	L10240-1
  4544 00:15D6: xx xx        	dw	L10240-1
  4545 00:15D8: xx xx        	dw	L10267-1
  4546 00:15DA: xx xx        	dw	L10240-1
  4547 00:15DC: xx xx        	dw	L10240-1
  4548 00:15DE: xx xx        	dw	L10240-1
  4549 00:15E0: xx xx        	dw	L10240-1
  4550 00:15E2: xx xx        	dw	L10240-1
  4551 00:15E4: xx xx        	dw	L10240-1
  4552 00:15E6: xx xx        	dw	L10240-1
  4553 00:15E8: xx xx        	dw	L10240-1
  4554 00:15EA: xx xx        	dw	L10240-1
  4555 00:15EC: xx xx        	dw	L10240-1
  4556 00:15EE: xx xx        	dw	L10240-1
  4557 00:15F0: xx xx        	dw	L10240-1
  4558 00:15F2: xx xx        	dw	L10240-1
  4559 00:15F4: xx xx        	dw	L10240-1
  4560 00:15F6: xx xx        	dw	L10240-1
  4561 00:15F8: xx xx        	dw	L10240-1
  4562 00:15FA: xx xx        	dw	L10240-1
  4563 00:15FC: xx xx        	dw	L10240-1
  4564 00:15FE: xx xx        	dw	L10272-1
  4565 00:1600: xx xx        	dw	L10240-1
  4566 00:1602: xx xx        	dw	L10240-1
  4567 00:1604: xx xx        	dw	L10248-1
  4568 00:1606: xx xx        	dw	L10240-1
  4569 00:1608: xx xx        	dw	L10240-1
  4570 00:160A: xx xx        	dw	L10240-1
  4571 00:160C: xx xx        	dw	L10240-1
  4572 00:160E: xx xx        	dw	L10240-1
  4573 00:1610: xx xx        	dw	L10240-1
  4574 00:1612: xx xx        	dw	L10279-1
  4575 00:1614: xx xx        	dw	L10240-1
  4576 00:1616: xx xx        	dw	L10240-1
  4577 00:1618: xx xx        	dw	L10240-1
  4578 00:161A: xx xx        	dw	L10240-1
  4579 00:161C: xx xx        	dw	L10288-1
  4580 00:161E: xx xx        	dw	L10274-1
  4581 00:1620: xx xx        	dw	L10240-1
  4582 00:1622: xx xx        	dw	L10275-1
  4583 00:1624: xx xx        	dw	L10240-1
  4584 00:1626: xx xx        	dw	L10240-1
  4585 00:1628: xx xx        	dw	L10240-1
  4586 00:162A: xx xx        	dw	L10240-1
  4587                        ;					case 'A': {// mo
                    ve cursor up (cursor stops at top margin)
  4588                        L10239:
  4589                        ;						n = (ter
                    m->narg > 0)?term->args[0]:1;
  4590 00:162C: A9 00 00     	lda	#$0
  Wed Jan 19 2022 17:05                                                Page 86


  4591 00:162F: A0 0B 08     	ldy	#$80b
  4592 00:1632: D7 20        	cmp	[<L199+term_0],Y
  4593 00:1634: B0 06        	bcs	L203
  4594 00:1636: C8           	iny
  4595 00:1637: C8           	iny
  4596 00:1638: B7 20        	lda	[<L199+term_0],Y
  4597 00:163A: 80 03        	bra	L205
  4598                        L203:
  4599 00:163C: A9 01 00     	lda	#$1
  4600                        L205:
  4601 00:163F: 85 11        	sta	<L200+n_1
  4602                        ;						term->cu
                    rsor_y -= n;
  4603 00:1641: A9 27 00     	lda	#$27
  4604 00:1644: 18           	clc
  4605 00:1645: 65 20        	adc	<L199+term_0
  4606 00:1647: 85 01        	sta	<R0
  4607 00:1649: A9 00 00     	lda	#$0
  4608 00:164C: 65 22        	adc	<L199+term_0+2
  4609 00:164E: 85 03        	sta	<R0+2
  4610 00:1650: 38           	sec
  4611 00:1651: A7 01        	lda	[<R0]
  4612 00:1653: E5 11        	sbc	<L200+n_1
  4613 00:1655: 87 01        	sta	[<R0]
  4614                        ;						if(term-
                    >cursor_y < 0) term->cursor_y = 0; 
  4615 00:1657: A0 27 00     	ldy	#$27
  4616 00:165A: B7 20        	lda	[<L199+term_0],Y
  4617 00:165C: C9 00 00     	cmp	#<$0
  4618 00:165F: B0 08        	bcs	L10240
  4619 00:1661: A9 00 00     	lda	#$0
  4620                        L20154:
  4621 00:1664: A0 27 00     	ldy	#$27
  4622                        L20150:
  4623 00:1667: 97 20        	sta	[<L199+term_0],Y
  4624                        ;						term->st
                    ate = _st_idle; 
  4625                        L10240:
  4626 00:1669: A9 xx xx     	lda	#<~~_st_idle
  4627 00:166C: A0 15 08     	ldy	#$815
  4628 00:166F: 97 20        	sta	[<L199+term_0],Y
  4629 00:1671: A9 xx xx     	lda	#^~~_st_idle
  4630 00:1674: 82 27 FF     	brl	L20113
  4631                        ;						break;
  4632                        ;					} 
  4633                        ;					case 'B': { // c
                    ursor down (cursor stops at bottom margin)
  4634                        L10241:
  4635                        ;						n = (ter
                    m->narg > 0)?term->args[0]:1;
  4636 00:1677: A9 00 00     	lda	#$0
  4637 00:167A: A0 0B 08     	ldy	#$80b
  4638 00:167D: D7 20        	cmp	[<L199+term_0],Y
  4639 00:167F: B0 06        	bcs	L207
  4640 00:1681: C8           	iny
  4641 00:1682: C8           	iny
  4642 00:1683: B7 20        	lda	[<L199+term_0],Y
  4643 00:1685: 80 03        	bra	L209
  Wed Jan 19 2022 17:05                                                Page 87


  4644                        L207:
  4645 00:1687: A9 01 00     	lda	#$1
  4646                        L209:
  4647 00:168A: 85 11        	sta	<L200+n_1
  4648                        ;						term->cu
                    rsor_y += n;
  4649 00:168C: A9 27 00     	lda	#$27
  4650 00:168F: 18           	clc
  4651 00:1690: 65 20        	adc	<L199+term_0
  4652 00:1692: 85 01        	sta	<R0
  4653 00:1694: A9 00 00     	lda	#$0
  4654 00:1697: 65 22        	adc	<L199+term_0+2
  4655 00:1699: 85 03        	sta	<R0+2
  4656 00:169B: A7 01        	lda	[<R0]
  4657 00:169D: 18           	clc
  4658 00:169E: 65 11        	adc	<L200+n_1
  4659 00:16A0: 87 01        	sta	[<R0]
  4660                        ;						if(term-
                    >cursor_y > VT100_HEIGHT) term->cursor_y = VT100_HEIGHT; 
  4661                        L20190:
  4662 00:16A2: A0 07 00     	ldy	#$7
  4663 00:16A5: B7 20        	lda	[<L199+term_0],Y
  4664 00:16A7: A0 27 00     	ldy	#$27
  4665 00:16AA: D7 20        	cmp	[<L199+term_0],Y
  4666 00:16AC: B0 BB        	bcs	L10240
  4667 00:16AE: A0 07 00     	ldy	#$7
  4668                        L20191:
  4669 00:16B1: B7 20        	lda	[<L199+term_0],Y
  4670 00:16B3: 80 AF        	bra	L20154
  4671                        ;						term->st
                    ate = _st_idle; 
  4672                        ;						break;
  4673                        ;					}
  4674                        ;					case 'C': { // c
                    ursor right (cursor stops at right margin)
  4675                        L10243:
  4676                        ;						n = (ter
                    m->narg > 0)?term->args[0]:1;
  4677 00:16B5: A9 00 00     	lda	#$0
  4678 00:16B8: A0 0B 08     	ldy	#$80b
  4679 00:16BB: D7 20        	cmp	[<L199+term_0],Y
  4680 00:16BD: B0 06        	bcs	L211
  4681 00:16BF: C8           	iny
  4682 00:16C0: C8           	iny
  4683 00:16C1: B7 20        	lda	[<L199+term_0],Y
  4684 00:16C3: 80 03        	bra	L213
  4685                        L211:
  4686 00:16C5: A9 01 00     	lda	#$1
  4687                        L213:
  4688 00:16C8: 85 11        	sta	<L200+n_1
  4689                        ;						term->cu
                    rsor_x += n;
  4690 00:16CA: A9 25 00     	lda	#$25
  4691 00:16CD: 18           	clc
  4692 00:16CE: 65 20        	adc	<L199+term_0
  4693 00:16D0: 85 01        	sta	<R0
  4694 00:16D2: A9 00 00     	lda	#$0
  4695 00:16D5: 65 22        	adc	<L199+term_0+2
  Wed Jan 19 2022 17:05                                                Page 88


  4696 00:16D7: 85 03        	sta	<R0+2
  4697 00:16D9: A7 01        	lda	[<R0]
  4698 00:16DB: 18           	clc
  4699 00:16DC: 65 11        	adc	<L200+n_1
  4700 00:16DE: 87 01        	sta	[<R0]
  4701                        ;						if(term-
                    >cursor_x > VT100_WIDTH) term->cursor_x = VT100_WIDTH;
  4702 00:16E0: A0 05 00     	ldy	#$5
  4703 00:16E3: B7 20        	lda	[<L199+term_0],Y
  4704 00:16E5: A0 25 00     	ldy	#$25
  4705 00:16E8: D7 20        	cmp	[<L199+term_0],Y
  4706 00:16EA: 90 03        	bcc	*+5
  4707 00:16EC: 82 7A FF     	brl	L10240
  4708 00:16EF: A0 05 00     	ldy	#$5
  4709 00:16F2: B7 20        	lda	[<L199+term_0],Y
  4710 00:16F4: A0 25 00     	ldy	#$25
  4711 00:16F7: 82 6D FF     	brl	L20150
  4712                        ;						term->st
                    ate = _st_idle; 
  4713                        ;						break;
  4714                        ;					}
  4715                        ;					case 'D': { // c
                    ursor left
  4716                        L10245:
  4717                        ;						n = (ter
                    m->narg > 0)?term->args[0]:1;
  4718 00:16FA: A9 00 00     	lda	#$0
  4719 00:16FD: A0 0B 08     	ldy	#$80b
  4720 00:1700: D7 20        	cmp	[<L199+term_0],Y
  4721 00:1702: B0 06        	bcs	L215
  4722 00:1704: C8           	iny
  4723 00:1705: C8           	iny
  4724 00:1706: B7 20        	lda	[<L199+term_0],Y
  4725 00:1708: 80 03        	bra	L217
  4726                        L215:
  4727 00:170A: A9 01 00     	lda	#$1
  4728                        L217:
  4729 00:170D: 85 11        	sta	<L200+n_1
  4730                        ;						term->cu
                    rsor_x -= n;
  4731 00:170F: A9 25 00     	lda	#$25
  4732 00:1712: 18           	clc
  4733 00:1713: 65 20        	adc	<L199+term_0
  4734 00:1715: 85 01        	sta	<R0
  4735 00:1717: A9 00 00     	lda	#$0
  4736 00:171A: 65 22        	adc	<L199+term_0+2
  4737 00:171C: 85 03        	sta	<R0+2
  4738 00:171E: 38           	sec
  4739 00:171F: A7 01        	lda	[<R0]
  4740 00:1721: E5 11        	sbc	<L200+n_1
  4741 00:1723: 87 01        	sta	[<R0]
  4742                        ;						if(term-
                    >cursor_x < 0) term->cursor_x = 0;
  4743 00:1725: A0 25 00     	ldy	#$25
  4744 00:1728: B7 20        	lda	[<L199+term_0],Y
  4745 00:172A: C9 00 00     	cmp	#<$0
  4746 00:172D: 90 03        	bcc	*+5
  4747 00:172F: 82 37 FF     	brl	L10240
  Wed Jan 19 2022 17:05                                                Page 89


  4748 00:1732: A9 00 00     	lda	#$0
  4749 00:1735: 82 2F FF     	brl	L20150
  4750                        ;						term->st
                    ate = _st_idle; 
  4751                        ;						break;
  4752                        ;					}
  4753                        ;					case 'f': 
  4754                        ;					case 'H': { // m
                    ove cursor to position (default 0;0)
  4755                        L10248:
  4756                        ;						// curso
                    r stops at respective margins
  4757                        ;						term->cu
                    rsor_x = (term->narg >= 1)?(term->args[1]-1):0; 
  4758 00:1738: A0 0B 08     	ldy	#$80b
  4759 00:173B: B7 20        	lda	[<L199+term_0],Y
  4760 00:173D: C9 01 00     	cmp	#<$1
  4761 00:1740: 90 0B        	bcc	L219
  4762 00:1742: 18           	clc
  4763 00:1743: A9 FF FF     	lda	#$ffff
  4764 00:1746: A0 0F 08     	ldy	#$80f
  4765 00:1749: 77 20        	adc	[<L199+term_0],Y
  4766 00:174B: 80 03        	bra	L221
  4767                        L219:
  4768 00:174D: A9 00 00     	lda	#$0
  4769                        L221:
  4770 00:1750: A0 25 00     	ldy	#$25
  4771 00:1753: 97 20        	sta	[<L199+term_0],Y
  4772                        ;						term->cu
                    rsor_y = (term->narg == 2)?(term->args[0]-1):0;
  4773 00:1755: A0 0B 08     	ldy	#$80b
  4774 00:1758: B7 20        	lda	[<L199+term_0],Y
  4775 00:175A: C9 02 00     	cmp	#<$2
  4776 00:175D: D0 0A        	bne	L222
  4777 00:175F: 18           	clc
  4778 00:1760: A9 FF FF     	lda	#$ffff
  4779 00:1763: C8           	iny
  4780 00:1764: C8           	iny
  4781 00:1765: 77 20        	adc	[<L199+term_0],Y
  4782 00:1767: 80 03        	bra	L224
  4783                        L222:
  4784 00:1769: A9 00 00     	lda	#$0
  4785                        L224:
  4786 00:176C: A0 27 00     	ldy	#$27
  4787 00:176F: 97 20        	sta	[<L199+term_0],Y
  4788                        ;						if(term-
                    >flags.f.origin_mode) {
  4789 00:1771: A7 20        	lda	[<L199+term_0]
  4790 00:1773: 89 04 00     	bit	#$4
  4791 00:1776: F0 2E        	beq	L10249
  4792                        ;							
                    term->cursor_y += term->scroll_start_row;
  4793 00:1778: 98           	tya
  4794 00:1779: 18           	clc
  4795 00:177A: 65 20        	adc	<L199+term_0
  4796 00:177C: 85 01        	sta	<R0
  4797 00:177E: A9 00 00     	lda	#$0
  4798 00:1781: 65 22        	adc	<L199+term_0+2
  Wed Jan 19 2022 17:05                                                Page 90


  4799 00:1783: 85 03        	sta	<R0+2
  4800 00:1785: 18           	clc
  4801 00:1786: A7 01        	lda	[<R0]
  4802 00:1788: A0 2D 00     	ldy	#$2d
  4803 00:178B: 77 20        	adc	[<L199+term_0],Y
  4804 00:178D: 87 01        	sta	[<R0]
  4805                        ;							
                    if(term->cursor_y >= term->scroll_end_row){
  4806 00:178F: A0 27 00     	ldy	#$27
  4807 00:1792: B7 20        	lda	[<L199+term_0],Y
  4808 00:1794: A0 2F 00     	ldy	#$2f
  4809 00:1797: D7 20        	cmp	[<L199+term_0],Y
  4810 00:1799: 90 0B        	bcc	L10249
  4811                        ;							
                    	term->cursor_y = term->scroll_end_row - 1;
  4812 00:179B: A9 FF FF     	lda	#$ffff
  4813 00:179E: 18           	clc
  4814 00:179F: 77 20        	adc	[<L199+term_0],Y
  4815 00:17A1: A0 27 00     	ldy	#$27
  4816 00:17A4: 97 20        	sta	[<L199+term_0],Y
  4817                        ;							
                    }
  4818                        ;						}
  4819                        ;						if(term-
                    >cursor_x > VT100_WIDTH) term->cursor_x = VT100_WIDTH;
  4820                        L10249:
  4821 00:17A6: A0 05 00     	ldy	#$5
  4822 00:17A9: B7 20        	lda	[<L199+term_0],Y
  4823 00:17AB: A0 25 00     	ldy	#$25
  4824 00:17AE: D7 20        	cmp	[<L199+term_0],Y
  4825 00:17B0: 90 03        	bcc	*+5
  4826 00:17B2: 82 ED FE     	brl	L20190
  4827 00:17B5: A0 05 00     	ldy	#$5
  4828 00:17B8: B7 20        	lda	[<L199+term_0],Y
  4829 00:17BA: A0 25 00     	ldy	#$25
  4830 00:17BD: 97 20        	sta	[<L199+term_0],Y
  4831                        ;						if(term-
                    >cursor_y > VT100_HEIGHT) term->cursor_y = VT100_HEIGHT; 
  4832 00:17BF: 82 E0 FE     	brl	L20190
  4833                        ;						term->st
                    ate = _st_idle; 
  4834                        ;						break;
  4835                        ;					}
  4836                        ;					case 'J':{// cle
                    ar screen from cursor up or down
  4837                        L10253:
  4838                        ;						y = VT10
                    0_CURSOR_Y(term); 
  4839 00:17C2: D4 22        	pei	<L199+term_0+2
  4840 00:17C4: D4 20        	pei	<L199+term_0
  4841 00:17C6: 22 xx xx xx  	jsl	~~VT100_CURSOR_Y
  4842 00:17CA: 85 15        	sta	<L200+y_1
  4843                        ;						if(term-
                    >narg == 0 || (term->narg == 1 && term->args[0] == 0)){
  4844 00:17CC: A0 0B 08     	ldy	#$80b
  4845 00:17CF: B7 20        	lda	[<L199+term_0],Y
  4846 00:17D1: F0 0D        	beq	L229
  4847 00:17D3: B7 20        	lda	[<L199+term_0],Y
  Wed Jan 19 2022 17:05                                                Page 91


  4848 00:17D5: C9 01 00     	cmp	#<$1
  4849 00:17D8: D0 31        	bne	L10254
  4850 00:17DA: C8           	iny
  4851 00:17DB: C8           	iny
  4852 00:17DC: B7 20        	lda	[<L199+term_0],Y
  4853 00:17DE: D0 2B        	bne	L10254
  4854                        L229:
  4855                        ;							
                    // clear down to the bottom of screen (including cursor)
  4856                        ;							
                    _vt100_clearLines(term, term->cursor_y, VT100_HEIGHT); 
  4857 00:17E0: A0 07 00     	ldy	#$7
  4858 00:17E3: B7 20        	lda	[<L199+term_0],Y
  4859 00:17E5: 48           	pha
  4860 00:17E6: A0 27 00     	ldy	#$27
  4861 00:17E9: B7 20        	lda	[<L199+term_0],Y
  4862 00:17EB: 48           	pha
  4863 00:17EC: 80 12        	bra	L20181
  4864                        L20183:
  4865 00:17EE: C8           	iny
  4866 00:17EF: C8           	iny
  4867 00:17F0: B7 20        	lda	[<L199+term_0],Y
  4868 00:17F2: C9 01 00     	cmp	#<$1
  4869 00:17F5: D0 1E        	bne	L10256
  4870                        ;							
                    // clear top of screen to current line (including cursor)
  4871                        ;							
                    _vt100_clearLines(term, 0, term->cursor_y); 
  4872 00:17F7: A0 27 00     	ldy	#$27
  4873 00:17FA: B7 20        	lda	[<L199+term_0],Y
  4874 00:17FC: 48           	pha
  4875 00:17FD: F4 00 00     	pea	#<$0
  4876                        ;						} else i
                    f(term->narg == 1 && term->args[0] == 2){
  4877                        L20181:
  4878 00:1800: D4 22        	pei	<L199+term_0+2
  4879 00:1802: D4 20        	pei	<L199+term_0
  4880 00:1804: 22 xx xx xx  	jsl	~~_vt100_clearLines
  4881                        ;						} else i
                    f(term->narg == 1 && term->args[0] == 1){
  4882 00:1808: 82 5E FE     	brl	L10240
  4883                        L10254:
  4884 00:180B: A0 0B 08     	ldy	#$80b
  4885 00:180E: B7 20        	lda	[<L199+term_0],Y
  4886 00:1810: C9 01 00     	cmp	#<$1
  4887 00:1813: F0 D9        	beq	L20183
  4888                        L10256:
  4889 00:1815: A0 0B 08     	ldy	#$80b
  4890 00:1818: B7 20        	lda	[<L199+term_0],Y
  4891 00:181A: C9 01 00     	cmp	#<$1
  4892 00:181D: F0 03        	beq	*+5
  4893 00:181F: 82 47 FE     	brl	L10240
  4894 00:1822: C8           	iny
  4895 00:1823: C8           	iny
  4896 00:1824: B7 20        	lda	[<L199+term_0],Y
  4897 00:1826: C9 02 00     	cmp	#<$2
  4898 00:1829: F0 03        	beq	*+5
  4899 00:182B: 82 3B FE     	brl	L10240
  Wed Jan 19 2022 17:05                                                Page 92


  4900                        ;							
                    // clear whole screen
  4901                        ;							
                    _vt100_clearLines(term, 0, VT100_HEIGHT);
  4902 00:182E: A0 07 00     	ldy	#$7
  4903 00:1831: B7 20        	lda	[<L199+term_0],Y
  4904 00:1833: 48           	pha
  4905 00:1834: F4 00 00     	pea	#<$0
  4906 00:1837: D4 22        	pei	<L199+term_0+2
  4907 00:1839: D4 20        	pei	<L199+term_0
  4908 00:183B: 22 xx xx xx  	jsl	~~_vt100_clearLines
  4909                        ;							
                    // reset scroll value
  4910                        ;							
                    _vt100_resetScroll(term); 
  4911                        L20194:
  4912 00:183F: D4 22        	pei	<L199+term_0+2
  4913 00:1841: D4 20        	pei	<L199+term_0
  4914 00:1843: 22 xx xx xx  	jsl	~~_vt100_resetScroll
  4915                        ;						}
  4916                        ;						term->st
                    ate = _st_idle; 
  4917 00:1847: 82 1F FE     	brl	L10240
  4918                        ;						break;
  4919                        ;					}
  4920                        ;					case 'K':{// cle
                    ar line from cursor right/left
  4921                        L10259:
  4922                        ;						x = VT10
                    0_CURSOR_X(term);
  4923 00:184A: A0 25 00     	ldy	#$25
  4924 00:184D: B7 20        	lda	[<L199+term_0],Y
  4925 00:184F: 85 13        	sta	<L200+x_1
  4926                        ;						y = VT10
                    0_CURSOR_Y(term);
  4927 00:1851: D4 22        	pei	<L199+term_0+2
  4928 00:1853: D4 20        	pei	<L199+term_0
  4929 00:1855: 22 xx xx xx  	jsl	~~VT100_CURSOR_Y
  4930 00:1859: 85 15        	sta	<L200+y_1
  4931                        ;
  4932                        ;						if(term-
                    >narg == 0 || (term->narg == 1 && term->args[0] == 0)){
  4933 00:185B: A0 0B 08     	ldy	#$80b
  4934 00:185E: B7 20        	lda	[<L199+term_0],Y
  4935 00:1860: F0 0D        	beq	L237
  4936 00:1862: B7 20        	lda	[<L199+term_0],Y
  4937 00:1864: C9 01 00     	cmp	#<$1
  4938 00:1867: D0 1C        	bne	L10260
  4939 00:1869: C8           	iny
  4940 00:186A: C8           	iny
  4941 00:186B: B7 20        	lda	[<L199+term_0],Y
  4942 00:186D: D0 16        	bne	L10260
  4943                        L237:
  4944                        ;							
                    // clear to end of line (to \n or to edge?)
  4945                        ;							
                    // including cursor
  4946                        ;							
  Wed Jan 19 2022 17:05                                                Page 93


                    ili9340_fillRect(x, y, VT100_SCREEN_WIDTH - x, VT100_CHAR_HE
                    IGHT, term->back_color);
  4947 00:186F: A0 35 00     	ldy	#$35
  4948 00:1872: B7 20        	lda	[<L199+term_0],Y
  4949 00:1874: 48           	pha
  4950 00:1875: F4 01 00     	pea	#<$1
  4951 00:1878: 38           	sec
  4952 00:1879: A9 50 00     	lda	#$50
  4953 00:187C: E5 13        	sbc	<L200+x_1
  4954 00:187E: 48           	pha
  4955 00:187F: D4 15        	pei	<L200+y_1
  4956 00:1881: D4 13        	pei	<L200+x_1
  4957 00:1883: 80 4A        	bra	L20109
  4958                        ;						} else i
                    f(term->narg == 1 && term->args[0] == 1){
  4959                        L10260:
  4960 00:1885: A0 0B 08     	ldy	#$80b
  4961 00:1888: B7 20        	lda	[<L199+term_0],Y
  4962 00:188A: C9 01 00     	cmp	#<$1
  4963 00:188D: D0 16        	bne	L10262
  4964 00:188F: C8           	iny
  4965 00:1890: C8           	iny
  4966 00:1891: B7 20        	lda	[<L199+term_0],Y
  4967 00:1893: C9 01 00     	cmp	#<$1
  4968 00:1896: D0 0D        	bne	L10262
  4969                        ;							
                    // clear from left to current cursor position
  4970                        ;							
                    ili9340_fillRect(0, y, x + VT100_CHAR_WIDTH, VT100_CHAR_HEIG
                    HT, term->back_color);
  4971 00:1898: A0 35 00     	ldy	#$35
  4972 00:189B: B7 20        	lda	[<L199+term_0],Y
  4973 00:189D: 48           	pha
  4974 00:189E: F4 01 00     	pea	#<$1
  4975 00:18A1: D4 13        	pei	<L200+x_1
  4976 00:18A3: 80 25        	bra	L20115
  4977                        ;						} else i
                    f(term->narg == 1 && term->args[0] == 2){
  4978                        L10262:
  4979 00:18A5: A0 0B 08     	ldy	#$80b
  4980 00:18A8: B7 20        	lda	[<L199+term_0],Y
  4981 00:18AA: C9 01 00     	cmp	#<$1
  4982 00:18AD: F0 03        	beq	*+5
  4983 00:18AF: 82 B7 FD     	brl	L10240
  4984 00:18B2: C8           	iny
  4985 00:18B3: C8           	iny
  4986 00:18B4: B7 20        	lda	[<L199+term_0],Y
  4987 00:18B6: C9 02 00     	cmp	#<$2
  4988 00:18B9: F0 03        	beq	*+5
  4989 00:18BB: 82 AB FD     	brl	L10240
  4990                        ;							
                    // clear whole current line
  4991                        ;							
                    ili9340_fillRect(0, y, VT100_SCREEN_WIDTH, VT100_CHAR_HEIGHT
                    , term->back_color);
  4992 00:18BE: A0 35 00     	ldy	#$35
  4993 00:18C1: B7 20        	lda	[<L199+term_0],Y
  4994 00:18C3: 48           	pha
  Wed Jan 19 2022 17:05                                                Page 94


  4995 00:18C4: F4 01 00     	pea	#<$1
  4996 00:18C7: F4 50 00     	pea	#<$50
  4997                        L20115:
  4998 00:18CA: D4 15        	pei	<L200+y_1
  4999 00:18CC: F4 00 00     	pea	#<$0
  5000                        L20109:
  5001 00:18CF: 22 xx xx xx  	jsl	~~ili9340_fillRect
  5002                        ;						}
  5003                        ;						term->st
                    ate = _st_idle; 
  5004 00:18D3: 82 93 FD     	brl	L10240
  5005                        ;						break;
  5006                        ;					}
  5007                        ;					
  5008                        ;					case 'L': // ins
                    ert lines (args[0] = number of lines)
  5009                        ;					case 'M': // del
                    ete lines (args[0] = number of lines)
  5010                        ;						term->st
                    ate = _st_idle;
  5011                        ;						break; 
  5012                        ;					case 'P': {// de
                    lete characters args[0] or 1 in front of cursor
  5013                        L10267:
  5014                        ;						// TODO:
                     this needs to correctly delete n chars
  5015                        ;						n = ((te
                    rm->narg > 0)?term->args[0]:1);
  5016 00:18D6: A9 00 00     	lda	#$0
  5017 00:18D9: A0 0B 08     	ldy	#$80b
  5018 00:18DC: D7 20        	cmp	[<L199+term_0],Y
  5019 00:18DE: B0 06        	bcs	L245
  5020 00:18E0: C8           	iny
  5021 00:18E1: C8           	iny
  5022 00:18E2: B7 20        	lda	[<L199+term_0],Y
  5023 00:18E4: 80 03        	bra	L247
  5024                        L245:
  5025 00:18E6: A9 01 00     	lda	#$1
  5026                        L247:
  5027 00:18E9: 85 11        	sta	<L200+n_1
  5028                        ;						_vt100_m
                    ove(term, -n, 0);
  5029 00:18EB: F4 00 00     	pea	#<$0
  5030 00:18EE: 38           	sec
  5031 00:18EF: A9 00 00     	lda	#$0
  5032 00:18F2: E5 11        	sbc	<L200+n_1
  5033 00:18F4: 48           	pha
  5034 00:18F5: D4 22        	pei	<L199+term_0+2
  5035 00:18F7: D4 20        	pei	<L199+term_0
  5036 00:18F9: 22 xx xx xx  	jsl	~~_vt100_move
  5037                        ;						for(c = 
                    0; c < n; c++){
  5038 00:18FD: 64 1B        	stz	<L200+c_1
  5039 00:18FF: 80 0D        	bra	L10271
  5040                        L10270:
  5041                        ;							
                    _vt100_putc(term, ' ');
  5042 00:1901: F4 20 00     	pea	#<$20
  Wed Jan 19 2022 17:05                                                Page 95


  5043 00:1904: D4 22        	pei	<L199+term_0+2
  5044 00:1906: D4 20        	pei	<L199+term_0
  5045 00:1908: 22 xx xx xx  	jsl	~~_vt100_putc
  5046                        ;						}
  5047 00:190C: E6 1B        	inc	<L200+c_1
  5048                        L10271:
  5049 00:190E: A5 1B        	lda	<L200+c_1
  5050 00:1910: C5 11        	cmp	<L200+n_1
  5051 00:1912: 90 ED        	bcc	L10270
  5052                        ;						term->st
                    ate = _st_idle;
  5053 00:1914: 82 52 FD     	brl	L10240
  5054                        ;						break;
  5055                        ;					}
  5056                        ;					case 'c':{ // qu
                    ery device code
  5057                        L10272:
  5058                        ;						term->se
                    nd_response("\x1b[?1;0c"); 
  5059 00:1917: F4 xx xx     	pea	#^L192
  5060 00:191A: F4 xx xx     	pea	#<L192
  5061 00:191D: A0 1B 08     	ldy	#$81b
  5062 00:1920: B7 20        	lda	[<L199+term_0],Y
  5063 00:1922: AA           	tax
  5064 00:1923: 88           	dey
  5065 00:1924: 88           	dey
  5066 00:1925: B7 20        	lda	[<L199+term_0],Y
  5067                        	xref	~~~lcal
  5068 00:1927: 22 xx xx xx  	jsl	~~~lcal
  5069                        ;						term->st
                    ate = _st_idle; 
  5070 00:192B: 82 3B FD     	brl	L10240
  5071                        ;						break; 
  5072                        ;					}
  5073                        ;					case 'x': {
  5074                        ;						term->st
                    ate = _st_idle;
  5075                        ;						break;
  5076                        ;					}
  5077                        ;					case 's':{// sav
                    e cursor pos
  5078                        L10274:
  5079                        ;						term->sa
                    ved_cursor_x = term->cursor_x;
  5080 00:192E: A0 25 00     	ldy	#$25
  5081 00:1931: B7 20        	lda	[<L199+term_0],Y
  5082 00:1933: A0 29 00     	ldy	#$29
  5083 00:1936: 97 20        	sta	[<L199+term_0],Y
  5084                        ;						term->sa
                    ved_cursor_y = term->cursor_y;
  5085 00:1938: 88           	dey
  5086 00:1939: 88           	dey
  5087 00:193A: B7 20        	lda	[<L199+term_0],Y
  5088 00:193C: A0 2B 00     	ldy	#$2b
  5089                        ;						term->st
                    ate = _st_idle; 
  5090 00:193F: 82 25 FD     	brl	L20150
  5091                        ;						break;
  Wed Jan 19 2022 17:05                                                Page 96


  5092                        ;					}
  5093                        ;					case 'u':{// res
                    tore cursor pos
  5094                        L10275:
  5095                        ;						term->cu
                    rsor_x = term->saved_cursor_x;
  5096 00:1942: A0 29 00     	ldy	#$29
  5097 00:1945: B7 20        	lda	[<L199+term_0],Y
  5098 00:1947: A0 25 00     	ldy	#$25
  5099 00:194A: 97 20        	sta	[<L199+term_0],Y
  5100                        ;						term->cu
                    rsor_y = term->saved_cursor_y; 
  5101 00:194C: A0 2B 00     	ldy	#$2b
  5102                        ;						//_vt100
                    _moveCursor(term, term->saved_cursor_x, term->saved_cursor_y
                    );
  5103                        ;						term->st
                    ate = _st_idle; 
  5104 00:194F: 82 5F FD     	brl	L20191
  5105                        ;						break;
  5106                        ;					}
  5107                        ;					case 'h':
  5108                        ;					case 'l': {
  5109                        ;						term->st
                    ate = _st_idle;
  5110                        ;						break;
  5111                        ;					}
  5112                        ;					
  5113                        ;					case 'g': {
  5114                        ;						term->st
                    ate = _st_idle;
  5115                        ;						break;
  5116                        ;					}
  5117                        ;					case 'm': { // s
                    ets colors. Accepts up to 3 args
  5118                        L10279:
  5119                        ;						// [m me
                    ans reset the colors to default
  5120                        ;						if(!term
                    ->narg){
  5121 00:1952: A0 0B 08     	ldy	#$80b
  5122 00:1955: B7 20        	lda	[<L199+term_0],Y
  5123 00:1957: F0 03        	beq	*+5
  5124 00:1959: 82 B6 00     	brl	L10281
  5125                        ;							
                    term->front_color = 0xffff;
  5126 00:195C: A9 FF FF     	lda	#$ffff
  5127 00:195F: A0 33 00     	ldy	#$33
  5128 00:1962: 97 20        	sta	[<L199+term_0],Y
  5129                        ;							
                    term->back_color = 0x0000;
  5130 00:1964: A9 00 00     	lda	#$0
  5131 00:1967: C8           	iny
  5132 00:1968: C8           	iny
  5133 00:1969: 97 20        	sta	[<L199+term_0],Y
  5134                        ;						}
  5135                        ;						while(te
                    rm->narg){
  Wed Jan 19 2022 17:05                                                Page 97


  5136 00:196B: 82 A4 00     	brl	L10281
  5137                        L20110:
  5138                        ;							
                    term->narg--; 
  5139 00:196E: 18           	clc
  5140 00:196F: A9 FF FF     	lda	#$ffff
  5141 00:1972: A0 0B 08     	ldy	#$80b
  5142 00:1975: 77 20        	adc	[<L199+term_0],Y
  5143 00:1977: 97 20        	sta	[<L199+term_0],Y
  5144                        ;							
                    n = term->args[term->narg];
  5145 00:1979: 85 05        	sta	<R1
  5146 00:197B: 64 07        	stz	<R1+2
  5147 00:197D: D4 07        	pei	<R1+2
  5148 00:197F: D4 05        	pei	<R1
  5149 00:1981: A9 01 00     	lda	#$1
  5150                        	xref	~~~lasl
  5151 00:1984: 22 xx xx xx  	jsl	~~~lasl
  5152 00:1988: 85 01        	sta	<R0
  5153 00:198A: 86 03        	stx	<R0+2
  5154 00:198C: A9 0D 08     	lda	#$80d
  5155 00:198F: 18           	clc
  5156 00:1990: 65 20        	adc	<L199+term_0
  5157 00:1992: 85 09        	sta	<R2
  5158 00:1994: A9 00 00     	lda	#$0
  5159 00:1997: 65 22        	adc	<L199+term_0+2
  5160 00:1999: 85 0B        	sta	<R2+2
  5161 00:199B: A5 09        	lda	<R2
  5162 00:199D: 18           	clc
  5163 00:199E: 65 01        	adc	<R0
  5164 00:19A0: 85 0D        	sta	<R3
  5165 00:19A2: A5 0B        	lda	<R2+2
  5166 00:19A4: 65 03        	adc	<R0+2
  5167 00:19A6: 85 0F        	sta	<R3+2
  5168 00:19A8: A7 0D        	lda	[<R3]
  5169 00:19AA: 85 11        	sta	<L200+n_1
  5170                        ;							
                    if(n == 0){ // all attributes off
  5171 00:19AC: A5 11        	lda	<L200+n_1
  5172 00:19AE: D0 22        	bne	L10283
  5173                        ;							
                    	term->front_color = 0xffff;
  5174 00:19B0: A9 FF FF     	lda	#$ffff
  5175 00:19B3: A0 33 00     	ldy	#$33
  5176 00:19B6: 97 20        	sta	[<L199+term_0],Y
  5177                        ;							
                    	term->back_color = 0x0000;
  5178 00:19B8: A9 00 00     	lda	#$0
  5179 00:19BB: C8           	iny
  5180 00:19BC: C8           	iny
  5181 00:19BD: 97 20        	sta	[<L199+term_0],Y
  5182                        ;							
                    	
  5183                        ;							
                    	ili9340_setFrontColor(term->front_color);
  5184 00:19BF: 88           	dey
  5185 00:19C0: 88           	dey
  5186 00:19C1: B7 20        	lda	[<L199+term_0],Y
  Wed Jan 19 2022 17:05                                                Page 98


  5187 00:19C3: 48           	pha
  5188 00:19C4: 22 xx xx xx  	jsl	~~ili9340_setFrontColor
  5189                        ;							
                    	ili9340_setBackColor(term->back_color);
  5190 00:19C8: A0 35 00     	ldy	#$35
  5191 00:19CB: B7 20        	lda	[<L199+term_0],Y
  5192 00:19CD: 48           	pha
  5193 00:19CE: 22 xx xx xx  	jsl	~~ili9340_setBackColor
  5194                        ;							
                    }
  5195                        ;							
                    if(n >= 30 && n < 38){ // fg colors
  5196                        L10283:
  5197 00:19D2: A5 11        	lda	<L200+n_1
  5198 00:19D4: C9 1E 00     	cmp	#<$1e
  5199 00:19D7: 90 1A        	bcc	L10284
  5200 00:19D9: A5 11        	lda	<L200+n_1
  5201 00:19DB: C9 26 00     	cmp	#<$26
  5202 00:19DE: B0 13        	bcs	L10284
  5203                        ;							
                    	term->front_color = colors[n-30]; 
  5204 00:19E0: A5 11        	lda	<L200+n_1
  5205 00:19E2: 0A           	asl	A
  5206 00:19E3: AA           	tax
  5207 00:19E4: BD xx xx     	lda	|~~colors+65476,X
  5208 00:19E7: A0 33 00     	ldy	#$33
  5209 00:19EA: 97 20        	sta	[<L199+term_0],Y
  5210                        ;							
                    	ili9340_setFrontColor(term->front_color);
  5211 00:19EC: 48           	pha
  5212 00:19ED: 22 xx xx xx  	jsl	~~ili9340_setFrontColor
  5213                        ;							
                    } else if(n >= 40 && n < 48){
  5214 00:19F1: 80 1F        	bra	L10281
  5215                        L10284:
  5216 00:19F3: A5 11        	lda	<L200+n_1
  5217 00:19F5: C9 28 00     	cmp	#<$28
  5218 00:19F8: 90 18        	bcc	L10281
  5219 00:19FA: A5 11        	lda	<L200+n_1
  5220 00:19FC: C9 30 00     	cmp	#<$30
  5221 00:19FF: B0 11        	bcs	L10281
  5222                        ;							
                    	term->back_color = colors[n-40]; 
  5223 00:1A01: A5 11        	lda	<L200+n_1
  5224 00:1A03: 0A           	asl	A
  5225 00:1A04: AA           	tax
  5226 00:1A05: BD xx xx     	lda	|~~colors+65456,X
  5227 00:1A08: A0 35 00     	ldy	#$35
  5228 00:1A0B: 97 20        	sta	[<L199+term_0],Y
  5229                        ;							
                    	ili9340_setBackColor(term->back_color); 
  5230 00:1A0D: 48           	pha
  5231 00:1A0E: 22 xx xx xx  	jsl	~~ili9340_setBackColor
  5232                        ;							
                    }
  5233                        ;						}
  5234                        L10281:
  5235 00:1A12: A0 0B 08     	ldy	#$80b
  Wed Jan 19 2022 17:05                                                Page 99


  5236 00:1A15: B7 20        	lda	[<L199+term_0],Y
  5237 00:1A17: F0 03        	beq	*+5
  5238 00:1A19: 82 52 FF     	brl	L20110
  5239                        ;						term->st
                    ate = _st_idle; 
  5240 00:1A1C: 82 4A FC     	brl	L10240
  5241                        ;						break;
  5242                        ;					}
  5243                        ;					
  5244                        ;					case '@': // Ins
                    ert Characters          
  5245                        ;						term->st
                    ate = _st_idle;
  5246                        ;						break; 
  5247                        ;					case 'r': // Set
                     scroll region (top and bottom margins)
  5248                        L10288:
  5249                        ;						// the t
                    op value is first row of scroll region
  5250                        ;						// the b
                    ottom value is the first row of static region after scroll
  5251                        ;						if(term-
                    >narg == 2 && term->args[0] < term->args[1]){
  5252 00:1A1F: A0 0B 08     	ldy	#$80b
  5253 00:1A22: B7 20        	lda	[<L199+term_0],Y
  5254 00:1A24: C9 02 00     	cmp	#<$2
  5255 00:1A27: F0 03        	beq	*+5
  5256 00:1A29: 82 13 FE     	brl	L20194
  5257 00:1A2C: C8           	iny
  5258 00:1A2D: C8           	iny
  5259 00:1A2E: B7 20        	lda	[<L199+term_0],Y
  5260 00:1A30: C8           	iny
  5261 00:1A31: C8           	iny
  5262 00:1A32: D7 20        	cmp	[<L199+term_0],Y
  5263 00:1A34: 90 03        	bcc	*+5
  5264 00:1A36: 82 06 FE     	brl	L20194
  5265                        ;							
                    // [1;40r means scroll region between 8 and 312
  5266                        ;							
                    // bottom margin is 320 - (40 - 1) * 8 = 8 pix
  5267                        ;							
                    term->scroll_start_row = term->args[0] - 1;
  5268 00:1A39: 18           	clc
  5269 00:1A3A: A9 FF FF     	lda	#$ffff
  5270 00:1A3D: 88           	dey
  5271 00:1A3E: 88           	dey
  5272 00:1A3F: 77 20        	adc	[<L199+term_0],Y
  5273 00:1A41: A0 2D 00     	ldy	#$2d
  5274 00:1A44: 97 20        	sta	[<L199+term_0],Y
  5275                        ;							
                    term->scroll_end_row = term->args[1] - 1; 
  5276 00:1A46: 18           	clc
  5277 00:1A47: A9 FF FF     	lda	#$ffff
  5278 00:1A4A: A0 0F 08     	ldy	#$80f
  5279 00:1A4D: 77 20        	adc	[<L199+term_0],Y
  5280 00:1A4F: A0 2F 00     	ldy	#$2f
  5281 00:1A52: 97 20        	sta	[<L199+term_0],Y
  5282                        ;							
  Wed Jan 19 2022 17:05                                                Page 100


                    top_margin = term->scroll_start_row * VT100_CHAR_HEIGHT;
  5283 00:1A54: 88           	dey
  5284 00:1A55: 88           	dey
  5285 00:1A56: B7 20        	lda	[<L199+term_0],Y
  5286 00:1A58: 85 17        	sta	<L200+top_margin_1
  5287                        ;							
                    bottom_margin = VT100_SCREEN_HEIGHT -
  5288                        ;							
                    	(term->scroll_end_row * VT100_CHAR_HEIGHT); 
  5289 00:1A5A: 38           	sec
  5290 00:1A5B: A9 19 00     	lda	#$19
  5291 00:1A5E: C8           	iny
  5292 00:1A5F: C8           	iny
  5293 00:1A60: F7 20        	sbc	[<L199+term_0],Y
  5294 00:1A62: 85 19        	sta	<L200+bottom_margin_1
  5295                        ;							
                    ili9340_setScrollMargins(top_margin, bottom_margin);
  5296 00:1A64: 48           	pha
  5297 00:1A65: D4 17        	pei	<L200+top_margin_1
  5298 00:1A67: 22 xx xx xx  	jsl	~~ili9340_setScrollMargins
  5299                        ;							
                    //ili9340_setScrollStart(0); // reset scroll 
  5300                        ;						} else {
  5301 00:1A6B: 82 FB FB     	brl	L10240
  5302                        ;							
                    _vt100_resetScroll(term); 
  5303                        ;						}
  5304                        ;						term->st
                    ate = _st_idle; 
  5305                        ;						break;  
  5306                        ;					case 'i': // Pri
                    nting  
  5307                        ;					case 'y': // sel
                    f test modes..
  5308                        ;					case '=':{ // ar
                    gument follows... 
  5309                        ;						//term->
                    state = _st_screen_mode;
  5310                        ;						term->st
                    ate = _st_idle; 
  5311                        ;						break; 
  5312                        ;					}
  5313                        ;					case '?': // '[?
                    ' escape mode
  5314                        L10294:
  5315                        ;						term->st
                    ate = _st_esc_question;
  5316 00:1A6E: A9 xx xx     	lda	#<~~_st_esc_question
  5317 00:1A71: A0 15 08     	ldy	#$815
  5318 00:1A74: 97 20        	sta	[<L199+term_0],Y
  5319 00:1A76: A9 xx xx     	lda	#^~~_st_esc_question
  5320 00:1A79: 82 22 FB     	brl	L20113
  5321                        ;						break; 
  5322                        ;					default: { // un
                    known sequence
  5323                        ;						
  5324                        ;						term->st
                    ate = _st_idle;
  Wed Jan 19 2022 17:05                                                Page 101


  5325                        ;						break;
  5326                        L10233:
  5327 00:1A7C: A5 26        	lda	<L199+arg_0
  5328 00:1A7E: C9 3B 00     	cmp	#<$3b
  5329 00:1A81: F0 03        	beq	*+5
  5330 00:1A83: 82 20 FB     	brl	L20112
  5331                        ;					}
  5332                        ;				}
  5333                        ;				//term->state = _st_idle
                    ;
  5334                        ;			} // else
  5335                        ;			break;
  5336                        L258:
  5337 00:1A86: A5 1E        	lda	<L199+2
  5338 00:1A88: 85 26        	sta	<L199+2+8
  5339 00:1A8A: A5 1D        	lda	<L199+1
  5340 00:1A8C: 85 25        	sta	<L199+1+8
  5341 00:1A8E: 2B           	pld
  5342 00:1A8F: 3B           	tsc
  5343 00:1A90: 18           	clc
  5344 00:1A91: 69 24 00     	adc	#L199+8
  5345 00:1A94: 1B           	tcs
  5346 00:1A95: 6B           	rtl
  5347                        ;		}
  5348                        ;		default: { // switch (ev)
  5349                        ;			// for all other events restore 
                    normal mode
  5350                        ;			term->state = _st_idle; 
  5351                        ;		}
  5352                        ;	}
  5353                        ;}
  5354             0000001C   L199	equ	28
  5355             00000011   L200	equ	17
  5356                        	ends
  5357                        	efunc
  5358                        	data
  5359                        L192:
  5360 00:0120: 1B 5B 3F 31  	db	$1B,$5B,$3F,$31,$3B,$30,$63,$00
       00:0124: 3B 30 63 00 
  5361 00:0128:              	ends
  5362                        ;
  5363                        ;
  5364                        ;int main(int argv, char **s) {
  5365                        	code
  5366                        	xdef	~~main
  5367                        	func
  5368                        ~~main:
  5369                        	longa	on
  5370                        	longi	on
  5371 00:1A96: 3B           	tsc
  5372 00:1A97: 38           	sec
  5373 00:1A98: E9 06 00     	sbc	#L260
  5374 00:1A9B: 1B           	tcs
  5375 00:1A9C: 0B           	phd
  5376 00:1A9D: 5B           	tcd
  5377             00000004   argv_0	set	4
  5378             00000006   s_0	set	6
  5379                        ;	
  Wed Jan 19 2022 17:05                                                Page 102


  5380                        ;	int fd0, fd1, c;
  5381                        ;	
  5382                        ;	wins.anchor = NULL;
  5383             00000000   fd0_1	set	0
  5384             00000002   fd1_1	set	2
  5385             00000004   c_1	set	4
  5386 00:1A9E: 9C xx xx     	stz	|~~wins
  5387 00:1AA1: 9C xx xx     	stz	|~~wins+2
  5388                        ;	wins.maxFileDesc = FILEDESC;
  5389 00:1AA4: A9 64 00     	lda	#$64
  5390 00:1AA7: 8D xx xx     	sta	|~~wins+4
  5391                        ;	
  5392                        ;	fd0 = w_open("W:FD0,X01,Y02,W11,H10", 0);
  5393 00:1AAA: F4 00 00     	pea	#<$0
  5394 00:1AAD: F4 xx xx     	pea	#^L259
  5395 00:1AB0: F4 xx xx     	pea	#<L259
  5396 00:1AB3: 22 xx xx xx  	jsl	~~w_open
  5397 00:1AB7: 85 01        	sta	<L261+fd0_1
  5398                        ;	fd1 = w_open("W:FD1,X15,Y05,W40,H15", 0);
  5399 00:1AB9: F4 00 00     	pea	#<$0
  5400 00:1ABC: F4 xx xx     	pea	#^L259+22
  5401 00:1ABF: F4 xx xx     	pea	#<L259+22
  5402 00:1AC2: 22 xx xx xx  	jsl	~~w_open
  5403 00:1AC6: 85 03        	sta	<L261+fd1_1
  5404                        ;
  5405                        ;	w_write(fd0, "1234567890\x1b[B4567890", 20);
  5406 00:1AC8: F4 00 00     	pea	#^$14
  5407 00:1ACB: F4 14 00     	pea	#<$14
  5408 00:1ACE: F4 xx xx     	pea	#^L259+44
  5409 00:1AD1: F4 xx xx     	pea	#<L259+44
  5410 00:1AD4: D4 01        	pei	<L261+fd0_1
  5411 00:1AD6: 22 xx xx xx  	jsl	~~w_write
  5412                        ;	w_write(fd1, "1234567890123456789012345678901234
                    56789012345678901234567890", 60);
  5413 00:1ADA: F4 00 00     	pea	#^$3c
  5414 00:1ADD: F4 3C 00     	pea	#<$3c
  5415 00:1AE0: F4 xx xx     	pea	#^L259+65
  5416 00:1AE3: F4 xx xx     	pea	#<L259+65
  5417 00:1AE6: D4 03        	pei	<L261+fd1_1
  5418 00:1AE8: 22 xx xx xx  	jsl	~~w_write
  5419                        ;	
  5420                        ;	while(1) {
  5421                        L10297:
  5422                        ;		c = getchar();
  5423 00:1AEC: AD xx xx     	lda	|~~stdin+2
  5424 00:1AEF: 48           	pha
  5425 00:1AF0: AD xx xx     	lda	|~~stdin
  5426 00:1AF3: 48           	pha
  5427 00:1AF4: 22 xx xx xx  	jsl	~~fgetc
  5428 00:1AF8: 85 05        	sta	<L261+c_1
  5429                        ;		w_write(fd0, (char *)&c, 1);
  5430 00:1AFA: F4 00 00     	pea	#^$1
  5431 00:1AFD: F4 01 00     	pea	#<$1
  5432 00:1B00: F4 00 00     	pea	#0
  5433 00:1B03: 18           	clc
  5434 00:1B04: 7B           	tdc
  5435 00:1B05: 69 05 00     	adc	#<L261+c_1
  5436 00:1B08: 48           	pha
  Wed Jan 19 2022 17:05                                                Page 103


  5437 00:1B09: D4 01        	pei	<L261+fd0_1
  5438 00:1B0B: 22 xx xx xx  	jsl	~~w_write
  5439                        ;		if (c == 'X') break;
  5440 00:1B0F: A5 05        	lda	<L261+c_1
  5441 00:1B11: C9 58 00     	cmp	#<$58
  5442 00:1B14: D0 D6        	bne	L10297
  5443                        ;	}
  5444                        ;
  5445                        ;	getchar();	
  5446 00:1B16: AD xx xx     	lda	|~~stdin+2
  5447 00:1B19: 48           	pha
  5448 00:1B1A: AD xx xx     	lda	|~~stdin
  5449 00:1B1D: 48           	pha
  5450 00:1B1E: 22 xx xx xx  	jsl	~~fgetc
  5451                        ;	w_close(fd1);
  5452 00:1B22: D4 03        	pei	<L261+fd1_1
  5453 00:1B24: 22 xx xx xx  	jsl	~~w_close
  5454                        ;	getchar();
  5455 00:1B28: AD xx xx     	lda	|~~stdin+2
  5456 00:1B2B: 48           	pha
  5457 00:1B2C: AD xx xx     	lda	|~~stdin
  5458 00:1B2F: 48           	pha
  5459 00:1B30: 22 xx xx xx  	jsl	~~fgetc
  5460                        ;	w_close(fd0);
  5461 00:1B34: D4 01        	pei	<L261+fd0_1
  5462 00:1B36: 22 xx xx xx  	jsl	~~w_close
  5463                        ;	getchar();
  5464 00:1B3A: AD xx xx     	lda	|~~stdin+2
  5465 00:1B3D: 48           	pha
  5466 00:1B3E: AD xx xx     	lda	|~~stdin
  5467 00:1B41: 48           	pha
  5468 00:1B42: 22 xx xx xx  	jsl	~~fgetc
  5469                        ;	
  5470                        ;	printWindows();
  5471 00:1B46: 22 xx xx xx  	jsl	~~printWindows
  5472                        ;	return 0;
  5473 00:1B4A: A9 00 00     	lda	#$0
  5474 00:1B4D: A8           	tay
  5475 00:1B4E: A5 08        	lda	<L260+2
  5476 00:1B50: 85 0E        	sta	<L260+2+6
  5477 00:1B52: A5 07        	lda	<L260+1
  5478 00:1B54: 85 0D        	sta	<L260+1+6
  5479 00:1B56: 2B           	pld
  5480 00:1B57: 3B           	tsc
  5481 00:1B58: 18           	clc
  5482 00:1B59: 69 0C 00     	adc	#L260+6
  5483 00:1B5C: 1B           	tcs
  5484 00:1B5D: 98           	tya
  5485 00:1B5E: 6B           	rtl
  5486                        ;}
  5487             00000006   L260	equ	6
  5488             00000001   L261	equ	1
  5489                        	ends
  5490                        	efunc
  5491                        	data
  5492                        L259:
  5493 00:0128: 57 3A 46 44  	db	$57,$3A,$46,$44,$30,$2C,$58,$30,$31,$2C,
                    $59,$30,$32,$2C,$57
  Wed Jan 19 2022 17:05                                                Page 104


       00:012C: 30 2C 58 30 
       00:0130: 31 2C 59 30 
       00:0134: 32 2C 57 
  5494 00:0137: 31 31 2C 48  	db	$31,$31,$2C,$48,$31,$30,$00,$57,$3A,$46,
                    $44,$31,$2C,$58,$31
       00:013B: 31 30 00 57 
       00:013F: 3A 46 44 31 
       00:0143: 2C 58 31 
  5495 00:0146: 35 2C 59 30  	db	$35,$2C,$59,$30,$35,$2C,$57,$34,$30,$2C,
                    $48,$31,$35,$00,$31
       00:014A: 35 2C 57 34 
       00:014E: 30 2C 48 31 
       00:0152: 35 00 31 
  5496 00:0155: 32 33 34 35  	db	$32,$33,$34,$35,$36,$37,$38,$39,$30,$1B,
                    $5B,$42,$34,$35,$36
       00:0159: 36 37 38 39 
       00:015D: 30 1B 5B 42 
       00:0161: 34 35 36 
  5497 00:0164: 37 38 39 30  	db	$37,$38,$39,$30,$00,$31,$32,$33,$34,$35,
                    $36,$37,$38,$39,$30
       00:0168: 00 31 32 33 
       00:016C: 34 35 36 37 
       00:0170: 38 39 30 
  5498 00:0173: 31 32 33 34  	db	$31,$32,$33,$34,$35,$36,$37,$38,$39,$30,
                    $31,$32,$33,$34,$35
       00:0177: 35 36 37 38 
       00:017B: 39 30 31 32 
       00:017F: 33 34 35 
  5499 00:0182: 36 37 38 39  	db	$36,$37,$38,$39,$30,$31,$32,$33,$34,$35,
                    $36,$37,$38,$39,$30
       00:0186: 30 31 32 33 
       00:018A: 34 35 36 37 
       00:018E: 38 39 30 
  5500 00:0191: 31 32 33 34  	db	$31,$32,$33,$34,$35,$36,$37,$38,$39,$30,
                    $31,$32,$33,$34,$35
       00:0195: 35 36 37 38 
       00:0199: 39 30 31 32 
       00:019D: 33 34 35 
  5501 00:01A0: 36 37 38 39  	db	$36,$37,$38,$39,$30,$00
       00:01A4: 30 00 
  5502 00:01A6:              	ends
  5503                        ;
  5504                        	xref	~~isdigit
  5505                        	xref	~~debugf
  5506                        	xref	~~strlen
  5507                        	xref	~~memcpy
  5508                        	xref	~~memset
  5509                        	xref	~~memmove
  5510                        	xref	~~strcpy
  5511                        	xref	~~atoi
  5512                        	xref	~~free
  5513                        	xref	~~malloc
  5514                        	xref	~~fgetc
  5515                        	xref	~~printf
  5516                        	udata
  5517                        ~~wins
  5518 00:0000:              	ds	6
  5519 00:0006:              	ends
  Wed Jan 19 2022 17:05                                                Page 105


  5520                        	xref	~~stdin


      Lines assembled: 5520
      Errors: 0
